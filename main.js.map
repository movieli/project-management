{"version":3,"file":"main.js","sources":["node_modules/style-inject/dist/style-inject.es.js","src/views/progress.ts","src/views/timeline.ts","src/newProject.ts","src/newActionItem.ts","src/views/task_weeks.ts","src/views/resources.ts","node_modules/@kurkle/color/dist/color.esm.js","node_modules/chart.js/dist/chunks/helpers.dataset.js","node_modules/chart.js/dist/chart.js","src/views/dashboard.ts","src/views/today.ts","src/views/calendar.ts","src/views/portfolio.ts","src/services/cache.ts","settings.ts","src/main.ts"],"sourcesContent":["function styleInject(css, ref) {\r\n  if ( ref === void 0 ) ref = {};\r\n  var insertAt = ref.insertAt;\r\n\r\n  if (!css || typeof document === 'undefined') { return; }\r\n\r\n  var head = document.head || document.getElementsByTagName('head')[0];\r\n  var style = document.createElement('style');\r\n  style.type = 'text/css';\r\n\r\n  if (insertAt === 'top') {\r\n    if (head.firstChild) {\r\n      head.insertBefore(style, head.firstChild);\r\n    } else {\r\n      head.appendChild(style);\r\n    }\r\n  } else {\r\n    head.appendChild(style);\r\n  }\r\n\r\n  if (style.styleSheet) {\r\n    style.styleSheet.cssText = css;\r\n  } else {\r\n    style.appendChild(document.createTextNode(css));\r\n  }\r\n}\r\n\r\nexport default styleInject;\r\n","import {\r\n  ItemView,\r\n  WorkspaceLeaf,\r\n  setIcon,\r\n} from \"obsidian\";\r\nimport type { ViewStateResult } from \"obsidian\";\r\nimport { ProjectCache } from \"../services/cache\";\r\nimport { PmSettings } from \"../../settings\";\r\n\r\n// Load dashboard-specific stylesheet\r\nimport \"../../styles/styles-progress.css\";\r\n\r\n/** Helper: format a date or return an em-dash if undefined */\r\nfunction formatDate(d: string | number | Date | undefined): string {\r\n  if (!d) return \"—\";\r\n  return new Date(d).toLocaleDateString();\r\n}\r\n\r\n/** Helper: determine status badge label and CSS class\r\n *  If overrideOnTrack is true, and pct < 1 and not overdue, returns \"On track\"\r\n */\r\nfunction projectStatus(\r\n  nextDue?: string,\r\n  pct = 0,\r\n  overrideOnTrack: boolean = false\r\n): { label: string; cls: string } {\r\n  if (pct >= 1) return { label: \"Completed\", cls: \"complete\" };\r\n  if (!nextDue) {\r\n    // If overrideOnTrack is set, still allow \"On track\" if in progress\r\n    if (overrideOnTrack) return { label: \"On track\", cls: \"on-track\" };\r\n    return { label: \"No date\", cls: \"no-date\" };\r\n  }\r\n\r\n  const today   = new Date();\r\n  const due     = new Date(nextDue);\r\n  const msInDay = 86_400_000;\r\n  const diff    = (due.getTime() - today.getTime()) / msInDay;\r\n\r\n  if (diff < 0)  return { label: \"Off track\", cls: \"off-track\" }; // red\r\n  // If overrideOnTrack, and not overdue, force \"On track\"\r\n  if (overrideOnTrack) return { label: \"On track\", cls: \"on-track\" };\r\n  if (diff <= 10) return { label: \"Warning\",  cls: \"warning\"   }; // orange\r\n  return { label: \"On track\", cls: \"on-track\" };\r\n}\r\n\r\n/** Progress bar colour bucket */\r\nfunction progressClass(pct: number): string {\r\n  if (pct >= 100) return \"done\";\r\n  if (pct >= 75)  return \"high\";\r\n  if (pct >= 40)  return \"medium\";\r\n  return \"low\";\r\n}\r\n\r\n/** Tooltip explaining status (same logic as Task Weeks view) */\r\nfunction statusTooltip(nextDue?: string, pct = 0): string {\r\n  if (pct >= 1) return \"Task reached 100 % completion\";\r\n  if (!nextDue) return \"No due date set\";\r\n  const today   = new Date();\r\n  const due     = new Date(nextDue);\r\n  const msInDay = 86_400_000;\r\n  const diff    = Math.ceil((due.getTime() - today.getTime()) / msInDay);\r\n\r\n  if (diff < 0)  return `Past due by ${-diff} day${diff === -1 ? \"\" : \"s\"} (due ${formatDate(due)})`;\r\n  if (diff === 0) return \"Due today\";\r\n  if (diff <= 10) return `Due in ${diff} day${diff === 1 ? \"\" : \"s\"} (${formatDate(due)})`;\r\n  return `Due on ${formatDate(due)}`;\r\n}\r\n\r\n/** Detect whether a task is completed */\r\nfunction isTaskDone(t: any): boolean {\r\n  /* explicit flags from parsers */\r\n  if (t.done === true || t.checked === true) return true;\r\n  if (typeof t.done === \"string\" && t.done.toLowerCase() === \"done\") return true;\r\n\r\n  /* explicit status strings */\r\n  if (typeof t.status === \"string\") {\r\n    const s = t.status.toLowerCase();\r\n    if ([\"done\", \"complete\", \"completed\"].includes(s)) return true;\r\n  }\r\n\r\n  /* percent-complete field */\r\n  if (typeof t.percentComplete === \"number\" && t.percentComplete >= 1) return true;\r\n\r\n  /* markdown checkbox or bullet */\r\n  const raw = (t.raw ?? t.text ?? \"\").toString();\r\n  if (/^\\s*-\\s*\\[[xX]\\]/.test(raw)) return true;\r\n\r\n  /* completed:: 2025‑05‑01 inline field or front‑matter */\r\n  if (t.props?.completed || t.props?.[\"completionDate\"]) return true;\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Order tasks for the dashboard so that\r\n *   • Each Epic (E‑n) is followed by all Stories (S‑n) sharing the same number\r\n *   • Each Story (S‑n) is followed by SB‑tasks (SB‑n) sharing the same number\r\n *   • If no numeric match exists, fall back to “depends” links\r\n *   • Any remaining tasks keep their original relative order\r\n */\r\nfunction orderTasksDash(tasks: any[]): any[] {\r\n  const done = new Set<any>();\r\n  const out: any[] = [];\r\n\r\n  /* Extract the numeric “core” of an ID: E‑1 → 1, S‑2.3 → 2.3, SB‑007 → 007 */\r\n  const core = (id: string = \"\"): string =>\r\n    id.replace(/^[A-Za-z]+-?/, \"\").trim().toLowerCase();\r\n\r\n  /* Quick look‑ups by epic and story properties */\r\n  const storiesByEpic = new Map<string, any[]>();\r\n  const subsByStory = new Map<string, any[]>();\r\n\r\n  tasks.forEach((t) => {\r\n    const id = (t.id ?? \"\").toString();\r\n    \r\n    if (/^s\\b/i.test(id) && !/^sb\\b/i.test(id)) {\r\n      // Group stories by their epic property\r\n      const epicRef = (t.props?.epic ?? \"\").toString().trim().toLowerCase();\r\n      if (epicRef) {\r\n        (storiesByEpic.get(epicRef) ?? storiesByEpic.set(epicRef, []).get(epicRef)!).push(t);\r\n      }\r\n    } else if (/^sb\\b/i.test(id)) {\r\n      // Group subtasks by their story property\r\n      const storyRef = (t.props?.story ?? \"\").toString().trim().toLowerCase();\r\n      if (storyRef) {\r\n        (subsByStory.get(storyRef) ?? subsByStory.set(storyRef, []).get(storyRef)!).push(t);\r\n      }\r\n    }\r\n  });\r\n\r\n  /* Push a task and, if Epic/Story, its children */\r\n  const pushCascade = (t: any) => {\r\n    if (done.has(t)) return;\r\n    done.add(t);\r\n    out.push(t);\r\n\r\n    const id = (t.id ?? \"\").toString().toLowerCase();\r\n\r\n    if (/^e\\b/i.test(id)) {\r\n      /* Push Stories that belong to this epic */\r\n      const stories = storiesByEpic.get(id) ?? [];\r\n      stories.forEach(pushCascade);\r\n    }\r\n\r\n    if (/^s\\b/i.test(id) && !/^sb\\b/i.test(id)) {\r\n      /* Push SB‑tasks that belong to this story */\r\n      const subtasks = subsByStory.get(id) ?? [];\r\n      subtasks.forEach(pushCascade);\r\n    }\r\n  };\r\n\r\n  /* Pass 1: Epics first (and their cascades) */\r\n  tasks.forEach((t) => {\r\n    if (/^e\\b/i.test((t.id ?? \"\").toString())) pushCascade(t);\r\n  });\r\n\r\n  /* Pass 2: Stories not already output */\r\n  tasks.forEach((t) => {\r\n    const id = (t.id ?? \"\").toString();\r\n    if (done.has(t)) return;\r\n    if (/^s\\b/i.test(id) && !/^sb\\b/i.test(id)) pushCascade(t);\r\n  });\r\n\r\n  /* Pass 3: Remaining tasks in original order */\r\n  tasks.forEach((t) => {\r\n    if (!done.has(t)) {\r\n      done.add(t);\r\n      out.push(t);\r\n    }\r\n  });\r\n\r\n  return out;\r\n}\r\n\r\nexport const VIEW_TYPE_PM_PROGRESS = \"pm-progress-view\";\r\n\r\nexport class ProjectProgressView extends ItemView {\r\n  /** icon shown on the view tab */\r\n  public icon = \"bar-chart-2\";   // bar‑chart icon signals \"progress\"\r\n  /** Optional set of project file paths to display (injected by Portfolio view) */\r\n  private filterPaths?: Set<string>;\r\n  /** Optional name of the portfolio that opened this dashboard */\r\n  private filterName?: string;\r\n  private sortField: string | null = \"project\";\r\n  private sortAsc = true;\r\n  private collapsed = new Set<string>();\r\n  private firstRender = true;\r\n  private showEpics = true;                // show/hide epics\r\n  private showStories = true;              // show/hide stories\r\n  private showSubTasks = true;             // show/hide sub-tasks\r\n  private filterAssignees?: Set<string>;   // filtered assignees (undefined = all)\r\n  private originalPaths: string[] | null = null;  // The initial project paths passed in from Portfolio\r\n  private filterText = \"\";                 // live text in the quick-filter box\r\n\r\n  private cache: ProjectCache;\r\n  private settings: PmSettings;\r\n  private container!: HTMLElement;\r\n  private detachFn: (() => void) | null = null;\r\n\r\n  constructor(\r\n    leaf: WorkspaceLeaf,\r\n    cache: ProjectCache,\r\n    settings: PmSettings\r\n  ) {\r\n    super(leaf);\r\n    this.cache = cache;\r\n    this.settings = settings;\r\n  }\r\n\r\n  /** Called when leaf.setViewState({ state }) is invoked */\r\n  async setState(state: any, result: ViewStateResult): Promise<void> {\r\n    if (state?.filterProjects && Array.isArray(state.filterProjects)) {\r\n      this.filterPaths = new Set(state.filterProjects as string[]);\r\n      this.originalPaths = [...state.filterProjects];  // Store original paths for Portfolio filter\r\n    } else {\r\n      this.filterPaths = undefined;\r\n      this.originalPaths = null;\r\n    }\r\n    if (typeof state?.filterName === \"string\" && state.filterName.trim() !== \"\") {\r\n      this.filterName = state.filterName.trim();\r\n    } else {\r\n      this.filterName = undefined;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Allow Portfolio view to refresh the filter at runtime */\r\n  public updateFilter(paths: string[] | null, name?: string) {\r\n    if (paths === null) {\r\n      this.filterPaths = undefined;\r\n    } else {\r\n      this.filterPaths = new Set(paths);\r\n      // Update originalPaths if we're setting a specific filter\r\n      if (paths.length > 0 && name) {\r\n        this.originalPaths = [...paths];\r\n      }\r\n    }\r\n    this.filterName  = name;\r\n    this.render();\r\n  }\r\n\r\n  getViewType(): string {\r\n    return VIEW_TYPE_PM_PROGRESS;\r\n  }\r\n  getDisplayText(): string {\r\n    return this.filterName\r\n      ? `Progress – ${this.filterName}`\r\n      : \"Progress\";\r\n  }\r\n\r\n  async onOpen() {\r\n    this.container = this.contentEl;\r\n    this.render();\r\n    this.detachFn = this.cache.onChange(() => this.render());\r\n  }\r\n  async onClose() {\r\n    this.detachFn?.();\r\n  }\r\n\r\n  /** Returns true if every project row is collapsed */\r\n  private allCollapsed(): boolean {\r\n    return this.collapsed.size === this.cache.projects.size && this.cache.projects.size > 0;\r\n  }\r\n\r\n  /** Collapse or expand all projects at once */\r\n  private toggleAll() {\r\n    if (this.allCollapsed()) {\r\n      this.collapsed.clear();                 // expand everything\r\n    } else {\r\n      this.collapsed = new Set(\r\n        [...this.cache.projects.values()].map(p => p.file.path)\r\n      );                                       // collapse everything\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Toggle fold / unfold for one project and re-render */\r\n  private toggle(path: string) {\r\n    if (this.collapsed.has(path)) this.collapsed.delete(path);\r\n    else this.collapsed.add(path);\r\n    this.render();\r\n  }\r\n\r\n  private render() {\r\n    // Remove any lingering tooltips from previous interactions\r\n    document.querySelectorAll('.pm-dash-tooltip').forEach((el) => el.remove());\r\n    this.container.empty();\r\n    this.container.addClass(\"pm-progress-view\");\r\n\r\n    /* ── Fold/Unfold top bar ───────────────────────── */\r\n    const topbar = this.container.createEl(\"div\", { cls: \"pm-dash-topbar\" });\r\n    const globalCaret = topbar.createEl(\"span\");\r\n    setIcon(globalCaret, this.allCollapsed() ? \"chevron-right\" : \"chevron-down\");\r\n    globalCaret.style.cursor = \"pointer\";\r\n    globalCaret.onclick = () => this.toggleAll();\r\n    topbar.createEl(\"span\", { text: \"Projects\" });\r\n\r\n    /* Task filter input now lives in the top bar */\r\n    const searchInput = topbar.createEl(\"input\", {\r\n      type: \"search\",\r\n      placeholder: \"Filter tasks…\",\r\n      cls: \"pm-search-input\",\r\n      value: this.filterText,\r\n    });\r\n\r\n    searchInput.oninput = () => {\r\n      this.filterText = searchInput.value.toLowerCase();\r\n      const caretPos = searchInput.selectionStart ?? searchInput.value.length;\r\n      this.render();\r\n\r\n      const again = this.container.querySelector<HTMLInputElement>(\".pm-search-input\");\r\n      if (again) {\r\n        again.focus();\r\n        again.setSelectionRange(caretPos, caretPos);\r\n      }\r\n    };\r\n\r\n    /* ── Projects dropdown (checkbox list) ─────────────────── */\r\n    const projBtn = topbar.createEl(\"button\", { cls: \"pm-proj-btn\" });\r\n    /* Label */\r\n    projBtn.createSpan({ text: \"Projects \" });\r\n    /* Lucide chevron-down icon */\r\n    const caret = projBtn.createSpan();\r\n    setIcon(caret, \"chevron-down\");\r\n\r\n    let ddOpen = false;\r\n    let ddEl: HTMLElement | null = null;\r\n\r\n    const buildDropdown = (projectList: any[]) => {\r\n      ddEl = document.createElement(\"div\");\r\n      ddEl.className = \"pm-proj-dd\";\r\n\r\n      /* Select/Deselect controls */\r\n      const controls = ddEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n      /* ALL */\r\n      controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        this.updateFilter(null, this.filterName ?? \"\");\r\n      };\r\n\r\n      /* PORTFOLIO (only if originalPaths present) */\r\n      if (this.originalPaths && this.originalPaths.length) {\r\n        controls.createSpan({ text: \" | \" });\r\n        controls.createEl(\"a\", { text: this.filterName ?? \"Portfolio\" }).onclick = (e) => {\r\n          e.preventDefault();\r\n          this.updateFilter([...this.originalPaths!], this.filterName ?? \"\");\r\n        };\r\n      }\r\n\r\n      /* NONE */\r\n      controls.createSpan({ text: \" | \" });\r\n      controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        this.updateFilter([], this.filterName ?? \"\");\r\n      };\r\n\r\n      /* Checkbox list */\r\n      projectList.forEach((p: any) => {\r\n        const wrap = ddEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n        const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n        cb.style.cursor = \"pointer\";\r\n        cb.style.marginRight = \"8px\";\r\n        cb.style.display = \"inline-block\";\r\n        cb.style.width = \"16px\";\r\n        cb.style.height = \"16px\";\r\n        \r\n        const isChecked = !this.filterPaths || this.filterPaths.has(p.file.path);\r\n        setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n        \r\n        // Store the project path on the element for easy access\r\n        cb.setAttribute(\"data-project-path\", p.file.path);\r\n        cb.setAttribute(\"data-checked\", isChecked.toString());\r\n        \r\n        wrap.createSpan({ text: p.file.basename });\r\n        \r\n        wrap.onclick = () => {\r\n          const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n          const newChecked = !currentChecked;\r\n          \r\n          cb.setAttribute(\"data-checked\", newChecked.toString());\r\n          setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n          \r\n          /* gather all check icons to compute new filter */\r\n          const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\"));\r\n          const selected = checkIcons\r\n            .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n            .map(icon => icon.getAttribute(\"data-project-path\")!);\r\n\r\n          this.updateFilter(selected.length === projectList.length ? null : selected);\r\n        };\r\n      });\r\n\r\n      document.body.appendChild(ddEl);\r\n\r\n      /* Position dropdown and ensure it stays within the viewport */\r\n      const r   = projBtn.getBoundingClientRect();\r\n      const pad = 4;                           // minimal gap from window edges\r\n\r\n      let left = r.left;\r\n      let top  = r.bottom + pad;               // default: just below button\r\n\r\n      /* Measure after insertion */\r\n      const ddW = ddEl.offsetWidth  || 240;\r\n      const ddH = ddEl.offsetHeight || 260;\r\n\r\n      /* Prevent horizontal overflow */\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      } else if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      /* Prevent vertical overflow – if not enough space below, flip above;\r\n         if still too tall, clamp to bottom edge */\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        const above = r.top - ddH - pad;\r\n        top = above >= pad ? above\r\n                           : Math.max(window.innerHeight - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      ddEl.style.left = `${left}px`;\r\n      ddEl.style.top  = `${top}px`;\r\n    };\r\n\r\n    const closeDropdown = () => {\r\n      ddEl?.remove();\r\n      ddEl = null;\r\n      ddOpen = false;\r\n    };\r\n\r\n    projBtn.onclick = () => {\r\n      if (ddOpen) {\r\n        closeDropdown();\r\n        return;\r\n      }\r\n      ddOpen = true;\r\n\r\n      /* Build project list based on current cache + initial portfolio filter */\r\n      const projectList = Array.from(this.cache.projects.values())   // list every project\r\n        .sort((a, b) => a.file.basename.localeCompare(b.file.basename)); // sort A-Z\r\n      buildDropdown(projectList);\r\n\r\n      /* Close on outside click */\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (ddEl && !ddEl.contains(e.target as Node) && e.target !== projBtn) {\r\n          closeDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    /* ── Assignees dropdown (checkbox list) ─────────────────── */\r\n    const assigneesBtn = topbar.createEl(\"button\", { cls: \"pm-proj-btn\" });\r\n    /* Label */\r\n    assigneesBtn.createSpan({ text: \"Assignees \" });\r\n    /* Lucide chevron-down icon */\r\n    const assigneesCaret = assigneesBtn.createSpan();\r\n    setIcon(assigneesCaret, \"chevron-down\");\r\n\r\n    let assigneesDdOpen = false;\r\n    let assigneesDdEl: HTMLElement | null = null;\r\n\r\n    const buildAssigneesDropdown = (assigneesList: { id: string; name: string }[]) => {\r\n      assigneesDdEl = document.createElement(\"div\");\r\n      assigneesDdEl.className = \"pm-proj-dd\";\r\n\r\n      /* Select/Deselect controls */\r\n      const controls = assigneesDdEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n      /* ALL */\r\n      controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        this.filterAssignees = undefined;\r\n        this.render();\r\n      };\r\n\r\n      /* PORTFOLIO (only if originalPaths present) */\r\n      if (this.originalPaths && this.originalPaths.length) {\r\n        controls.createSpan({ text: \" | \" });\r\n        controls.createEl(\"a\", { text: this.filterName ?? \"Portfolio\" }).onclick = (e) => {\r\n          e.preventDefault();\r\n          // Filter assignees to only those who have tasks in the current portfolio projects\r\n          const portfolioAssignees = new Set<string>();\r\n          this.cache.projects.forEach((proj) => {\r\n            if (this.originalPaths!.includes(proj.file.path)) {\r\n              (proj as any).tasks?.forEach((t: any) => {\r\n                const raw = (t.assignee ?? t.props?.assignee ?? t.owner ?? t.props?.owner ?? \"Unassigned\").toString();\r\n                raw.split(\",\").forEach((s: string) => {\r\n                  const n = s.trim();\r\n                  if (n && n !== \"-\") {\r\n                    const cleaned = /^[-‑—–]+$/.test(n) ? \"Unassigned\" : n;\r\n                    portfolioAssignees.add(cleaned.toLowerCase());\r\n                  }\r\n                });\r\n              });\r\n            }\r\n          });\r\n          this.filterAssignees = portfolioAssignees.size > 0 ? portfolioAssignees : undefined;\r\n          this.render();\r\n        };\r\n      }\r\n\r\n      /* NONE */\r\n      controls.createSpan({ text: \" | \" });\r\n      controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        this.filterAssignees = new Set<string>();\r\n        this.render();\r\n      };\r\n\r\n      /* Checkbox list */\r\n      assigneesList.forEach((assignee) => {\r\n        const wrap = assigneesDdEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n        const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n        cb.style.cursor = \"pointer\";\r\n        cb.style.marginRight = \"8px\";\r\n        cb.style.display = \"inline-block\";\r\n        cb.style.width = \"16px\";\r\n        cb.style.height = \"16px\";\r\n        \r\n        const isChecked = !this.filterAssignees || this.filterAssignees.has(assignee.id);\r\n        setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n        \r\n        // Store the assignee id on the element for easy access\r\n        cb.setAttribute(\"data-assignee-id\", assignee.id);\r\n        cb.setAttribute(\"data-checked\", isChecked.toString());\r\n        \r\n        wrap.createSpan({ text: assignee.name });\r\n        \r\n        wrap.onclick = () => {\r\n          const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n          const newChecked = !currentChecked;\r\n          \r\n          cb.setAttribute(\"data-checked\", newChecked.toString());\r\n          setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n          \r\n          /* gather all check icons to compute new filter */\r\n          const checkIcons = Array.from(assigneesDdEl!.querySelectorAll(\".pm-dd-check\"));\r\n          const selected = checkIcons\r\n            .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n            .map(icon => icon.getAttribute(\"data-assignee-id\")!);\r\n\r\n          this.filterAssignees = selected.length === assigneesList.length ? undefined : new Set(selected);\r\n          this.render();\r\n        };\r\n      });\r\n\r\n      document.body.appendChild(assigneesDdEl);\r\n\r\n      /* Position dropdown and ensure it stays within the viewport */\r\n      const r   = assigneesBtn.getBoundingClientRect();\r\n      const pad = 4;                           // minimal gap from window edges\r\n\r\n      let left = r.left;\r\n      let top  = r.bottom + pad;               // default: just below button\r\n\r\n      /* Measure after insertion */\r\n      const ddW = assigneesDdEl.offsetWidth  || 240;\r\n      const ddH = assigneesDdEl.offsetHeight || 260;\r\n\r\n      /* Prevent horizontal overflow */\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      } else if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      /* Prevent vertical overflow – if not enough space below, flip above;\r\n         if still too tall, clamp to bottom edge */\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        const above = r.top - ddH - pad;\r\n        top = above >= pad ? above\r\n                           : Math.max(window.innerHeight - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      assigneesDdEl.style.left = `${left}px`;\r\n      assigneesDdEl.style.top  = `${top}px`;\r\n    };\r\n\r\n    const closeAssigneesDropdown = () => {\r\n      assigneesDdEl?.remove();\r\n      assigneesDdEl = null;\r\n      assigneesDdOpen = false;\r\n    };\r\n\r\n    assigneesBtn.onclick = () => {\r\n      if (assigneesDdOpen) {\r\n        closeAssigneesDropdown();\r\n        return;\r\n      }\r\n      assigneesDdOpen = true;\r\n\r\n      /* Build assignees list from current cache */\r\n      const assigneesMap = new Map<string, string>();\r\n      this.cache.projects.forEach((proj) => {\r\n        (proj as any).tasks?.forEach((t: any) => {\r\n          const raw = (t.assignee ?? t.props?.assignee ?? t.owner ?? t.props?.owner ?? \"Unassigned\").toString();\r\n          raw.split(\",\").forEach((s: string) => {\r\n            const n = s.trim();\r\n            if (n && n !== \"-\") {\r\n              const cleaned = /^[-‑—–]+$/.test(n) ? \"Unassigned\" : n;\r\n              assigneesMap.set(cleaned.toLowerCase(), cleaned);\r\n            }\r\n          });\r\n        });\r\n      });\r\n      if (assigneesMap.size === 0) assigneesMap.set(\"unassigned\", \"Unassigned\");\r\n      \r\n      const assigneesList = Array.from(assigneesMap.entries())\r\n        .map(([id, name]) => ({ id, name }))\r\n        .sort((a, b) => a.name.localeCompare(b.name)); // sort A-Z\r\n      \r\n      buildAssigneesDropdown(assigneesList);\r\n\r\n      /* Close on outside click */\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (assigneesDdEl && !assigneesDdEl.contains(e.target as Node) && e.target !== assigneesBtn) {\r\n          closeAssigneesDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    /* ── Epic, Story, and Sub-task visibility toggles ─────────────────── */\r\n    const epicIcon = topbar.createEl(\"span\", { cls: \"pm-toggle-icon\" });\r\n    epicIcon.style.marginLeft = \"16px\";\r\n    epicIcon.style.cursor = \"pointer\";\r\n    setIcon(epicIcon, \"crown\");\r\n    epicIcon.style.opacity = this.showEpics ? \"1\" : \"0.3\";\r\n    epicIcon.setAttr(\"aria-label\", this.showEpics ? \"Hide Epics\" : \"Show Epics\");\r\n    \r\n    // Epic icon tooltip\r\n    let epicTip: HTMLElement | null = null;\r\n    epicIcon.addEventListener(\"mouseenter\", () => {\r\n      if (epicTip) {\r\n        epicTip.remove();\r\n        epicTip = null;\r\n      }\r\n      epicTip = document.createElement(\"div\");\r\n      epicTip.classList.add(\"pm-dash-tooltip\");\r\n      epicTip.textContent = this.showEpics ? \"Hide Epics\" : \"Show Epics\";\r\n      document.body.appendChild(epicTip);\r\n      const r = epicIcon.getBoundingClientRect();\r\n      epicTip.style.left = `${r.left}px`;\r\n      epicTip.style.top = `${r.bottom + 6}px`;\r\n    });\r\n    epicIcon.addEventListener(\"mouseleave\", () => { \r\n      if (epicTip) {\r\n        epicTip.remove(); \r\n        epicTip = null; \r\n      }\r\n    });\r\n    \r\n    epicIcon.onclick = () => {\r\n      if (epicTip) {\r\n        epicTip.remove();\r\n        epicTip = null;\r\n      }\r\n      this.showEpics = !this.showEpics;\r\n      this.render();\r\n    };\r\n\r\n    const storyIcon = topbar.createEl(\"span\", { cls: \"pm-toggle-icon\" });\r\n    storyIcon.style.marginLeft = \"8px\";\r\n    storyIcon.style.cursor = \"pointer\";\r\n    setIcon(storyIcon, \"file-text\");\r\n    storyIcon.style.opacity = this.showStories ? \"1\" : \"0.3\";\r\n    storyIcon.setAttr(\"aria-label\", this.showStories ? \"Hide Stories\" : \"Show Stories\");\r\n    \r\n    // Story icon tooltip\r\n    let storyTip: HTMLElement | null = null;\r\n    storyIcon.addEventListener(\"mouseenter\", () => {\r\n      if (storyTip) {\r\n        storyTip.remove();\r\n        storyTip = null;\r\n      }\r\n      storyTip = document.createElement(\"div\");\r\n      storyTip.classList.add(\"pm-dash-tooltip\");\r\n      storyTip.textContent = this.showStories ? \"Hide Stories\" : \"Show Stories\";\r\n      document.body.appendChild(storyTip);\r\n      const r = storyIcon.getBoundingClientRect();\r\n      storyTip.style.left = `${r.left}px`;\r\n      storyTip.style.top = `${r.bottom + 6}px`;\r\n    });\r\n    storyIcon.addEventListener(\"mouseleave\", () => { \r\n      if (storyTip) {\r\n        storyTip.remove(); \r\n        storyTip = null; \r\n      }\r\n    });\r\n    \r\n    storyIcon.onclick = () => {\r\n      if (storyTip) {\r\n        storyTip.remove();\r\n        storyTip = null;\r\n      }\r\n      this.showStories = !this.showStories;\r\n      this.render();\r\n    };\r\n\r\n    const subTasksIcon = topbar.createEl(\"span\", { cls: \"pm-toggle-icon\" });\r\n    subTasksIcon.style.marginLeft = \"8px\";\r\n    subTasksIcon.style.cursor = \"pointer\";\r\n    setIcon(subTasksIcon, \"list\");\r\n    subTasksIcon.style.opacity = this.showSubTasks ? \"1\" : \"0.3\";\r\n    subTasksIcon.setAttr(\"aria-label\", this.showSubTasks ? \"Hide Sub-tasks\" : \"Show Sub-tasks\");\r\n    \r\n    // Sub-tasks icon tooltip\r\n    let subTasksTip: HTMLElement | null = null;\r\n    subTasksIcon.addEventListener(\"mouseenter\", () => {\r\n      if (subTasksTip) {\r\n        subTasksTip.remove();\r\n        subTasksTip = null;\r\n      }\r\n      subTasksTip = document.createElement(\"div\");\r\n      subTasksTip.classList.add(\"pm-dash-tooltip\");\r\n      subTasksTip.textContent = this.showSubTasks ? \"Hide Sub-tasks\" : \"Show Sub-tasks\";\r\n      document.body.appendChild(subTasksTip);\r\n      const r = subTasksIcon.getBoundingClientRect();\r\n      subTasksTip.style.left = `${r.left}px`;\r\n      subTasksTip.style.top = `${r.bottom + 6}px`;\r\n    });\r\n    subTasksIcon.addEventListener(\"mouseleave\", () => { \r\n      if (subTasksTip) {\r\n        subTasksTip.remove(); \r\n        subTasksTip = null; \r\n      }\r\n    });\r\n    \r\n    subTasksIcon.onclick = () => {\r\n      if (subTasksTip) {\r\n        subTasksTip.remove();\r\n        subTasksTip = null;\r\n      }\r\n      this.showSubTasks = !this.showSubTasks;\r\n      this.render();\r\n    };\r\n\r\n    /* ── Table + header ─────────────────────────────── */\r\n    const tableContainer = this.container.createEl(\"div\", { cls: \"pm-table-container\" });\r\n    const table = tableContainer.createEl(\"table\", { cls: \"pm-table\" });\r\n    /* Column widths: Project widest, Tasks & Status thinner */\r\n    const colgroup = table.createEl(\"colgroup\");\r\n    [\"56%\", \"12%\", \"6%\", \"6%\", \"10%\", \"10%\"].forEach((w) =>\r\n      colgroup.createEl(\"col\", { attr: { style: `width:${w}` } })\r\n    );\r\n    const thead = table.createEl(\"thead\");\r\n    const headerRow = thead.createEl(\"tr\");\r\n\r\n    const headers: [string, string][] = [\r\n      [\"project\", \"Project\"],\r\n      [\"progress\", \"Progress\"],\r\n      [\"tasks\", \"Tasks\"],\r\n      [\"status\", \"Status\"],\r\n      [\"nextDue\", \"Next Due\"],\r\n      [\"lastUpdated\", \"Last Updated\"],\r\n    ];\r\n\r\n    headers.forEach(([field, label]) => {\r\n      const th = headerRow.createEl(\"th\", { cls: \"pm-sortable\" });\r\n      th.style.cursor = \"pointer\";\r\n\r\n      /* Label text */\r\n      th.createSpan({ text: label });\r\n\r\n      /* Chevron icon */\r\n      const ico = th.createSpan({ cls: \"pm-sort-ico\" });\r\n\r\n      if (this.sortField === field) {\r\n        setIcon(ico, this.sortAsc ? \"chevron-up\" : \"chevron-down\");\r\n      } else {\r\n        setIcon(ico, \"chevrons-up-down\");\r\n        ico.style.opacity = \"0.5\";        /* dim when inactive */\r\n      }\r\n\r\n      th.onclick = () => {\r\n        if (this.sortField === field) this.sortAsc = !this.sortAsc;\r\n        else {\r\n          this.sortField = field;\r\n          this.sortAsc = true;\r\n        }\r\n        this.render();\r\n      };\r\n    });\r\n\r\n    const tbody = table.createEl(\"tbody\");\r\n\r\n    /* Helper: custom tooltip for Status cells */\r\n    const attachStatusPopup = (cell: HTMLElement, msg: string) => {\r\n      let tip: HTMLElement | null = null;\r\n      cell.addEventListener(\"mouseenter\", (ev) => {\r\n        const mouse = ev as MouseEvent;\r\n        tip = document.createElement(\"div\");\r\n        tip.className = \"pm-dash-tooltip\";\r\n        tip.textContent = msg;\r\n        document.body.appendChild(tip);\r\n\r\n        const pad = 8;\r\n        const w   = tip.offsetWidth  || 140;\r\n        const h   = tip.offsetHeight || 40;\r\n\r\n        /* default position: bottom‑right of pointer */\r\n        let left = mouse.clientX + pad;\r\n        let top  = mouse.clientY + pad;\r\n\r\n        if (left + w > window.innerWidth - pad) left = mouse.clientX - w - pad;\r\n        if (top  + h > window.innerHeight - pad) top  = mouse.clientY - h - pad;\r\n        if (left < pad) left = pad;\r\n        if (top  < pad) top  = pad;\r\n\r\n        tip.style.left = `${left}px`;\r\n        tip.style.top  = `${top}px`;\r\n      });\r\n      cell.addEventListener(\"mouseleave\", () => { tip?.remove(); tip = null; });\r\n    };\r\n\r\n    /* ── Sort projects ─────────────────────────────── */\r\n    let projects = Array.from(this.cache.projects.values()).filter(\r\n      (p) => !this.filterPaths || this.filterPaths.has(p.file.path)\r\n    );\r\n\r\n    /* Apply assignee filter */\r\n    if (this.filterAssignees) {\r\n      projects = projects.filter(p => {\r\n        // Check if any task in this project has an assignee that matches the filter\r\n        return (p as any).tasks?.some((t: any) => {\r\n          const raw = (t.assignee ?? t.props?.assignee ?? t.owner ?? t.props?.owner ?? \"Unassigned\").toString();\r\n          const assignees = raw.split(\",\").map((s: string) => s.trim().toLowerCase());\r\n          return assignees.some((assignee: string) => this.filterAssignees!.has(assignee));\r\n        });\r\n      });\r\n    }\r\n\r\n    // Auto‑collapse only on the very first render; afterwards respect user toggles\r\n    if (this.firstRender) {\r\n      this.collapsed = new Set(projects.map(p => p.file.path));\r\n      this.firstRender = false;\r\n    }\r\n    \r\n    if (this.sortField) {\r\n      const dir = this.sortAsc ? 1 : -1;\r\n      const statusRank = (p: typeof projects[number]) => {\r\n        const { label } = projectStatus(p.nextDue, p.percentComplete);\r\n        return [\"Off track\", \"Warning\", \"On track\", \"Completed\", \"No date\"].indexOf(\r\n          label\r\n        );\r\n      };\r\n\r\n      projects.sort((a, b) => {\r\n        switch (this.sortField) {\r\n          case \"project\":\r\n            return a.file.basename.localeCompare(b.file.basename) * dir;\r\n          case \"progress\":\r\n            return (a.percentComplete - b.percentComplete) * dir;\r\n          case \"tasks\":\r\n            const ratio = (p: typeof a) =>\r\n              (p.completedTasks ?? 0) / Math.max(p.totalTasks ?? 1, 1);\r\n            return (ratio(a) - ratio(b)) * dir;\r\n          case \"status\":\r\n            return (statusRank(a) - statusRank(b)) * dir;\r\n          case \"nextDue\": {\r\n            const dv = (d?: string) =>\r\n              d ? new Date(d).getTime() : Number.POSITIVE_INFINITY;\r\n            return (dv(a.nextDue) - dv(b.nextDue)) * dir;\r\n          }\r\n          case \"lastUpdated\":\r\n            return (\r\n              ((a.file.stat?.mtime ?? 0) - (b.file.stat?.mtime ?? 0)) * dir\r\n            );\r\n          default:\r\n            return 0;\r\n        }\r\n      });\r\n    }\r\n\r\n    /* ── Project rows ─────────────────────────────── */\r\n    for (const project of projects) {\r\n      /* ── Evaluate filters *before* rendering this project ── */\r\n      const matchesFilter = this.filterText\r\n        ? (project.tasks as any[]).some(t => {\r\n            const hay = `${t.text ?? \"\"} ${(t.id ?? \"\")}`.toLowerCase();\r\n            return hay.includes(this.filterText);\r\n          })\r\n        : true;                                   // no quick‑filter ⇒ match\r\n\r\n      /* Auto‑expand only when a quick‑filter is active *and* this project matches it */\r\n      const autoExpand = this.filterText && matchesFilter;\r\n\r\n      const row = tbody.createEl(\"tr\", { cls: \"pm-project-row\" });\r\n      const isCollapsed = this.collapsed.has(project.file.path) && !autoExpand;\r\n\r\n      /* Name + caret */\r\n      const nameCell = row.createEl(\"td\", { cls: \"pm-dash-name\" });\r\n      const caret = nameCell.createEl(\"span\");\r\n      setIcon(caret, isCollapsed ? \"chevron-right\" : \"chevron-down\");\r\n      caret.style.marginRight = \"4px\";\r\n      caret.style.cursor = \"pointer\";\r\n      caret.onclick = (e) => {\r\n        e.stopPropagation();\r\n        this.toggle(project.file.path);\r\n      };\r\n\r\n      const projLink = nameCell.createEl(\"a\", {\r\n        text: project.file.basename,\r\n        href: project.file.path,\r\n      });\r\n      projLink.style.cursor = \"pointer\";\r\n\r\n      projLink.onclick = (e) => {\r\n        e.preventDefault();\r\n        this.app.workspace.openLinkText(project.file.path, \"\", false);\r\n      };\r\n\r\n      /* ── Hover tooltip with project front‑matter ────────────────────── */\r\n      let projHover: HTMLElement | null = null;\r\n\r\n      projLink.addEventListener(\"mouseenter\", () => {\r\n        /* Get latest front‑matter */\r\n        const cache = this.app.metadataCache.getFileCache(project.file);\r\n        const fm: Record<string, any> = cache?.frontmatter ?? {};\r\n\r\n        const val = (k: string) =>\r\n          fm[k] ?? fm[k.replace(/ /g, \"\").toLowerCase()] ?? \"—\";\r\n\r\n        const html = `\r\n          <strong>${project.file.basename}</strong><br>\r\n          <em>${val(\"Description\")}</em><br>\r\n          <span>Start: ${val(\"Start Date\")}</span><br>\r\n          <span>Due  : ${val(\"End Date\") || val(\"Due Date\")}</span>\r\n        `;\r\n\r\n        projHover = document.createElement(\"div\");\r\n        projHover.className = \"pm-dash-tooltip\";\r\n        projHover.innerHTML = html;\r\n        document.body.appendChild(projHover);\r\n\r\n        const r = projLink.getBoundingClientRect();\r\n        projHover.style.left = `${r.right + 8}px`;\r\n        projHover.style.top  = `${r.top}px`;\r\n      });\r\n\r\n      projLink.addEventListener(\"mouseleave\", () => {\r\n        projHover?.remove();\r\n        projHover = null;\r\n      });\r\n\r\n      /* Tally only SB‑sub‑tasks at the project level */\r\n      let totalTasks: number;\r\n      let doneTasks:  number;\r\n      if (Array.isArray((project as any).tasks)) {\r\n        const projTasks: any[] = (project as any).tasks.filter((t: any) => {\r\n          const id = ((t.id ?? \"\") as string).toUpperCase();\r\n          return id.startsWith(\"SB\");\r\n        });\r\n        totalTasks = projTasks.length;\r\n        doneTasks  = projTasks.filter(isTaskDone).length;\r\n      } else {\r\n        totalTasks = (project as any).totalTasks ?? 0;        // legacy cache fields\r\n        doneTasks  = (project as any).completedTasks ?? 0;\r\n      }\r\n\r\n      /* Progress bar — derive from task tally */\r\n      const progCell = row.createEl(\"td\");\r\n\r\n      const pctNum =\r\n        totalTasks === 0 ? 0 : Math.round((doneTasks / totalTasks) * 100);\r\n\r\n      const outer = progCell.createEl(\"div\", {\r\n        cls: `pm-progress ${progressClass(pctNum)}`,\r\n      });\r\n      outer.createEl(\"div\", {\r\n        cls: `pm-progress-inner ${progressClass(pctNum)}`,\r\n        attr: { style: `width:${pctNum}%` },\r\n      });\r\n      progCell.createEl(\"span\", {       // ← add label below bar\r\n        cls: \"pm-progress-percent\",\r\n        text: `${pctNum}%`,\r\n      });\r\n\r\n      /* Tasks ✓/total */\r\n      row.createEl(\"td\", {\r\n        text: `${doneTasks} / ${totalTasks}`,\r\n      });\r\n\r\n      /* Status */\r\n      const { label, cls } = projectStatus(\r\n        project.nextDue,\r\n        pctNum / 100      // 1 ⇒ “Completed”\r\n      );\r\n      const stTd = row.createEl(\"td\");\r\n      stTd.createEl(\"span\", { cls: `pm-badge ${cls}`, text: label });\r\n      attachStatusPopup(stTd, statusTooltip(project.nextDue, pctNum / 100));\r\n\r\n      /* Dates */\r\n      row.createEl(\"td\", { text: formatDate(project.nextDue) });\r\n      row.createEl(\"td\", { text: formatDate(project.file.stat?.mtime) });\r\n\r\n      /* ── Task sub-rows ─────────────────────────── */\r\n      if (!isCollapsed && Array.isArray((project as any).tasks)) {\r\n        /* Sort tasks: Epics (E-) first, then Stories (S-), then Sub‑tasks (SB‑/others) */\r\n        const tasks: any[] = orderTasksDash((project as any).tasks as any[]);\r\n        /* Track which Epic and Story headers we've already inserted */\r\n        const renderedEpics   = new Set<string>();\r\n        const renderedStories = new Set<string>();\r\n        for (const t of tasks) {\r\n          /* ── Skip tasks based on visibility settings ─────────────────── */\r\n          const idU = ((t as any).id ?? \"\").toUpperCase();\r\n          const isEpic = idU.startsWith(\"E\");\r\n          const isStory = idU.startsWith(\"S\") && !idU.startsWith(\"SB\");\r\n          const isSubTask = idU.startsWith(\"SB\");\r\n          \r\n          if (isEpic && !this.showEpics) continue;\r\n          if (isStory && !this.showStories) continue;\r\n          if (isSubTask && !this.showSubTasks) continue;\r\n\r\n          /* Skip tasks that don't match filter */\r\n          if (this.filterText) {\r\n            const hay = `${t.text ?? \"\"} ${(t.id ?? \"\")}`.toLowerCase();\r\n            if (!hay.includes(this.filterText)) continue;\r\n          }\r\n\r\n          /* ── Group headings (insert once per Epic / Story) ─────────────────── */\r\n\r\n          if (isEpic && !renderedEpics.has(idU)) {\r\n            renderedEpics.add(idU);\r\n            const epicHead  = tbody.createEl(\"tr\", { cls: \"pm-epic-header\" });\r\n            const epicCell  = epicHead.createEl(\"td\", { attr: { colspan: 6 } });\r\n            epicCell.style.paddingLeft = \"20px\";\r\n\r\n            /* Anchor link (same behaviour as task rows) */\r\n            const epicLink = epicCell.createEl(\"a\", {\r\n              text: `${idU}  ${t.text ?? \"(untitled)\"}`,\r\n              href: (t as any).file?.path ?? \"\",\r\n            });\r\n            epicLink.style.cursor = \"pointer\";\r\n            epicLink.onclick = (e) => {\r\n              e.preventDefault();\r\n              const filePath = (t as any).file?.path;\r\n              if (filePath) this.app.workspace.openLinkText(filePath, \"\", false);\r\n            };\r\n\r\n            /* Tooltip – reuse same logic as task anchor */\r\n            let epicTip: HTMLElement | null = null;\r\n            epicLink.addEventListener(\"mouseenter\", () => {\r\n              const props = (t as any).props ?? {};\r\n              const val = (k: string) => props[k] ?? props[k.toLowerCase()] ?? \"—\";\r\n\r\n              const html = `\r\n                <strong>${idU}  ${(t.text ?? \"(untitled)\")}</strong><br>\r\n                <em>${val(\"description\") || (t.description ?? \"\").toString().trim() || \"—\"}</em><br>\r\n                <span>Start: ${val(\"start\")}</span><br>\r\n                <span>Due  : ${val(\"due\") || val(\"end\")}</span><br>\r\n                <span>Assignee: ${val(\"assignee\") || val(\"owner\") || (t.assignee ?? t.owner ?? \"—\")}</span>\r\n              `;\r\n\r\n              epicTip = document.createElement(\"div\");\r\n              epicTip.className = \"pm-dash-tooltip\";\r\n              epicTip.innerHTML = html;\r\n              document.body.appendChild(epicTip);\r\n\r\n              const r   = epicLink.getBoundingClientRect();\r\n              const pad = 8;\r\n              let left  = r.right + 8;\r\n              let top   = r.top;\r\n\r\n              const tipW = epicTip.offsetWidth  || 220;\r\n              const tipH = epicTip.offsetHeight || 140;\r\n\r\n              if (left + tipW > window.innerWidth - pad) left = Math.max(r.left - tipW - 8, pad);\r\n              if (top  + tipH > window.innerHeight - pad) top  = Math.max(window.innerHeight - tipH - pad, pad);\r\n\r\n              epicTip.style.left = `${left}px`;\r\n              epicTip.style.top  = `${top}px`;\r\n            });\r\n            epicLink.addEventListener(\"mouseleave\", () => {\r\n              epicTip?.remove();\r\n              epicTip = null;\r\n            });\r\n          }\r\n\r\n          if (isStory && !renderedStories.has(idU)) {\r\n            renderedStories.add(idU);\r\n            const storyHead = tbody.createEl(\"tr\", { cls: \"pm-story-header\" });\r\n            const storyCell = storyHead.createEl(\"td\", { attr: { colspan: 6 } });\r\n            storyCell.style.paddingLeft = \"32px\";\r\n\r\n            /* Anchor link (same behaviour as task rows) */\r\n            const storyLink = storyCell.createEl(\"a\", {\r\n              text: `${idU}  ${t.text ?? \"(untitled)\"}`,\r\n              href: (t as any).file?.path ?? \"\",\r\n            });\r\n            storyLink.style.cursor = \"pointer\";\r\n            storyLink.onclick = (e) => {\r\n              e.preventDefault();\r\n              const filePath = (t as any).file?.path;\r\n              if (filePath) this.app.workspace.openLinkText(filePath, \"\", false);\r\n            };\r\n\r\n            /* Tooltip – identical to task anchor */\r\n            let storyTip: HTMLElement | null = null;\r\n            storyLink.addEventListener(\"mouseenter\", () => {\r\n              const props = (t as any).props ?? {};\r\n              const val = (k: string) => props[k] ?? props[k.toLowerCase()] ?? \"—\";\r\n\r\n              const html = `\r\n                <strong>${idU}  ${(t.text ?? \"(untitled)\")}</strong><br>\r\n                <em>${val(\"description\") || (t.description ?? \"\").toString().trim() || \"—\"}</em><br>\r\n                <span>Start: ${val(\"start\")}</span><br>\r\n                <span>Due  : ${val(\"due\") || val(\"end\")}</span><br>\r\n                <span>Assignee: ${val(\"assignee\") || val(\"owner\") || (t.assignee ?? t.owner ?? \"—\")}</span>\r\n              `;\r\n\r\n              storyTip = document.createElement(\"div\");\r\n              storyTip.className = \"pm-dash-tooltip\";\r\n              storyTip.innerHTML = html;\r\n              document.body.appendChild(storyTip);\r\n\r\n              const r   = storyLink.getBoundingClientRect();\r\n              const pad = 8;\r\n              let left  = r.right + 8;\r\n              let top   = r.top;\r\n\r\n              const tipW = storyTip.offsetWidth  || 220;\r\n              const tipH = storyTip.offsetHeight || 140;\r\n\r\n              if (left + tipW > window.innerWidth - pad) left = Math.max(r.left - tipW - 8, pad);\r\n              if (top  + tipH > window.innerHeight - pad) top  = Math.max(window.innerHeight - tipH - pad, pad);\r\n\r\n              storyTip.style.left = `${left}px`;\r\n              storyTip.style.top  = `${top}px`;\r\n            });\r\n            storyLink.addEventListener(\"mouseleave\", () => {\r\n              storyTip?.remove();\r\n              storyTip = null;\r\n            });\r\n          }\r\n          /* After inserting its group header, skip rendering a duplicate detail row\r\n             for this Epic or Story itself. */\r\n          if (isEpic || isStory) continue;\r\n          /* ───────────────────────────────────────────────────────── */\r\n\r\n          const tRow = tbody.createEl(\"tr\", { cls: \"pm-task-row\" });\r\n\r\n          /* Task name (clickable link) */\r\n          const tName = tRow.createEl(\"td\", { cls: \"pm-task-name\" });\r\n\r\n          const idTag = ((t as any).id ?? \"\").toUpperCase();\r\n          const indentLevel =\r\n            idTag.startsWith(\"E\") ? 0 :                     // Epics\r\n            (idTag.startsWith(\"S\") && !idTag.startsWith(\"SB\")) ? 1 : 2;  // Stories vs. SB-tasks\r\n\r\n          /* 20 px base + 12 px per indent level */\r\n          tName.style.paddingLeft = `${20 + indentLevel * 12}px`;\r\n\r\n          /* Determine completion */\r\n          let done = isTaskDone(t);\r\n\r\n          /* Bullet or check icon depending on completion */\r\n          if (done) {\r\n            const chk = tName.createEl(\"span\");\r\n            setIcon(chk, \"check-circle\");\r\n            chk.addClass(\"pm-task-check\");\r\n            chk.style.marginRight = \"4px\";\r\n          } else {\r\n            tName.createEl(\"span\", { text: \"• \", cls: \"pm-task-bullet\" });\r\n          }\r\n\r\n          /* Show ID prefix (E‑, S‑, SB‑) before the task name */\r\n          const prefix = (() => {\r\n            const id: string = (t as any).id ?? \"\";\r\n            if (!id) return \"\";\r\n            const match = id.match(/^(E|SB?|S)-?\\d+/i); // captures E‑, S‑, SB‑\r\n            return match ? `${match[0].toUpperCase()} ` : \"\";\r\n          })();\r\n\r\n          const anchor = tName.createEl(\"a\", {\r\n            text: `${prefix}${t.text ?? \"(untitled)\"}`,\r\n            href: (t as any).file?.path ?? \"\",\r\n          });\r\n\r\n          /* ── Hover tooltip for task meta ─────────────────────────── */\r\n          let hoverTip: HTMLElement | null = null;\r\n\r\n          anchor.addEventListener(\"mouseenter\", () => {\r\n            const props = (t as any).props ?? {};\r\n            const val = (k: string) => props[k] ?? props[k.toLowerCase()] ?? \"—\";\r\n\r\n            const html = `\r\n              <strong>${prefix}${t.text ?? \"(untitled)\"}</strong><br>\r\n              <em>${val(\"description\") || (t.description ?? \"\").toString().trim() || \"—\"}</em><br>\r\n              <span>Start: ${val(\"start\")}</span><br>\r\n              <span>Due  : ${val(\"due\") || val(\"end\")}</span><br>\r\n              <span>Assignee: ${val(\"assignee\") || val(\"owner\") || (t.assignee ?? t.owner ?? \"—\")}</span>\r\n            `;\r\n\r\n            hoverTip = document.createElement(\"div\");\r\n            hoverTip.className = \"pm-dash-tooltip\";\r\n            hoverTip.innerHTML = html;\r\n            document.body.appendChild(hoverTip);\r\n\r\n            const r   = anchor.getBoundingClientRect();\r\n            const pad = 8;                               // minimum gap from edges\r\n\r\n            /* Default position: to the right of the task anchor */\r\n            let left = r.right + 8;\r\n            let top  = r.top;\r\n\r\n            /* Measure tooltip after it’s in the DOM */\r\n            const tipW = hoverTip.offsetWidth  || 220;    // fallback width\r\n            const tipH = hoverTip.offsetHeight || 140;    // fallback height\r\n\r\n            /* Prevent horizontal overflow – if not enough room on the right,\r\n               flip to the left of the anchor */\r\n            if (left + tipW > window.innerWidth - pad) {\r\n              left = Math.max(r.left - tipW - 8, pad);\r\n            }\r\n\r\n            /* Prevent vertical overflow – clamp inside viewport */\r\n            if (top + tipH > window.innerHeight - pad) {\r\n              top = Math.max(window.innerHeight - tipH - pad, pad);\r\n            }\r\n\r\n            hoverTip.style.left = `${left}px`;\r\n            hoverTip.style.top  = `${top}px`;\r\n          });\r\n\r\n          anchor.addEventListener(\"mouseleave\", () => {\r\n            hoverTip?.remove();\r\n            hoverTip = null;\r\n          });\r\n          \r\n          /* Bold for Epics (E‑) and Stories (S‑) but not SB‑ sub‑tasks */\r\n          const idUpper = ((t as any).id ?? \"\").toUpperCase();\r\n          if (idUpper.startsWith(\"E\") ||\r\n             (idUpper.startsWith(\"S\") && !idUpper.startsWith(\"SB\"))) {\r\n            anchor.addClass(\"pm-task-bold\");\r\n          }\r\n\r\n          anchor.style.cursor = \"pointer\";\r\n          anchor.onclick = (e) => {\r\n            e.preventDefault();\r\n            const filePath = (t as any).file?.path;\r\n            if (filePath) this.app.workspace.openLinkText(filePath, \"\", false);\r\n          };\r\n\r\n          /* Task progress */\r\n          const tProg = tRow.createEl(\"td\");\r\n          const pctRaw = (t.percentComplete ?? 0) as number;\r\n          let   tPct   = done ? 100 : Math.round(pctRaw * 100);\r\n\r\n          /* ── Story roll‑up: derive Story progress as average of child‑task progress ── */\r\n          {\r\n            const idU = ((t as any).id ?? \"\").toUpperCase();\r\n            const isStory = idU.startsWith(\"S\") && !idU.startsWith(\"SB\");\r\n            if (isStory) {\r\n              /* Gather SB‑children using *exactly* the same rule as the\r\n                 `orderTasksDash › pushWithSubs` helper (depends → Story.id) */\r\n              const childTasks = tasks.filter((sb) => {\r\n                const sid = ((sb as any).id ?? \"\").toUpperCase();\r\n                if (!sid.startsWith(\"SB\")) return false;\r\n\r\n                const deps = (sb.depends ?? []).map((d: string) => d.toUpperCase());\r\n                return deps.includes(idU);     // linked via “depends”\r\n              });\r\n\r\n              if (childTasks.length > 0) {\r\n                /* Derive Story progress = average of child‑task progress */\r\n                const pctSum = childTasks.reduce((sum, st) => {\r\n                  if (isTaskDone(st)) return sum + 100;\r\n\r\n                  let pcRaw = st.percentComplete ?? 0;\r\n                  if (pcRaw <= 1) pcRaw *= 100;   // convert 0‒1 → 0‒100\r\n                  return sum + Math.min(pcRaw, 100);\r\n                }, 0);\r\n\r\n                tPct = Math.round(pctSum / childTasks.length);\r\n                done = tPct >= 100;               // mark Story complete at 100 %\r\n              }\r\n            }\r\n          }\r\n\r\n          const tOuter = tProg.createEl(\"div\", {\r\n            cls: `pm-progress ${progressClass(tPct)}`,\r\n          });\r\n          tOuter.createEl(\"div\", {\r\n            cls: `pm-progress-inner ${progressClass(tPct)}`,\r\n            attr: { style: `width:${tPct}%` },\r\n          });\r\n          tProg.createEl(\"span\", {          // ← add label\r\n            cls: \"pm-progress-percent\",\r\n            text: `${tPct}%`,\r\n          });\r\n\r\n          /* Tasks column: tally sub-tasks for Epics and Stories */\r\n          (() => {\r\n            const idUp = ((t as any).id ?? \"\").toUpperCase();\r\n            const isEpic = idUp.startsWith(\"E\");\r\n            const isStory = idUp.startsWith(\"S\") && !idUp.startsWith(\"SB\");\r\n            let taskText = \"—\";\r\n\r\n            if (isEpic || isStory) {\r\n              /* Gather descendant tasks (recursive for Epics,\r\n                 direct SB-children for Stories) */\r\n\r\n              const gatherDescendants = (rootId: string): any[] => {\r\n                const desc: any[] = [];\r\n                const seen = new Set<string>();\r\n                const queue = [rootId];\r\n                while (queue.length) {\r\n                  const pid = queue.shift()!;\r\n                  tasks.forEach((candidate) => {\r\n                    const deps = (candidate.depends ?? []).map((d: string) => d.toUpperCase());\r\n                    if (deps.includes(pid)) {\r\n                      const cid = ((candidate.id ?? \"\") as string).toUpperCase();\r\n                      if (!seen.has(cid)) {\r\n                        seen.add(cid);\r\n                        desc.push(candidate);\r\n                        queue.push(cid);   // explore deeper levels\r\n                      }\r\n                    }\r\n                  });\r\n                }\r\n                return desc;\r\n              };\r\n\r\n              let childTasks: any[] = [];\r\n\r\n              if (isStory) {\r\n                /* Only direct SB‑children for Stories */\r\n                childTasks = tasks.filter((candidate) => {\r\n                  const deps = (candidate.depends ?? []).map((d: string) => d.toUpperCase());\r\n                  if (!deps.includes(idUp)) return false;\r\n                  const cid = ((candidate.id ?? \"\") as string).toUpperCase();\r\n                  return cid.startsWith(\"SB\");\r\n                });\r\n              } else if (isEpic) {\r\n                /* All descendant tasks (recursive) → keep only SB‑sub‑tasks */\r\n                childTasks = gatherDescendants(idUp).filter((cand) => {\r\n                  const cid = ((cand.id ?? \"\") as string).toUpperCase();\r\n                  return cid.startsWith(\"SB\");\r\n                });\r\n              }\r\n\r\n              if (childTasks.length > 0) {\r\n                const doneCnt = childTasks.filter(isTaskDone).length;\r\n                taskText = `${doneCnt} / ${childTasks.length}`;\r\n              }\r\n            }\r\n            // Create Tasks column with clickable check/X icon\r\n            const tasksCell = tRow.createEl(\"td\");\r\n            \r\n            // For SB tasks, add clickable completion toggle\r\n            const taskIdUp = ((t as any).id ?? \"\").toUpperCase();\r\n            const isSB = taskIdUp.startsWith(\"SB\");\r\n            \r\n            if (isSB) {\r\n              const isDone = isTaskDone(t);\r\n              const toggleBtn = tasksCell.createEl(\"span\");\r\n              toggleBtn.style.cursor = \"pointer\";\r\n              toggleBtn.style.marginRight = \"4px\";\r\n              \r\n              if (isDone) {\r\n                setIcon(toggleBtn, \"check-circle\");\r\n                let tooltip: HTMLElement | null = null;\r\n                toggleBtn.addEventListener(\"mouseenter\", () => {\r\n                  tooltip = document.createElement(\"div\");\r\n                  tooltip.className = \"pm-dash-tooltip\";\r\n                  tooltip.textContent = \"Mark as incomplete\";\r\n                  document.body.appendChild(tooltip);\r\n                  const rect = toggleBtn.getBoundingClientRect();\r\n                  tooltip.style.left = `${rect.left}px`;\r\n                  tooltip.style.top = `${rect.top - 30}px`;\r\n                });\r\n                const hideToggleTip = () => { tooltip?.remove(); tooltip = null; };\r\n                toggleBtn.addEventListener(\"mouseleave\", hideToggleTip);\r\n                document.addEventListener(\"scroll\", hideToggleTip, { capture: true, once: true });\r\n                toggleBtn.onclick = async (e) => {\r\n                  e.stopPropagation();\r\n                  hideToggleTip();\r\n                  await this.toggleTaskCompletion(t, false);\r\n                };\r\n              } else {\r\n                setIcon(toggleBtn, \"circle\");\r\n                let tooltip: HTMLElement | null = null;\r\n                toggleBtn.addEventListener(\"mouseenter\", () => {\r\n                  tooltip = document.createElement(\"div\");\r\n                  tooltip.className = \"pm-dash-tooltip\";\r\n                  tooltip.textContent = \"Mark as complete\";\r\n                  document.body.appendChild(tooltip);\r\n                  const rect = toggleBtn.getBoundingClientRect();\r\n                  tooltip.style.left = `${rect.left}px`;\r\n                  tooltip.style.top = `${rect.top - 30}px`;\r\n                });\r\n                const hideToggleTip2 = () => { tooltip?.remove(); tooltip = null; };\r\n                toggleBtn.addEventListener(\"mouseleave\", hideToggleTip2);\r\n                document.addEventListener(\"scroll\", hideToggleTip2, { capture: true, once: true });\r\n                toggleBtn.onclick = async (e) => {\r\n                  e.stopPropagation();\r\n                  hideToggleTip2();\r\n                  await this.toggleTaskCompletion(t, true);\r\n                };\r\n              }\r\n              // No text for SB tasks, just the icon\r\n            } else {\r\n              // For non-SB tasks (Epics/Stories), just show the text\r\n              tasksCell.setText(taskText);\r\n            }\r\n          })();\r\n\r\n          /* Status + dates — mirror Timeline logic */\r\n          const taskDueIso = ((t as any).props?.[\"due\"] ?? \"\")\r\n            .toString()\r\n            .replace(/\\u00A0/g, \" \")\r\n            .trim();\r\n\r\n          const taskStartIso = ((t as any).props?.[\"start\"] ?? \"\")\r\n            .toString()\r\n            .replace(/\\u00A0/g, \" \")\r\n            .trim();\r\n\r\n          /* prefer due::, fall back to start:: */\r\n          const taskDue = taskDueIso || taskStartIso || undefined;\r\n\r\n          /* last‑modified: note file mtime if present */\r\n          const taskMtime =\r\n            (t as any).file?.stat?.mtime ??\r\n            (t as any).mtime ??\r\n            (t as any).updated ??\r\n            undefined;\r\n\r\n          // --- Use t.status property provided by the cache\r\n          let taskStatusVal: \"not-started\" | \"in-progress\" | \"on-hold\" | \"done\" = \"not-started\";\r\n          if (typeof t.status === \"string\") {\r\n            const s = t.status.toLowerCase();\r\n            if (s === \"done\" || s === \"complete\" || s === \"completed\") {\r\n              taskStatusVal = \"done\";\r\n            } else if (s === \"in-progress\") {\r\n              taskStatusVal = \"in-progress\";\r\n            } else if (s === \"on-hold\") {\r\n              taskStatusVal = \"on-hold\";\r\n            }\r\n          }\r\n\r\n          // --- Status badge logic for all tasks (Epics/Stories/SB-etc)\r\n          const idUpForStatus = ((t as any).id ?? \"\").toUpperCase();\r\n          const isEpicRow = idUpForStatus.startsWith(\"E\");\r\n          const isStoryRow = idUpForStatus.startsWith(\"S\") && !idUpForStatus.startsWith(\"SB\");\r\n          const isSBRow = idUpForStatus.startsWith(\"SB\");\r\n          const pctForStatus = (done || tPct === 100) ? 1 : (tPct / 100);\r\n\r\n          // --- Override status if \"in progress\" and not overdue\r\n          let overrideOnTrack = false;\r\n          if (\r\n            (isSBRow || isEpicRow || isStoryRow) &&\r\n            t.status === \"in-progress\" &&\r\n            pctForStatus < 1\r\n          ) {\r\n            overrideOnTrack = true;\r\n          }\r\n\r\n          const { label: tLabel0, cls: tCls0 } = projectStatus(taskDue, pctForStatus, overrideOnTrack);\r\n          const tLabel = (tPct === 100) ? \"Completed\" : tLabel0;\r\n          const tCls   = (tPct === 100) ? \"complete\"   : tCls0;\r\n\r\n          const statusCell = tRow.createEl(\"td\");\r\n          statusCell.style.whiteSpace = \"nowrap\";\r\n          // Always render badge for all tasks\r\n          const badgeEl = statusCell.createEl(\"span\", { cls: `pm-badge ${tCls}`, text: tLabel });\r\n          // Insert in-progress or on-hold dot immediately after badge if task is in-progress or on-hold (using t.status)\r\n          if (t.status === \"in-progress\") {\r\n            statusCell.createEl(\"span\", { text: \"●\", cls: \"pm-in-progress-dot\" });\r\n          } else if (t.status === \"on-hold\") {\r\n            statusCell.createEl(\"span\", { text: \"●\", cls: \"pm-on-hold-dot\" });\r\n          }\r\n          attachStatusPopup(badgeEl, statusTooltip(taskDueIso || taskStartIso, pctForStatus));\r\n\r\n          // --- For SB-sub-tasks, append play/pause icon for in-progress toggle\r\n          if (isSBRow) {\r\n            // Only show icon if not done\r\n            if (taskStatusVal === \"not-started\" || taskStatusVal === \"in-progress\" || taskStatusVal === \"on-hold\") {\r\n              const iconBtn = statusCell.createEl(\"span\");\r\n              iconBtn.style.cursor = \"pointer\";\r\n              iconBtn.style.marginLeft = \"6px\";\r\n              iconBtn.style.verticalAlign = \"middle\";\r\n              // Add status button classes for styling\r\n              iconBtn.addClass(\"pm-status-btn\");\r\n              // Ensure t.status is one of the canonical status strings\r\n              // (already normalized above as taskStatusVal)\r\n              // Add class for current status (\"not-started\", \"in-progress\", \"on-hold\")\r\n              iconBtn.addClass(taskStatusVal);\r\n              // Icon and tooltip for each state\r\n              if (taskStatusVal === \"not-started\") {\r\n                setIcon(iconBtn, \"play\");\r\n                let tooltip: HTMLElement | null = null;\r\n                iconBtn.addEventListener(\"mouseenter\", () => {\r\n                  tooltip = document.createElement(\"div\");\r\n                  tooltip.className = \"pm-dash-tooltip\";\r\n                  tooltip.textContent = \"Mark as in progress\";\r\n                  document.body.appendChild(tooltip);\r\n                  const rect = iconBtn.getBoundingClientRect();\r\n                  tooltip.style.left = `${rect.left}px`;\r\n                  tooltip.style.top = `${rect.top - 30}px`;\r\n                });\r\n                const hideStatusTip1 = () => { tooltip?.remove(); tooltip = null; };\r\n                iconBtn.addEventListener(\"mouseleave\", hideStatusTip1);\r\n                document.addEventListener(\"scroll\", hideStatusTip1, { capture: true, once: true });\r\n              } else if (taskStatusVal === \"in-progress\") {\r\n                setIcon(iconBtn, \"pause\");\r\n                let tooltip: HTMLElement | null = null;\r\n                iconBtn.addEventListener(\"mouseenter\", () => {\r\n                  tooltip = document.createElement(\"div\");\r\n                  tooltip.className = \"pm-dash-tooltip\";\r\n                  tooltip.textContent = \"Mark as on hold\";\r\n                  document.body.appendChild(tooltip);\r\n                  const rect = iconBtn.getBoundingClientRect();\r\n                  tooltip.style.left = `${rect.left}px`;\r\n                  tooltip.style.top = `${rect.top - 30}px`;\r\n                });\r\n                const hideStatusTip2 = () => { tooltip?.remove(); tooltip = null; };\r\n                iconBtn.addEventListener(\"mouseleave\", hideStatusTip2);\r\n                document.addEventListener(\"scroll\", hideStatusTip2, { capture: true, once: true });\r\n              } else if (taskStatusVal === \"on-hold\") {\r\n                setIcon(iconBtn, \"play\");\r\n                let tooltip: HTMLElement | null = null;\r\n                iconBtn.addEventListener(\"mouseenter\", () => {\r\n                  tooltip = document.createElement(\"div\");\r\n                  tooltip.className = \"pm-dash-tooltip\";\r\n                  tooltip.textContent = \"Mark as in progress\";\r\n                  document.body.appendChild(tooltip);\r\n                  const rect = iconBtn.getBoundingClientRect();\r\n                  tooltip.style.left = `${rect.left}px`;\r\n                  tooltip.style.top = `${rect.top - 30}px`;\r\n                });\r\n                const hideStatusTip3 = () => { tooltip?.remove(); tooltip = null; };\r\n                iconBtn.addEventListener(\"mouseleave\", hideStatusTip3);\r\n                document.addEventListener(\"scroll\", hideStatusTip3, { capture: true, once: true });\r\n              }\r\n              iconBtn.onclick = async (ev) => {\r\n                ev.stopPropagation();\r\n                const file = (t as any).file;\r\n                if (file) {\r\n                  const content = await this.app.vault.read(file);\r\n                  const lines = content.split(/\\r?\\n/);\r\n                  // Regex for any markdown checkbox: [ ], [x], [X], [/], [-]\r\n                  const checkboxRegex = /\\[[ xX\\/-]\\]/;\r\n                  // Use task line number if available, else search for the line\r\n                  let found = false;\r\n                  let lineIdx = typeof t.line === \"number\" ? t.line : -1;\r\n                  // Defensive: check if the line at t.line matches checkbox\r\n                  if (\r\n                    lineIdx >= 0 &&\r\n                    lines[lineIdx] &&\r\n                    checkboxRegex.test(lines[lineIdx])\r\n                  ) {\r\n                    // Use this line\r\n                  } else {\r\n                    // Search for the first line with a checkbox and matching task text\r\n                    lineIdx = -1;\r\n                    const taskText = (t.text ?? \"\").toString();\r\n                    for (let i = 0; i < lines.length; i++) {\r\n                      if (lines[i].includes(taskText) && checkboxRegex.test(lines[i])) {\r\n                        lineIdx = i;\r\n                        break;\r\n                      }\r\n                    }\r\n                  }\r\n                  if (lineIdx >= 0) {\r\n                    // Determine the current checkbox value\r\n                    const match = lines[lineIdx].match(/\\[[ xX\\/-]\\]/);\r\n                    if (match) {\r\n                      const box = match[0];\r\n                      let replacement = box;\r\n                      if (box === \"[ ]\") {\r\n                        replacement = \"[/]\";\r\n                      } else if (box === \"[/]\") {\r\n                        replacement = \"[-]\";\r\n                      } else if (box === \"[-]\") {\r\n                        replacement = \"[/]\";\r\n                      }\r\n                      lines[lineIdx] = lines[lineIdx].replace(/\\[[ xX\\/-]\\]/, replacement);\r\n                      found = true;\r\n                    }\r\n                  }\r\n                  if (found) {\r\n                    const updated = lines.join(\"\\n\");\r\n                    await this.app.vault.modify(file, updated);\r\n                    // Ensure immediate visual badge update after toggling\r\n                    this.render();\r\n                    // Close the status popup if open\r\n                    const popup = iconBtn.closest(\".pm-status-popup\");\r\n                    if (popup) popup.remove();\r\n                  }\r\n                }\r\n              };\r\n            }\r\n          }\r\n\r\n          tRow.createEl(\"td\", { text: formatDate(taskDue) });\r\n          tRow.createEl(\"td\", { text: formatDate(taskMtime) });\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.cache.projects.size === 0) {\r\n      this.container.createEl(\"p\", {\r\n        text: `No project notes found (front-matter \\`${this.settings.projectFlagProperty}: true\\`).`,\r\n      });\r\n    }\r\n  }\r\n\r\n  private async toggleTaskCompletion(task: any, done: boolean) {\r\n    const file = task.file;\r\n    if (!file) return;\r\n\r\n    const content = await this.app.vault.read(file);\r\n    const lines = content.split(/\\r?\\n/);\r\n    const taskText = (task.text ?? \"\").toString();\r\n    const checkboxRegex = /\\[[ xX\\/-]\\]/;\r\n\r\n    let lineIdx = typeof task.line === \"number\" ? task.line : -1;\r\n\r\n    if (lineIdx >= 0 && lines[lineIdx] && checkboxRegex.test(lines[lineIdx])) {\r\n      // Use this line\r\n    } else {\r\n      // Search for the first line with a checkbox and matching task text\r\n      lineIdx = -1;\r\n      for (let i = 0; i < lines.length; i++) {\r\n        if (lines[i].includes(taskText) && checkboxRegex.test(lines[i])) {\r\n          lineIdx = i;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (lineIdx >= 0) {\r\n      const match = lines[lineIdx].match(/\\[[ xX\\/-]\\]/);\r\n      if (match) {\r\n        const box = match[0];\r\n        let replacement = box;\r\n        if (done) {\r\n          // Mark as complete\r\n          if (box === \"[ ]\" || box === \"[/]\" || box === \"[-]\") {\r\n            replacement = \"[x]\";\r\n          }\r\n        } else {\r\n          // Mark as incomplete\r\n          if (box === \"[x]\" || box === \"[X]\") {\r\n            replacement = \"[ ]\";\r\n          }\r\n        }\r\n        lines[lineIdx] = lines[lineIdx].replace(/\\[[ xX\\/-]\\]/, replacement);\r\n        await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n        this.render();\r\n      }\r\n    }\r\n  }\r\n\r\n  public focusSearch() {\r\n    this.container\r\n      .querySelector<HTMLInputElement>(\".pm-search-input\")\r\n      ?.focus();\r\n  }\r\n}","import { ItemView, WorkspaceLeaf, MarkdownView, moment, setIcon, Notice, Modal, TFile, App } from \"obsidian\";\r\nimport type { ViewStateResult } from \"obsidian\";\r\nimport type { ProjectCache, TaskItem, ProjectEntry, Milestone } from \"../services/cache\";\r\nimport type ProjectManagementPlugin from \"../main\";\r\n\r\n// Extended task interface for timeline view\r\ninterface ExtendedTaskItem extends TaskItem {\r\n  done?: boolean | string;\r\n  percentComplete?: number;\r\n  raw?: string;\r\n  priority?: string;\r\n}\r\n\r\n// Extended milestone interface for timeline view\r\ninterface ExtendedMilestone extends Milestone {\r\n  path?: string;\r\n  filePath?: string;\r\n  name?: string;\r\n  description?: string;\r\n}\r\n\r\n/**\r\n * Get task priority from task properties\r\n */\r\nfunction getTaskPriority(task: TaskItem): string {\r\n  const priority = task.props[\"priority\"]?.replace(/\\u00A0/g, \" \").trim().toLowerCase();\r\n  if (!priority) return \"\";\r\n  \r\n  // Critical priority\r\n  if ([\"critical\", \"crit\", \"c\", \"p0\", \"highest\"].includes(priority)) return \"critical\";\r\n  // High priority\r\n  if ([\"high\", \"h\", \"1\", \"p1\"].includes(priority)) return \"high\";\r\n  // Medium priority\r\n  if ([\"medium\", \"med\", \"m\", \"2\", \"p2\"].includes(priority)) return \"medium\";\r\n  // Low priority\r\n  if ([\"low\", \"l\", \"3\", \"p3\"].includes(priority)) return \"low\";\r\n  \r\n  return \"\";\r\n}\r\n\r\n// Load timeline-specific stylesheet\r\nimport \"../../styles/styles-timeline.css\";\r\n/** Trigger native date picker for timeline dates */\r\nfunction triggerNativeDatePicker(currentDate: string, onSelect: (date: string | null) => void) {\r\n  console.log(\"Triggering native date picker with currentDate:\", currentDate);\r\n  \r\n  // Create a visible but small date input positioned near the cursor\r\n  const dateInput = document.createElement(\"input\");\r\n  dateInput.type = \"date\";\r\n  dateInput.style.position = \"fixed\";\r\n  dateInput.style.left = \"50%\";\r\n  dateInput.style.top = \"50%\";\r\n  dateInput.style.transform = \"translate(-50%, -50%)\";\r\n  dateInput.style.zIndex = \"10000\";\r\n  dateInput.style.opacity = \"0.01\"; // Nearly invisible but still clickable\r\n  dateInput.style.pointerEvents = \"auto\";\r\n  dateInput.value = currentDate || \"\";\r\n  \r\n  console.log(\"Created date input:\", dateInput);\r\n  \r\n  // Add to body\r\n  document.body.appendChild(dateInput);\r\n  console.log(\"Added date input to body\");\r\n  \r\n  // Handle date change\r\n  dateInput.addEventListener(\"change\", () => {\r\n    console.log(\"Date input changed to:\", dateInput.value);\r\n    const result = dateInput.value;\r\n    document.body.removeChild(dateInput);\r\n    onSelect(result);\r\n  });\r\n  \r\n  // Handle blur (user clicked away)\r\n  dateInput.addEventListener(\"blur\", () => {\r\n    console.log(\"Date input blurred\");\r\n    setTimeout(() => {\r\n      if (document.body.contains(dateInput)) {\r\n        document.body.removeChild(dateInput);\r\n        onSelect(null);\r\n      }\r\n    }, 100);\r\n  });\r\n  \r\n  // Focus and show the picker\r\n  setTimeout(() => {\r\n    console.log(\"Focusing date input...\");\r\n    dateInput.focus();\r\n    dateInput.showPicker?.(); // Modern browsers support this\r\n    console.log(\"Date picker should be visible now\");\r\n  }, 10);\r\n}\r\n\r\n/** Discrete zoom stops (px per day) shown in the slider */\r\nconst ZOOM_STOPS = [2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 14, 16, 18, 20];\r\n\r\n\r\n/** ── Simple drag context for Alt‑drag bar move or resize ───────────────── */\r\ninterface DragContext {\r\n  barEl: HTMLElement;\r\n  startClientX: number;\r\n  originalDayOffset: number;\r\n  originalSpan: number;          // durationDays when drag started\r\n  taskPath: string;\r\n  mode: \"move\" | \"resize-left\" | \"resize-right\";\r\n}\r\nlet currentDrag: DragContext | null = null;\r\n\r\n/** Drag context for a project‑level bar (YAML Start/End) */\r\ninterface ProjDragContext {\r\n  barEl: HTMLElement;\r\n  startClientX: number;\r\n  originalStart: number;      // projStart at drag start\r\n  originalWidth: number;      // bar width at drag start (for resizing)\r\n  mode: \"move\" | \"resize-left\" | \"resize-right\";\r\n  projectPath: string;        // full file path (for YAML update)\r\n}\r\nlet currentProjDrag: ProjDragContext | null = null;\r\n\r\nexport const VIEW_TYPE_PM_TIMELINE = \"pm-timeline-view\";\r\n\r\n/**\r\n * Basic project Timeline / Gantt view.\r\n * Displays one row per project and a 1‑day bar for each task with a `due` date.\r\n */\r\nexport class TimelineView extends ItemView {\r\n  private cache: ProjectCache;\r\n  private detachFn: (() => void) | null = null;\r\n  private pluginInst: ProjectManagementPlugin | null = null;\r\n\r\n  /** Heat‑map layer element (created lazily) */\r\n  private heatLayerEl: HTMLElement | null = null;\r\n\r\n  /** True if a render is already queued for the next animation frame */\r\n  private renderQueued = false;\r\n\r\n  /** User‑resizable width of the project‑name column (pixels) */\r\n  private labelWidth = 400;    // start at maximum width\r\n  private sortAsc = true;        // toggle project sort order\r\n  /** Pixels per day — initialised from settings (must be a valid zoom stop) */\r\n  private zoomPxPerDay = (() => {\r\n    const saved =\r\n      ((this.app as any).plugins.plugins[\"project-management\"] as ProjectManagementPlugin)?.settings\r\n        ?.zoomPxPerDay as number | undefined;\r\n    return ZOOM_STOPS.includes(saved ?? -1) ? saved! : ZOOM_STOPS[1]; // default 4\r\n  })();\r\n  /** true while a zoom drag has a render queued */\r\n  private zoomRenderScheduled = false;\r\n  \r\n  /** Cache of row elements to avoid repeated querySelector calls */\r\n  private timelineRows: HTMLElement[] = [];\r\n  \r\n  /** Throttled style update for zoom changes */\r\n  private zoomStyleUpdateScheduled = false;\r\n  \r\n  /** Show flat task list sorted by start date instead of project grouping */\r\n  private sortByStartDate = false;\r\n\r\n  /** Remember scroll offsets between renders triggered externally */\r\n  private pendingScroll: { v: number; h: number } | null = null;\r\n\r\n  /** Projects whose task list is currently collapsed */\r\n  private collapsed = new Set<string>();\r\n  /** Projects manually hidden via the per‑project eye icon */\r\n  private hiddenProjects = new Set<string>();\r\n  /** Whether to hide bars when projects are collapsed */\r\n  private hideBarsWhenCollapsed = false;\r\n  /** Collapsed Epic/Story tasks for hierarchical collapse */\r\n  private collapsedTasks = new Set<string>();\r\n\r\n  /** Optional set of project file paths to display (injected by Portfolio view) */\r\n  private filterPaths?: Set<string>;\r\n  /** Optional name of the portfolio that opened this timeline */\r\n  private filterName?: string;\r\n\r\n  /** Keeps the vertical splitter height in sync with pane resize */\r\n  private splitterRO: ResizeObserver | null = null;\r\n  \r\n  /** Debounced render to prevent excessive refreshes */\r\n  private renderTimeout: ReturnType<typeof setTimeout> | null = null;\r\n  private pendingSettingsChanges = false;\r\n  \r\n  /** Batch multiple operations into a single render */\r\n  private renderBatchTimeout: ReturnType<typeof setTimeout> | null = null;\r\n  private pendingRenderOperations: Set<string> = new Set();\r\n  \r\n  constructor(\r\n    leaf: WorkspaceLeaf,\r\n    cache: ProjectCache,\r\n    plugin?: ProjectManagementPlugin\r\n  ) {\r\n    super(leaf);\r\n    this.cache      = cache;\r\n    this.pluginInst = plugin ?? null;\r\n  }\r\n  /**\r\n   * Obsidian calls setState when the view is first loaded or when\r\n   * leaf.setViewState({...state}) is invoked. Capture `filterProjects`\r\n   * so we can filter the timeline rows.\r\n   */\r\n  async setState(state: { filterProjects?: string[]; filterName?: string } | undefined, result: ViewStateResult): Promise<void> {\r\n    if (state?.filterProjects && Array.isArray(state.filterProjects)) {\r\n      this.filterPaths = new Set(state.filterProjects as string[]);\r\n    } else {\r\n      this.filterPaths = undefined;\r\n    }\r\n    if (typeof state?.filterName === \"string\" && state.filterName.trim() !== \"\") {\r\n      this.filterName = state.filterName.trim();\r\n    } else {\r\n      this.filterName = undefined;\r\n    }\r\n    // No special history handling; just re‑render\r\n    this.render();\r\n  }\r\n  /** Handy accessor that falls back to global plugin lookup. */\r\n  private get plugin() {\r\n    return (\r\n      this.pluginInst ??\r\n      (this.app as any).plugins.plugins[\"project-management\"] as ProjectManagementPlugin\r\n    );\r\n  }\r\n\r\n  getViewType() {\r\n    return VIEW_TYPE_PM_TIMELINE;\r\n  }\r\n  getDisplayText() {\r\n    return this.filterName\r\n      ? `Timeline – ${this.filterName}`\r\n      : \"Timeline\";\r\n  }\r\n  /** Display the same icon used in the ribbon (\"calendar-clock\"). */\r\n  getIcon(): string {\r\n    return \"calendar-clock\";\r\n  }\r\n\r\n  async onOpen() {\r\n    this.render();\r\n    // live refresh on cache updates\r\n    this.detachFn = this.cache.onChange(() => this.saveAndRender());\r\n  }\r\n  /** Debounced render to prevent excessive refreshes */\r\n  private debouncedRender(delay: number = 100) {\r\n    if (this.renderTimeout) {\r\n      clearTimeout(this.renderTimeout);\r\n    }\r\n    this.renderTimeout = setTimeout(() => {\r\n      this.renderTimeout = null;\r\n      this.render();\r\n    }, delay);\r\n  }\r\n\r\n  /** Save settings and render with debouncing */\r\n  private async saveAndRenderDebounced() {\r\n    if (this.pendingSettingsChanges) {\r\n      await this.plugin.saveSettings?.();\r\n      this.pendingSettingsChanges = false;\r\n    }\r\n    this.debouncedRender();\r\n  }\r\n\r\n  /** Batch multiple render operations into a single render */\r\n  private batchRender(operation: string, delay: number = 150) {\r\n    this.pendingRenderOperations.add(operation);\r\n    \r\n    if (this.renderBatchTimeout) {\r\n      clearTimeout(this.renderBatchTimeout);\r\n    }\r\n    \r\n    this.renderBatchTimeout = setTimeout(() => {\r\n      this.renderBatchTimeout = null;\r\n      this.pendingRenderOperations.clear();\r\n      \r\n      // Clean up any lingering tooltips before re-rendering\r\n      document.querySelectorAll(\".pm-dash-tooltip\").forEach(el => el.remove());\r\n      \r\n      this.saveAndRender();\r\n    }, delay);\r\n  }\r\n\r\n  /** Render a flat task list sorted by start date */\r\n  private renderFlatTaskList(leftPane: HTMLElement, rightPane: HTMLElement, pxPerDay: number, horizon: number, today: moment.Moment, projects: ProjectEntry[]) {\r\n    /** Return a description for a task using a three‑step, robust heuristic. */\r\n    const getDescription = (t: TaskItem): string => {\r\n      /* 1️⃣  Any prop whose key (after trimming NBSP/space and lower‑casing)\r\n             equals \"description\" */\r\n      for (const [rawK, rawV] of Object.entries(t.props)) {\r\n        const k = rawK.replace(/\\u00A0/g, \" \").trim().toLowerCase();\r\n        if (k === \"description\") {\r\n          const v = rawV.replace(/\\u00A0/g, \" \").trim();\r\n          if (v) return v;\r\n        }\r\n      }\r\n\r\n      /* 2️⃣  Table‑row heuristic: capture the cell under the \"Description\" column.\r\n             We assume the first cell holds the ID, so try cell[1] first; if that\r\n             looks like a date or is blank, fall back to scanning right‑to‑left\r\n             for the first non‑date cell. */\r\n      if (t.text.includes(\"|\")) {\r\n        const cells = t.text.split(\"|\").map(s => s.replace(/\\u00A0/g, \" \").trim());\r\n        if (cells.length && cells[0] === \"\") cells.shift();           // leading pipe\r\n        if (cells.length && cells[cells.length - 1] === \"\") cells.pop(); // trailing pipe\r\n\r\n        const dateRe = /^\\d{4}-\\d{2}-\\d{2}$/;\r\n\r\n        /* Prefer the cell immediately after the ID (index 1) */\r\n        if (cells.length >= 2) {\r\n          const cand = cells[1];\r\n          if (cand && !dateRe.test(cand)) return cand;\r\n        }\r\n\r\n        /* Fallback: walk from right to left, pick first non‑date, non‑blank cell */\r\n        for (let i = cells.length - 1; i >= 0; i--) {\r\n          const cell = cells[i];\r\n          if (cell && !dateRe.test(cell)) return cell;\r\n        }\r\n      }\r\n\r\n      /* 3️⃣  Extra lines under the checkbox bullet */\r\n      const lines = t.text\r\n        .split(\"\\n\")\r\n        .slice(1)\r\n        .map(s => s.trim())\r\n        .filter(Boolean);\r\n      return lines.join(\" \");\r\n    };\r\n\r\n    /** Local done predicate to mirror normal mode */\r\n    const isTaskDone = (t: TaskItem): boolean => {\r\n      const anyT = t as any;\r\n      if (anyT.done === true || t.checked === true) return true;\r\n      if (typeof anyT.done === \"string\" && anyT.done.toLowerCase() === \"done\") return true;\r\n      if (typeof anyT.percentComplete === \"number\" && anyT.percentComplete >= 1) return true;\r\n      const raw = (anyT.raw ?? t.text ?? \"\").toString();\r\n      return /^\\s*-\\s*\\[[xX]\\]/.test(raw);\r\n    };\r\n    \r\n    /** Check if task is on-hold */\r\n    const isTaskOnHold = (t: TaskItem): boolean => {\r\n      return t.status === \"on-hold\";\r\n    };\r\n\r\n    // Helper function to render a single task\r\n    const renderTask = (task: TaskItem, project: ProjectEntry) => {\r\n      const rowLeft = leftPane.createEl(\"div\", { cls: \"pm-tl-taskrow\" });\r\n      const rowRight = rightPane.createEl(\"div\", { cls: \"pm-tl-row\" });\r\n      \r\n      // Cache the row for efficient zoom updates\r\n      this.timelineRows.push(rowRight);\r\n      \r\n      // Set minimum width for zoom compatibility\r\n      rowRight.style.minWidth = `${(horizon + 1) * pxPerDay}px`;\r\n\r\n      // Create task label with proper indentation and styling\r\n      const taskText = task.text.split(\"\\n\")[0].trim();\r\n      \r\n      // Add bullet point or check icon for completed tasks or pause icon for on-hold\r\n      if (isTaskDone(task)) {\r\n        const chk = rowLeft.createEl(\"span\");\r\n        setIcon(chk, \"check-circle\");\r\n        chk.addClass(\"pm-task-check\");\r\n        chk.style.marginRight = \"4px\";\r\n      } else if (isTaskOnHold(task)) {\r\n        const hold = rowLeft.createEl(\"span\");\r\n        setIcon(hold, \"pause-circle\");\r\n        hold.addClass(\"pm-task-hold\");\r\n        hold.style.marginRight = \"4px\";\r\n      } else {\r\n        const bullet = rowLeft.createEl(\"span\", { \r\n          text: \"•\", \r\n          cls: \"pm-task-bullet\" \r\n        });\r\n      }\r\n      \r\n      const taskLink = rowLeft.createEl(\"a\", {\r\n        text: taskText, // Use full text, let CSS handle truncation\r\n        href: `${project.file.path}#L${task.line + 1}`,\r\n      });\r\n\r\n      // Add ID prefix\r\n      const idLower = task.id.toLowerCase();\r\n      const num = task.id.match(/\\d+/)?.[0] ?? \"\";\r\n      let prefix = \"\";\r\n      if (idLower.startsWith(\"sb\")) {\r\n        prefix = `SB-${num}. `;\r\n      } else if (idLower.startsWith(\"s\")) {\r\n        prefix = `S-${num}. `;\r\n      } else if (idLower.startsWith(\"e\")) {\r\n        prefix = `E-${num}. `;\r\n      }\r\n      taskLink.setText(prefix + taskText);\r\n\r\n      // In start date mode, we want to show hierarchical relationships through indentation\r\n      // but maintain chronological order. So we'll indent based on task type and relationships.\r\n      const idTag = (task.id ?? \"\").toUpperCase();\r\n      let indent = 0;\r\n      \r\n      if (idTag.startsWith(\"E\")) {\r\n        // Epics: no indent\r\n        indent = 0;\r\n      } else if (idTag.startsWith(\"S\") && !idTag.startsWith(\"SB\")) {\r\n        // Stories: indent by 1 level\r\n        indent = 1;\r\n      } else if (idTag.startsWith(\"SB\")) {\r\n        // Subtasks: indent by 2 levels\r\n        indent = 2;\r\n      }\r\n      \r\n      taskLink.style.marginLeft = `${indent * 12}px`;\r\n\r\n      // Bold for \"E\" or plain \"S\" (not SB)\r\n      if (\r\n        idLower.startsWith(\"e\") ||                       // any \"E…\"\r\n        (idLower.startsWith(\"s\") && !idLower.startsWith(\"sb\"))  // \"S…\" but NOT \"SB…\"\r\n      ) {\r\n        taskLink.classList.add(\"pm-task-bold\");\r\n      }\r\n\r\n      taskLink.addClass(\"pm-tl-label\");               // inherit ellipsis styles\r\n      // Adjust width to account for indentation\r\n      const availableWidth = this.labelWidth - (indent * 12);\r\n      taskLink.style.width = `${availableWidth}px`;\r\n\r\n      /* ── Hover tooltip for this task ─────────────────────────── */\r\n      {\r\n        let tip: HTMLElement | null = null;\r\n\r\n        const showTip = () => {\r\n          /* Build short text & ID prefix locally */\r\n          const raw       = task.text.split(\"\\n\")[0].trim();\r\n          const shortTxt  = raw.length > 70 ? raw.slice(0, 67) + \"…\" : raw;\r\n\r\n          let idPrefix = \"\";\r\n          {\r\n            const idL  = task.id.toLowerCase();\r\n            const num  = task.id.match(/\\d+/)?.[0] ?? \"\";\r\n            if (idL.startsWith(\"sb\"))      idPrefix = `SB-${num}. `;\r\n            else if (idL.startsWith(\"s\") && !idL.startsWith(\"sb\")) idPrefix = `S-${num}. `;\r\n            else if (idL.startsWith(\"e\"))  idPrefix = `E-${num}. `;\r\n          }\r\n          const who = (task.props[\"assignee\"] ?? \"\").replace(/\\u00A0/g, \" \").trim() || \"—\";\r\n          const fmt = (s: string) => (s && s.trim() !== \"\" ? s.trim() : \"—\");\r\n          const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n          const dueIso = (task.props[\"due\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n          const desc = getDescription(task);\r\n          const html = `\r\n            <strong>${idPrefix}${shortTxt}</strong>${desc ? `<br><em>${desc}</em>` : \"\"}\r\n            <br><span>Project: ${project.file.basename}</span>\r\n            <br><span>Start: ${fmt(startIso)}</span>\r\n            <br><span>Due&nbsp;&nbsp;: ${fmt(dueIso)}</span>\r\n            <br><span>Assignee:&nbsp;${who}</span>\r\n          `;\r\n\r\n          tip = document.createElement(\"div\");\r\n          tip.className = \"pm-dash-tooltip\";\r\n          tip.innerHTML = html;\r\n          document.body.appendChild(tip);\r\n\r\n          /* Position beside the link, keep on-screen and under header */\r\n          const r   = taskLink.getBoundingClientRect();\r\n          const pad = 8;\r\n          const w   = tip.offsetWidth;\r\n          let x = r.right + pad;\r\n          if (x + w > window.innerWidth - pad) {\r\n            x = Math.max(r.left - pad - w, pad);\r\n          }\r\n          const h = tip.offsetHeight;\r\n          let y   = Math.max(r.top, 48);\r\n          if (y + h > window.innerHeight - pad) {\r\n            y = Math.max(window.innerHeight - h - pad, 48);\r\n          }\r\n          tip.style.left = `${x}px`;\r\n          tip.style.top  = `${y}px`;\r\n        };\r\n\r\n        const hideTip = () => { tip?.remove(); tip = null; };\r\n\r\n        taskLink.addEventListener(\"mouseenter\", showTip);\r\n        taskLink.addEventListener(\"mouseleave\", hideTip);\r\n      }\r\n\r\n      taskLink.onclick = (e) => {\r\n        e.preventDefault();\r\n        this.openAndScroll(project.file.path, task.id, task.line);\r\n      };\r\n\r\n      // Create task bar\r\n      const barWrap = rowRight.createEl(\"div\", { cls: \"pm-tl-barwrap\" });\r\n      barWrap.style.height = \"27px\";\r\n      barWrap.style.position = \"relative\";\r\n\r\n      const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n      const dueIso = (task.props[\"due\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n      \r\n      if (startIso && dueIso) {\r\n        // @ts-ignore callable moment\r\n        const start = (moment as any)(startIso, \"YYYY-MM-DD\");\r\n        // @ts-ignore callable moment\r\n        const due = (moment as any)(dueIso, \"YYYY-MM-DD\");\r\n        \r\n        if (start.isValid() && due.isValid()) {\r\n          const startOff = start.diff(today, \"days\");\r\n          const spanDays = Math.max(due.diff(start, \"days\") + 1, 1);\r\n\r\n          const bar = barWrap.createEl(\"div\", { cls: \"pm-tl-bar\" });\r\n          bar.style.left = `${startOff * pxPerDay}px`;\r\n          bar.style.width = `${Math.max(spanDays * pxPerDay, 3)}px`;\r\n          bar.style.zIndex = \"2\";\r\n\r\n          // Add priority border color\r\n          const priority = getTaskPriority(task);\r\n          if (priority) bar.addClass(`pm-priority-${priority}`);\r\n\r\n          // Color by task type\r\n          const id = task.id.toLowerCase();\r\n          if (id.startsWith(\"e\")) bar.addClass(\"pm-bar-e\");\r\n          else if (id.startsWith(\"sb\")) bar.addClass(\"pm-bar-sb\");\r\n          else if (id.startsWith(\"s\")) bar.addClass(\"pm-bar-s\");\r\n\r\n          // Completed state (match normal mode)\r\n          const isDone = isTaskDone(task);\r\n          const isOnHold = isTaskOnHold(task);\r\n          if (isDone) {\r\n            bar.addClass(\"pm-tl-bar-done\");\r\n          } else if (isOnHold) {\r\n            bar.addClass(\"pm-tl-bar-hold\");\r\n          }\r\n\r\n          // Urgency color\r\n          if (!isDone && !isOnHold) {\r\n            const dOff = due.diff(today, \"days\");\r\n            if (dOff < 0) bar.addClass(\"pm-bar-overdue\");\r\n            else if (dOff <= 10) bar.addClass(\"pm-bar-warning\");\r\n          }\r\n\r\n          // Bar tooltip with hover events (same as normal timeline mode)\r\n          if (this.plugin.settings.showTooltips !== false) {\r\n            const buildHtml = () => {\r\n              /* Build short text & ID prefix locally */\r\n              const raw = task.text.split(\"\\n\")[0].trim();\r\n              const shortTxt = raw.length > 70 ? raw.slice(0, 67) + \"…\" : raw;\r\n\r\n              let idPrefix = \"\";\r\n              {\r\n                const idL = task.id.toLowerCase();\r\n                const num = task.id.match(/\\d+/)?.[0] ?? \"\";\r\n                if (idL.startsWith(\"sb\")) idPrefix = `SB-${num}. `;\r\n                else if (idL.startsWith(\"s\") && !idL.startsWith(\"sb\")) idPrefix = `S-${num}. `;\r\n                else if (idL.startsWith(\"e\")) idPrefix = `E-${num}. `;\r\n              }\r\n              const who = (task.props[\"assignee\"] ?? \"\").replace(/\\u00A0/g, \" \").trim() || \"—\";\r\n              const fmt = (s: string) => (s && s.trim() !== \"\" ? s.trim() : \"—\");\r\n              const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n              const dueIso = (task.props[\"due\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n              const desc = getDescription(task);\r\n              const priority = getTaskPriority(task);\r\n              const priorityText = priority ? priority.charAt(0).toUpperCase() + priority.slice(1) : \"—\";\r\n              \r\n              return `\r\n                <strong>${idPrefix}${shortTxt}</strong>${desc ? `<br><em>${desc}</em>` : \"\"}\r\n                <br><span>Project: ${project.file.basename}</span>\r\n                <br><span>Start: ${fmt(startIso)}</span>\r\n                <br><span>Due&nbsp;&nbsp;: ${fmt(dueIso)}</span>\r\n                <br><span>Assignee:&nbsp;${who}</span>\r\n                <br><span>Priority: ${priorityText}</span>\r\n              `;\r\n            };\r\n\r\n            let barTooltip: HTMLElement | null = null;\r\n            \r\n            bar.addEventListener(\"mouseenter\", (ev) => {\r\n              const rect = bar.getBoundingClientRect();\r\n              const html = buildHtml();\r\n              \r\n              // Create tooltip element\r\n              barTooltip = document.createElement(\"div\");\r\n              barTooltip.className = \"pm-dash-tooltip\";\r\n              barTooltip.innerHTML = html;\r\n              document.body.appendChild(barTooltip);\r\n\r\n              // Position tooltip\r\n              const pad = 8;\r\n              const w = barTooltip.offsetWidth;\r\n              let left = rect.right + pad;\r\n              if (left + w > window.innerWidth - pad) {\r\n                left = Math.max(rect.left - pad - w, pad);\r\n              }\r\n\r\n              const h = barTooltip.offsetHeight;\r\n              let top = Math.max(rect.top, 48);\r\n              if (top + h > window.innerHeight - pad) {\r\n                top = Math.max(window.innerHeight - h - pad, 48);\r\n              }\r\n\r\n              barTooltip.style.left = `${left}px`;\r\n              barTooltip.style.top = `${top}px`;\r\n            });\r\n\r\n            bar.addEventListener(\"mouseleave\", () => {\r\n              if (barTooltip && document.body.contains(barTooltip)) {\r\n                barTooltip.remove();\r\n                barTooltip = null;\r\n              }\r\n            });\r\n          }\r\n\r\n          // Track pointer movement for drag detection\r\n          let dragMoved = false;\r\n          let dragStartX = 0;\r\n\r\n          // Add drag functionality (same as regular timeline bars)\r\n          if (this.plugin.settings.allowBarMove !== false) {\r\n            const origOffset = startOff;\r\n            const origSpan = spanDays;\r\n            \r\n            // Resize handles\r\n            const leftHandle = bar.createEl(\"div\", { cls: \"pm-resize-handle left\" });\r\n            const rightHandle = bar.createEl(\"div\", { cls: \"pm-resize-handle right\" });\r\n\r\n            [leftHandle, rightHandle].forEach(h => {\r\n              h.style.position = \"absolute\";\r\n              h.style.top = \"0\";\r\n              h.style.width = \"6px\";\r\n              h.style.height = \"100%\";\r\n              h.style.cursor = \"ew-resize\";\r\n              h.style.touchAction = \"none\";\r\n              h.style.background = \"transparent\";\r\n            });\r\n            leftHandle.style.left = \"0\";\r\n            rightHandle.style.right = \"0\";\r\n\r\n            // Pointer events for resize handles\r\n            leftHandle.addEventListener(\"pointerdown\", (ev) => {\r\n              if (ev.button !== 0) return;\r\n              ev.stopPropagation();\r\n              bar.setPointerCapture(ev.pointerId);\r\n              \r\n              // Calculate current visual position of the bar\r\n              const currentLeft = parseFloat(bar.style.left) || 0;\r\n              const currentDayOffset = Math.round(currentLeft / pxPerDay);\r\n              const currentWidth = parseFloat(bar.style.width) || 0;\r\n              const currentSpan = Math.round(currentWidth / pxPerDay);\r\n              \r\n              currentDrag = {\r\n                barEl: bar,\r\n                startClientX: ev.clientX,\r\n                originalDayOffset: currentDayOffset,\r\n                originalSpan: currentSpan,\r\n                taskPath: project.file.path + \"::\" + task.id,\r\n                mode: \"resize-left\"\r\n              };\r\n            });\r\n\r\n            rightHandle.addEventListener(\"pointerdown\", (ev) => {\r\n              if (ev.button !== 0) return;\r\n              ev.stopPropagation();\r\n              bar.setPointerCapture(ev.pointerId);\r\n              \r\n              // Calculate current visual position of the bar\r\n              const currentLeft = parseFloat(bar.style.left) || 0;\r\n              const currentDayOffset = Math.round(currentLeft / pxPerDay);\r\n              const currentWidth = parseFloat(bar.style.width) || 0;\r\n              const currentSpan = Math.round(currentWidth / pxPerDay);\r\n              \r\n              currentDrag = {\r\n                barEl: bar,\r\n                startClientX: ev.clientX,\r\n                originalDayOffset: currentDayOffset,\r\n                originalSpan: currentSpan,\r\n                taskPath: project.file.path + \"::\" + task.id,\r\n                mode: \"resize-right\"\r\n              };\r\n            });\r\n\r\n            bar.addEventListener(\"pointerdown\", (ev) => {\r\n              if (ev.button !== 0) return;\r\n              ev.preventDefault();\r\n              dragMoved = false;\r\n              dragStartX = ev.clientX;\r\n              bar.setPointerCapture(ev.pointerId);\r\n              \r\n              // Calculate current visual position of the bar\r\n              const currentLeft = parseFloat(bar.style.left) || 0;\r\n              const currentDayOffset = Math.round(currentLeft / pxPerDay);\r\n              \r\n              currentDrag = {\r\n                barEl: bar,\r\n                startClientX: ev.clientX,\r\n                originalDayOffset: currentDayOffset,\r\n                originalSpan: origSpan,\r\n                taskPath: project.file.path + \"::\" + task.id,\r\n                mode: \"move\"\r\n              };\r\n              bar.style.opacity = \"0.6\";\r\n            });\r\n\r\n            bar.addEventListener(\"pointermove\", (ev) => {\r\n              if (Math.abs(ev.clientX - dragStartX) > 3) dragMoved = true;\r\n              \r\n              if (!currentDrag || currentDrag.barEl !== bar) return;\r\n              const deltaPx = ev.clientX - currentDrag.startClientX;\r\n              const deltaDays = Math.round(deltaPx / pxPerDay);\r\n\r\n              if (currentDrag.mode === \"move\") {\r\n                const newOffset = currentDrag.originalDayOffset + deltaDays;\r\n                bar.style.left = `${newOffset * pxPerDay}px`;\r\n              } else if (currentDrag.mode === \"resize-left\") {\r\n                const newOffset = currentDrag.originalDayOffset + deltaDays;\r\n                const newSpan = currentDrag.originalSpan - deltaDays;\r\n                if (newSpan >= 1) {\r\n                  bar.style.left = `${newOffset * pxPerDay}px`;\r\n                  bar.style.width = `${newSpan * pxPerDay}px`;\r\n                }\r\n              } else { // resize-right\r\n                const newSpan = currentDrag.originalSpan + deltaDays;\r\n                if (newSpan >= 1) {\r\n                  bar.style.width = `${newSpan * pxPerDay}px`;\r\n                }\r\n              }\r\n            });\r\n\r\n            bar.addEventListener(\"pointerup\", (ev) => {\r\n              if (!currentDrag || currentDrag.barEl !== bar) return;\r\n              bar.releasePointerCapture(ev.pointerId);\r\n              bar.style.opacity = \"\";\r\n              const deltaDays = Math.round(\r\n                (ev.clientX - currentDrag.startClientX) / pxPerDay\r\n              );\r\n              if (deltaDays !== 0) {\r\n                if (currentDrag.mode === \"move\") {\r\n                  /* Bubble event so main.ts can update markdown */\r\n                  this.containerEl.dispatchEvent(\r\n                    new CustomEvent(\"pm-bar-moved\", {\r\n                      detail: {\r\n                        taskPath: currentDrag.taskPath,\r\n                        deltaDays: deltaDays,\r\n                        mode: currentDrag.mode\r\n                      }\r\n                    })\r\n                  );\r\n                } else {\r\n                  /* Bubble event for resize operations */\r\n                  this.containerEl.dispatchEvent(\r\n                    new CustomEvent(\"pm-bar-resized\", {\r\n                      detail: {\r\n                        taskPath: currentDrag.taskPath,\r\n                        deltaDays: deltaDays,\r\n                        mode: currentDrag.mode\r\n                      }\r\n                    })\r\n                  );\r\n                }\r\n              }\r\n              currentDrag = null;\r\n            });\r\n\r\n            // Hover feedback: change cursor to ↔ at edges\r\n            bar.addEventListener(\"mousemove\", (ev) => {\r\n              if (this.plugin.settings.allowBarMove === false) return;\r\n              const offsetX = ev.offsetX;\r\n              const edge = 6;\r\n              bar.style.cursor =\r\n                offsetX < edge || bar.clientWidth - offsetX < edge ? \"ew-resize\" : \"default\";\r\n            });\r\n          }\r\n\r\n          // Click handler (only if not dragging)\r\n          bar.onclick = (e) => {\r\n            if (dragMoved) return; // Don't open if we were dragging\r\n            e.preventDefault();\r\n            this.openAndScroll(project.file.path, task.id, task.line);\r\n          };\r\n        }\r\n      }\r\n    };\r\n    // Collect all tasks from all projects\r\n    const allTasks: Array<{task: TaskItem, project: ProjectEntry}> = [];\r\n    \r\n    projects.forEach((project: ProjectEntry) => {\r\n      if (this.hiddenProjects.has(project.file.path)) return;\r\n      \r\n      project.tasks.forEach((task: TaskItem) => {\r\n        // Filter out completed and on-hold tasks if settings enabled\r\n        if (this.plugin.settings.hideCompletedTasks && isTaskDone(task)) return;\r\n        if (this.plugin.settings.hideOnHoldTasks && isTaskOnHold(task)) return;\r\n        \r\n        const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n        if (startIso) {\r\n          // @ts-ignore callable moment\r\n          const start = (moment as any)(startIso, \"YYYY-MM-DD\");\r\n          if (start.isValid()) {\r\n            allTasks.push({task, project});\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    // Sort by start date\r\n    allTasks.sort((a, b) => {\r\n      const aStart = (moment as any)(a.task.props[\"start\"], \"YYYY-MM-DD\");\r\n      const bStart = (moment as any)(b.task.props[\"start\"], \"YYYY-MM-DD\");\r\n      return this.sortAsc ? aStart.diff(bStart) : bStart.diff(aStart);\r\n    });\r\n\r\n    // In start date mode, render tasks directly without project headers\r\n    // Project information will be shown in tooltips instead\r\n    allTasks.forEach(({task, project}) => {\r\n      renderTask(task, project);\r\n    });\r\n    \r\n    // Add heatmap support for flat task list\r\n    const heatmapEnabled: boolean = this.plugin.settings.showHeatmap ?? true;\r\n    if (heatmapEnabled) {\r\n      // Build heat data from all tasks\r\n      const heat: Record<number, number> = {};\r\n      \r\n      // Collect only subtasks (SB-) for heatmap, as per normal mode\r\n      const allSubtasks: Array<{task: TaskItem, project: ProjectEntry}> = [];\r\n      projects.forEach((project: ProjectEntry) => {\r\n        if (this.hiddenProjects.has(project.file.path)) return;\r\n        \r\n        project.tasks.forEach((task: TaskItem) => {\r\n          // Only include subtasks (SB-) in heatmap\r\n          if (task.id.toLowerCase().startsWith('sb')) {\r\n            const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n            const dueIso = (task.props[\"due\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n            if (startIso && dueIso) {\r\n              // @ts-ignore callable moment\r\n              const start = (moment as any)(startIso, \"YYYY-MM-DD\");\r\n              // @ts-ignore callable moment\r\n              const due = (moment as any)(dueIso, \"YYYY-MM-DD\");\r\n              if (start.isValid() && due.isValid()) {\r\n                allSubtasks.push({task, project});\r\n              }\r\n            }\r\n          }\r\n        });\r\n      });\r\n      \r\n      // Build heat data\r\n      allSubtasks.forEach(({task}) => {\r\n        const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n        const dueIso = (task.props[\"due\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n        if (startIso && dueIso) {\r\n          // @ts-ignore callable moment\r\n          const start = (moment as any)(startIso, \"YYYY-MM-DD\");\r\n          // @ts-ignore callable moment\r\n          const due = (moment as any)(dueIso, \"YYYY-MM-DD\");\r\n          if (start.isValid() && due.isValid()) {\r\n            const startOff = start.diff(today, \"days\");\r\n            const spanDays = Math.max(due.diff(start, \"days\") + 1, 1);\r\n            \r\n            // Add heat for each day in the task's range\r\n            for (let i = 0; i < spanDays; i++) {\r\n              const dayOffset = startOff + i;\r\n              heat[dayOffset] = (heat[dayOffset] || 0) + 1;\r\n            }\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Render the heatmap\r\n      this.renderHeatmap(heat, pxPerDay, horizon);\r\n      \r\n      // Show the heatmap strip\r\n      if (this.heatLayerEl) {\r\n        (this.heatLayerEl as HTMLElement).style.display = \"block\";\r\n      }\r\n      \r\n      // Keep header transparent so the strip shows through\r\n      const headerWrap = this.containerEl.querySelector<HTMLElement>(\".pm-tl-headwrap\");\r\n      if (headerWrap) {\r\n        headerWrap.style.background = \"transparent\";\r\n      }\r\n    } else {\r\n      // Hide heatmap if disabled\r\n      if (this.heatLayerEl) {\r\n        const hl = this.heatLayerEl as HTMLElement;\r\n        hl.style.display = \"none\";\r\n        hl.innerHTML = \"\";\r\n      }\r\n      \r\n      // Apply solid fallback background to header rows\r\n      const headerWrap = this.containerEl.querySelector<HTMLElement>(\".pm-tl-headwrap\");\r\n      if (headerWrap) {\r\n        headerWrap.style.background = \"var(--background-primary, var(--background-secondary, #fff))\";\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Efficiently update zoom-related styles without full render */\r\n  private updateZoomStyles(pxPerDay: number, horizon: number) {\r\n    const minWidth = `${(horizon + 1) * pxPerDay}px`;\r\n    \r\n    // Update header width\r\n    const headerWrap = this.containerEl.querySelector<HTMLElement>(\".pm-tl-header-wrap\");\r\n    if (headerWrap) {\r\n      headerWrap.style.minWidth = minWidth;\r\n    }\r\n    \r\n    // Update all cached row widths in one batch\r\n    if (this.timelineRows.length > 0) {\r\n      this.timelineRows.forEach(row => {\r\n        row.style.minWidth = minWidth;\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n\r\n  /** Allow Portfolio view to refresh the project filter at runtime */\r\n  public updateFilter(paths: string[], name?: string) {\r\n    this.filterPaths = new Set(paths);\r\n    this.filterName  = name;\r\n    this.batchRender(\"filter-update\");\r\n  }\r\n\r\n  async onClose() {\r\n    this.detachFn?.();\r\n    this.splitterRO?.disconnect();\r\n    this.splitterRO = null;\r\n    if (this.renderTimeout) {\r\n      clearTimeout(this.renderTimeout);\r\n      this.renderTimeout = null;\r\n    }\r\n    if (this.renderBatchTimeout) {\r\n      clearTimeout(this.renderBatchTimeout);\r\n      this.renderBatchTimeout = null;\r\n    }\r\n    // Clear row cache to prevent memory leaks\r\n    this.timelineRows = [];\r\n    \r\n    // Clean up any lingering tooltips\r\n    document.querySelectorAll(\".pm-dash-tooltip\").forEach(el => el.remove());\r\n  }\r\n\r\n  /**\r\n   * Opens the given markdown file (re‑uses current leaf) and scrolls to the\r\n   * specified block reference (`^id`). It first tries the rendered element;\r\n   * if that never appears within 1.2 s, it falls back to scrolling the editor\r\n   * to the provided line number.\r\n   */\r\n  private openAndScroll(path: string, blockId: string, line?: number) {\r\n    const target = `${path}#^${blockId}`;\r\n\r\n    // Open (or jump) in current leaf\r\n    this.app.workspace.openLinkText(target, \"\", false);\r\n\r\n    // Try until success or timeout\r\n    const startTime = Date.now();\r\n    const tryScroll = () => {\r\n      const mdView = this.app.workspace.getActiveViewOfType(MarkdownView);\r\n      if (!mdView) {\r\n        requestAnimationFrame(tryScroll);\r\n        return;\r\n      }\r\n\r\n      const el = mdView.containerEl.querySelector(`[id=\"${blockId}\"]`);\r\n      if (el) {\r\n        el.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\r\n\r\n        /* --- temporary highlight so the user sees the target task --- */\r\n        el.classList.add(\"pm-scroll-highlight\");\r\n        setTimeout(() => el.classList.remove(\"pm-scroll-highlight\"), 2000);\r\n\r\n        return; // success\r\n      }\r\n\r\n      const elapsed = Date.now() - startTime;\r\n      if (elapsed < 1200) {\r\n        requestAnimationFrame(tryScroll);\r\n      } else if (line != null && mdView.editor) {\r\n        // Fallback: ensure the editor scrolls even if the element never rendered\r\n        mdView.editor.scrollIntoView(\r\n          { from: { line, ch: 0 }, to: { line: line + 1, ch: 0 } },\r\n          true\r\n        );\r\n      }\r\n    };\r\n\r\n    requestAnimationFrame(tryScroll);\r\n  }\r\n\r\n  private render() {\r\n    const el = this.containerEl;\r\n    /* Make sure only one observer is active */\r\n    this.splitterRO?.disconnect();\r\n    this.splitterRO = null;\r\n    \r\n    /* Clear row cache for fresh references */\r\n    this.timelineRows = [];\r\n    \r\n    /* Remove any floating tooltip from a previous render */\r\n    document.querySelectorAll(\".pm-dash-tooltip\").forEach(el => el.remove());\r\n    \r\n    // Additional cleanup for any lingering tooltips\r\n    const cleanupTooltips = () => {\r\n      document.querySelectorAll(\".pm-dash-tooltip\").forEach(el => el.remove());\r\n    };\r\n    \r\n    // Clean up tooltips when switching modes or re-rendering\r\n    cleanupTooltips();\r\n    /* ── Shared tooltip reused by every bar ───────────────────────────── */\r\n    let barTip: HTMLElement | null = null;\r\n    const showBarTip = (html: string, rect: DOMRect) => {\r\n      /* Only show tooltips if the setting is enabled */\r\n      if (this.plugin.settings.showTooltips === false) return;\r\n      \r\n      /* Create or reuse floating tooltip element */\r\n      if (!barTip || !document.body.contains(barTip)) {\r\n        barTip?.remove();\r\n        barTip = document.createElement(\"div\");\r\n        barTip.className = \"pm-dash-tooltip\";\r\n        document.body.appendChild(barTip);\r\n      }\r\n      barTip.innerHTML = html;\r\n\r\n      const pad = 8;\r\n      const w   = barTip.offsetWidth;\r\n      /* Horizontal clamp */\r\n      let left = rect.right + pad;\r\n      if (left + w > window.innerWidth - pad) {\r\n        left = Math.max(rect.left - pad - w, pad);\r\n      }\r\n\r\n      /* Vertical clamp */\r\n      const h   = barTip.offsetHeight;\r\n      let top   = Math.max(rect.top, 48);              // keep below sticky header\r\n      if (top + h > window.innerHeight - pad) {\r\n        top = Math.max(window.innerHeight - h - pad, 48);\r\n      }\r\n\r\n      barTip.style.left = `${left}px`;\r\n      barTip.style.top  = `${top}px`;\r\n    };\r\n    const hideBarTip = () => { barTip?.remove(); barTip = null; };\r\n    /* Generic hover helper for icons (always shows, not affected by tooltip setting) */\r\n    const attachTip = (el: HTMLElement, text: string) => {\r\n      let iconTip: HTMLElement | null = null;\r\n      \r\n      el.addEventListener(\"mouseenter\", (ev) => {\r\n        const m = ev as MouseEvent;\r\n        \r\n        /* Create floating tooltip element for icons */\r\n        iconTip = document.createElement(\"div\");\r\n        iconTip.className = \"pm-dash-tooltip\";\r\n        iconTip.innerHTML = `<span>${text}</span>`;\r\n        document.body.appendChild(iconTip);\r\n\r\n        const pad = 8;\r\n        const w   = iconTip.offsetWidth;\r\n        /* Horizontal clamp */\r\n        let left = m.clientX + pad;\r\n        if (left + w > window.innerWidth - pad) {\r\n          left = Math.max(m.clientX - pad - w, pad);\r\n        }\r\n\r\n        /* Vertical clamp */\r\n        const h   = iconTip.offsetHeight;\r\n        let top   = Math.max(m.clientY + 6, 48);              // keep below sticky header\r\n        if (top + h > window.innerHeight - pad) {\r\n          top = Math.max(window.innerHeight - h - pad, 48);\r\n        }\r\n\r\n        iconTip.style.left = `${left}px`;\r\n        iconTip.style.top  = `${top}px`;\r\n      });\r\n      \r\n      el.addEventListener(\"mouseleave\", () => {\r\n        if (iconTip && document.body.contains(iconTip)) {\r\n          iconTip.remove();\r\n          iconTip = null;\r\n        }\r\n      });\r\n    };\r\n    /* Pull updated default zoom from settings in case the user changed it via Settings */\r\n    this.zoomPxPerDay = this.plugin.settings.zoomPxPerDay ?? this.zoomPxPerDay;\r\n    /* Capture scroll offsets of existing layout */\r\n    const prevRight = this.containerEl.querySelector<HTMLElement>(\".pm-tl-right\");\r\n    const restoreScroll = this.pendingScroll ?? {\r\n      v: prevRight?.scrollTop ?? 0,\r\n      h: prevRight?.scrollLeft ?? 0,\r\n    };\r\n    el.empty();\r\n    /* ---------- sticky top header that holds the zoom slider ---------- */\r\n    const topHeader = this.containerEl.createEl(\"div\", { cls: \"pm-tl-topheader\" });\r\n    /* ── global project-column controls (eye, sort-chevron, fold-all) ── */\r\n    const topControls = topHeader.createEl(\"div\", { cls: \"pm-top-controls\" });\r\n    /* Ensure top‑controls (eye, fold, calendar icons, etc.) sit above zoomWrap */\r\n    topControls.style.position = \"relative\";\r\n    topControls.style.zIndex = \"8\";    // zoomWrap uses z‑index 6\r\n    \r\n    /* Right-hand timeline controls (all icons) */\r\n    const rightControls = topHeader.createEl(\"div\", { cls: \"pm-top-right\" });\r\n    rightControls.style.position   = \"absolute\";\r\n    rightControls.style.zIndex     = \"8\";\r\n    \r\n    // Helper: keep the icon block exactly 8 px to the right of the splitter\r\n    const alignIcons = () => {\r\n      const splitRect  = globalSplit.getBoundingClientRect();\r\n      const headerRect = topHeader.getBoundingClientRect();\r\n      const off        = splitRect.left - headerRect.left + 8; // 8-px gap\r\n      rightControls.style.left = `${off}px`;\r\n    };\r\n    \r\n    // heat‑map element was removed by .empty(); reset so next render re‑creates it\r\n    this.heatLayerEl = null;\r\n    // Remove any lingering arrow-layer SVG from an earlier render\r\n    this.containerEl.querySelectorAll(\"svg.pm-arrow-layer\").forEach(svg => svg.remove());\r\n\r\n    // Remove global offset on topControls (if present)\r\n    // topControls.style.marginLeft = `${this.labelWidth}px`;\r\n\r\n    // ── outer flex container ─────────────\r\n    const outer = el.createEl(\"div\", { cls: \"pm-tl-outer\" });\r\n    outer.style.position = \"relative\";   // so absolutely‑positioned children (splitter) anchor here\r\n    outer.style.height   = \"100%\";\r\n\r\n    /** Store bar geometry for dependency arrows */\r\n    const barsById: Record<string, { x: number; w: number; el: HTMLElement }> = {};\r\n    /** Task lookup so we can check project equality when drawing arrows */\r\n    const tasksById = new Map<string, TaskItem>();\r\n    /** Helper: strip leading ^ and force lower‑case for reliable matching */\r\n    const norm = (raw: string) => raw.replace(/^\\^/, \"\").trim().toLowerCase();\r\n\r\n    const key = (taskOrId: TaskItem | string, filePath?: string) =>\r\n          (typeof taskOrId === \"string\"\r\n          ? filePath! + \"::\" + norm(taskOrId)\r\n          : taskOrId.file.path + \"::\" + norm(taskOrId.id));\r\n\r\n    /** Return a description for a task using a three‑step, robust heuristic. */\r\n    const getDescription = (t: TaskItem): string => {\r\n      /* 1️⃣  Any prop whose key (after trimming NBSP/space and lower‑casing)\r\n             equals \"description\" */\r\n      for (const [rawK, rawV] of Object.entries(t.props)) {\r\n        const k = rawK.replace(/\\u00A0/g, \" \").trim().toLowerCase();\r\n        if (k === \"description\") {\r\n          const v = rawV.replace(/\\u00A0/g, \" \").trim();\r\n          if (v) return v;\r\n        }\r\n      }\r\n\r\n      /* 2️⃣  Table‑row heuristic: capture the cell under the \"Description\" column.\r\n             We assume the first cell holds the ID, so try cell[1] first; if that\r\n             looks like a date or is blank, fall back to scanning right‑to‑left\r\n             for the first non‑date cell. */\r\n      if (t.text.includes(\"|\")) {\r\n        const cells = t.text.split(\"|\").map(s => s.replace(/\\u00A0/g, \" \").trim());\r\n        if (cells.length && cells[0] === \"\") cells.shift();           // leading pipe\r\n        if (cells.length && cells[cells.length - 1] === \"\") cells.pop(); // trailing pipe\r\n\r\n        const dateRe = /^\\d{4}-\\d{2}-\\d{2}$/;\r\n\r\n        /* Prefer the cell immediately after the ID (index 1) */\r\n        if (cells.length >= 2) {\r\n          const cand = cells[1];\r\n          if (cand && !dateRe.test(cand)) return cand;\r\n        }\r\n\r\n        /* Fallback: walk from right to left, pick first non‑date, non‑blank cell */\r\n        for (let i = cells.length - 1; i >= 0; i--) {\r\n          const cell = cells[i];\r\n          if (cell && !dateRe.test(cell)) return cell;\r\n        }\r\n      }\r\n\r\n      /* 3️⃣  Extra lines under the checkbox bullet */\r\n      const lines = t.text\r\n        .split(\"\\n\")\r\n        .slice(1)\r\n        .map(s => s.trim())\r\n        .filter(Boolean);\r\n      return lines.join(\" \");\r\n    };\r\n    \r\n    /** Heat‑map data: day offset → overlapping‑task count */\r\n    const heat: Record<number, number> = {};\r\n    /** Milestone guideline data */\r\n    const milestoneOffsets = new Set<number>();          // unique day offsets\r\n    const milestoneMap     = new Map<number, string>();  // (future) offset → tooltip\r\n    const addHeat = (startOffset: number, span: number) => {\r\n      for (let i = 0; i < span; i++) {\r\n        // @ts-ignore Obsidian bundles callable moment\r\n        const dayOfWeek = (moment as any)()\r\n          .startOf(\"day\")\r\n          .add(startOffset + i, \"days\")\r\n          .day();               // 0 = Sun, 6 = Sat\r\n        if (dayOfWeek === 0 || dayOfWeek === 6) continue;  // skip weekends\r\n        heat[startOffset + i] = (heat[startOffset + i] ?? 0) + 1;\r\n      }\r\n    };\r\n    \r\n    /* --- all tasks per file (includes undated ones) ---------------- */\r\n    const allTasksByPath = new Map<string, TaskItem[]>();\r\n    this.cache.tasks.forEach((t) => {\r\n      const arr = allTasksByPath.get(t.file.path) ?? [];\r\n      arr.push(t);\r\n      allTasksByPath.set(t.file.path, arr);\r\n    });\r\n\r\n    // fixed‑width left pane (project names)\r\n    const leftPane = outer.createEl(\"div\", { cls: \"pm-tl-left\" });\r\n    leftPane.style.width = `${this.labelWidth}px`;\r\n\r\n    // scrollable right pane (timeline grid + bars)\r\n    const rightPane = outer.createEl(\"div\", { cls: \"pm-tl-right\" });\r\n    rightPane.style.overflow = \"visible\";\r\n    rightPane.style.overflowX = \"auto\";\r\n    /* keep project column vertically in sync with timeline scroll */\r\n    rightPane.addEventListener(\"scroll\", () => {\r\n      leftPane.scrollTop = rightPane.scrollTop;\r\n    });\r\n\r\n    /* Allow mouse‑wheel on the fixed project column to scroll the timeline */\r\n    leftPane.addEventListener(\r\n      \"wheel\",\r\n      (ev) => {\r\n        rightPane.scrollTop += ev.deltaY;\r\n        ev.preventDefault();        /* avoid rubber‑band / no‑scroll feeling */\r\n      },\r\n      { passive: false }\r\n    );\r\n\r\n\r\n    /* ────── shared SVG layer for ALL dependency arrows ───────── */\r\n    const svgNS = \"http://www.w3.org/2000/svg\";\r\n    const arrowLayer = document.createElementNS(svgNS, \"svg\");\r\n    arrowLayer.classList.add(\"pm-arrow-layer\");\r\n    arrowLayer.style.position = \"absolute\";\r\n    arrowLayer.style.top      = \"0\";\r\n    arrowLayer.style.left     = \"0\";\r\n    arrowLayer.style.width    = \"100%\";\r\n    arrowLayer.style.height   = \"100%\";\r\n\r\n    arrowLayer.style.overflow  = \"visible\";          // ← new\r\n    arrowLayer.setAttribute(\"preserveAspectRatio\", \"none\"); // ← new\r\n    \r\n    /* new: keep SVG above rows & let clicks pass through */\r\n    arrowLayer.style.zIndex = \"50\";\r\n    arrowLayer.style.pointerEvents = \"none\";\r\n    // Insert arrowLayer *after* all project rows so SVG sits above all rows\r\n    rightPane.appendChild(arrowLayer);   // SVG sits above all rows\r\n\r\n    /* ---------- month‑start & weekend guide lines (auto height) ---------- */\r\n    const injectGuidelines = () => {\r\n      // Remove previous guideline DIVs\r\n      rightPane\r\n        .querySelectorAll(\".pm-month-line, .pm-weekend-line, .pm-today-line, .pm-milestone-line, .pm-milestone-label\")\r\n        .forEach(el => el.remove());\r\n\r\n      const lastRow = rightPane.querySelector<HTMLElement>(\".pm-tl-row:last-child\");\r\n      if (!lastRow) return;\r\n\r\n      const headerHeight = headerWrap.offsetHeight;\r\n      const totalHeight  = lastRow.offsetTop + lastRow.offsetHeight - headerHeight;\r\n\r\n      const addLine = (cls: string, left: number, width: number) => {\r\n        const div = document.createElement(\"div\");\r\n        div.className   = cls;\r\n        div.style.left  = `${left}px`;\r\n        div.style.top   = `${headerHeight}px`;\r\n        div.style.width = `${width}px`;\r\n        div.style.height= `${totalHeight}px`;\r\n\r\n        if (cls === \"pm-milestone-line\" || cls === \"pm-today-line\") {\r\n          /* Make milestone + today bars hoverable */\r\n          if (width < 4) div.style.width = \"4px\";     // easy hit‑area\r\n          div.style.pointerEvents = \"auto\";\r\n\r\n          /* Build tooltip HTML */\r\n          let html: string | undefined;\r\n          if (cls === \"pm-milestone-line\") {\r\n            const off = Math.round(left / pxPerDay);\r\n            const fullData = milestoneMap.get(off);\r\n            if (fullData) {\r\n              html = fullData.split('|||')[0];  // Extract HTML part\r\n            }\r\n          } else { /* today bar */\r\n            // Show the real calendar date, not the timeline anchor\r\n            // @ts-ignore callable moment bundled by Obsidian\r\n            html = `<strong>Today</strong><br>${(moment as any)().format(\"YYYY-MM-DD\")}`;\r\n          }\r\n\r\n          if (html) {\r\n            div.addEventListener(\"mouseenter\", (ev) => {\r\n              const m = ev as MouseEvent;\r\n              const fake = {\r\n                left:   m.clientX,\r\n                right:  m.clientX,\r\n                top:    m.clientY,\r\n                bottom: m.clientY,\r\n                width:  0,\r\n                height: 0,\r\n              } as DOMRect;\r\n              showBarTip(html!, fake);\r\n            });\r\n            div.addEventListener(\"mouseleave\", hideBarTip);\r\n          }\r\n        } else {\r\n          /* Other guideline lines stay transparent */\r\n          div.style.pointerEvents = \"none\";\r\n        }\r\n        rightPane.appendChild(div);\r\n      };\r\n\r\n      // Scan header day‑cells once\r\n      gridRow.querySelectorAll<HTMLElement>(\".pm-tl-daycell\").forEach(cell => {\r\n        const x = cell.offsetLeft;\r\n        if (cell.classList.contains(\"pm-tl-month-start\"))\r\n          addLine(\"pm-month-line\", x, 2);\r\n        if (cell.classList.contains(\"pm-tl-weekend\"))\r\n          addLine(\"pm-weekend-line\", x, pxPerDay);\r\n        if (cell.classList.contains(\"pm-tl-today\"))\r\n          addLine(\"pm-today-line\", x, 2);\r\n      });\r\n      /* ---- milestone guideline lines ---- */\r\n      if (this.plugin.settings.showMilestones !== false) {\r\n        milestoneOffsets.forEach((offset) => {\r\n          const leftPx = offset * pxPerDay;\r\n          addLine(\"pm-milestone-line\", leftPx, 2);   // thin 2-px bar\r\n          \r\n          // Add milestone title label in header area\r\n          const milestoneData = milestoneMap.get(offset);\r\n          if (milestoneData) {\r\n            // Extract label text from stored data\r\n            const parts = milestoneData.split('|||');\r\n            if (parts.length > 1) {\r\n              const labelText = parts[1];\r\n              const label = document.createElement(\"div\");\r\n              label.className = \"pm-milestone-label\";\r\n              label.textContent = labelText;\r\n              label.style.position = \"absolute\";\r\n              label.style.left = `${leftPx + 4}px`;\r\n              label.style.top = \"2px\";  // Top of header area\r\n              label.style.fontSize = \"11px\";\r\n              label.style.fontWeight = \"700\";\r\n              label.style.color = \"var(--color-orange)\";\r\n              label.style.backgroundColor = \"var(--background-primary)\";\r\n              label.style.padding = \"2px 5px\";\r\n              label.style.borderRadius = \"3px\";\r\n              label.style.whiteSpace = \"nowrap\";\r\n              label.style.pointerEvents = \"none\";\r\n              label.style.zIndex = \"1000\";  // Very high to stay on top\r\n              label.style.boxShadow = \"0 2px 4px rgba(0,0,0,0.3)\";\r\n              label.style.border = \"1px solid var(--color-orange)\";\r\n              headerWrap.appendChild(label);  // Add to header instead of rightPane\r\n            }\r\n          }\r\n        });\r\n      }      \r\n    };\r\n\r\n    // Inject guidelines once layout is settled\r\n    setTimeout(injectGuidelines, 0);\r\n    \r\n    // Add spacers at the bottom to ensure vertical scrolling works\r\n    setTimeout(() => {\r\n      // Right pane spacer\r\n      const rightSpacer = rightPane.createEl(\"div\", { cls: \"pm-tl-bottom-spacer\" });\r\n      rightSpacer.style.height = \"100px\";\r\n      rightSpacer.style.width = \"100%\";\r\n      rightSpacer.style.flexShrink = \"0\";\r\n      \r\n      // Left pane spacer (to keep in sync)\r\n      const leftSpacer = leftPane.createEl(\"div\", { cls: \"pm-tl-bottom-spacer\" });\r\n      leftSpacer.style.height = \"100px\";\r\n      leftSpacer.style.width = \"100%\";\r\n      leftSpacer.style.flexShrink = \"0\";\r\n    }, 100);\r\n    /* ---------- dependency arrows ---------- */\r\n\r\n    // Read arrow‑toggle setting (default true)\r\n    const arrowsEnabled: boolean =\r\n      (this.app as any).plugins.plugins[\"project-management\"]?.settings\r\n        ?.showArrows ?? true;\r\n    /** When TRUE we show only one bar per project (no per‑task rows) */\r\n    const barsMode: boolean =\r\n      !((this.app as any).plugins.plugins[\"project-management\"]?.settings\r\n        ?.showTasksInTimeline ?? true);\r\n    // Toggle for heat‑map strip\r\n    // @ts-ignore runtime has .plugins\r\n    const heatmapEnabled: boolean =\r\n      (this.app as any).plugins.plugins[\"project-management\"]?.settings\r\n        ?.showHeatmap ?? true;\r\n\r\n    // Hide the arrow layer entirely when disabled\r\n    if (!arrowsEnabled) {\r\n      arrowLayer.style.display = \"none\";\r\n    }\r\n    \r\n    // make the right pane horizontally scrollable\r\n    rightPane.style.overflowX = \"auto\";\r\n    rightPane.style.position  = \"relative\";   // context for sticky header\r\n\r\n    /* helper to normalise vault‑relative paths: strip NBSP, trim, lower‑case, remove \".md\" */\r\n    const normPath = (p: string) =>\r\n      p.replace(/\\u00A0/g, \" \")\r\n        .trim()\r\n        .toLowerCase()\r\n        .replace(/\\.md$/, \"\");\r\n\r\n    /** Detect whether a task is completed (same logic as dashboard) */\r\n    function tlIsTaskDone(t: ExtendedTaskItem): boolean {\r\n      if (t.done === true || t.checked === true) return true;\r\n      if (typeof t.done === \"string\" && t.done.toLowerCase() === \"done\") return true;\r\n      if (typeof t.percentComplete === \"number\" && t.percentComplete >= 1) return true;\r\n      const raw = (t.raw ?? t.text ?? \"\").toString();\r\n      return /^\\s*-\\s*\\[[xX]\\]/.test(raw);\r\n    }\r\n    \r\n    /** Detect whether a task is on-hold */\r\n    function tlIsTaskOnHold(t: TaskItem): boolean {\r\n      return t.status === \"on-hold\";\r\n    }\r\n\r\n    const filterSet = this.filterPaths\r\n      ? new Set(Array.from(this.filterPaths).map(normPath))\r\n      : undefined;\r\n\r\n    /** True when the project is not hidden and (no portfolio filter is active\r\n     *  OR it belongs to the active filter). */\r\n    const isProjectVisible = (filePath: string): boolean => {\r\n      if (this.hiddenProjects.has(filePath)) return false;           // eye‑icon off\r\n      if (filterSet && !filterSet.has(normPath(filePath))) return false; // outside filter\r\n      return true;\r\n    };\r\n\r\n    const projects = Array.from(this.cache.projects.values())\r\n      .filter(p => !filterSet || filterSet.has(normPath(p.file.path)))\r\n      .sort((a, b) =>\r\n        this.sortAsc\r\n          ? a.file.basename.localeCompare(b.file.basename)\r\n          : b.file.basename.localeCompare(a.file.basename)\r\n      );\r\n    /* Collect the full paths and basenames of *visible* projects (i.e. those\r\n       that will have a row in the project column). We'll use this to filter\r\n       milestone guideline bars so we never show milestones from projects that\r\n       aren't listed. */\r\n    const visiblePaths  = new Set(projects.map(p => p.file.path));\r\n    const visibleBases  = new Set(\r\n      projects.map(p => p.file.basename.toLowerCase())\r\n    );\r\n    /* Lower‑cased, \".md\"‑stripped version of each visible file path */\r\n    const visiblePathsNorm = new Set(\r\n      projects.map(p => normPath(p.file.path))\r\n    );\r\n    \r\n    /* ---------- calendar header (sticky) ---------- */\r\n    const pxPerDay = this.zoomPxPerDay;   // zoomable px/day\r\n\r\n    /* ─── anchor \"today\" either to settings.timelineStart or the real today ─── */\r\n    // @ts-ignore callable moment\r\n    const today =\r\n      this.plugin.settings.timelineStart && this.plugin.settings.timelineStart !== \"\"\r\n        ? (moment as any)(\r\n            this.plugin.settings.timelineStart,\r\n            \"YYYY-MM-DD\"\r\n          ).startOf(\"day\")\r\n        : (moment as any)().startOf(\"day\");\r\n\r\n\r\n    /* ----- Horizon: show at least 12 full calendar months,\r\n             or up to the end‑of‑month containing the latest due task ----- */\r\n    let horizon = 30;   // minimum ≈ one month\r\n\r\n    // 1️⃣ furthest due‑date month‑end (if any)\r\n    let latestEndDays = 0;\r\n    (() => {\r\n      let latest: moment.Moment | null = null;\r\n      this.cache.tasks.forEach(t => {\r\n        const iso = (t.props[\"due\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n        if (!iso) return;\r\n        // @ts-ignore Obsidian bundles callable moment\r\n        const d = (moment as any)(iso, \"YYYY-MM-DD\");\r\n        if (d.isValid() && (!latest || d.isAfter(latest))) latest = d;\r\n      });\r\n      if (latest) {\r\n        const lastDay = (latest as any).endOf(\"month\");\r\n        latestEndDays = lastDay.diff((moment as any)().startOf(\"day\"), \"days\") + 1;\r\n      }\r\n    })();\r\n\r\n    // 2️⃣ exactly 12 months from today → end of that future month\r\n    // @ts-ignore callable moment\r\n    const oneYearEnd = (moment as any)().add(11, \"months\").endOf(\"month\");\r\n    const oneYearDays = oneYearEnd.diff((moment as any)().startOf(\"day\"), \"days\") + 1;\r\n\r\n    horizon = Math.max(30, latestEndDays, oneYearDays);\r\n    /* User-defined end date overrides horizon */\r\n    if (this.plugin.settings.timelineEnd && this.plugin.settings.timelineEnd !== \"\") {\r\n      // @ts-ignore callable moment\r\n      const end = (moment as any)(\r\n        this.plugin.settings.timelineEnd,\r\n        \"YYYY-MM-DD\"\r\n      ).endOf(\"day\");\r\n      if (end.isValid() && end.isAfter(today)) {\r\n        horizon = end.diff(today, \"days\") + 1;\r\n      }\r\n    }\r\n    const headerWrap = rightPane.createEl(\"div\", { cls: \"pm-tl-headwrap\" });\r\n    // header grid begins exactly where bars start (right after the label)\r\n    headerWrap.style.marginLeft = \"0px\";          // header starts flush with timeline\r\n\r\n    \r\n    /* ---------- global splitter (absolute, covers all rows) ---------- */\r\n    const globalSplit = outer.createEl(\"div\", { cls: \"pm-tl-splitter\" });\r\n    //globalSplit.style.position = \"sticky\";  // keep splitter fixed when scrolling\r\n    // start at the current column edge\r\n    globalSplit.style.left = `${this.labelWidth}px`;\r\n    globalSplit.style.top    = \"0\";\r\n    globalSplit.style.bottom = \"100%\";\r\n    alignIcons();  // initial icon alignment\r\n    \r\n    /* keep splitter as tall as the entire list OR the viewport (whichever is taller) */\r\n    const syncSplitterHeight = () => {\r\n      const viewportH = this.containerEl.clientHeight;   // full height of the pane\r\n\r\n      /* Make sure the outer wrapper itself stretches to at least pane height */\r\n      outer.style.minHeight = `${viewportH}px`;\r\n\r\n      /* Choose the larger of content height vs. viewport height */\r\n      const h = Math.max(\r\n        viewportH,\r\n        outer.scrollHeight,\r\n        outer.clientHeight,\r\n        rightPane.scrollHeight,\r\n        rightPane.clientHeight\r\n      );\r\n      globalSplit.style.height = `${h}px`;\r\n    };\r\n    syncSplitterHeight();             // initial\r\n    setTimeout(syncSplitterHeight, 0); // after bars render\r\n    outer.addEventListener(\"scroll\", syncSplitterHeight);\r\n    window.addEventListener(\"resize\", syncSplitterHeight);\r\n    // Also resize splitter when the pane itself is dragged taller / shorter\r\n    this.splitterRO = new ResizeObserver(() => syncSplitterHeight());\r\n    this.splitterRO.observe(this.containerEl);\r\n    \r\n    let splitDragId: number | null = null;   /* active pointer id for splitter */\r\n    let dragging = false;\r\n\r\n    globalSplit.addEventListener(\"pointerdown\", (e: PointerEvent) => {\r\n      if (e.button !== 0) return;        // left button only\r\n      e.preventDefault();                // stop native selection/drag\r\n      dragging     = true;\r\n      splitDragId  = e.pointerId;\r\n      globalSplit.setPointerCapture(e.pointerId);\r\n      document.body.style.userSelect = \"none\";\r\n      document.body.classList.add(\"pm-noselect\");\r\n      e.stopPropagation();               // prevent bar‑drag or text selection\r\n    });\r\n\r\n    /* handle move on the splitter itself (pointer capture keeps events flowing) */\r\n    globalSplit.addEventListener(\"pointermove\", (e: PointerEvent) => {\r\n      if (!dragging || e.pointerId !== splitDragId) return;\r\n\r\n      /* Determine widest label (project or task) each time we drag */\r\n      const labels = leftPane.querySelectorAll<HTMLElement>(\".pm-tl-label\");\r\n      let widest = 0;\r\n      labels.forEach(l => { widest = Math.max(widest, l.scrollWidth); });\r\n      const maxWidth = Math.max(120, Math.min(widest + 32, 800));\r\n\r\n      const newWidth = Math.max(\r\n        80,\r\n        Math.min(maxWidth, e.clientX - outer.getBoundingClientRect().left)\r\n      );\r\n      this.labelWidth          = newWidth;\r\n      globalSplit.style.left   = `${newWidth}px`;\r\n      leftPane.style.width     = `${newWidth}px`;\r\n      // Update project-header width as well\r\n      const hdr = leftPane.querySelector<HTMLElement>(\".pm-tl-nameheader\");\r\n      if (hdr) hdr.style.width = `${newWidth}px`;\r\n      leftPane.querySelectorAll<HTMLElement>(\".pm-tl-label\")\r\n        .forEach(l => {\r\n          const hasCaret = l.previousElementSibling?.classList.contains(\"pm-fold-caret\");\r\n          const indentPx = parseFloat(l.style.marginLeft || \"0\");\r\n          const caretW = hasCaret ? 18 : 0;\r\n          \r\n          // Account for additional elements before the label\r\n          let extraWidth = 0;\r\n          const parent = l.parentElement;\r\n          if (parent) {\r\n            // Check for check icon or bullet point before the label\r\n            const prevSibling = l.previousElementSibling;\r\n            if (prevSibling) {\r\n              if (prevSibling.classList.contains(\"pm-task-check\")) {\r\n                // Check icon with margin-right: 4px\r\n                extraWidth += 20; // Approximate width of check icon + margin\r\n              } else if (prevSibling.textContent === \"• \") {\r\n                // Bullet point\r\n                extraWidth += 8; // Approximate width of bullet + space\r\n              }\r\n            }\r\n            \r\n            // Check for eye icon after the label (project rows)\r\n            const nextSibling = l.nextElementSibling;\r\n            if (nextSibling && nextSibling.classList.contains(\"pm-project-eye\")) {\r\n              extraWidth += 20; // Approximate width of eye icon\r\n            }\r\n          }\r\n          \r\n          const w = Math.max(newWidth - caretW - indentPx - extraWidth, 0);\r\n          l.style.width = `${w}px`;\r\n        });\r\n      \r\n      alignIcons();  // keep icons glued to splitter while dragging\r\n    });\r\n\r\n    const endSplitDrag = () => {\r\n      if (!dragging) return;\r\n      dragging = false;\r\n      splitDragId = null;\r\n      document.body.style.userSelect = \"\";\r\n      document.body.classList.remove(\"pm-noselect\");\r\n    };\r\n\r\n    globalSplit.addEventListener(\"pointerup\", (e: PointerEvent) => {\r\n      if (e.pointerId === splitDragId) {\r\n        globalSplit.releasePointerCapture(e.pointerId);\r\n        endSplitDrag();\r\n      }\r\n    });\r\n\r\n    globalSplit.addEventListener(\"pointercancel\", endSplitDrag);\r\n    window.addEventListener(\"blur\", endSplitDrag);  // safety: stop drag if window loses focus\r\n\r\n    const gridRow    = headerWrap.createEl(\"div\", { cls: \"pm-tl-header\" });\r\n    const monthRow   = headerWrap.createEl(\"div\", { cls: \"pm-tl-monthrow\" });\r\n    /* allow absolute‑positioned labels */\r\n    monthRow.style.position = \"relative\";\r\n    /* Stretch header so the no‑heatmap background covers the full timeline */\r\n    headerWrap.style.minWidth = `${(horizon + 1) * pxPerDay}px`;\r\n\r\n    /* ---------- zoom slider (top‑right) ---------- */\r\n    // Helper assigned below once zoomWrap exists\r\n    let syncZoomPos: () => void = () => {};\r\n    let zoomWrap = topHeader.querySelector<HTMLDivElement>(\".pm-zoom-wrap\");\r\n    if (!zoomWrap) {\r\n      zoomWrap = topHeader.createEl(\"div\", { cls: \"pm-zoom-wrap\" });\r\n      zoomWrap.style.zIndex = \"6\";\r\n      zoomWrap.style.display = \"flex\";\r\n      zoomWrap.style.alignItems = \"center\";\r\n      zoomWrap.style.gap = \"16px\";\r\n      \r\n      const label = zoomWrap.createEl(\"span\", { cls: \"pm-zoom-label\", text: \"Zoom:\" });\r\n\r\n      const slider = zoomWrap.createEl(\"input\") as HTMLInputElement;\r\n      slider.type  = \"range\";\r\n      slider.min   = \"0\";\r\n      slider.max   = (ZOOM_STOPS.length - 1).toString();\r\n      slider.step  = \"1\";\r\n      /* slider value stores INDEX not pxPerDay */\r\n      slider.value = ZOOM_STOPS.indexOf(this.zoomPxPerDay).toString();\r\n      slider.className = \"pm-zoom-slider\";\r\n\r\n      syncZoomPos = () => {};   // no‑op; top header is outside scroll pane\r\n\r\n      slider.oninput = () => {\r\n        const idx = slider.valueAsNumber;\r\n        const newPx = ZOOM_STOPS[idx];\r\n        if (newPx !== this.zoomPxPerDay) {\r\n          this.zoomPxPerDay               = newPx;\r\n          this.plugin.settings.zoomPxPerDay = newPx;   // persist\r\n          this.pendingSettingsChanges = true;\r\n          \r\n          // Update styles efficiently\r\n          this.updateZoomStyles(this.zoomPxPerDay, horizon);\r\n          syncZoomPos();   // keep slider in view\r\n          this.batchRender(\"zoom-change\");\r\n        }\r\n      };\r\n      \r\n      // Add time navigation slider next to zoom\r\n      const timeNavSep = zoomWrap.createEl(\"span\", { text: \"|\" });\r\n      timeNavSep.style.color = \"var(--text-faint)\";\r\n      timeNavSep.style.margin = \"0 4px\";\r\n      \r\n      const navLabel = zoomWrap.createEl(\"span\", { \r\n        cls: \"pm-time-nav-label\",\r\n        text: \"Timeline:\"\r\n      });\r\n      \r\n      const timeSlider = zoomWrap.createEl(\"input\") as HTMLInputElement;\r\n      timeSlider.type = \"range\";\r\n      timeSlider.min = \"0\";\r\n      timeSlider.max = \"100\";\r\n      timeSlider.value = \"0\";\r\n      timeSlider.className = \"pm-time-slider\";\r\n      \r\n      const dateDisplay = zoomWrap.createEl(\"span\", { cls: \"pm-time-display\" });\r\n      \r\n      // Setup time navigation - will be finalized after rightPane is ready\r\n      requestAnimationFrame(() => {\r\n        const rightEl = this.containerEl.querySelector<HTMLElement>(\".pm-tl-right\");\r\n        if (rightEl && timeSlider && dateDisplay) {\r\n          const totalWidth = horizon * pxPerDay;\r\n          const viewportWidth = rightEl.clientWidth;\r\n          const maxScroll = Math.max(0, totalWidth - viewportWidth);\r\n          \r\n          // Update date display\r\n          const updateDateDisplay = (scrollLeft: number) => {\r\n            const dayOffset = Math.round(scrollLeft / pxPerDay);\r\n            const endDayOffset = Math.min(horizon, dayOffset + Math.round(viewportWidth / pxPerDay));\r\n            // @ts-ignore callable moment\r\n            const startDate = (today.clone() as any).add(dayOffset, \"days\").format(\"MMM DD\");\r\n            // @ts-ignore callable moment\r\n            const endDate = (today.clone() as any).add(endDayOffset, \"days\").format(\"MMM DD, YYYY\");\r\n            dateDisplay.textContent = `${startDate} → ${endDate}`;\r\n          };\r\n          \r\n          // Initialize display\r\n          updateDateDisplay(rightEl.scrollLeft);\r\n          \r\n          // Slider input handler\r\n          timeSlider.oninput = () => {\r\n            const scrollPos = (parseFloat(timeSlider.value) / 100) * maxScroll;\r\n            rightEl.scrollLeft = scrollPos;\r\n            updateDateDisplay(scrollPos);\r\n          };\r\n          \r\n          // Update slider when user scrolls manually\r\n          rightEl.addEventListener(\"scroll\", () => {\r\n            const scrollPercent = maxScroll > 0 ? (rightEl.scrollLeft / maxScroll) * 100 : 0;\r\n            timeSlider.value = scrollPercent.toString();\r\n            updateDateDisplay(rightEl.scrollLeft);\r\n          });\r\n        }\r\n      });\r\n    } else {\r\n      const slider = zoomWrap.querySelector<HTMLInputElement>(\"input\");\r\n      if (slider) slider.value = ZOOM_STOPS.indexOf(this.zoomPxPerDay).toString();\r\n      syncZoomPos = () => {};\r\n    }\r\n\r\n    /* ----- keep zoom slider pinned to the timeline viewport (horizontally) ----- */\r\n\r\n    /* ----- drag anywhere on the zoom wrapper for fluid multi-step zoom ----- */\r\n    {\r\n      const slider = zoomWrap.querySelector<HTMLInputElement>(\"input\");\r\n      if (slider) {\r\n        let dragStartX = 0;\r\n        let dragStartValIdx = 0;   // store index\r\n        let stepPxPerStop = 8;      // will be updated on pointerdown\r\n\r\n        const onDragMove = (ev: PointerEvent) => {\r\n          const deltaPx = ev.clientX - dragStartX;\r\n          /* Convert pointer movement to a floating index and round to nearest stop.\r\n             This lets the slider respond once you cross the mid‑point instead of\r\n             waiting for a full stop width, making it feel snappier. */\r\n          const rawIdx = dragStartValIdx + deltaPx / stepPxPerStop;\r\n          let newIdx   = Math.round(rawIdx);\r\n          newIdx = Math.max(0, Math.min(ZOOM_STOPS.length - 1, newIdx));\r\n\r\n          if (ZOOM_STOPS[newIdx] !== this.zoomPxPerDay) {\r\n            this.zoomPxPerDay = ZOOM_STOPS[newIdx];\r\n            slider.value = newIdx.toString();\r\n            \r\n            // Update styles efficiently\r\n            this.updateZoomStyles(this.zoomPxPerDay, horizon);\r\n            syncZoomPos();   // keep slider pinned while dragging\r\n            \r\n            /* throttle: queue exactly one re-render per animation frame */\r\n            if (!this.zoomRenderScheduled) {\r\n              this.zoomRenderScheduled = true;\r\n              requestAnimationFrame(() => {\r\n                this.zoomRenderScheduled = false;\r\n                this.saveAndRender();\r\n              });\r\n            }\r\n          }\r\n        };\r\n\r\n        const onDragEnd = () => {\r\n          window.removeEventListener(\"pointermove\", onDragMove);\r\n          window.removeEventListener(\"pointerup\", onDragEnd);\r\n          /* if no frame render is pending, render now */\r\n          if (!this.zoomRenderScheduled) {\r\n            this.plugin.settings.zoomPxPerDay = this.zoomPxPerDay;\r\n            this.plugin.saveSettings?.();\r\n            this.saveAndRender();\r\n          }\r\n        };\r\n\r\n        zoomWrap.onpointerdown = (ev: PointerEvent) => {\r\n          // allow drag to start on either the label or slider\r\n          dragStartX = ev.clientX;\r\n          dragStartValIdx = ZOOM_STOPS.indexOf(this.zoomPxPerDay);\r\n\r\n          /* Compute step size based on slider track width */\r\n          const trackWidth = slider.offsetWidth;                 // full track px\r\n          stepPxPerStop    = trackWidth / (ZOOM_STOPS.length - 1);\r\n\r\n          window.addEventListener(\"pointermove\", onDragMove);\r\n          window.addEventListener(\"pointerup\", onDragEnd);\r\n        };\r\n      }\r\n    }\r\n    // mark the real calendar \"today\", not merely the first cell\r\n    // @ts-ignore callable moment\r\n    const realToday = (moment as any)().startOf(\"day\");\r\n    for (let i = 0; i <= horizon; i++) {\r\n      // Use timelineStart anchor (\"today\") instead of real today\r\n      const date = (today.clone() as any).add(i, \"days\");\r\n      const dayCell   = gridRow.createEl(\"div\", { cls: \"pm-tl-daycell\" });\r\n      dayCell.style.width = `${pxPerDay}px`;\r\n\r\n      if (date.isSame(realToday, \"day\")) dayCell.addClass(\"pm-tl-today\");\r\n      if (date.day() === 0 || date.day() === 6) dayCell.addClass(\"pm-tl-weekend\");\r\n\r\n      // Add week start label (Thursday)\r\n      if (date.day() === 4) {\r\n        const weekLabel = dayCell.createEl(\"div\", {\r\n          cls: \"pm-week-label\",\r\n          text: date.format(\"M/D\"),\r\n        });\r\n        weekLabel.style.fontSize = \"10px\";\r\n        weekLabel.style.color = \"var(--text-muted)\";\r\n        weekLabel.style.textAlign = \"center\";\r\n        weekLabel.style.marginTop = \"2px\";\r\n      }\r\n\r\n      if (date.date() === 1) {\r\n        dayCell.addClass(\"pm-tl-month-start\");\r\n\r\n        // month label spanning this month\r\n        const label = monthRow.createEl(\"div\", {\r\n          cls: \"pm-tl-month-label\",\r\n          text: date.format(\"MMM YYYY\"),\r\n        });\r\n        const daysInMonth = date.daysInMonth();\r\n        /* Absolute positioning so the label's left edge equals the month bar position */\r\n        const x = i * pxPerDay;          // i = day offset where this month starts\r\n        label.style.position  = \"absolute\";\r\n        label.style.left      = `${x + 2}px`;         /* 2‑px bar width offset */\r\n        label.style.top       = \"0\";\r\n        label.style.width     = `${Math.min(daysInMonth * pxPerDay, horizon * pxPerDay)}px`;\r\n        label.style.padding   = \"0\";                  /* no extra padding */\r\n        label.style.textAlign = \"left\";\r\n      }\r\n    }\r\n\r\n    /* ---------- project-name column header ---------- */\r\n    const nameHeader = leftPane.createEl(\"div\", { cls: \"pm-tl-nameheader\" });\r\n    nameHeader.createEl(\"span\", { text: \"Project \" });\r\n\r\n    /* sorting icon */\r\n    const sortIcon = topControls.createEl(\"span\");\r\n    setIcon(sortIcon, \"arrow-up-down\");   // dual‑arrow sort icon\r\n    attachTip(sortIcon, \"Sort projects A–Z / Z–A\");\r\n    sortIcon.onclick = (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.sortAsc = !this.sortAsc;\r\n      this.batchRender(\"sort-toggle\");\r\n    };\r\n\r\n    /* ---------- tasks ON/OFF toggle button ---------- */\r\n    const plugin: ProjectManagementPlugin =\r\n      (this.app as any).plugins.plugins[\"project-management\"] as ProjectManagementPlugin;\r\n\r\n    const toggleBtn = topControls.createEl(\"span\", { cls: \"pm-tl-tasktoggle\" });\r\n    const toggleIcon = toggleBtn.createEl(\"span\");\r\n    setIcon(toggleIcon, plugin.settings.showTasksInTimeline ? \"eye\" : \"eye-off\");\r\n    attachTip(toggleBtn, \"Show / hide individual task rows\");\r\n\r\n    toggleBtn.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation(); // don't flip the sort order\r\n      plugin.settings.showTasksInTimeline = !(plugin.settings.showTasksInTimeline ?? true);\r\n      this.pendingSettingsChanges = true;\r\n      setIcon(toggleIcon, plugin.settings.showTasksInTimeline ? \"eye\" : \"eye-off\");\r\n      this.batchRender(\"tasks-toggle\");\r\n    };\r\n\r\n    /* ---------- optional global fold/unfold caret ---------- */\r\n    let allCaret: HTMLSpanElement | null = null;\r\n    let allCaretIcon: HTMLSpanElement | null = null;\r\n    allCaret = topControls.createEl(\"span\", { cls: \"pm-fold-all-caret\" });\r\n    attachTip(allCaret, \"Expand / collapse all projects\");\r\n    allCaretIcon = allCaret.createEl(\"span\");\r\n    setIcon(\r\n      allCaretIcon,\r\n      this.collapsed.size === projects.length ? \"plus-square\" : \"minus-square\"\r\n    );\r\n\r\n    allCaret.onclick = (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      /* toggle collapse state */\r\n      if (this.collapsed.size === projects.length) {\r\n        this.collapsed.clear();               // expand all\r\n      } else {\r\n        projects.forEach((p) => this.collapsed.add(p.file.path)); // collapse all\r\n      }\r\n\r\n      /* update icon only */\r\n      const isCollapsed = this.collapsed.size === projects.length;\r\n      if (allCaretIcon) setIcon(allCaretIcon, isCollapsed ? \"plus-square\" : \"minus-square\");\r\n\r\n      this.batchRender(\"expand-collapse-all\");\r\n    };\r\n\r\n    /* ---------- hide bars when collapsed toggle ---------- */\r\n    const hideBarsToggle = topControls.createEl(\"span\", { cls: \"pm-hide-bars-toggle\" });\r\n    attachTip(hideBarsToggle, \"Hide / show timeline bars when projects are collapsed\");\r\n\r\n    const updateHideBarsIcon = () => {\r\n      setIcon(hideBarsToggle, \"bar-chart-3\");\r\n      hideBarsToggle.classList.toggle(\"off\", this.hideBarsWhenCollapsed);\r\n    };\r\n    updateHideBarsIcon();\r\n\r\n    hideBarsToggle.onclick = (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.hideBarsWhenCollapsed = !this.hideBarsWhenCollapsed;\r\n      updateHideBarsIcon();\r\n      this.batchRender(\"hide-bars-toggle\");\r\n    };\r\n\r\n    /* ---------- heat‑map ON / OFF toggle button ---------- */\r\n    const heatToggle = rightControls.createEl(\"span\", { cls: \"pm-heatmap-toggle\" });\r\n    attachTip(heatToggle, \"Toggle workload heat‑map strip\");\r\n\r\n    /* Always use the same flame icon; dim it when map is off */\r\n    const updateHeatIcon = () => {\r\n      setIcon(heatToggle, \"flame\");\r\n      heatToggle.classList.toggle(\"off\", !this.plugin.settings.showHeatmap);\r\n    };\r\n    updateHeatIcon();\r\n\r\n    heatToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.plugin.settings.showHeatmap = !this.plugin.settings.showHeatmap;\r\n      this.pendingSettingsChanges = true;\r\n      updateHeatIcon();\r\n      this.batchRender(\"heatmap-toggle\");\r\n    };\r\n\r\n    /* ---------- allow-bar-move ON / OFF toggle button ---------- */\r\n    const moveToggle = rightControls.createEl(\"span\", { cls: \"pm-move-toggle\" });\r\n    attachTip(moveToggle, \"Enable / disable bar move & resize\");\r\n\r\n    /* Always use the \"move\" icon; dim it when the feature is disabled */\r\n    const updateMoveIcon = () => {\r\n      setIcon(moveToggle, \"move\");\r\n      moveToggle.classList.toggle(\"off\", this.plugin.settings.allowBarMove === false);\r\n    };\r\n    updateMoveIcon();\r\n\r\n    moveToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      // undefined counts as true; flip boolean\r\n      this.plugin.settings.allowBarMove = this.plugin.settings.allowBarMove === false;\r\n      this.pendingSettingsChanges = true;\r\n      updateMoveIcon();\r\n      this.batchRender(\"move-toggle\");\r\n    };\r\n    \r\n    /* ---------- dependency-arrows ON / OFF toggle button ---------- */\r\n    const arrowToggle = rightControls.createEl(\"span\", { cls: \"pm-arrow-toggle\" });\r\n    attachTip(arrowToggle, \"Show / hide dependency arrows\");\r\n\r\n    /* Always show the same icon; dim when arrows are hidden */\r\n    const updateArrowIcon = () => {\r\n      setIcon(arrowToggle, \"arrow-right-left\");   // Lucide icon name\r\n      arrowToggle.classList.toggle(\"off\", this.plugin.settings.showArrows === false);\r\n    };\r\n    updateArrowIcon();\r\n\r\n    arrowToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      // undefined counts as \"true\"; flip boolean\r\n      this.plugin.settings.showArrows = this.plugin.settings.showArrows === false;\r\n      this.pendingSettingsChanges = true;\r\n      updateArrowIcon();\r\n      this.batchRender(\"arrow-toggle\");\r\n    };\r\n    \r\n    /* ---------- assignee-label ON / OFF toggle button ---------- */\r\n    const assigneeToggle = rightControls.createEl(\"span\", { cls: \"pm-assignee-toggle\" });\r\n    attachTip(assigneeToggle, \"Show / hide assignee labels on bars\");\r\n\r\n    const updateAssigneeIcon = () => {\r\n      setIcon(assigneeToggle, \"user\");   // Lucide \"user\" icon\r\n      assigneeToggle.classList.toggle(\"off\", this.plugin.settings.showAssignees === false);\r\n    };\r\n    updateAssigneeIcon();\r\n\r\n    assigneeToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.plugin.settings.showAssignees = this.plugin.settings.showAssignees === false;\r\n      this.pendingSettingsChanges = true;\r\n      updateAssigneeIcon();\r\n      this.batchRender(\"assignee-toggle\");\r\n    };\r\n    \r\n    /* ---------- tooltip ON / OFF toggle button ---------- */\r\n    const tooltipToggle = rightControls.createEl(\"span\", { cls: \"pm-tooltip-toggle\" });\r\n    attachTip(tooltipToggle, \"Show / hide bar tooltips/popups\");\r\n\r\n    const updateTooltipIcon = () => {\r\n      setIcon(tooltipToggle, \"info\");   // Lucide \"info\" icon\r\n      tooltipToggle.classList.toggle(\"off\", this.plugin.settings.showTooltips === false);\r\n    };\r\n    updateTooltipIcon();\r\n\r\n    tooltipToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.plugin.settings.showTooltips = this.plugin.settings.showTooltips === false;\r\n      this.pendingSettingsChanges = true;\r\n      updateTooltipIcon();\r\n      this.batchRender(\"tooltip-toggle\");\r\n    };\r\n    \r\n    /* ---------- hide completed tasks toggle ---------- */\r\n    const hideCompletedToggle = rightControls.createEl(\"span\", { cls: \"pm-hide-completed-toggle\" });\r\n    attachTip(hideCompletedToggle, \"Hide / show completed tasks\");\r\n\r\n    const updateHideCompletedIcon = () => {\r\n      setIcon(hideCompletedToggle, \"check-circle\");\r\n      hideCompletedToggle.classList.toggle(\"off\", !this.plugin.settings.hideCompletedTasks);\r\n    };\r\n    updateHideCompletedIcon();\r\n\r\n    hideCompletedToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.plugin.settings.hideCompletedTasks = !this.plugin.settings.hideCompletedTasks;\r\n      this.pendingSettingsChanges = true;\r\n      updateHideCompletedIcon();\r\n      this.batchRender(\"hide-completed-toggle\");\r\n    };\r\n    \r\n    /* ---------- hide on-hold tasks toggle ---------- */\r\n    const hideOnHoldToggle = rightControls.createEl(\"span\", { cls: \"pm-hide-onhold-toggle\" });\r\n    attachTip(hideOnHoldToggle, \"Hide / show on-hold tasks\");\r\n\r\n    const updateHideOnHoldIcon = () => {\r\n      setIcon(hideOnHoldToggle, \"pause-circle\");\r\n      hideOnHoldToggle.classList.toggle(\"off\", !this.plugin.settings.hideOnHoldTasks);\r\n    };\r\n    updateHideOnHoldIcon();\r\n\r\n    hideOnHoldToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.plugin.settings.hideOnHoldTasks = !this.plugin.settings.hideOnHoldTasks;\r\n      this.pendingSettingsChanges = true;\r\n      updateHideOnHoldIcon();\r\n      this.batchRender(\"hide-onhold-toggle\");\r\n    };\r\n    \r\n    /* ---------- export timeline as image ---------- */\r\n    const exportImageToggle = rightControls.createEl(\"span\", { cls: \"pm-export-toggle\" });\r\n    attachTip(exportImageToggle, \"Export timeline as image\");\r\n\r\n    setIcon(exportImageToggle, \"image\");\r\n    \r\n    exportImageToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      await this.exportAsImage();\r\n    };\r\n    \r\n    /* ---------- export timeline as HTML ---------- */\r\n    const exportHtmlToggle = rightControls.createEl(\"span\", { cls: \"pm-export-html-toggle\" });\r\n    attachTip(exportHtmlToggle, \"Export timeline as HTML\");\r\n\r\n    setIcon(exportHtmlToggle, \"download\");\r\n    \r\n    exportHtmlToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      await this.exportAsHtml();\r\n    };\r\n    \r\n    /* ---------- milestone ON / OFF toggle button ---------- */\r\n    const milestoneToggle = rightControls.createEl(\"span\", { cls: \"pm-milestone-toggle\" });\r\n    attachTip(milestoneToggle, \"Show / hide milestone guidelines\");\r\n\r\n    const updateMilestoneIcon = () => {\r\n      setIcon(milestoneToggle, \"flag\");   // Lucide \"flag\" icon\r\n      milestoneToggle.classList.toggle(\"off\", this.plugin.settings.showMilestones === false);\r\n    };\r\n    updateMilestoneIcon();\r\n\r\n    milestoneToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.plugin.settings.showMilestones = this.plugin.settings.showMilestones === false;\r\n      this.pendingSettingsChanges = true;\r\n      updateMilestoneIcon();\r\n      this.batchRender(\"milestone-toggle\");\r\n    };\r\n    \r\n    /* ---------- start date sort toggle button ---------- */\r\n    const startDateSortToggle = rightControls.createEl(\"span\", { cls: \"pm-start-date-sort-toggle\" });\r\n    attachTip(startDateSortToggle, \"Sort timeline by start date\");\r\n\r\n    const updateStartDateSortIcon = () => {\r\n      setIcon(startDateSortToggle, \"calendar-days\");   // Lucide \"calendar-days\" icon\r\n      startDateSortToggle.classList.toggle(\"off\", !this.sortByStartDate);\r\n    };\r\n    updateStartDateSortIcon();\r\n\r\n    startDateSortToggle.onclick = async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      \r\n      // Clean up any lingering tooltips before switching modes\r\n      document.querySelectorAll(\".pm-dash-tooltip\").forEach(el => el.remove());\r\n      \r\n      this.sortByStartDate = !this.sortByStartDate;\r\n      updateStartDateSortIcon();\r\n      this.batchRender(\"start-date-sort-toggle\");\r\n    };\r\n    \r\n    /* ---------- timeline START / END calendar icons ---------- */\r\n    const startCal = rightControls.createEl(\"span\", { cls: \"pm-cal-start\" });\r\n    const startLabel = rightControls.createEl(\"span\", { cls: \"pm-cal-label\" });\r\n    startLabel.style.marginLeft = \"4px\";\r\n    const endCal   = rightControls.createEl(\"span\", { cls: \"pm-cal-end\" });\r\n    setIcon(startCal, \"calendar\");\r\n    attachTip(startCal, \"Set timeline start date\");\r\n    setIcon(endCal,   \"calendar-range\");\r\n    attachTip(endCal,   \"Set timeline end date\");\r\n    const endLabel   = rightControls.createEl(\"span\", { cls: \"pm-cal-label\" });\r\n    endLabel.style.marginLeft   = \"4px\";\r\n\r\n    const fmt = (iso?: string) => (iso && iso.trim() !== \"\" ? iso : \"—\");\r\n    const refreshCalLabels = () => {\r\n      startLabel.textContent = fmt(this.plugin.settings.timelineStart);\r\n      endLabel.textContent   = fmt(this.plugin.settings.timelineEnd);\r\n    };\r\n    refreshCalLabels();\r\n    \r\n    startCal.onclick = (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      console.log(\"Start calendar clicked\");\r\n      \r\n      triggerNativeDatePicker(\r\n        this.plugin.settings.timelineStart || \"\",\r\n        (result) => {\r\n          console.log(\"Start date picker result:\", result);\r\n          if (result === null) return; // User cancelled\r\n          this.plugin.settings.timelineStart = result;\r\n          this.plugin.saveSettings?.();\r\n          this.saveAndRender();\r\n          refreshCalLabels();\r\n        }\r\n      );\r\n    };\r\n    \r\n    endCal.onclick = (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      \r\n      triggerNativeDatePicker(\r\n        this.plugin.settings.timelineEnd || \"\",\r\n        (result) => {\r\n          if (result === null) return; // User cancelled\r\n          this.plugin.settings.timelineEnd = result;\r\n          this.plugin.saveSettings?.();\r\n          this.saveAndRender();\r\n          refreshCalLabels();\r\n        }\r\n      );\r\n    };\r\n    \r\n    nameHeader.style.width = `${this.labelWidth}px`;\r\n    nameHeader.onclick = () => {\r\n      this.sortAsc = !this.sortAsc;\r\n      /* update icon in-place */\r\n      setIcon(sortIcon, this.sortAsc ? \"chevron-up\" : \"chevron-down\");\r\n      this.render();                 // re-render with new order\r\n    };\r\n\r\n\r\n    // (no-op: global caret icons and label are now managed above)\r\n\r\n    // (toggleBtn.setText is no longer used; icon handles state)\r\n\r\n    /** Return tasks ordered as\r\n     *   Epic\r\n     *     └─ Story\r\n     *          └─ Sub‑task\r\n     * Tasks that have no Epic/Story reference keep their original relative order.\r\n     */\r\n    const orderTasks = (tasks: TaskItem[], projectPath: string): TaskItem[] => {\r\n      // Filter out completed and on-hold tasks if settings enabled\r\n      tasks = tasks.filter(t => {\r\n        if (this.plugin.settings.hideCompletedTasks && tlIsTaskDone(t)) return false;\r\n        if (this.plugin.settings.hideOnHoldTasks && tlIsTaskOnHold(t)) return false;\r\n        return true;\r\n      });\r\n      \r\n      // Filter out collapsed child tasks\r\n      tasks = tasks.filter(t => {\r\n        const taskKey = `${projectPath}::${t.id.toLowerCase()}`;\r\n        \r\n        // Check if parent Epic is collapsed\r\n        const epicId = t.props[\"epic\"]?.trim();\r\n        if (epicId && this.collapsedTasks.has(`${projectPath}::${epicId.toLowerCase()}`)) {\r\n          return false;\r\n        }\r\n        \r\n        // Check if parent Story is collapsed\r\n        const storyId = t.props[\"story\"]?.trim();\r\n        if (storyId && this.collapsedTasks.has(`${projectPath}::${storyId.toLowerCase()}`)) {\r\n          return false;\r\n        }\r\n        \r\n        return true;\r\n      });\r\n\r\n      const done = new Set<TaskItem>();\r\n      const out: TaskItem[] = [];\r\n\r\n      /** quick helpers */\r\n      const idLower = (t: TaskItem) => t.id.toLowerCase();\r\n      const isEpic  = (t: TaskItem) => idLower(t).startsWith(\"e\");\r\n      const isStory = (t: TaskItem) =>\r\n        idLower(t).startsWith(\"s\") && !idLower(t).startsWith(\"sb\");\r\n      const isSub   = (t: TaskItem) => idLower(t).startsWith(\"sb\");\r\n\r\n      /** Get start date for a task */\r\n      const getTaskStartDate = (task: TaskItem): moment.Moment | null => {\r\n        const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n        if (startIso) {\r\n          // @ts-ignore callable moment\r\n          const start = (moment as any)(startIso, \"YYYY-MM-DD\");\r\n          if (start.isValid()) {\r\n            return start;\r\n          }\r\n        }\r\n        return null;\r\n      };\r\n\r\n      /** Sort tasks by start date if enabled */\r\n      const sortByStartDate = (taskList: TaskItem[]): TaskItem[] => {\r\n        if (!this.sortByStartDate) return taskList;\r\n        \r\n        return taskList.sort((a, b) => {\r\n          const aStart = getTaskStartDate(a);\r\n          const bStart = getTaskStartDate(b);\r\n          \r\n          if (aStart && bStart) {\r\n            return this.sortAsc ? aStart.diff(bStart) : bStart.diff(aStart);\r\n          } else if (aStart) {\r\n            return this.sortAsc ? -1 : 1; // aStart comes first\r\n          } else if (bStart) {\r\n            return this.sortAsc ? 1 : -1; // bStart comes first\r\n          }\r\n          // Both have no start date, maintain original order\r\n          return 0;\r\n        });\r\n      };\r\n\r\n      /** map Story‑id → [sub‑tasks]  (reuse existing Story column + depends logic) */\r\n      const subsByStory = new Map<string, TaskItem[]>();\r\n      const stripType = (raw: string) =>\r\n        raw.trim().toLowerCase().replace(/^(fs|ss|ff|sf):/, \"\"); // drop link‑type\r\n\r\n      tasks.forEach(t => {\r\n        if (!isSub(t)) return;\r\n\r\n        /* 1️⃣  Preferred: explicit Story column */\r\n        let storyKey = (t.props[\"story\"] ?? \"\").toString().trim();\r\n        storyKey = storyKey ? storyKey.toLowerCase() : \"\";\r\n\r\n        /* 2️⃣  Fallback: first depends:: entry, minus any FS/SS/FF/SF prefix */\r\n        if (!storyKey && Array.isArray(t.depends) && t.depends.length) {\r\n          storyKey = stripType(String(t.depends[0]));\r\n        }\r\n\r\n        if (!storyKey) return;\r\n\r\n        if (!subsByStory.has(storyKey)) subsByStory.set(storyKey, []);\r\n        subsByStory.get(storyKey)!.push(t);\r\n      });\r\n\r\n      /** map Epic‑id → [stories] (Story.Epic column) */\r\n      const storiesByEpic = new Map<string, TaskItem[]>();\r\n      tasks.forEach(t => {\r\n        if (!isStory(t)) return;\r\n        const epicField = (t.props[\"epic\"] ?? \"\").toString().trim().toLowerCase();\r\n        if (!epicField) return;\r\n        if (!storiesByEpic.has(epicField)) storiesByEpic.set(epicField, []);\r\n        storiesByEpic.get(epicField)!.push(t);\r\n      });\r\n\r\n      /** helper to push Story + its subs */\r\n      const pushStoryWithSubs = (s: TaskItem) => {\r\n        if (done.has(s)) return;\r\n        done.add(s);\r\n        out.push(s);\r\n        const kids = subsByStory.get(idLower(s));\r\n        if (kids) kids.forEach(k => {\r\n          if (!done.has(k)) {\r\n            done.add(k);\r\n            out.push(k);\r\n          }\r\n        });\r\n      };\r\n\r\n      /** 1️⃣ Epics sorted by start date (if enabled), each followed by its Stories + Subs */\r\n      const epics = tasks.filter(t => isEpic(t));\r\n      const sortedEpics = sortByStartDate(epics);\r\n      \r\n      sortedEpics.forEach(t => {\r\n        if (done.has(t)) return;\r\n        done.add(t);\r\n        out.push(t);\r\n        const stories = storiesByEpic.get(idLower(t));\r\n        if (stories) {\r\n          const sortedStories = sortByStartDate(stories);\r\n          sortedStories.forEach(pushStoryWithSubs);\r\n        }\r\n      });\r\n\r\n      /** 2️⃣ Standalone Stories (no Epic) sorted by start date */\r\n      const standaloneStories = tasks.filter(t => isStory(t) && !done.has(t));\r\n      const sortedStandaloneStories = sortByStartDate(standaloneStories);\r\n      \r\n      sortedStandaloneStories.forEach(t => {\r\n        pushStoryWithSubs(t);\r\n      });\r\n\r\n      /** 3️⃣ Remaining tasks (subs w/out story, plain rows, etc.) sorted by start date */\r\n      const remainingTasks = tasks.filter(t => !done.has(t));\r\n      const sortedRemainingTasks = sortByStartDate(remainingTasks);\r\n      \r\n      sortedRemainingTasks.forEach(t => {\r\n        done.add(t);\r\n        out.push(t);\r\n      });\r\n\r\n      return out;\r\n    };\r\n\r\n    // Check if we should render flat task list instead of project grouping\r\n    if (this.sortByStartDate) {\r\n      this.renderFlatTaskList(leftPane, rightPane, pxPerDay, horizon, today, projects);\r\n    } else {\r\n      // Original project-based rendering\r\n      for (const project of projects) {\r\n      /* Collect milestone offsets and tooltip HTML for this project */\r\n      const projMilestones: { off: number; html: string }[] = [];\r\n      /* ── Milestones for *this* project (table inside its note) ── */\r\n      {\r\n        /* If the eye‑icon has hidden this project, skip its milestones entirely */\r\n        if (this.hiddenProjects.has(project.file.path)) {\r\n          /* Nothing to collect for hidden projects */\r\n        } else {\r\n          const normP = normPath(project.file.path);\r\n\r\n          (this.plugin?.cache?.milestones ?? [])\r\n            .filter((m: ExtendedMilestone) => {\r\n              /* Resolve the milestone's file reference, if any */\r\n              const fileStr: string | undefined =\r\n                typeof m.file     === \"string\" && m.file.trim()      ? m.file :\r\n                typeof m.path     === \"string\" && m.path.trim()      ? m.path :\r\n                typeof m.filePath === \"string\" && m.filePath.trim()  ? m.filePath :\r\n                undefined;\r\n\r\n              /* Keep the row when:\r\n                 – it specifies a file/path matching this project OR\r\n                 – it has no file reference (assumed to belong to this project note). */\r\n              return fileStr ? normPath(fileStr) === normP : true;\r\n            })\r\n            .forEach((m: ExtendedMilestone) => {\r\n              // @ts-ignore callable moment bundled by Obsidian\r\n              const d = (moment as any)(m.date, \"YYYY-MM-DD\", true);\r\n              if (!d.isValid()) return;\r\n              const off = d.diff(today, \"days\");\r\n              milestoneOffsets.add(off);\r\n\r\n              const label = m.name ?? m.title ?? \"Milestone\";\r\n              /* Prefer `description`, fall back to `desc` (parsed from the table) */\r\n              const desc  = (m.description ?? m.desc ?? \"\").toString().trim();\r\n\r\n              const html =\r\n                `<span><strong>Project:</strong> ${project.file.basename}</span><br>` +\r\n                `<span><strong>Title:</strong> ${label}</span><br>` +\r\n                `<span><strong>Date:</strong> ${m.date}</span>` +\r\n                (desc ? `<br>${desc}` : \"\");\r\n              const labelText = label;  // Use title, not description\r\n              milestoneMap.set(off, `${html}|||${labelText}`);\r\n              projMilestones.push({ off, html });\r\n            });\r\n        }\r\n      }\r\n      const rowLeft  = leftPane.createEl(\"div\", { cls: \"pm-tl-row pm-project-row\" });\r\n      const rowRight = rightPane.createEl(\"div\", { cls: \"pm-tl-row pm-project-row\" });\r\n      rowRight.dataset.proj = project.file.path;          // identify owner project\r\n      if (this.hiddenProjects.has(project.file.path))      // honour hide state\r\n        rowRight.classList.add(\"pm-hide-bars\");      \r\n      /* Ensure separator spans the full timeline width */\r\n      rowRight.style.minWidth = `${(horizon + 1) * pxPerDay}px`;\r\n      \r\n      // Cache the row for efficient zoom updates\r\n      this.timelineRows.push(rowRight);\r\n      /* ----- project name with fold caret ----- */\r\n      let caret: HTMLSpanElement | null = null;\r\n      if (!barsMode) {                         /* only show when tasks list visible */\r\n        caret = rowLeft.createEl(\"span\", { cls: \"pm-fold-caret\" });\r\n        setIcon(\r\n          caret,\r\n          this.collapsed.has(project.file.path) ? \"chevron-right\" : \"chevron-down\"\r\n        );\r\n        caret.onclick = (e) => {\r\n          e.preventDefault();\r\n          if (this.collapsed.has(project.file.path)) {\r\n            this.collapsed.delete(project.file.path);\r\n          } else {\r\n            this.collapsed.add(project.file.path);\r\n          }\r\n          if (caret)\r\n            setIcon(\r\n              caret,\r\n              this.collapsed.has(project.file.path) ? \"chevron-right\" : \"chevron-down\"\r\n            );\r\n          this.batchRender(\"project-collapse\");\r\n        };\r\n      }\r\n\r\n      /* ── per‑project eye toggle ───────────────────────────── */\r\n      const eyeSpan  = rowLeft.createEl(\"span\", { cls: \"pm-project-eye\" });\r\n      attachTip(eyeSpan, \"Show / hide this project\");\r\n      const eyeIcon  = eyeSpan.createEl(\"span\");\r\n      const isHidden = this.hiddenProjects.has(project.file.path);\r\n      setIcon(eyeIcon, isHidden ? \"eye-off\" : \"eye\");\r\n      eyeSpan.style.cursor = \"pointer\";\r\n      eyeSpan.style.marginRight = \"4px\";\r\n\r\n      const updateEyeVis = () => {\r\n        const hide = this.hiddenProjects.has(project.file.path);\r\n        setIcon(eyeIcon, hide ? \"eye-off\" : \"eye\");\r\n\r\n        /* toggle class on every right-pane row that belongs to this project */\r\n        rightPane\r\n          .querySelectorAll<HTMLElement>(`[data-proj=\"${project.file.path}\"]`)\r\n          .forEach(el => el.classList.toggle(\"pm-hide-bars\", hide));\r\n      };\r\n      \r\n      eyeSpan.onclick = (e) => {\r\n        e.preventDefault();\r\n        if (this.hiddenProjects.has(project.file.path))\r\n          this.hiddenProjects.delete(project.file.path);\r\n        else\r\n          this.hiddenProjects.add(project.file.path);\r\n\r\n        /* Update bars immediately for smoother UX */\r\n        updateEyeVis();\r\n\r\n        /* Re‑render so milestone guideline bars refresh */\r\n        this.batchRender(\"project-visibility\");\r\n      };\r\n      /* apply initial visibility */\r\n      updateEyeVis();\r\n\r\n      const label = rowLeft.createEl(\"a\", {\r\n        cls: \"pm-tl-label\",\r\n        text: project.file.basename,\r\n        href: project.file.path,\r\n      });\r\n\r\n      /* ── Hover tooltip with project front-matter ─────────────────────── */\r\n      {\r\n        let tip: HTMLElement | null = null;\r\n\r\n        const showTip = () => {\r\n          const fm: Record<string, any> =\r\n            project.file instanceof TFile\r\n              ? this.app.metadataCache.getFileCache(project.file)?.frontmatter ?? {}\r\n              : {};\r\n\r\n          const norm = (s: string) => s.replace(/[\\s_]+/g, \"\").toLowerCase();\r\n          const val  = (k: string) => {\r\n            const want = norm(k);\r\n            for (const key in fm) if (norm(key) === want) return String(fm[key]);\r\n            return \"—\";\r\n          };\r\n\r\n          let html = `<strong>${project.file.basename}</strong>`;\r\n          if (Object.keys(fm).length) {\r\n            html += `<br><em>${val(\"description\")}</em>\r\n                    <br><span>Start: ${val(\"start date\")}</span>\r\n                    <br><span>Due  : ${val(\"end date\") || val(\"due date\")}</span>`;\r\n          }\r\n\r\n          tip = document.createElement(\"div\");\r\n          tip.className = \"pm-dash-tooltip\";\r\n          tip.innerHTML = html;\r\n          document.body.appendChild(tip);\r\n\r\n          const r = label.getBoundingClientRect();\r\n          const pad = 8;\r\n          const w = tip.offsetWidth;\r\n          let x = r.right + pad;\r\n          if (x + w > window.innerWidth - pad) {\r\n            x = Math.max(r.left - pad - w, pad);\r\n          }\r\n          const h = tip.offsetHeight;\r\n          let y   = Math.max(r.top, 48);\r\n          if (y + h > window.innerHeight - pad) {\r\n            y = Math.max(window.innerHeight - h - pad, 48);\r\n          }\r\n          tip.style.left = `${x}px`;\r\n          tip.style.top  = `${y}px`;\r\n        };\r\n\r\n        const hideTip = () => { tip?.remove(); tip = null; };\r\n\r\n        label.addEventListener(\"mouseenter\", showTip);\r\n        label.addEventListener(\"mouseleave\", hideTip);\r\n      }\r\n      \r\n      // Toggle collapse on caret click\r\n      // (moved to caret.onclick above)\r\n\r\n      /* Allow space for fold-caret and eye icon so ellipsis can appear */\r\n      const caretW = caret ? 18 : 0;\r\n      const eyeW = 20; // Approximate width of eye icon\r\n      label.style.width = `${Math.max(this.labelWidth - caretW - eyeW, 0)}px`;\r\n      label.onclick = (e) => {\r\n        e.preventDefault();\r\n        this.app.workspace.openLinkText(project.file.path, \"\", false);\r\n      };\r\n\r\n      const barWrap = rowRight.createEl(\"div\", { cls: \"pm-tl-barwrap\" });\r\n      /* Ensure the project row has a visible height even when no task bars render */\r\n      rowLeft.style.height  = \"27px\";   // keep left column the same height      \r\n      rowRight.style.height = \"27px\";   // match task-row height\r\n      barWrap.style.height  = \"27px\";\r\n      barWrap.style.position = \"relative\";   // so bracket's absolute positioning is relative\r\n\r\n      /* ─── show sub-task bars when the task list is hidden (barsMode === true) ─── */\r\n      if (barsMode || this.collapsed.has(project.file.path)) {\r\n        orderTasks(project.tasks, project.file.path).forEach((task) => {\r\n          let dueIso = (task.props[\"due\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n          if (!dueIso) return;\r\n\r\n          // @ts-ignore runtime bundles moment\r\n          const due = (moment as any)(dueIso, \"YYYY-MM-DD\");\r\n          if (!due.isValid()) return;\r\n\r\n          /* multi-day support via start:: */\r\n          const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n          let startOff = due.diff(today, \"days\");\r\n          let spanDays = 1;\r\n\r\n          if (startIso) {\r\n            // @ts-ignore\r\n            const s = (moment as any)(startIso, \"YYYY-MM-DD\");\r\n            if (s.isValid()) {\r\n              startOff = s.diff(today, \"days\");\r\n              spanDays = Math.max(due.diff(s, \"days\") + 1, 1);\r\n            }\r\n          }\r\n\r\n          /* draw the bar */\r\n          const bar = barWrap.createEl(\"div\", { cls: \"pm-tl-bar\" });\r\n          bar.style.left  = `${startOff * pxPerDay}px`;\r\n          bar.style.width = `${Math.max(spanDays * pxPerDay, 3)}px`;\r\n          bar.style.zIndex = \"2\";\r\n\r\n          // Add priority border color\r\n          const priority = getTaskPriority(task);\r\n          if (priority) bar.addClass(`pm-priority-${priority}`);\r\n\r\n          // ── track pointer movement so we can suppress post-drag clicks ──\r\n          let dragMoved  = false;\r\n          let dragStartX = 0;\r\n\r\n          bar.addEventListener(\"pointerdown\", (ev) => {\r\n            dragMoved  = false;\r\n            dragStartX = ev.clientX;\r\n          });\r\n          bar.addEventListener(\"pointermove\", (ev) => {\r\n            if (Math.abs(ev.clientX - dragStartX) > 3) dragMoved = true;   // >3 px = drag\r\n          });\r\n          \r\n          const taskKey = key(task);\r\n          (bar as any).dataset.task = taskKey;\r\n          bar.addEventListener(\"mouseenter\", () => highlightArrows(taskKey, true));\r\n          bar.addEventListener(\"mouseleave\", () => highlightArrows(taskKey, false));\r\n        \r\n          /* colour by ID prefix */\r\n          {\r\n            const id = task.id.toLowerCase();\r\n            if (id.startsWith(\"e\"))       bar.addClass(\"pm-bar-e\");\r\n            else if (id.startsWith(\"sb\")) bar.addClass(\"pm-bar-sb\");\r\n            else if (id.startsWith(\"s\"))  bar.addClass(\"pm-bar-s\");\r\n          }\r\n\r\n          /* urgency colour (skip completed) */\r\n          if (!task.checked) {\r\n            const dOff = due.diff(today, \"days\");\r\n            if (dOff < 0)        bar.addClass(\"pm-bar-overdue\");\r\n            else if (dOff <= 10) bar.addClass(\"pm-bar-warning\");\r\n          }\r\n\r\n          /* tooltip + click-through */\r\n          bar.setAttr(\r\n            \"title\",\r\n            `${task.text}\\n${startIso ? \"start \" + startIso + \" → \" : \"\"}due ${due.format(\"YYYY-MM-DD\")}`\r\n          );\r\n          bar.onclick = (e) => {\r\n            // Suppress clicks that follow a drag, or when move-mode is enabled\r\n            if (dragMoved || this.plugin.settings.allowBarMove !== false) {\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n            e.preventDefault();\r\n            this.openAndScroll(project.file.path, task.id, task.line);\r\n          };\r\n\r\n          /* ── shared tooltip (collapsed‑row bar) ── */\r\n          {\r\n            const buildHtml = () => {\r\n              const fmt  = (s: string) => (s && s.trim() ? s.trim() : \"—\");\r\n              const desc = getDescription(task);\r\n              const raw  = task.text.split(\"\\n\")[0].trim();\r\n              const shortTxt = raw.length > 70 ? raw.slice(0, 67) + \"…\" : raw;\r\n              const who = (task.props[\"assignee\"] ?? \"\").replace(/\\u00A0/g, \" \").trim() || \"—\";\r\n              const priority = getTaskPriority(task);\r\n              const priorityText = priority ? priority.charAt(0).toUpperCase() + priority.slice(1) : \"—\";\r\n              \r\n              let idPrefix = \"\";\r\n              {\r\n                const idL = task.id.toLowerCase();\r\n                const num = task.id.match(/\\d+/)?.[0] ?? \"\";\r\n                if (idL.startsWith(\"sb\"))      idPrefix = `SB-${num}. `;\r\n                else if (idL.startsWith(\"s\") && !idL.startsWith(\"sb\")) idPrefix = `S-${num}. `;\r\n                else if (idL.startsWith(\"e\"))  idPrefix = `E-${num}. `;\r\n              }\r\n\r\n              return `<strong>${idPrefix}${shortTxt}</strong>${desc ? `<br><em>${desc}</em>` : \"\"}`\r\n                   + `<br><span>Start: ${fmt(startIso)}</span>`\r\n                   + `<br><span>Due&nbsp;&nbsp;: ${fmt(dueIso)}</span>`\r\n                   + `<br><span>Assignee:&nbsp;${who}</span>`\r\n                   + `<br><span>Priority: ${priorityText}</span>`;              \r\n            };\r\n\r\n            bar.addEventListener(\"mouseenter\", (ev) => {\r\n              const m = ev as MouseEvent;\r\n              const fakeRect = {\r\n                left:   m.clientX,\r\n                right:  m.clientX,\r\n                top:    m.clientY,\r\n                bottom: m.clientY,\r\n                width:  0,\r\n                height: 0,\r\n              } as DOMRect;\r\n              showBarTip(buildHtml(), fakeRect);\r\n            });\r\n            bar.addEventListener(\"mouseleave\", hideBarTip);\r\n          }\r\n\r\n          /* record geometry for arrows, heat-map, milestones */\r\n          barsById[key(task)] = { x: startOff * pxPerDay, w: Math.max(spanDays * pxPerDay, 3), el: bar };\r\n          tasksById.set(key(task), task);\r\n          \r\n          /* Heat‑map tally (exclude \"E\" and plain \"S\") */\r\n          {\r\n            const idL = task.id.toLowerCase();\r\n            const isPlainS = idL.startsWith(\"s\") && !idL.startsWith(\"sb\");\r\n            if (!idL.startsWith(\"e\") && !isPlainS) {\r\n              addHeat(startOff, spanDays);\r\n            }\r\n          }\r\n          {\r\n            const idL = task.id.toLowerCase();\r\n            const isMilestone = idL.startsWith(\"m\") ||\r\n              ((task.props[\"milestone\"] ?? \"\").toString().toLowerCase() === \"true\");\r\n            if (isMilestone && isProjectVisible(project.file.path)) {\r\n              milestoneOffsets.add(startOff);\r\n              const desc = getDescription(task);\r\n              const html =\r\n                `<span><strong>Project:</strong> ${project.file.basename}</span><br>` +\r\n                `<strong>${task.id}</strong><br>${dueIso}` +   // use dueIso here\r\n                (desc ? `<br>${desc}` : \"\");\r\n              const labelText = task.id;  // Use task ID\r\n              milestoneMap.set(startOff, `${html}|||${labelText}`);     // or startOff\r\n              projMilestones.push({ off: startOff, html });\r\n            }\r\n          }\r\n        });\r\n\r\n        /* maintain row height */\r\n        rowLeft.style.height  = \"27px\";   // keep left column the same height        \r\n        rowRight.style.height = \"27px\";\r\n        barWrap.style.height  = \"27px\";\r\n      }\r\n\r\n      /* ── Project span from YAML only ─────────────────────── */\r\n      let projStart = Number.POSITIVE_INFINITY;\r\n      let projEnd   = Number.NEGATIVE_INFINITY;\r\n\r\n      (() => {\r\n        /* Pull YAML from Obsidian's metadata cache instead of a non‑existent property */\r\n        const fileCache = (this.app as any).metadataCache.getFileCache(project.file);\r\n        const fm: Record<string, any> = (fileCache?.frontmatter ?? {});\r\n\r\n        /* helper: find front‑matter key ignoring case, spaces, underscores */\r\n        const pick = (want: string): string | undefined => {\r\n          const target = want.replace(/\\s|_/g, \"\").toLowerCase();\r\n          for (const [k, v] of Object.entries(fm)) {\r\n            const norm = k.replace(/\\s|_/g, \"\").toLowerCase();\r\n            if (norm === target) return String(v).trim();\r\n          }\r\n          return undefined;\r\n        };\r\n\r\n        const startIso = pick(\"startdate\") || pick(\"start\");\r\n        const endIso   = pick(\"enddate\")   || pick(\"end\");\r\n        if (!startIso || !endIso) return;\r\n\r\n        /* allow either explicit YYYY‑MM‑DD or any ISO‑like string the user writes */\r\n        // @ts-ignore moment callable in runtime\r\n        const s = (moment as any)(startIso, [\"YYYY-MM-DD\", moment.ISO_8601], true);\r\n        // @ts-ignore\r\n        const e = (moment as any)(endIso,   [\"YYYY-MM-DD\", moment.ISO_8601], true);\r\n        if (s.isValid() && e.isValid() && e.isSameOrAfter(s)) {\r\n          projStart = s.diff(today, \"days\");\r\n          projEnd   = e.diff(today, \"days\");\r\n        }\r\n      })();\r\n      \r\n      /* ── always-visible baseline bar + diamond milestones ── */\r\n      if (Number.isFinite(projStart) && Number.isFinite(projEnd) && barWrap) {\r\n        const base = barWrap.createEl(\"div\", { cls: \"pm-proj-baseline\" });\r\n        base.style.position      = \"absolute\";\r\n        base.style.left          = `${projStart * pxPerDay}px`;\r\n        base.style.width         = `${(projEnd - projStart + 1) * pxPerDay}px`;\r\n        base.style.height        = \"6px\";\r\n        base.style.top           = \"50%\";\r\n        base.style.transform     = \"translateY(-50%)\";\r\n        base.style.borderRadius  = \"4px\";\r\n        base.style.background    = \"#ccc\";     /* fallback colour; override in CSS */\r\n        base.style.zIndex        = \"1\";\r\n        base.style.pointerEvents = \"auto\";   // allow hover even in hidden/collapsed modes\r\n\r\n        // Hover tooltip for always-visible baseline (works when bars are hidden)\r\n        let baseTip: HTMLElement | null = null;\r\n        const showBaseTip = () => {\r\n          const cache = this.app.metadataCache.getFileCache(project.file);\r\n          const fm: Record<string, any> = cache?.frontmatter ?? {};\r\n\r\n          const val = (k: string) => fm[k] ?? fm[k.replace(/ /g, \"\").toLowerCase()] ?? \"—\";\r\n\r\n          const startDate = val(\"Start Date\") || val(\"start date\");\r\n          const endDate = val(\"End Date\") || val(\"Due Date\") || val(\"end date\") || val(\"due date\");\r\n          const description = val(\"Description\") || val(\"description\");\r\n\r\n          const html = `\r\n            <strong>${project.file.basename}</strong><br>\r\n            ${description !== \"—\" ? `<em>${description}</em><br>` : \"\"}\r\n            <span>Start: ${startDate}</span><br>\r\n            <span>End  : ${endDate}</span>\r\n          `;\r\n\r\n          baseTip = document.createElement(\"div\");\r\n          baseTip.className = \"pm-dash-tooltip\";\r\n          baseTip.innerHTML = html;\r\n          baseTip.style.zIndex = \"10001\";\r\n          document.body.appendChild(baseTip);\r\n\r\n          const r = base.getBoundingClientRect();\r\n          const pad = 8;\r\n          const w = baseTip.offsetWidth || 200;\r\n          const h = baseTip.offsetHeight || 100;\r\n\r\n          let left = r.left + (r.width - w) / 2;\r\n          if (left < pad) left = pad;\r\n          if (left + w > window.innerWidth - pad) left = window.innerWidth - w - pad;\r\n\r\n          let top = r.top - h - 8;\r\n          if (top < pad) top = r.bottom + 8;\r\n          if (top + h > window.innerHeight - pad) top = window.innerHeight - h - pad;\r\n\r\n          baseTip.style.left = `${left}px`;\r\n          baseTip.style.top = `${top}px`;\r\n        };\r\n\r\n        const hideBaseTip = () => { baseTip?.remove(); baseTip = null; };\r\n\r\n        base.addEventListener(\"mouseenter\", showBaseTip);\r\n        base.addEventListener(\"mouseleave\", hideBaseTip);\r\n\r\n        projMilestones.forEach(({ off, html }) => {\r\n          const dia = barWrap.createEl(\"div\", { cls: \"pm-milestone-diamond\" });\r\n          dia.style.position   = \"absolute\";\r\n          dia.style.left       = `${off * pxPerDay}px`;\r\n          dia.style.top        = \"50%\";\r\n          dia.style.width      = \"8px\";\r\n          dia.style.height     = \"8px\";\r\n          dia.style.transform  = \"translate(-50%,-50%) rotate(45deg)\";\r\n          dia.style.zIndex     = \"4\";          // above bars\r\n          dia.style.pointerEvents = \"auto\";    // ensure hover works\r\n\r\n          dia.addEventListener(\"mouseenter\", (ev) => {\r\n            const m = ev as MouseEvent;\r\n            const r: DOMRect = {\r\n              left:m.clientX, right:m.clientX,\r\n              top:m.clientY,  bottom:m.clientY,\r\n              width:0, height:0\r\n            } as DOMRect;\r\n            showBarTip(html, r);\r\n          });\r\n          dia.addEventListener(\"mouseleave\", hideBarTip);\r\n        });\r\n      }\r\n      // Decide whether to draw bars or text lines\r\n      const showBars = barsMode || this.collapsed.has(project.file.path);\r\n      \r\n      // Hide bars when project is collapsed and hide bars toggle is enabled\r\n      if (this.hideBarsWhenCollapsed && this.collapsed.has(project.file.path)) {\r\n        barWrap.classList.add(\"pm-hide-bars\");\r\n      }\r\n\r\n      if (!showBars) {\r\n        if (this.collapsed.has(project.file.path)) {\r\n          if (Number.isFinite(projStart) && Number.isFinite(projEnd)) {\r\n            const leftPx  = projStart * pxPerDay;                    // allow negative (before today)\r\n            const widthPx = (projEnd - projStart + 1) * pxPerDay;    // full span\r\n            if (widthPx > 0) {\r\n              const projBar = barWrap.createEl(\"div\", { cls: \"pm-proj-baseline\" });\r\n              projBar.style.position = \"absolute\";\r\n              projBar.style.left   = `${leftPx}px`;\r\n              projBar.style.width  = `${widthPx}px`;\r\n              projBar.style.height = \"6px\";\r\n              projBar.style.top    = \"50%\";\r\n              projBar.style.transform = \"translateY(-50%)\";\r\n              projBar.style.pointerEvents = \"auto\"; // always allow hover events\r\n              projBar.style.cursor        = this.plugin.settings.allowBarMove === false ? \"default\" : \"move\";\r\n              projBar.style.zIndex        = \"3\";\r\n\r\n              // Hover tooltip for collapsed baseline\r\n              let projBaseTip: HTMLElement | null = null;\r\n              const showProjBaseTip = () => {\r\n                const cache = this.app.metadataCache.getFileCache(project.file);\r\n                const fm: Record<string, any> = cache?.frontmatter ?? {};\r\n\r\n                const val = (k: string) => fm[k] ?? fm[k.replace(/ /g, \"\").toLowerCase()] ?? \"—\";\r\n\r\n                const startDate = val(\"Start Date\") || val(\"start date\");\r\n                const endDate = val(\"End Date\") || val(\"Due Date\") || val(\"end date\") || val(\"due date\");\r\n                const description = val(\"Description\") || val(\"description\");\r\n\r\n                const html = `\r\n                  <strong>${project.file.basename}</strong><br>\r\n                  ${description !== \"—\" ? `<em>${description}</em><br>` : \"\"}\r\n                  <span>Start: ${startDate}</span><br>\r\n                  <span>End  : ${endDate}</span>\r\n                `;\r\n\r\n                projBaseTip = document.createElement(\"div\");\r\n                projBaseTip.className = \"pm-dash-tooltip\";\r\n                projBaseTip.innerHTML = html;\r\n                projBaseTip.style.zIndex = \"10001\";\r\n                document.body.appendChild(projBaseTip);\r\n\r\n                const r = projBar.getBoundingClientRect();\r\n                const pad = 8;\r\n                const w = projBaseTip.offsetWidth || 200;\r\n                const h = projBaseTip.offsetHeight || 100;\r\n\r\n                let left = r.left + (r.width - w) / 2;\r\n                if (left < pad) left = pad;\r\n                if (left + w > window.innerWidth - pad) left = window.innerWidth - w - pad;\r\n\r\n                let top = r.top - h - 8;\r\n                if (top < pad) top = r.bottom + 8;\r\n                if (top + h > window.innerHeight - pad) top = window.innerHeight - h - pad;\r\n\r\n                projBaseTip.style.left = `${left}px`;\r\n                projBaseTip.style.top = `${top}px`;\r\n              };\r\n\r\n              const hideProjBaseTip = () => { projBaseTip?.remove(); projBaseTip = null; };\r\n\r\n              projBar.addEventListener(\"mouseenter\", showProjBaseTip);\r\n              projBar.addEventListener(\"mouseleave\", hideProjBaseTip);\r\n              /* ── enable move & edge‑resize ── */\r\n              if (this.plugin.settings.allowBarMove !== false) {\r\n                const edge = 6;   // px on each edge for resize\r\n\r\n                projBar.addEventListener(\"pointerdown\", (ev) => {\r\n                  if (ev.button !== 0) return;   // left button\r\n                  const r = projBar.getBoundingClientRect();\r\n                  let mode: \"move\" | \"resize-left\" | \"resize-right\" = \"move\";\r\n                  if (ev.clientX - r.left < edge)           mode = \"resize-left\";\r\n                  else if (r.right - ev.clientX < edge)     mode = \"resize-right\";\r\n\r\n                  projBar.setPointerCapture(ev.pointerId);\r\n                  currentProjDrag = {\r\n                    barEl: projBar,\r\n                    startClientX: ev.clientX,\r\n                    originalStart: projStart,\r\n                    originalWidth: r.width,\r\n                    mode,\r\n                    projectPath: project.file.path\r\n                  };\r\n                  projBar.style.opacity = \"0.6\";\r\n                  projBar.style.cursor  = mode === \"move\" ? \"grabbing\" : \"ew-resize\";\r\n                });\r\n\r\n                projBar.addEventListener(\"pointermove\", (ev) => {\r\n                  if (!currentProjDrag || currentProjDrag.barEl !== projBar) return;\r\n                  const deltaPx   = ev.clientX - currentProjDrag.startClientX;\r\n                  const deltaDays = Math.round(deltaPx / this.zoomPxPerDay);\r\n\r\n                  if (currentProjDrag.mode === \"move\") {\r\n                    projBar.style.left = `${(currentProjDrag.originalStart + deltaDays) * this.zoomPxPerDay}px`;\r\n                  } else if (currentProjDrag.mode === \"resize-left\") {\r\n                    const newWidth = currentProjDrag.originalWidth - deltaPx;\r\n                    if (newWidth > this.zoomPxPerDay) {\r\n                      projBar.style.left  = `${(currentProjDrag.originalStart + deltaDays) * this.zoomPxPerDay}px`;\r\n                      projBar.style.width = `${newWidth}px`;\r\n                    }\r\n                  } else { // resize-right\r\n                    const newWidth = currentProjDrag.originalWidth + deltaPx;\r\n                    if (newWidth > this.zoomPxPerDay) projBar.style.width = `${newWidth}px`;\r\n                  }\r\n                });\r\n\r\n                projBar.addEventListener(\"pointerup\", (ev) => {\r\n                  if (!currentProjDrag || currentProjDrag.barEl !== projBar) return;\r\n                  projBar.releasePointerCapture(ev.pointerId);\r\n                  projBar.style.opacity = \"\";\r\n                  projBar.style.cursor  = \"move\";\r\n\r\n                  const deltaPx   = ev.clientX - currentProjDrag.startClientX;\r\n                  const deltaDays = Math.round(deltaPx / this.zoomPxPerDay);\r\n\r\n                  if (deltaDays !== 0) {\r\n                    if (currentProjDrag.mode === \"move\") {\r\n                      this.containerEl.dispatchEvent(\r\n                        new CustomEvent(\"pm-project-bar-moved\", {\r\n                          detail: { projectPath: currentProjDrag.projectPath, deltaDays },\r\n                          bubbles: true\r\n                        })\r\n                      );\r\n                    } else if (currentProjDrag.mode === \"resize-left\") {\r\n                      this.containerEl.dispatchEvent(\r\n                        new CustomEvent(\"pm-project-bar-resized\", {\r\n                          detail: { projectPath: currentProjDrag.projectPath, deltaStart: deltaDays, deltaEnd: 0 },\r\n                          bubbles: true\r\n                        })\r\n                      );\r\n                    } else if (currentProjDrag.mode === \"resize-right\") {\r\n                      this.containerEl.dispatchEvent(\r\n                        new CustomEvent(\"pm-project-bar-resized\", {\r\n                          detail: { projectPath: currentProjDrag.projectPath, deltaStart: 0, deltaEnd: deltaDays },\r\n                          bubbles: true\r\n                        })\r\n                      );\r\n                    }\r\n                  }\r\n                  currentProjDrag = null;\r\n                });\r\n\r\n                /* Hover feedback: change cursor to ↔ at edges */\r\n                projBar.addEventListener(\"mousemove\", (ev) => {\r\n                  if (this.plugin.settings.allowBarMove === false) return;\r\n                  const offsetX = ev.offsetX;\r\n                  projBar.style.cursor =\r\n                    offsetX < edge || projBar.clientWidth - offsetX < edge ? \"ew-resize\" : \"move\";\r\n                });\r\n              }\r\n            }\r\n          }\r\n          continue;\r\n        }\r\n        // Render one row per task *and* draw its bar in that row\r\n        orderTasks(project.tasks, project.file.path).forEach((task) => {\r\n          /* ----- task row: left pane ----- */\r\n          const taskRowLeft = leftPane.createEl(\"div\", { cls: \"pm-tl-taskrow\" });\r\n          \r\n          // Add collapse caret for Epic/Story tasks\r\n          const taskId = task.id.toLowerCase();\r\n          if (taskId.startsWith(\"e-\") || taskId.startsWith(\"s-\")) {\r\n            const taskKey = `${project.file.path}::${taskId}`;\r\n            const isCollapsed = this.collapsedTasks.has(taskKey);\r\n            const caret = taskRowLeft.createEl(\"span\", { cls: \"pm-task-caret\" });\r\n            caret.textContent = isCollapsed ? \"▶\" : \"▼\";\r\n            caret.addEventListener(\"click\", (e) => {\r\n              e.stopPropagation();\r\n              if (this.collapsedTasks.has(taskKey)) {\r\n                this.collapsedTasks.delete(taskKey);\r\n              } else {\r\n                this.collapsedTasks.add(taskKey);\r\n              }\r\n              this.render();\r\n            });\r\n          }\r\n          \r\n          if (tlIsTaskDone(task)) {\r\n            const chk = taskRowLeft.createEl(\"span\");\r\n            setIcon(chk, \"check-circle\");\r\n            chk.addClass(\"pm-task-check\");\r\n            chk.style.marginRight = \"4px\";\r\n          } else if (tlIsTaskOnHold(task)) {\r\n            const hold = taskRowLeft.createEl(\"span\");\r\n            setIcon(hold, \"pause-circle\");\r\n            hold.addClass(\"pm-task-hold\");\r\n            hold.style.marginRight = \"4px\";\r\n          } else {\r\n            taskRowLeft.createEl(\"span\", { text: \"• \" });\r\n          }\r\n\r\n          // Build the same hover title used for timeline bars\r\n          let dueIso = (task.props[\"due\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n          // @ts-ignore moment callable\r\n          const dueFmt = dueIso ? (moment as any)(dueIso, \"YYYY-MM-DD\").format(\"YYYY-MM-DD\") : \"‑\";\r\n          const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n\r\n          // Remove Tasks‑emoji date markers (🔜 ⏳ 📅 ✅ 🛫 YYYY‑MM‑DD) from the display text\r\n          const firstLineRaw = task.text.split(\"\\n\")[0].trim();\r\n          const firstLine    = firstLineRaw.replace(/(🔜|⏳|📅|✅|🛫)\\uFE0F?\\s*\\d{4}-\\d{2}-\\d{2}/g, \"\").trim();\r\n\r\n          // Ellipsis if longer than 70 chars\r\n          const shortText = firstLine.length > 70 ? firstLine.slice(0, 67) + \"…\" : firstLine;\r\n\r\n          /* ---- build E‑x. / S‑x. / SB‑x. prefix ---- */\r\n          let prefix = \"\";\r\n          {\r\n            const idLower = task.id.toLowerCase();\r\n            const numMatch = task.id.match(/\\d+/);\r\n            const num = numMatch ? numMatch[0] : \"\";\r\n            if (idLower.startsWith(\"sb\")) {\r\n              prefix = `SB-${num}. `;\r\n            } else if (idLower.startsWith(\"s\")) {\r\n              prefix = `S-${num}. `;\r\n            } else if (idLower.startsWith(\"e\")) {\r\n              prefix = `E-${num}. `;\r\n            }\r\n          }\r\n\r\n          const taskLink = taskRowLeft.createEl(\"a\", {\r\n            text: prefix + shortText,\r\n            href: `${project.file.path}#^${task.id}`,\r\n          });\r\n        \r\n          /* ── Hover tooltip for this task ─────────────────────────── */\r\n          {\r\n            let tip: HTMLElement | null = null;\r\n\r\n            const showTip = () => {\r\n              /* Build short text & ID prefix locally */\r\n              const raw       = task.text.split(\"\\n\")[0].trim();\r\n              const shortTxt  = raw.length > 70 ? raw.slice(0, 67) + \"…\" : raw;\r\n\r\n              let idPrefix = \"\";\r\n              {\r\n                const idL  = task.id.toLowerCase();\r\n                const num  = task.id.match(/\\d+/)?.[0] ?? \"\";\r\n                if (idL.startsWith(\"sb\"))      idPrefix = `SB-${num}. `;\r\n                else if (idL.startsWith(\"s\") && !idL.startsWith(\"sb\")) idPrefix = `S-${num}. `;\r\n                else if (idL.startsWith(\"e\"))  idPrefix = `E-${num}. `;\r\n              }\r\n              const who = (task.props[\"assignee\"] ?? \"\").replace(/\\u00A0/g, \" \").trim() || \"—\";\r\n              const fmt = (s: string) => (s && s.trim() !== \"\" ? s.trim() : \"—\");\r\n              const desc = getDescription(task);\r\n              const priority = getTaskPriority(task);\r\n              const priorityText = priority ? priority.charAt(0).toUpperCase() + priority.slice(1) : \"—\";\r\n              const html = `\r\n                <strong>${idPrefix}${shortTxt}</strong>${desc ? `<br><em>${desc}</em>` : \"\"}\r\n                <br><span>Start: ${fmt(startIso)}</span>\r\n                <br><span>Due&nbsp;&nbsp;: ${fmt(dueIso)}</span>\r\n                <br><span>Assignee:&nbsp;${who}</span>\r\n                <br><span>Priority: ${priorityText}</span>\r\n              `;\r\n\r\n              tip = document.createElement(\"div\");\r\n              tip.className = \"pm-dash-tooltip\";\r\n              tip.innerHTML = html;\r\n              document.body.appendChild(tip);\r\n\r\n              /* Position beside the link, keep on-screen and under header */\r\n              const r   = taskLink.getBoundingClientRect();\r\n              const pad = 8;\r\n              const w   = tip.offsetWidth;\r\n              let x = r.right + pad;\r\n              if (x + w > window.innerWidth - pad) {\r\n                x = Math.max(r.left - pad - w, pad);\r\n              }\r\n              const h = tip.offsetHeight;\r\n              let y   = Math.max(r.top, 48);\r\n              if (y + h > window.innerHeight - pad) {\r\n                y = Math.max(window.innerHeight - h - pad, 48);\r\n              }\r\n              tip.style.left = `${x}px`;\r\n              tip.style.top  = `${y}px`;\r\n            };\r\n\r\n            const hideTip = () => { tip?.remove(); tip = null; };\r\n\r\n            taskLink.addEventListener(\"mouseenter\", showTip);\r\n            taskLink.addEventListener(\"mouseleave\", hideTip);\r\n          }\r\n        \r\n          /* Indent: Epics 0, Stories 1, SB 2 */\r\n          {\r\n          const idTag = (task.id ?? \"\").toUpperCase();\r\n          const indent =\r\n            idTag.startsWith(\"E\") ? 0 :\r\n            (idTag.startsWith(\"S\") && !idTag.startsWith(\"SB\")) ? 1 : 2;\r\n          taskLink.style.marginLeft = `${indent * 12}px`;\r\n          }\r\n        \r\n          /* --- bold for \"E\" or plain \"S\" (not SB) --- */\r\n          {\r\n            const idLower = task.id.toLowerCase();\r\n            if (\r\n              idLower.startsWith(\"e\") ||                       // any \"E…\"\r\n              (idLower.startsWith(\"s\") && !idLower.startsWith(\"sb\"))  // \"S…\" but NOT \"SB…\"\r\n            ) {\r\n              taskLink.classList.add(\"pm-task-bold\");\r\n            }\r\n          }\r\n          taskLink.addClass(\"pm-tl-label\");               // inherit ellipsis styles\r\n          taskLink.style.width = `${this.labelWidth}px`;  // same width as project column\r\n\r\n          taskLink.onclick = (e) => {\r\n            e.preventDefault();\r\n            this.openAndScroll(project.file.path, task.id, task.line);\r\n          };\r\n\r\n          /* ----- task row: right pane with its bar ----- */\r\n          const taskRowRight = rightPane.createEl(\"div\", { cls: \"pm-tl-row\" });\r\n          taskRowRight.dataset.proj = project.file.path;\r\n          if (this.hiddenProjects.has(project.file.path))\r\n            taskRowRight.classList.add(\"pm-hide-bars\");\r\n          /* Ensure separator spans the full timeline width */\r\n          taskRowRight.style.minWidth = `${(horizon + 1) * pxPerDay}px`;\r\n          \r\n          // Cache the task row for efficient zoom updates\r\n          this.timelineRows.push(taskRowRight);\r\n          /* If the timeline has exactly one project, make each task row shorter */\r\n          let taskBarWrap: HTMLDivElement;\r\n          if (projects.length === 1) {\r\n            taskRowLeft.style.height  = \"27px\";\r\n            taskRowRight.style.height = \"27px\";\r\n            /* keep bar‑wrap in sync */\r\n            taskBarWrap = taskRowRight.createEl(\"div\", { cls: \"pm-tl-barwrap\" });\r\n            taskBarWrap.style.height = \"27px\";\r\n            /* IMPORTANT: barWrap must be the *first* child so existing logic can reuse it */\r\n            taskRowRight.insertBefore(taskBarWrap, taskRowRight.firstChild);\r\n          } else {\r\n            /* multi‑project: create the barWrap as usual */\r\n            taskBarWrap = taskRowRight.createEl(\"div\", { cls: \"pm-tl-barwrap\" });\r\n            taskBarWrap.style.height = \"27px\";   // default task row height\r\n            taskRowRight.insertBefore(taskBarWrap, taskRowRight.firstChild);\r\n          }\r\n          taskBarWrap.style.position = \"relative\";   // make this the positioning context\r\n          \r\n          // ── draw the bar exactly as in the normal loop ──\r\n          let dueIsoBar = task.props[\"due\"] ?? \"\";\r\n          dueIsoBar = dueIsoBar.replace(/\\u00A0/g, \" \").trim();\r\n          if (!dueIsoBar) return;\r\n\r\n          // @ts-ignore callable moment present at runtime\r\n          const due = (moment as any)(dueIsoBar, \"YYYY-MM-DD\");\r\n          if (!due.isValid()) return;\r\n\r\n          const dayOffset = due.diff(today, \"days\");\r\n          // Allow bars far outside the viewport; rely on scroll/zoom to reveal\r\n          // if (dayOffset < -30 || dayOffset > 365) return;\r\n\r\n          const bar = taskBarWrap.createEl(\"div\", { cls: \"pm-tl-bar\" });\r\n        \r\n          // Add priority border color\r\n          const priority = getTaskPriority(task);\r\n          if (priority) bar.addClass(`pm-priority-${priority}`);\r\n        \r\n          const taskKey = key(task);\r\n          (bar as any).dataset.task = taskKey;\r\n          bar.addEventListener(\"mouseenter\", () => highlightArrows(taskKey, true));\r\n          bar.addEventListener(\"mouseleave\", () => highlightArrows(taskKey, false));\r\n        \r\n          // ── track pointer movement so we can suppress post-drag clicks ──\r\n          let dragMoved  = false;\r\n          let dragStartX = 0;\r\n\r\n          bar.addEventListener(\"pointerdown\", (ev) => {\r\n            dragMoved  = false;\r\n            dragStartX = ev.clientX;\r\n          });\r\n          bar.addEventListener(\"pointermove\", (ev) => {\r\n            if (Math.abs(ev.clientX - dragStartX) > 3) dragMoved = true;   // >3 px = drag\r\n          });\r\n        \r\n          /* --- colour by ID prefix --- */\r\n          {\r\n            const idLower = task.id.toLowerCase();\r\n            if (idLower.startsWith(\"e\")) {\r\n              bar.addClass(\"pm-bar-e\");          // red\r\n            } else if (idLower.startsWith(\"sb\")) {\r\n              bar.addClass(\"pm-bar-sb\");         // light blue\r\n            } else if (idLower.startsWith(\"s\")) {\r\n              bar.addClass(\"pm-bar-s\");          // grey\r\n            }\r\n          }\r\n          /* --- done/on-hold/urgency colour --- */\r\n          if (tlIsTaskDone(task)) {\r\n            bar.addClass(\"pm-tl-bar-done\");\r\n          } else if (tlIsTaskOnHold(task)) {\r\n            bar.addClass(\"pm-tl-bar-hold\");\r\n          } else if (!task.checked) {\r\n            if (dayOffset < 0) {\r\n              bar.addClass(\"pm-bar-overdue\");   // red\r\n            } else if (dayOffset <= 10) {\r\n              bar.addClass(\"pm-bar-warning\");   // orange\r\n            }\r\n          }\r\n          \r\n          // Support multi‑day tasks when a start:: date exists\r\n          const startIsoBar = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n          let startOffset  = dayOffset;  // default single‑day bar\r\n          let durationDays = 1;\r\n\r\n          // (moved: update project span after startOffset/durationDays are final)\r\n          // projStart = Math.min(projStart, startOffset);\r\n          // projEnd   = Math.max(projEnd, startOffset + durationDays - 1);\r\n          \r\n          if (startIsoBar) {\r\n            // @ts-ignore moment callable\r\n            const start = (moment as any)(startIsoBar, \"YYYY-MM-DD\");\r\n            if (start.isValid()) {\r\n              startOffset  = start.diff(today, \"days\");\r\n              /* +1 so the bar includes the due‑date day */\r\n              durationDays = Math.max(due.diff(start, \"days\") + 1, 1);\r\n            }\r\n          }\r\n\r\n          /* Heat‑map tally (exclude \"E\" and plain \"S\") */\r\n          {\r\n            const idL = task.id.toLowerCase();\r\n            const isPlainS = idL.startsWith(\"s\") && !idL.startsWith(\"sb\");\r\n            if (!idL.startsWith(\"e\") && !isPlainS) {\r\n              addHeat(startOffset, durationDays);\r\n            }\r\n          }\r\n          /* Record milestones so we can draw vertical guideline bars */\r\n          {\r\n            const idLower = task.id.toLowerCase();\r\n            const isMilestone =\r\n              idLower.startsWith(\"m\") ||                         // ID begins with \"M…\"\r\n              ((task.props[\"milestone\"] ?? \"\")\r\n              .toString()\r\n              .toLowerCase() === \"true\");                     // or milestone:: true\r\n            if (isMilestone && isProjectVisible(project.file.path)) {\r\n              milestoneOffsets.add(startOffset);      // or startOff\r\n              const desc = getDescription(task);\r\n              const html =\r\n                `<span><strong>Project:</strong> ${project.file.basename}</span><br>` +\r\n                `<strong>${task.id}</strong><br>${dueIso}` +        // or dueIsoBar\r\n                (desc ? `<br>${desc}` : \"\");\r\n              // Store both HTML and task info for label\r\n              const labelText = desc || task.id;\r\n              milestoneMap.set(startOffset, `${html}|||${labelText}`);     // or startOff\r\n            }\r\n          }\r\n          \r\n          bar.style.left  = `${startOffset * pxPerDay}px`;\r\n          bar.style.width = `${Math.max(durationDays * pxPerDay, 3)}px`;\r\n          bar.style.zIndex = \"2\";     // keep bars below sticky headers\r\n          // record coordinates\r\n          barsById[key(task)] = {\r\n            x: startOffset * pxPerDay,\r\n            w: Math.max(durationDays * pxPerDay, 3),\r\n            el: bar,\r\n          };\r\n          tasksById.set(key(task), task);\r\n\r\n          /* ───────────────── Drag‑to‑reschedule (left‑drag) and resize handles ───────────── */\r\n          if (this.plugin.settings.allowBarMove !== false) {\r\n            const origOffset = startOffset;          // day offset for this bar\r\n            /* ---- resize handles (6px wide) ---- */\r\n            const leftHandle = bar.createEl(\"div\", { cls: \"pm-resize-handle left\" });\r\n            const rightHandle = bar.createEl(\"div\", { cls: \"pm-resize-handle right\" });\r\n\r\n            [leftHandle, rightHandle].forEach(h => {\r\n              h.style.position = \"absolute\";\r\n              h.style.top = \"0\";\r\n              h.style.width = \"6px\";\r\n              h.style.height = \"100%\";\r\n              h.style.cursor = \"ew-resize\";\r\n              h.style.touchAction = \"none\";\r\n              h.style.background = \"transparent\";\r\n            });\r\n            leftHandle.style.left = \"0\";\r\n            rightHandle.style.right = \"0\";\r\n\r\n            /* pointer events */\r\n            leftHandle.addEventListener(\"pointerdown\", (ev) => {\r\n              if (ev.button !== 0) return;\r\n              ev.stopPropagation();\r\n              bar.setPointerCapture(ev.pointerId);\r\n              currentDrag = {\r\n                barEl: bar,\r\n                startClientX: ev.clientX,\r\n                originalDayOffset: startOffset,\r\n                originalSpan: durationDays,\r\n                taskPath: project.file.path + \"::\" + task.id,\r\n                mode: \"resize-left\"\r\n              };\r\n            });\r\n            rightHandle.addEventListener(\"pointerdown\", (ev) => {\r\n              if (ev.button !== 0) return;\r\n              ev.stopPropagation();\r\n              bar.setPointerCapture(ev.pointerId);\r\n              currentDrag = {\r\n                barEl: bar,\r\n                startClientX: ev.clientX,\r\n                originalDayOffset: startOffset,\r\n                originalSpan: durationDays,\r\n                taskPath: project.file.path + \"::\" + task.id,\r\n                mode: \"resize-right\"\r\n              };\r\n            });\r\n\r\n            bar.addEventListener(\"pointerdown\", (ev) => {\r\n              if (ev.button !== 0) return;           // left‑button only\r\n              ev.preventDefault();\r\n\r\n              /* ── suppress the bar's normal click while we drag ── */\r\n              const suppress = (e: MouseEvent) => { e.stopImmediatePropagation(); e.preventDefault(); };\r\n              bar.addEventListener(\"click\", suppress, true);           // capture phase\r\n              \r\n              /* Remove suppression AFTER the click event queue has fired */\r\n              const unhook = () => setTimeout(() => bar.removeEventListener(\"click\", suppress, true), 0);\r\n              bar.addEventListener(\"pointerup\", unhook,   { once: true });\r\n              bar.addEventListener(\"pointercancel\", unhook, { once: true });\r\n\r\n              bar.setPointerCapture(ev.pointerId);\r\n              currentDrag = {\r\n                barEl: bar,\r\n                startClientX: ev.clientX,\r\n                originalDayOffset: origOffset,\r\n                originalSpan: durationDays,\r\n                taskPath: project.file.path + \"::\" + task.id,\r\n                mode: \"move\"\r\n              };\r\n              bar.style.opacity = \"0.6\";\r\n            });\r\n\r\n            bar.addEventListener(\"pointermove\", (ev) => {\r\n              if (!currentDrag || currentDrag.barEl !== bar) return;\r\n              const deltaPx   = ev.clientX - currentDrag.startClientX;\r\n              const deltaDays = Math.round(deltaPx / this.zoomPxPerDay);\r\n\r\n              if (currentDrag.mode === \"move\") {\r\n                const newOffset = currentDrag.originalDayOffset + deltaDays;\r\n                bar.style.left  = `${newOffset * this.zoomPxPerDay}px`;\r\n              } else if (currentDrag.mode === \"resize-left\") {\r\n                const newOffset = currentDrag.originalDayOffset + deltaDays;\r\n                const newSpan   = currentDrag.originalSpan - deltaDays;\r\n                if (newSpan >= 1) {\r\n                  bar.style.left  = `${newOffset * this.zoomPxPerDay}px`;\r\n                  bar.style.width = `${newSpan * this.zoomPxPerDay}px`;\r\n                }\r\n              } else { // resize-right\r\n                const newSpan = currentDrag.originalSpan + deltaDays;\r\n                if (newSpan >= 1) {\r\n                  bar.style.width = `${newSpan * this.zoomPxPerDay}px`;\r\n                }\r\n              }\r\n            });\r\n\r\n            bar.addEventListener(\"pointerup\", (ev) => {\r\n              if (!currentDrag || currentDrag.barEl !== bar) return;\r\n              bar.releasePointerCapture(ev.pointerId);\r\n              bar.style.opacity = \"\";\r\n              const deltaDays = Math.round(\r\n                (ev.clientX - currentDrag.startClientX) / this.zoomPxPerDay\r\n              );\r\n              if (deltaDays !== 0) {\r\n                if (currentDrag.mode === \"move\") {\r\n                  this.containerEl.dispatchEvent(\r\n                    new CustomEvent(\"pm-bar-moved\", {\r\n                      detail: { taskKey: currentDrag.taskPath, deltaDays },\r\n                      bubbles: true\r\n                    })\r\n                  );\r\n                } else {\r\n                  const detail = {\r\n                    taskKey: currentDrag.taskPath,\r\n                    deltaStart: currentDrag.mode === \"resize-left\"  ? deltaDays : 0,\r\n                    deltaDue:   currentDrag.mode === \"resize-right\" ? deltaDays : 0\r\n                  };\r\n                  this.containerEl.dispatchEvent(\r\n                    new CustomEvent(\"pm-bar-resized\", { detail, bubbles: true })\r\n                  );\r\n                }\r\n              }\r\n              currentDrag = null;\r\n              // Immediate re-render removed; rely on main.ts refresh\r\n            });\r\n          }\r\n\r\n          /* show labels only when tasks list is visible (eye ON) */\r\n          if (\r\n          (this.plugin.settings.showAssignees !== false) &&\r\n          !barsMode &&                               /* tasks list visible */\r\n          !this.collapsed.has(project.file.path)     /* project expanded */\r\n          ) {\r\n            const who = (task.props[\"assignee\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n            if (who) {\r\n              const lbl = taskBarWrap.createEl(\"span\", { cls: \"pm-assignee\", text: who });\r\n              if (who === \"—\") {\r\n                lbl.style.color = \"red\";   // show unassigned placeholder in red\r\n              }\r\n              lbl.style.position       = \"absolute\";\r\n              const leftPx = parseFloat(bar.style.left || \"0\") + parseFloat(bar.style.width || \"0\") + 4;\r\n              lbl.style.left           = `${leftPx}px`;   // 4‑px gap after bar\r\n              lbl.style.top            = \"50%\";\r\n              lbl.style.transform      = \"translateY(-50%)\";\r\n              lbl.style.whiteSpace     = \"nowrap\";\r\n              lbl.style.pointerEvents  = \"none\";\r\n            }\r\n          }\r\n          if (task.checked) bar.addClass(\"pm-tl-bar-done\");\r\n\r\n          bar.onclick = (e) => {\r\n            // Suppress clicks that follow a drag, or when move-mode is enabled\r\n            if (dragMoved || this.plugin.settings.allowBarMove !== false) {\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n            e.preventDefault();\r\n            this.openAndScroll(project.file.path, task.id, task.line);\r\n          };\r\n        \r\n          /* ── shared tooltip (task‑row bar) ── */\r\n          {\r\n            const buildHtml = () => {\r\n              const fmt = (s: string) => (s && s.trim() ? s.trim() : \"—\");\r\n              const desc = getDescription(task);\r\n              const raw  = task.text.split(\"\\n\")[0].trim();\r\n              const shortTxt = raw.length > 70 ? raw.slice(0, 67) + \"…\" : raw;\r\n              const who = (task.props[\"assignee\"] ?? \"\").replace(/\\u00A0/g, \" \").trim() || \"—\";\r\n              const priority = getTaskPriority(task);\r\n              const priorityText = priority ? priority.charAt(0).toUpperCase() + priority.slice(1) : \"—\";\r\n              \r\n              let idPrefix = \"\";\r\n              {\r\n                const low = task.id.toLowerCase();\r\n                const num = task.id.match(/\\d+/)?.[0] ?? \"\";\r\n                if (low.startsWith(\"sb\"))      idPrefix = `SB-${num}. `;\r\n                else if (low.startsWith(\"s\") && !low.startsWith(\"sb\")) idPrefix = `S-${num}. `;\r\n                else if (low.startsWith(\"e\"))  idPrefix = `E-${num}. `;\r\n              }\r\n\r\n              return `<strong>${idPrefix}${shortTxt}</strong>${desc ? `<br><em>${desc}</em>` : \"\"}`\r\n                   + `<br><span>Start: ${fmt(startIso)}</span>`\r\n                   + `<br><span>Due&nbsp;&nbsp;: ${fmt(dueIso)}</span>`\r\n                   + `<br><span>Assignee:&nbsp;${who}</span>`\r\n                   + `<br><span>Priority: ${priorityText}</span>`;\r\n            };\r\n\r\n            bar.addEventListener(\"mouseenter\", (ev) => {\r\n              const m = ev as MouseEvent;\r\n              const fakeRect = {\r\n                left:   m.clientX,\r\n                right:  m.clientX,\r\n                top:    m.clientY,\r\n                bottom: m.clientY,\r\n                width:  0,\r\n                height: 0,\r\n              } as DOMRect;\r\n              showBarTip(buildHtml(), fakeRect);\r\n            });\r\n            bar.addEventListener(\"mouseleave\", hideBarTip);\r\n          }\r\n        });\r\n\r\n        /* draw backdrop bar after task rows so it sits underneath them */\r\n        if (Number.isFinite(projStart) && Number.isFinite(projEnd)) {\r\n          const leftPx  = projStart * pxPerDay;\r\n          const widthPx = (projEnd - projStart + 1) * pxPerDay;\r\n          if (widthPx > 0) {\r\n            const projBar = barWrap.createEl(\"div\", { cls: \"pm-proj-bar\" });\r\n            projBar.style.position = \"absolute\";\r\n            projBar.style.left   = `${leftPx}px`;\r\n            projBar.style.width  = `${widthPx}px`;\r\n            projBar.style.height = \"18px\";\r\n            projBar.style.top    = \"50%\";\r\n            projBar.style.transform = \"translateY(-50%)\";\r\n            projBar.style.pointerEvents = \"auto\"; // always allow hover events\r\n            projBar.style.cursor        = this.plugin.settings.allowBarMove === false ? \"default\" : \"move\";\r\n            projBar.style.zIndex        = \"3\";\r\n\r\n            /* ── Project bar hover tooltip ─────────────────────────── */\r\n            let projTip: HTMLElement | null = null;\r\n            const showProjTip = () => {\r\n              /* Get latest front‑matter */\r\n              const cache = this.app.metadataCache.getFileCache(project.file);\r\n              const fm: Record<string, any> = cache?.frontmatter ?? {};\r\n\r\n              const val = (k: string) =>\r\n                fm[k] ?? fm[k.replace(/ /g, \"\").toLowerCase()] ?? \"—\";\r\n\r\n              const startDate = val(\"Start Date\") || val(\"start date\");\r\n              const endDate = val(\"End Date\") || val(\"Due Date\") || val(\"end date\") || val(\"due date\");\r\n              const description = val(\"Description\") || val(\"description\");\r\n\r\n              const html = `\r\n                <strong>${project.file.basename}</strong><br>\r\n                ${description !== \"—\" ? `<em>${description}</em><br>` : \"\"}\r\n                <span>Start: ${startDate}</span><br>\r\n                <span>End  : ${endDate}</span>\r\n              `;\r\n\r\n              projTip = document.createElement(\"div\");\r\n              projTip.className = \"pm-dash-tooltip\";\r\n              projTip.innerHTML = html;\r\n              projTip.style.zIndex = \"10001\"; // Ensure it's above everything\r\n              document.body.appendChild(projTip);\r\n\r\n              const r = projBar.getBoundingClientRect();\r\n              const pad = 8;\r\n              const w = projTip.offsetWidth || 200;\r\n              const h = projTip.offsetHeight || 100;\r\n\r\n              let left = r.left + (r.width - w) / 2;\r\n              if (left < pad) left = pad;\r\n              if (left + w > window.innerWidth - pad) left = window.innerWidth - w - pad;\r\n\r\n              let top = r.top - h - 8;\r\n              if (top < pad) top = r.bottom + 8;\r\n              if (top + h > window.innerHeight - pad) top = window.innerHeight - h - pad;\r\n\r\n              projTip.style.left = `${left}px`;\r\n              projTip.style.top = `${top}px`;\r\n\r\n            };\r\n\r\n            const hideProjTip = () => {\r\n              projTip?.remove();\r\n              projTip = null;\r\n            };\r\n\r\n            /* ── Project bar hover tooltip ─────────────────────────── */\r\n            projBar.addEventListener(\"mouseenter\", (e) => {\r\n\r\n              projBar.style.backgroundColor = \"red\"; // Visual test\r\n              showProjTip();\r\n            });\r\n            projBar.addEventListener(\"mouseleave\", (e) => {\r\n\r\n              projBar.style.backgroundColor = \"\"; // Reset visual test\r\n              hideProjTip();\r\n            });\r\n            \r\n            /* ── enable move & edge‑resize ── */\r\n            if (this.plugin.settings.allowBarMove !== false) {\r\n              const edge = 6;   // px on each edge for resize\r\n\r\n              projBar.addEventListener(\"pointerdown\", (ev) => {\r\n                if (ev.button !== 0) return;   // left button\r\n\r\n                /* prevent project link from opening while dragging */\r\n                ev.preventDefault();\r\n                const suppress = (e: MouseEvent) => { e.stopImmediatePropagation(); e.preventDefault(); };\r\n                projBar.addEventListener(\"click\", suppress, true);\r\n                const unhook = () => setTimeout(() => projBar.removeEventListener(\"click\", suppress, true), 0);\r\n                projBar.addEventListener(\"pointerup\", unhook,   { once: true });\r\n                projBar.addEventListener(\"pointercancel\", unhook, { once: true });\r\n\r\n                const r = projBar.getBoundingClientRect();\r\n                let mode: \"move\" | \"resize-left\" | \"resize-right\" = \"move\";\r\n                if (ev.clientX - r.left < edge)           mode = \"resize-left\";\r\n                else if (r.right - ev.clientX < edge)     mode = \"resize-right\";\r\n\r\n                projBar.setPointerCapture(ev.pointerId);\r\n                currentProjDrag = {\r\n                  barEl: projBar,\r\n                  startClientX: ev.clientX,\r\n                  originalStart: projStart,\r\n                  originalWidth: r.width,\r\n                  mode,\r\n                  projectPath: project.file.path\r\n                };\r\n                projBar.style.opacity = \"0.6\";\r\n                projBar.style.cursor  = mode === \"move\" ? \"grabbing\" : \"ew-resize\";\r\n              });\r\n\r\n              projBar.addEventListener(\"pointermove\", (ev) => {\r\n                if (!currentProjDrag || currentProjDrag.barEl !== projBar) return;\r\n                const deltaPx   = ev.clientX - currentProjDrag.startClientX;\r\n                const deltaDays = Math.round(deltaPx / this.zoomPxPerDay);\r\n\r\n                if (currentProjDrag.mode === \"move\") {\r\n                  projBar.style.left = `${(currentProjDrag.originalStart + deltaDays) * this.zoomPxPerDay}px`;\r\n                } else if (currentProjDrag.mode === \"resize-left\") {\r\n                  const newWidth = currentProjDrag.originalWidth - deltaPx;\r\n                  if (newWidth > this.zoomPxPerDay) {\r\n                    projBar.style.left  = `${(currentProjDrag.originalStart + deltaDays) * this.zoomPxPerDay}px`;\r\n                    projBar.style.width = `${newWidth}px`;\r\n                  }\r\n                } else { // resize-right\r\n                  const newWidth = currentProjDrag.originalWidth + deltaPx;\r\n                  if (newWidth > this.zoomPxPerDay) projBar.style.width = `${newWidth}px`;\r\n                }\r\n              });\r\n\r\n              projBar.addEventListener(\"pointerup\", (ev) => {\r\n                if (!currentProjDrag || currentProjDrag.barEl !== projBar) return;\r\n                projBar.releasePointerCapture(ev.pointerId);\r\n                projBar.style.opacity = \"\";\r\n                projBar.style.cursor  = \"move\";\r\n\r\n                const deltaPx   = ev.clientX - currentProjDrag.startClientX;\r\n                const deltaDays = Math.round(deltaPx / this.zoomPxPerDay);\r\n\r\n                if (deltaDays !== 0) {\r\n                  if (currentProjDrag.mode === \"move\") {\r\n                    this.containerEl.dispatchEvent(\r\n                      new CustomEvent(\"pm-project-bar-moved\", {\r\n                        detail: { projectPath: currentProjDrag.projectPath, deltaDays },\r\n                        bubbles: true\r\n                      })\r\n                    );\r\n                  } else if (currentProjDrag.mode === \"resize-left\") {\r\n                    this.containerEl.dispatchEvent(\r\n                      new CustomEvent(\"pm-project-bar-resized\", {\r\n                        detail: { projectPath: currentProjDrag.projectPath, deltaStart: deltaDays, deltaEnd: 0 },\r\n                        bubbles: true\r\n                      })\r\n                    );\r\n                  } else if (currentProjDrag.mode === \"resize-right\") {\r\n                    this.containerEl.dispatchEvent(\r\n                      new CustomEvent(\"pm-project-bar-resized\", {\r\n                        detail: { projectPath: currentProjDrag.projectPath, deltaStart: 0, deltaEnd: deltaDays },\r\n                        bubbles: true\r\n                      })\r\n                    );\r\n                  }\r\n                }\r\n                currentProjDrag = null;\r\n              });\r\n\r\n              /* Hover feedback: change cursor to ↔ at edges */\r\n              projBar.addEventListener(\"mousemove\", (ev) => {\r\n                if (this.plugin.settings.allowBarMove === false) return;\r\n                const offsetX = ev.offsetX;\r\n                projBar.style.cursor =\r\n                  offsetX < edge || projBar.clientWidth - offsetX < edge ? \"ew-resize\" : \"move\";\r\n              });\r\n            }\r\n          }\r\n        }\r\n        continue; // skip project‑level bar rendering (already drawn above)\r\n      }\r\n\r\n      if (!barsMode && !this.collapsed.has(project.file.path)) {\r\n        orderTasks(project.tasks, project.file.path).forEach((task) => {\r\n          /* --- ensure every task has an anchor so arrows can attach --- */\r\n          const anchor = barWrap.createEl(\"div\", { cls: \"pm-tl-anchor\" });\r\n          anchor.style.left   = \"0px\";\r\n          anchor.style.width  = \"1px\";\r\n          anchor.style.height = \"14px\";\r\n          anchor.style.opacity = \"0\";\r\n          anchor.style.pointerEvents = \"none\";   // allow bar tooltip to show\r\n          barsById[key(task)] = { x: 0, w: 1, el: anchor };\r\n          tasksById.set(key(task), task);\r\n          // Collapsed-tasks block: show icon for completed tasks\r\n          const taskRowLeft = leftPane.createEl(\"div\", { cls: \"pm-tl-taskrow\" });\r\n          \r\n          // Add collapse caret for Epic/Story tasks\r\n          const taskId = task.id.toLowerCase();\r\n          if (taskId.startsWith(\"e-\") || taskId.startsWith(\"s-\")) {\r\n            const taskKey = `${project.file.path}::${taskId}`;\r\n            const isCollapsed = this.collapsedTasks.has(taskKey);\r\n            const caret = taskRowLeft.createEl(\"span\", { cls: \"pm-task-caret\" });\r\n            caret.textContent = isCollapsed ? \"▶\" : \"▼\";\r\n            caret.addEventListener(\"click\", (e) => {\r\n              e.stopPropagation();\r\n              if (this.collapsedTasks.has(taskKey)) {\r\n                this.collapsedTasks.delete(taskKey);\r\n              } else {\r\n                this.collapsedTasks.add(taskKey);\r\n              }\r\n              this.render();\r\n            });\r\n          }\r\n          \r\n          if (tlIsTaskDone(task)) {\r\n            const chk = taskRowLeft.createEl(\"span\");\r\n            setIcon(chk, \"check-circle\");\r\n            chk.addClass(\"pm-task-check\");\r\n            chk.style.marginRight = \"4px\";\r\n          } else {\r\n            taskRowLeft.createEl(\"span\", { text: \"• \" });\r\n          }\r\n          let dueIso = task.props[\"due\"] ?? \"\";\r\n          dueIso = dueIso.replace(/\\u00A0/g, \" \").trim();   // strip NBSP + trim\r\n\r\n          if (!dueIso) return;\r\n\r\n          // @ts-ignore – see above\r\n          const due = (moment as any)(dueIso, \"YYYY-MM-DD\");\r\n          if (!due.isValid()) {\r\n\r\n            return;\r\n          }\r\n          const dayOffset = due.diff(today, \"days\");\r\n          // Allow bars far outside the viewport; rely on scroll/zoom to reveal\r\n          // if (dayOffset < -30 || dayOffset > 365) return; // skip far dates\r\n\r\n          const bar = barWrap.createEl(\"div\", { cls: \"pm-tl-bar\" });\r\n        \r\n          // Add priority border color\r\n          const priority = getTaskPriority(task);\r\n          if (priority) bar.addClass(`pm-priority-${priority}`);\r\n        \r\n          // ── track pointer movement so we can suppress post-drag clicks ──\r\n          let dragMoved  = false;\r\n          let dragStartX = 0;\r\n\r\n          bar.addEventListener(\"pointerdown\", (ev) => {\r\n            dragMoved  = false;\r\n            dragStartX = ev.clientX;\r\n          });\r\n          bar.addEventListener(\"pointermove\", (ev) => {\r\n            if (Math.abs(ev.clientX - dragStartX) > 3) dragMoved = true;   // >3 px = drag\r\n          });\r\n        \r\n          /* --- colour by ID prefix --- */\r\n          {\r\n            const idLower = task.id.toLowerCase();\r\n            if (idLower.startsWith(\"e\")) {\r\n              bar.addClass(\"pm-bar-e\");          // red\r\n            } else if (idLower.startsWith(\"sb\")) {\r\n              bar.addClass(\"pm-bar-sb\");         // light blue\r\n            } else if (idLower.startsWith(\"s\")) {\r\n              bar.addClass(\"pm-bar-s\");          // grey\r\n            }\r\n          }\r\n          /* --- done/on-hold/urgency colour --- */\r\n          if (tlIsTaskDone(task)) {\r\n            bar.addClass(\"pm-tl-bar-done\");\r\n          } else if (tlIsTaskOnHold(task)) {\r\n            bar.addClass(\"pm-tl-bar-hold\");\r\n          } else if (!task.checked) {\r\n            if (dayOffset < 0) {\r\n              bar.addClass(\"pm-bar-overdue\");   // red\r\n            } else if (dayOffset <= 10) {\r\n              bar.addClass(\"pm-bar-warning\");   // orange\r\n            }\r\n          }\r\n          \r\n          // Support multi‑day tasks when a start:: date exists\r\n          const startIso = (task.props[\"start\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n          let startOffset  = dayOffset;  // default single‑day bar\r\n          let durationDays = 1;\r\n\r\n          // (moved: update project span after startOffset/durationDays are final)\r\n          // projStart = Math.min(projStart, startOffset);\r\n          // projEnd   = Math.max(projEnd, startOffset + durationDays - 1);\r\n          \r\n          if (startIso) {\r\n            // @ts-ignore – Obsidian bundles callable moment\r\n            const start = (moment as any)(startIso, \"YYYY-MM-DD\");\r\n            if (start.isValid()) {\r\n              startOffset  = start.diff(today, \"days\");\r\n              /* +1 so the bar includes the due‑date day */\r\n              durationDays = Math.max(due.diff(start, \"days\") + 1, 1);\r\n            }\r\n          }\r\n          \r\n          /* Heat‑map tally (exclude \"E\" and plain \"S\") */\r\n          {\r\n            const idL = task.id.toLowerCase();\r\n            const isPlainS = idL.startsWith(\"s\") && !idL.startsWith(\"sb\");\r\n            if (!idL.startsWith(\"e\") && !isPlainS) {\r\n              addHeat(startOffset, durationDays);\r\n            }\r\n          }\r\n          \r\n          /* Record milestones so we can draw vertical guideline bars */\r\n          {\r\n            const idLower = task.id.toLowerCase();\r\n            const isMilestone =\r\n              idLower.startsWith(\"m\") ||                         // ID begins with \"M…\"\r\n              ((task.props[\"milestone\"] ?? \"\")\r\n              .toString()\r\n              .toLowerCase() === \"true\");                     // or milestone:: true\r\n            if (isMilestone) {\r\n              milestoneOffsets.add(startOffset);      // or startOff\r\n              const desc = getDescription(task);\r\n              const html =\r\n                `<span><strong>Project:</strong> ${project.file.basename}</span><br>` +\r\n                `<strong>${task.id}</strong><br>${dueIso}` +        // or dueIsoBar\r\n                (desc ? `<br>${desc}` : \"\");\r\n              const labelText = task.id;  // Use task ID\r\n              milestoneMap.set(startOffset, `${html}|||${labelText}`);     // or startOff\r\n            }  \r\n          }        \r\n          bar.style.left  = `${startOffset * pxPerDay}px`;\r\n          bar.style.width = `${Math.max(durationDays * pxPerDay, 3)}px`;\r\n          bar.style.zIndex = \"2\";     // keep bars below sticky headers\r\n\r\n          /* custom tooltip */\r\n          {\r\n            let tip: HTMLElement | null = null;\r\n            const show = () => {\r\n \r\n              /* Build idPrefix + shortTxt for this scope */\r\n              const rawLine  = task.text.split(\"\\n\")[0].trim();\r\n              const shortTxt = rawLine.length > 70 ? rawLine.slice(0, 67) + \"…\" : rawLine;\r\n\r\n              let idPrefix = \"\";\r\n              {\r\n                const low = task.id.toLowerCase();\r\n                const num = task.id.match(/\\d+/)?.[0] ?? \"\";\r\n                if (low.startsWith(\"sb\"))      idPrefix = `SB-${num}. `;\r\n                else if (low.startsWith(\"s\") && !low.startsWith(\"sb\")) idPrefix = `S-${num}. `;\r\n                else if (low.startsWith(\"e\"))  idPrefix = `E-${num}. `;\r\n              }\r\n              \r\n              const desc = getDescription(task);\r\n              const fmt  = (s: string) => (s && s.trim() ? s.trim() : \"—\");\r\n              const html = `\r\n                <strong>${idPrefix}${shortTxt}</strong>${desc ? `<br><em>${desc}</em>` : \"\"}\r\n                <br><span>Start: ${fmt(startIso)}</span>\r\n                <br><span>Due&nbsp;&nbsp;: ${fmt(dueIso)}</span>\r\n              `;\r\n              tip = document.createElement(\"div\");\r\n              tip.className = \"pm-dash-tooltip\";\r\n              tip.innerHTML = html;\r\n              document.body.appendChild(tip);\r\n\r\n              const r   = bar.getBoundingClientRect();\r\n              const pad = 8;\r\n              const w   = tip.offsetWidth;\r\n              tip.style.left =\r\n                r.right + pad + w <= window.innerWidth\r\n                  ? `${r.right + pad}px`\r\n                  : `${Math.max(r.left - pad - w, 4)}px`;\r\n              tip.style.top = `${Math.max(r.top, 48)}px`;\r\n            };\r\n            const hide = () => { tip?.remove(); tip = null; };\r\n            bar.addEventListener(\"mouseenter\", show);\r\n            bar.addEventListener(\"mouseleave\", hide);\r\n          }\r\n        \r\n          /* ───────────────── Drag‑to‑reschedule (hold Alt + drag) and resize handles ───────────── */\r\n          {\r\n            if (plugin.settings.allowBarMove !== false) {  // default ON when undefined\r\n              const origOffset = startOffset;           // day offset for this bar\r\n              /* ---- resize handles (6px wide) ---- */\r\n              const leftHandle = bar.createEl(\"div\", { cls: \"pm-resize-handle left\" });\r\n              const rightHandle = bar.createEl(\"div\", { cls: \"pm-resize-handle right\" });\r\n\r\n              [leftHandle, rightHandle].forEach(h => {\r\n                h.style.position = \"absolute\";\r\n                h.style.top = \"0\";\r\n                h.style.width = \"6px\";\r\n                h.style.height = \"100%\";\r\n                h.style.cursor = \"ew-resize\";\r\n                h.style.touchAction = \"none\";\r\n                h.style.background = \"transparent\";\r\n              });\r\n              leftHandle.style.left = \"0\";\r\n              rightHandle.style.right = \"0\";\r\n\r\n              /* pointer events */\r\n              leftHandle.addEventListener(\"pointerdown\", (ev) => {\r\n                if (ev.button !== 0) return;\r\n                ev.stopPropagation();\r\n                bar.setPointerCapture(ev.pointerId);\r\n                currentDrag = {\r\n                  barEl: bar,\r\n                  startClientX: ev.clientX,\r\n                  originalDayOffset: startOffset,\r\n                  originalSpan: durationDays,\r\n                  taskPath: project.file.path + \"::\" + task.id,\r\n                  mode: \"resize-left\"\r\n                };\r\n              });\r\n              rightHandle.addEventListener(\"pointerdown\", (ev) => {\r\n                if (ev.button !== 0) return;\r\n                ev.stopPropagation();\r\n                bar.setPointerCapture(ev.pointerId);\r\n                currentDrag = {\r\n                  barEl: bar,\r\n                  startClientX: ev.clientX,\r\n                  originalDayOffset: startOffset,\r\n                  originalSpan: durationDays,\r\n                  taskPath: project.file.path + \"::\" + task.id,\r\n                  mode: \"resize-right\"\r\n                };\r\n              });\r\n\r\n              bar.addEventListener(\"pointerdown\", (ev) => {\r\n\r\n                if (ev.button !== 0) return;    // left‑button only\r\n                ev.preventDefault();\r\n                bar.setPointerCapture(ev.pointerId);\r\n                currentDrag = {\r\n                  barEl: bar,\r\n                  startClientX: ev.clientX,\r\n                  originalDayOffset: origOffset,\r\n                  originalSpan: durationDays,\r\n                  taskPath: project.file.path + \"::\" + task.id,\r\n                  mode: \"move\"\r\n                };\r\n                bar.style.opacity = \"0.6\";\r\n              });\r\n\r\n              bar.addEventListener(\"pointermove\", (ev) => {\r\n                if (!currentDrag || currentDrag.barEl !== bar) return;\r\n                const deltaPx   = ev.clientX - currentDrag.startClientX;\r\n                const deltaDays = Math.round(deltaPx / this.zoomPxPerDay);\r\n\r\n                if (currentDrag.mode === \"move\") {\r\n                  const newOffset = currentDrag.originalDayOffset + deltaDays;\r\n                  bar.style.left  = `${newOffset * this.zoomPxPerDay}px`;\r\n                } else if (currentDrag.mode === \"resize-left\") {\r\n                  const newOffset = currentDrag.originalDayOffset + deltaDays;\r\n                  const newSpan   = currentDrag.originalSpan - deltaDays;\r\n                  if (newSpan >= 1) {\r\n                    bar.style.left  = `${newOffset * this.zoomPxPerDay}px`;\r\n                    bar.style.width = `${newSpan * this.zoomPxPerDay}px`;\r\n                  }\r\n                } else { // resize-right\r\n                  const newSpan = currentDrag.originalSpan + deltaDays;\r\n                  if (newSpan >= 1) {\r\n                    bar.style.width = `${newSpan * this.zoomPxPerDay}px`;\r\n                  }\r\n                }\r\n              });\r\n\r\n              bar.addEventListener(\"pointerup\", (ev) => {\r\n                if (!currentDrag || currentDrag.barEl !== bar) return;\r\n                bar.releasePointerCapture(ev.pointerId);\r\n                bar.style.opacity = \"\";\r\n                const deltaDays = Math.round(\r\n                  (ev.clientX - currentDrag.startClientX) / this.zoomPxPerDay\r\n                );\r\n                if (deltaDays !== 0) {\r\n                  if (currentDrag.mode === \"move\") {\r\n                    /* Bubble event so main.ts (or another controller) can update markdown */\r\n                    this.containerEl.dispatchEvent(\r\n                      new CustomEvent(\"pm-bar-moved\", {\r\n                        detail: { taskKey: currentDrag.taskPath, deltaDays },\r\n                        bubbles: true\r\n                      })\r\n                    );\r\n                  } else {\r\n                    const detail = {\r\n                      taskKey: currentDrag.taskPath,\r\n                      deltaStart: currentDrag.mode === \"resize-left\"  ? deltaDays : 0,\r\n                      deltaDue:   currentDrag.mode === \"resize-right\" ? deltaDays : 0\r\n                    };\r\n                    this.containerEl.dispatchEvent(\r\n                      new CustomEvent(\"pm-bar-resized\", { detail, bubbles: true })\r\n                    );\r\n                  }\r\n                }\r\n                currentDrag = null;\r\n                // Immediate re-render removed; rely on main.ts refresh\r\n              });\r\n            }\r\n          }\r\n\r\n          \r\n          // record coordinates\r\n          barsById[key(task)] = {\r\n            x: startOffset * pxPerDay,\r\n            w: Math.max(durationDays * pxPerDay, 3),\r\n            el: bar,\r\n          };\r\n          tasksById.set(key(task), task);\r\n          /* show labels only when tasks list is visible (eye ON) */\r\n          if (\r\n            (this.plugin.settings.showAssignees !== false) &&\r\n            !barsMode &&                               /* tasks list visible */\r\n            !this.collapsed.has(project.file.path)\r\n          ) {\r\n            const who = (task.props[\"assignee\"] ?? \"\").replace(/\\u00A0/g, \" \").trim();\r\n            if (who) {\r\n              const lbl = barWrap.createEl(\"span\", { cls: \"pm-assignee\", text: who });\r\n              lbl.style.position = \"absolute\";\r\n              const leftPx2 = parseFloat(bar.style.left || \"0\") + parseFloat(bar.style.width || \"0\") + 4;\r\n              lbl.style.left = `${leftPx2}px`;   // 4‑px gap after bar\r\n              lbl.style.top = \"50%\";\r\n              lbl.style.transform = \"translateY(-50%)\";\r\n              lbl.style.whiteSpace = \"nowrap\";\r\n              lbl.style.pointerEvents = \"none\";\r\n            }\r\n          }\r\n          if (task.checked) bar.addClass(\"pm-tl-bar-done\");\r\n\r\n          bar.onclick = (e) => {\r\n            // Suppress clicks that follow a drag, or when move-mode is enabled\r\n            if (dragMoved || this.plugin.settings.allowBarMove !== false) {\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n            e.preventDefault();\r\n            this.openAndScroll(project.file.path, task.id, task.line);\r\n          };\r\n        });\r\n      }\r\n\r\n      /* After task rows, draw one background bar spanning YAML Start → End\r\n         so users still see the overall project duration. */\r\n      if (Number.isFinite(projStart) && Number.isFinite(projEnd)) {\r\n        const leftPx  = projStart * pxPerDay;\r\n        const widthPx = (projEnd - projStart + 1) * pxPerDay;\r\n        if (widthPx > 0) {\r\n          const projBar = barWrap.createEl(\"div\", { cls: \"pm-proj-bar\" });\r\n          projBar.style.position = \"absolute\";\r\n          projBar.style.left   = `${leftPx}px`;\r\n          projBar.style.width  = `${widthPx}px`;\r\n          projBar.style.height = \"18px\";\r\n          projBar.style.top    = \"50%\";\r\n          projBar.style.transform = \"translateY(-50%)\";\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    /** Highlight / un-highlight dependency arrows connected to a task bar. */\r\n    const highlightArrows = (taskKey: string, on: boolean) => {\r\n      arrowLayer\r\n        .querySelectorAll<SVGPathElement>('path.pm-dep-arrow')\r\n        .forEach(path => {\r\n          const { src, dst } =\r\n            (path as any).dataset as { src?: string; dst?: string };\r\n          if (src === taskKey || dst === taskKey) {\r\n            if (on) {\r\n              path.classList.add('pm-arrow-hover');\r\n              // ⬇︎ enforce red stroke, overriding any CSS !important\r\n              path.style.setProperty('stroke', '#d00', 'important');\r\n              path.setAttribute('stroke', '#d00');\r\n              const hovUrl = arrowLayer.getAttribute('data-hover-marker-url') || '';\r\n              if (hovUrl) path.setAttribute('marker-end', hovUrl);\r\n            } else {\r\n              path.classList.remove('pm-arrow-hover');\r\n              path.style.removeProperty('stroke');\r\n              path.removeAttribute('stroke');\r\n              const baseUrl = arrowLayer.getAttribute('data-marker-url') || '';\r\n              if (baseUrl) path.setAttribute('marker-end', baseUrl);\r\n            }\r\n          }\r\n        });\r\n    };\r\n    \r\n    /* ---------- dependency arrows ---------- */\r\n    const drawArrows = () => {\r\n      arrowLayer.innerHTML = \"\";                    // reset\r\n      /* Width & height are controlled by CSS (100%); explicit attributes caused\r\n         self‑inflation on each draw and led to excessive horizontal scroll. */\r\n      \r\n      const containerRect = rightPane.getBoundingClientRect();\r\n      const svgNS = \"http://www.w3.org/2000/svg\";\r\n\r\n      /* one marker definition is enough */\r\n      const defs   = document.createElementNS(svgNS, \"defs\");\r\n      arrowLayer.appendChild(defs);\r\n      // Generate unique IDs per draw to avoid cross-SVG collisions\r\n      const uniq = `${Date.now().toString(36)}-${Math.random().toString(36).slice(2,7)}`;\r\n      const markerId = `pmArrowHead-${uniq}`;\r\n      const hoverMarkerId = `pmArrowHeadHover-${uniq}`;\r\n\r\n      // Expose URLs so other handlers (e.g., bar hover) can reference them\r\n      arrowLayer.setAttribute('data-marker-url', `url(#${markerId})`);\r\n      arrowLayer.setAttribute('data-hover-marker-url', `url(#${hoverMarkerId})`);\r\n\r\n      const marker = document.createElementNS(svgNS, \"marker\");\r\n      defs.appendChild(marker);\r\n      marker.setAttribute(\"id\", markerId);\r\n      marker.setAttribute(\"viewBox\", \"0 0 10 10\");\r\n      marker.setAttribute(\"refX\", \"10\");\r\n      marker.setAttribute(\"refY\", \"5\");\r\n      marker.setAttribute(\"markerWidth\", \"6\");\r\n      marker.setAttribute(\"markerHeight\", \"6\");\r\n      marker.setAttribute(\"orient\", \"auto\");\r\n      const head = document.createElementNS(svgNS, \"path\");\r\n      head.setAttribute(\"d\", \"M 0 0 10 5 0 10 Z\");\r\n      head.classList.add(\"pm-dep-arrow\");\r\n      marker.appendChild(head);\r\n\r\n      /* --- hover variant of arrow‑head --------------------------------------- */\r\n      const markerHover = document.createElementNS(svgNS, \"marker\");\r\n      defs.appendChild(markerHover);\r\n      markerHover.setAttribute(\"id\", hoverMarkerId);\r\n      markerHover.setAttribute(\"viewBox\", \"0 0 10 10\");\r\n      markerHover.setAttribute(\"refX\", \"10\");\r\n      markerHover.setAttribute(\"refY\", \"5\");\r\n      markerHover.setAttribute(\"markerWidth\", \"6\");\r\n      markerHover.setAttribute(\"markerHeight\", \"6\");\r\n      markerHover.setAttribute(\"orient\", \"auto\");\r\n\r\n      const headHover = document.createElementNS(svgNS, \"path\");\r\n      headHover.setAttribute(\"d\", \"M 0 0 10 5 0 10 Z\");\r\n      /* Create a completely separate arrowhead with no inherited styles */\r\n      headHover.setAttribute(\"fill\", \"#d00\");\r\n      headHover.setAttribute(\"stroke\", \"#d00\");\r\n      headHover.setAttribute(\"stroke-width\", \"1\");\r\n      /* Set fill on marker element as well */\r\n      markerHover.setAttribute(\"fill\", \"#d00\");\r\n      /* Also set the marker's fill attribute */\r\n      markerHover.setAttribute(\"fill-opacity\", \"1\");\r\n      markerHover.appendChild(headHover);\r\n\r\n      this.cache.tasks.forEach((task) => {\r\n        if (!task.depends?.length) return;\r\n        const dst = barsById[key(task)];\r\n        if (!dst) return;\r\n\r\n        task.depends.forEach((depStr) => {\r\n          /* Robust parser: FS default, or SS / FF / SF prefix */\r\n          let linkType: \"FS\" | \"SS\" | \"FF\" | \"SF\" = \"FS\";\r\n          let depId = depStr.trim();\r\n\r\n          const colon = depStr.indexOf(\":\");\r\n          if (colon !== -1) {\r\n            linkType = depStr.slice(0, colon).toUpperCase() as any; // FS / SS / FF / SF\r\n            depId    = depStr.slice(colon + 1).trim();\r\n          }\r\n\r\n          const srcId = key(depId, task.file.path);\r\n          const src     = barsById[srcId];\r\n          const srcTask = tasksById.get(srcId);\r\n          if (!src || !srcTask) return;\r\n          if (srcTask.file.path !== task.file.path) return;\r\n\r\n          const srcRect = src.el.getBoundingClientRect();\r\n          const dstRect = dst.el.getBoundingClientRect();\r\n\r\n          const y1 = srcRect.top + srcRect.height / 2 - containerRect.top + rightPane.scrollTop;\r\n          const rowTopSrc = srcRect.top - containerRect.top + rightPane.scrollTop;\r\n          const rowTopDst = dstRect.top - containerRect.top + rightPane.scrollTop;   // ← must exist\r\n          const y2 = dstRect.top + dstRect.height / 2 - containerRect.top + rightPane.scrollTop + 1;\r\n          \r\n          /* ---- pick anchors based on linkType ---- */\r\n          const srcLeft  = srcRect.left  - containerRect.left + rightPane.scrollLeft;\r\n          const srcRight = srcRect.right - containerRect.left + rightPane.scrollLeft;\r\n          const dstLeft  = dstRect.left  - containerRect.left + rightPane.scrollLeft;\r\n          const dstRight = dstRect.right - containerRect.left + rightPane.scrollLeft;\r\n\r\n          let x1: number, x2: number;\r\n          switch (linkType) {\r\n            case \"SS\": x1 = srcLeft;  x2 = dstLeft;  break;   // Start→Start\r\n            case \"FF\": x1 = srcRight; x2 = dstRight; break;   // Finish→Finish\r\n            case \"SF\": x1 = srcLeft;  x2 = dstRight; break;   // Start→Finish\r\n            default:   x1 = srcRight; x2 = dstLeft;  break;   // Finish→Start (FS)\r\n          }\r\n\r\n          /* --- smarter orthogonal path: find free vertical corridor that avoids bars --- */\r\n          const run     = 24;      // 24‑px horizontal exits/entries\r\n          const r       = 12;   // corner radius (px)\r\n          const dirY    = y2 > y1 ? 1 : -1;\r\n\r\n          /**\r\n           * Scan all bars to find the first x position between minX and maxX\r\n           * where a vertical line from yTop→yBot does NOT intersect any bar.\r\n           */\r\n          const findFreeX = (minX: number, maxX: number, yTop: number, yBot: number): number => {\r\n            const step = 4;           // 4‑px increments when searching\r\n            for (let x = maxX; x >= minX; x -= step) {\r\n              // test this x against all bars\r\n              let clear = true;\r\n              for (const b of Object.values(barsById)) {\r\n                const br = b.el.getBoundingClientRect();\r\n                const bx1 = br.left  - containerRect.left + rightPane.scrollLeft;\r\n                const bx2 = bx1 + br.width;\r\n                const by1 = br.top   - containerRect.top  + rightPane.scrollTop;\r\n                const by2 = by1 + br.height;\r\n                // vertical overlap?\r\n                if (by2 >= yTop && by1 <= yBot && x >= bx1 && x <= bx2) {\r\n                  clear = false;\r\n                  break;\r\n                }\r\n              }\r\n              if (clear) return x;\r\n            }\r\n            // fallback\r\n            return minX;\r\n          };\r\n\r\n          // Only skip strictly backward-pointing arrows\r\n          if (x2 + 2 < x1) return;\r\n          \r\n          let d: string;\r\n          const padH  = 10;                       // 10-px horizontal offset\r\n          const midY  = (y1 + y2) / 2;            // divider halfway between rows\r\n\r\n          if (x2 >= x1) {\r\n            /* ➡️ successor sits to the right */\r\n\r\n            /* Exit: SS & SF hop left, FS & FF hop right */\r\n            const leftHop  = (linkType === \"SS\" || linkType === \"SF\")\r\n              ? x1 - padH   //  ←  exit to left of bar\r\n              : x1 + padH;  //  →  exit to right of bar\r\n\r\n            /* Approach: FF & SF come in from the right,\r\n                          SS & FS approach from the left */\r\n            const rightHop = (linkType === \"FF\" || linkType === \"SF\")\r\n              ? x2 + padH   // run past the bar then back‑track\r\n              : x2 - padH;  // stop just before the bar\r\n\r\n            d = [\r\n              `M ${x1} ${y1}`,  // 1. start at chosen anchor on predecessor\r\n              `H ${leftHop}`,   // 2. initial horizontal hop (← or →)\r\n              `V ${midY}`,      // 3. down / up to divider\r\n              `H ${rightHop}`,  // 4. long horizontal run towards successor\r\n              `V ${y2}`,        // 5. down / up to successor mid‑line\r\n              `H ${x2}`         // 6. final hop into the bar (→ or ←)\r\n            ].join(\" \");\r\n          } else {\r\n            /* ⬅️ successor sits to the left */\r\n            d = [\r\n              `M ${x1} ${y1}`,\r\n              `H ${x1 + padH}`,\r\n              `V ${midY}`,\r\n              `H ${x2 + padH}`,              // run past successor\r\n              `V ${y2}`,\r\n              `H ${x2}`\r\n            ].join(\" \");\r\n          }\r\n\r\n          const path = document.createElementNS(svgNS, \"path\");\r\n          path.classList.add(\"pm-dep-arrow\");\r\n          path.setAttribute(\"d\", d);\r\n          path.setAttribute(\"marker-end\", `url(#${markerId})`);\r\n\r\n          (path as any).dataset.src = srcId;\r\n          (path as any).dataset.dst = key(task);\r\n          \r\n          /* ── hover‑highlight for arrows ─────────────────────────── */\r\n          path.style.pointerEvents = \"visibleStroke\";          // enable hover on stroke\r\n          path.addEventListener(\"mouseenter\", () => {\r\n            path.classList.add(\"pm-arrow-hover\");\r\n            path.setAttribute(\"marker-end\", `url(#${hoverMarkerId})`);\r\n            // Force red fill on hover marker\r\n            const hoverMarker = arrowLayer.querySelector(`#${hoverMarkerId}`);\r\n            if (hoverMarker) {\r\n              const hoverPath = hoverMarker.querySelector('path');\r\n              if (hoverPath) {\r\n                hoverPath.setAttribute(\"fill\", \"#d00\");\r\n                hoverPath.setAttribute(\"stroke\", \"#d00\");\r\n                // Also set on the marker element\r\n                (hoverMarker as SVGMarkerElement).setAttribute(\"fill\", \"#d00\");\r\n                (hoverMarker as SVGMarkerElement).setAttribute(\"fill-opacity\", \"1\");\r\n              }\r\n            }\r\n          });\r\n          path.addEventListener(\"mouseleave\", () => {\r\n            path.classList.remove(\"pm-arrow-hover\");\r\n            path.setAttribute(\"marker-end\", `url(#${markerId})`);\r\n          });\r\n\r\n          arrowLayer.appendChild(path);\r\n\r\n        });\r\n      });\r\n    };\r\n\r\n    if (arrowsEnabled) {\r\n      /* Wait two frames so bar geometry is guaranteed final before drawing arrows */\r\n      requestAnimationFrame(() => requestAnimationFrame(drawArrows));\r\n\r\n      /* Re‑draw arrows whenever the timeline pane scrolls vertically or horizontally */\r\n      outer.addEventListener(\"scroll\", () => {\r\n        requestAnimationFrame(drawArrows);\r\n      });\r\n    }\r\n\r\n    /* ---------- heat‑map strip + header fallback background ---------- */\r\n    if (heatmapEnabled) {\r\n      this.renderHeatmap(heat, pxPerDay, horizon);\r\n      // show the strip\r\n      if (this.heatLayerEl) {\r\n        (this.heatLayerEl as HTMLElement).style.display = \"block\";\r\n      }\r\n      // keep header transparent so the strip shows through\r\n      headerWrap.style.background = \"transparent\";\r\n    } else {\r\n      // hide and clear strip if it exists\r\n      if (this.heatLayerEl) {\r\n        const hl = this.heatLayerEl as HTMLElement;\r\n        hl.style.display = \"none\";\r\n        hl.innerHTML = \"\";\r\n      }\r\n      // apply solid fallback background to header rows\r\n      headerWrap.style.background =\r\n        \"var(--background-primary, var(--background-secondary, #fff))\";\r\n    }\r\n    /* DEBUG: expose bar coords so DevTools can inspect */\r\n    (window as any).pmBars = barsById;\r\n\r\n    if (this.cache.projects.size === 0) {\r\n      leftPane.createEl(\"p\", {\r\n        text: `No projects found (front‑matter \\`${this.plugin.settings.projectFlagProperty}: true\\`).`,\r\n      });\r\n    }\r\n\r\n    // --- fallback: normalise IDs to lower-case in table-row scan (if present) ---\r\n    // (See: search for explicitIdMatch in instructions)\r\n    // Not present in main render loop, but if you use it elsewhere:\r\n    // Example replacement for:\r\n    // const explicitIdMatch = line.match(/\\^([A-Za-z0-9_-]+)\\s*$/);\r\n    // const id = explicitIdMatch ? explicitIdMatch[1] : `${file.path}-row-${idx}`;\r\n    //\r\n    // let id: string;\r\n    // const caretMatch = line.match(/\\^([A-Za-z0-9_-]+)\\s*$/);\r\n    // if (caretMatch) {\r\n    //   id = caretMatch[1]; // use caret ID if present (^s-1)\r\n    // } else {\r\n    //   // else take first column cell, e.g., \"S-1\" or \"SB-3\"\r\n    //   const idCell = line.match(/^\\s*\\|\\s*([A-Za-z0-9_-]+)\\s*\\|/);\r\n    //   id = idCell ? idCell[1] : `${file.path}-row-${idx}`;\r\n    // }\r\n    // id = id.toLowerCase(); // normalise for dependable matching\r\n    } // End of else block for project-based rendering\r\n\r\n    /* Final scroll restore (after DOM fully built) */\r\n    requestAnimationFrame(() => {\r\n      const rightEl = this.containerEl.querySelector<HTMLElement>(\".pm-tl-right\");\r\n      const v = this.pendingScroll ? this.pendingScroll.v : restoreScroll.v;\r\n      const h = this.pendingScroll ? this.pendingScroll.h : restoreScroll.h;\r\n\r\n      if (rightEl) rightEl.scrollTop  = v;   // restore vertical scroll\r\n      if (rightEl) rightEl.scrollLeft = h;   // restore horizontal scroll\r\n\r\n      /* Defer clearing so any additional queued renders reuse the same offsets */\r\n      requestAnimationFrame(() => (this.pendingScroll = null));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Draw a 4‑px‑tall heat‑map strip under the header. Opacity scales with\r\n   * the number of overlapping bars recorded in `heat` for each day.\r\n   * @param heat       day‑offset (int) → count\r\n   * @param pxPerDay   horizontal pixels per day\r\n   * @param horizon    number of days to cover (inclusive)\r\n   */\r\n  private renderHeatmap(\r\n    heat: Record<number, number>,\r\n    pxPerDay: number,\r\n    horizon: number\r\n  ) {\r\n    // Create or reuse the heat layer element\r\n    if (!this.heatLayerEl) {\r\n      // Insert just under the header in the right pane\r\n      const rightPane = this.containerEl.querySelector(\".pm-tl-right\");\r\n      if (!rightPane) return;\r\n      this.heatLayerEl = rightPane.querySelector(\".pm-heat-layer\") as HTMLElement;\r\n      if (!this.heatLayerEl) {\r\n        // Anchor INSIDE the sticky header wrapper so it scrolls with it\r\n        const headerWrap = this.containerEl.querySelector(\".pm-tl-headwrap\") as HTMLElement | null;\r\n        if (!headerWrap) return;\r\n\r\n        this.heatLayerEl = headerWrap.querySelector(\".pm-heat-layer\") as HTMLElement | null;\r\n        if (!this.heatLayerEl) {\r\n          this.heatLayerEl = document.createElement(\"div\");\r\n          this.heatLayerEl.className = \"pm-heat-layer\";\r\n          headerWrap.appendChild(this.heatLayerEl);\r\n        }\r\n      }\r\n    }\r\n    // Clear old\r\n    this.heatLayerEl.innerHTML = \"\";\r\n\r\n    // Calculate the timeline anchor date (same logic as in render method)\r\n    const today =\r\n      this.plugin.settings.timelineStart && this.plugin.settings.timelineStart !== \"\"\r\n        ? (moment as any)(\r\n            this.plugin.settings.timelineStart,\r\n            \"YYYY-MM-DD\"\r\n          ).startOf(\"day\")\r\n        : (moment as any)().startOf(\"day\");\r\n\r\n    // Render a cell for every day from 0 to horizon (inclusive)\r\n    for (let offset = 0; offset <= horizon; offset++) {\r\n      const count = heat[offset] ?? 0;\r\n      const cell  = this.heatLayerEl.createEl(\"div\", { cls: \"pm-heat-cell\" });\r\n      cell.style.left  = `${offset * pxPerDay}px`;\r\n      cell.style.width = `${pxPerDay}px`;\r\n\r\n      /* --- continuous yellow→red scale using settings.heatMin / heatMax ----\r\n         ≤ heatMin : very pale yellow  (h 55°, L 90 %)\r\n         ≥ heatMax : pure red          (h  0°, L 40 %)                       */\r\n      const { heatMin = 5, heatMax = 25 } = this.plugin.settings;\r\n      const span     = Math.max(1, heatMax - heatMin);   // avoid divide‑by‑zero\r\n      const fracRaw  = (count - heatMin) / span;         // could be <0 or >1\r\n      const frac     = Math.max(0, Math.min(1, fracRaw)); // clamp 0‑1\r\n      const hue      = 55 - 55 * frac;                   // 55° → 0°\r\n      const light    = 90 - 50 * frac;                   // 90 % → 40 %\r\n      cell.style.background = `hsl(${hue}deg 95% ${light}%)`;\r\n      cell.style.opacity    = \"1\";\r\n\r\n      // Enhanced hover tooltip with proper positioning\r\n      let tip: HTMLElement | null = null;\r\n      \r\n      const showTip = () => {\r\n        if (tip) return;\r\n        \r\n        // Calculate the date for this offset using the timeline anchor date\r\n        const date = today.clone().add(offset, 'days');\r\n        const dateStr = date.format('dddd, MMMM Do YYYY');\r\n        \r\n        tip = document.createElement(\"div\");\r\n        tip.className = \"pm-dash-tooltip\";\r\n        tip.innerHTML = `<strong>${dateStr}</strong><br>${count} task${count === 1 ? \"\" : \"s\"}`;\r\n        document.body.appendChild(tip);\r\n\r\n        const r = cell.getBoundingClientRect();\r\n        const pad = 8;\r\n        const w = tip.offsetWidth;\r\n        let x = r.left + (r.width / 2) - (w / 2); // Center horizontally\r\n        if (x < pad) x = pad;\r\n        if (x + w > window.innerWidth - pad) {\r\n          x = Math.max(window.innerWidth - w - pad, pad);\r\n        }\r\n        \r\n        const h = tip.offsetHeight;\r\n        let y = r.top - h - pad; // Position above the cell\r\n        if (y < pad) {\r\n          y = r.bottom + pad; // Position below if not enough space above\r\n        }\r\n        \r\n        tip.style.left = `${x}px`;\r\n        tip.style.top = `${y}px`;\r\n      };\r\n\r\n      const hideTip = () => { tip?.remove(); tip = null; };\r\n\r\n      cell.addEventListener(\"mouseenter\", showTip);\r\n      cell.addEventListener(\"mouseleave\", hideTip);\r\n    }\r\n  }\r\n\r\n  /** Queue a scroll‑preserving re‑render. Multiple calls within\r\n   *  the same animation frame coalesce into a single render. */\r\n  public saveAndRender() {\r\n    if (!this.pendingScroll) {\r\n      const right = this.containerEl.querySelector<HTMLElement>(\".pm-tl-right\");\r\n      this.pendingScroll = {\r\n        v: right?.scrollTop  ?? 0,\r\n        h: right?.scrollLeft ?? 0,\r\n      };\r\n    }\r\n\r\n    if (this.renderQueued) return;   // already scheduled this frame\r\n    this.renderQueued = true;\r\n\r\n    requestAnimationFrame(() => {\r\n      this.renderQueued = false;\r\n      this.render();\r\n    });\r\n  }\r\n\r\n  /** Export timeline as image using html2canvas-like approach */\r\n  private async exportAsImage() {\r\n    try {\r\n      new Notice(\"Preparing timeline export...\");\r\n      \r\n      const outer = this.containerEl.querySelector('.pm-tl-outer') as HTMLElement;\r\n      if (!outer) {\r\n        new Notice(\"Timeline not found\");\r\n        return;\r\n      }\r\n\r\n      const leftPane = outer.querySelector('.pm-tl-left') as HTMLElement;\r\n      const rightPane = outer.querySelector('.pm-tl-right') as HTMLElement;\r\n      \r\n      if (!leftPane || !rightPane) {\r\n        new Notice(\"Timeline structure not found\");\r\n        return;\r\n      }\r\n\r\n      // Clone both panes\r\n      const leftClone = leftPane.cloneNode(true) as HTMLElement;\r\n      const rightClone = rightPane.cloneNode(true) as HTMLElement;\r\n      \r\n      // Create a wrapper for both clones\r\n      const wrapper = document.createElement('div');\r\n      wrapper.style.position = 'absolute';\r\n      wrapper.style.left = '-99999px';\r\n      wrapper.style.top = '0';\r\n      wrapper.style.display = 'flex';\r\n      wrapper.style.overflow = 'visible';\r\n      \r\n      // Style left clone\r\n      leftClone.style.width = leftPane.offsetWidth + 'px';\r\n      leftClone.style.height = 'auto';\r\n      leftClone.style.overflow = 'visible';\r\n      leftClone.style.flexShrink = '0';\r\n      \r\n      // Style right clone to show full content\r\n      rightClone.style.width = rightPane.scrollWidth + 'px';\r\n      rightClone.style.height = rightPane.scrollHeight + 'px';\r\n      rightClone.style.overflow = 'visible';\r\n      \r\n      // Expand sticky header in right clone\r\n      const headerWrap = rightClone.querySelector('.pm-tl-headwrap') as HTMLElement;\r\n      if (headerWrap) {\r\n        headerWrap.style.position = 'relative';\r\n        headerWrap.style.top = '0';\r\n        headerWrap.style.width = rightPane.scrollWidth + 'px';\r\n      }\r\n      \r\n      const bodyWrap = rightClone.querySelector('.pm-tl-bodywrap') as HTMLElement;\r\n      if (bodyWrap) {\r\n        bodyWrap.style.width = rightPane.scrollWidth + 'px';\r\n      }\r\n      \r\n      wrapper.appendChild(leftClone);\r\n      wrapper.appendChild(rightClone);\r\n      document.body.appendChild(wrapper);\r\n      \r\n      // Wait for layout\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n      \r\n      // Calculate total dimensions\r\n      const totalWidth = leftClone.offsetWidth + rightClone.scrollWidth;\r\n      const totalHeight = Math.max(leftClone.scrollHeight, rightClone.scrollHeight);\r\n      \r\n      // Create canvas\r\n      const scale = 2;\r\n      const canvas = document.createElement('canvas');\r\n      canvas.width = totalWidth * scale;\r\n      canvas.height = totalHeight * scale;\r\n      \r\n      const ctx = canvas.getContext('2d');\r\n      if (!ctx) {\r\n        document.body.removeChild(wrapper);\r\n        new Notice(\"Failed to create canvas\");\r\n        return;\r\n      }\r\n      \r\n      ctx.scale(scale, scale);\r\n      \r\n      // Fill background\r\n      const isDark = document.body.classList.contains('theme-dark');\r\n      ctx.fillStyle = isDark ? '#1e1e1e' : '#ffffff';\r\n      ctx.fillRect(0, 0, totalWidth, totalHeight);\r\n      \r\n      // Recursive function to draw elements\r\n      const drawNode = (node: HTMLElement, baseRect: DOMRect) => {\r\n        const styles = window.getComputedStyle(node);\r\n        if (styles.display === 'none' || styles.visibility === 'hidden') return;\r\n        \r\n        const rect = node.getBoundingClientRect();\r\n        const x = rect.left - baseRect.left;\r\n        const y = rect.top - baseRect.top;\r\n        \r\n        // Skip elements that are outside the visible area\r\n        if (rect.width === 0 || rect.height === 0) return;\r\n        \r\n        // Draw background\r\n        const bgColor = styles.backgroundColor;\r\n        if (bgColor && bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {\r\n          ctx.fillStyle = bgColor;\r\n          ctx.fillRect(x, y, rect.width, rect.height);\r\n        }\r\n        \r\n        // Draw border (all sides)\r\n        const borderTopWidth = parseFloat(styles.borderTopWidth) || 0;\r\n        const borderRightWidth = parseFloat(styles.borderRightWidth) || 0;\r\n        const borderBottomWidth = parseFloat(styles.borderBottomWidth) || 0;\r\n        const borderLeftWidth = parseFloat(styles.borderLeftWidth) || 0;\r\n        \r\n        if (borderTopWidth > 0 || borderRightWidth > 0 || borderBottomWidth > 0 || borderLeftWidth > 0) {\r\n          if (borderTopWidth > 0) {\r\n            ctx.strokeStyle = styles.borderTopColor || styles.borderColor || '#000';\r\n            ctx.lineWidth = borderTopWidth;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x, y);\r\n            ctx.lineTo(x + rect.width, y);\r\n            ctx.stroke();\r\n          }\r\n          if (borderRightWidth > 0) {\r\n            ctx.strokeStyle = styles.borderRightColor || styles.borderColor || '#000';\r\n            ctx.lineWidth = borderRightWidth;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x + rect.width, y);\r\n            ctx.lineTo(x + rect.width, y + rect.height);\r\n            ctx.stroke();\r\n          }\r\n          if (borderBottomWidth > 0) {\r\n            ctx.strokeStyle = styles.borderBottomColor || styles.borderColor || '#000';\r\n            ctx.lineWidth = borderBottomWidth;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x, y + rect.height);\r\n            ctx.lineTo(x + rect.width, y + rect.height);\r\n            ctx.stroke();\r\n          }\r\n          if (borderLeftWidth > 0) {\r\n            ctx.strokeStyle = styles.borderLeftColor || styles.borderColor || '#000';\r\n            ctx.lineWidth = borderLeftWidth;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x, y);\r\n            ctx.lineTo(x, y + rect.height);\r\n            ctx.stroke();\r\n          }\r\n        }\r\n        \r\n        // Draw status icons (check-circle, pause-circle, etc.)\r\n        if (node.classList.contains('pm-task-check') || node.classList.contains('pm-task-hold')) {\r\n          const centerX = x + rect.width / 2;\r\n          const centerY = y + rect.height / 2;\r\n          const radius = Math.min(rect.width, rect.height) / 3;\r\n          \r\n          ctx.save();\r\n          ctx.strokeStyle = styles.color;\r\n          ctx.fillStyle = styles.color;\r\n          ctx.lineWidth = 1.5;\r\n          \r\n          // Draw circle\r\n          ctx.beginPath();\r\n          ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\r\n          ctx.stroke();\r\n          \r\n          if (node.classList.contains('pm-task-check')) {\r\n            // Draw checkmark\r\n            ctx.beginPath();\r\n            ctx.moveTo(centerX - radius * 0.5, centerY);\r\n            ctx.lineTo(centerX - radius * 0.1, centerY + radius * 0.5);\r\n            ctx.lineTo(centerX + radius * 0.6, centerY - radius * 0.5);\r\n            ctx.stroke();\r\n          } else if (node.classList.contains('pm-task-hold')) {\r\n            // Draw pause bars\r\n            const barWidth = radius * 0.3;\r\n            const barHeight = radius * 1.2;\r\n            ctx.fillRect(centerX - radius * 0.4, centerY - barHeight / 2, barWidth, barHeight);\r\n            ctx.fillRect(centerX + radius * 0.1, centerY - barHeight / 2, barWidth, barHeight);\r\n          }\r\n          \r\n          ctx.restore();\r\n        }\r\n        \r\n        // First, recursively draw children\r\n        Array.from(node.children).forEach(child => {\r\n          if (child instanceof HTMLElement) {\r\n            drawNode(child, baseRect);\r\n          }\r\n        });\r\n        \r\n        // Then draw text on top (for elements with direct text nodes)\r\n        let textContent = '';\r\n        node.childNodes.forEach(child => {\r\n          if (child.nodeType === Node.TEXT_NODE) {\r\n            textContent += child.textContent || '';\r\n          }\r\n        });\r\n        \r\n        textContent = textContent.trim();\r\n        if (textContent) {\r\n          ctx.save();\r\n          ctx.fillStyle = styles.color;\r\n          const fontStyle = styles.fontStyle !== 'normal' ? styles.fontStyle + ' ' : '';\r\n          const fontWeight = styles.fontWeight !== 'normal' && styles.fontWeight !== '400' ? styles.fontWeight + ' ' : '';\r\n          ctx.font = `${fontStyle}${fontWeight}${styles.fontSize} ${styles.fontFamily}`;\r\n          ctx.textBaseline = 'top';\r\n          \r\n          const paddingLeft = parseFloat(styles.paddingLeft) || 0;\r\n          const paddingTop = parseFloat(styles.paddingTop) || 0;\r\n          \r\n          // Handle text alignment\r\n          const align = styles.textAlign;\r\n          if (align === 'center') {\r\n            ctx.textAlign = 'center';\r\n            ctx.fillText(textContent, x + rect.width / 2, y + paddingTop);\r\n          } else if (align === 'right') {\r\n            ctx.textAlign = 'right';\r\n            ctx.fillText(textContent, x + rect.width - paddingLeft, y + paddingTop);\r\n          } else {\r\n            ctx.textAlign = 'left';\r\n            ctx.fillText(textContent, x + paddingLeft, y + paddingTop, rect.width - paddingLeft * 2);\r\n          }\r\n          \r\n          ctx.restore();\r\n        }\r\n      };\r\n      \r\n      const wrapperRect = wrapper.getBoundingClientRect();\r\n      \r\n      // Draw left pane\r\n      drawNode(leftClone, wrapperRect);\r\n      \r\n      // Draw right pane\r\n      drawNode(rightClone, wrapperRect);\r\n      \r\n      // Remove wrapper\r\n      document.body.removeChild(wrapper);\r\n      \r\n      // Convert to blob and download\r\n      canvas.toBlob(async (blob) => {\r\n        if (!blob) {\r\n          new Notice(\"Failed to create image\");\r\n          return;\r\n        }\r\n\r\n        const timestamp = (moment as any)().format('YYYY-MM-DD-HHmmss');\r\n        const filename = `timeline-${timestamp}.png`;\r\n\r\n        try {\r\n          const downloadUrl = URL.createObjectURL(blob);\r\n          const link = document.createElement('a');\r\n          link.download = filename;\r\n          link.href = downloadUrl;\r\n          link.click();\r\n          URL.revokeObjectURL(downloadUrl);\r\n          \r\n          new Notice(`Timeline exported: ${filename}`);\r\n        } catch (error) {\r\n          console.error(\"Export error:\", error);\r\n          new Notice(\"Failed to export image\");\r\n        }\r\n      }, 'image/png', 0.95);\r\n\r\n    } catch (error) {\r\n      console.error(\"Export error:\", error);\r\n      new Notice(`Export failed: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n  }\r\n\r\n  /** Export timeline as standalone HTML page */\r\n  private async exportAsHtml() {\r\n    try {\r\n      new Notice(\"Preparing HTML export...\");\r\n      \r\n      const outer = this.containerEl.querySelector('.pm-tl-outer') as HTMLElement;\r\n      if (!outer) {\r\n        new Notice(\"Timeline not found\");\r\n        return;\r\n      }\r\n\r\n      // Clone the timeline\r\n      const clone = outer.cloneNode(true) as HTMLElement;\r\n      \r\n      // Collect all computed styles from the original\r\n      const collectStyles = (element: Element, clone: Element) => {\r\n        if (element instanceof HTMLElement && clone instanceof HTMLElement) {\r\n          const styles = window.getComputedStyle(element);\r\n          const cssText = Array.from(styles).map(prop => \r\n            `${prop}: ${styles.getPropertyValue(prop)};`\r\n          ).join('\\n');\r\n          clone.setAttribute('style', cssText);\r\n          \r\n          // Recursively process children\r\n          Array.from(element.children).forEach((child, i) => {\r\n            if (clone.children[i]) {\r\n              collectStyles(child, clone.children[i]);\r\n            }\r\n          });\r\n        }\r\n      };\r\n      \r\n      collectStyles(outer, clone);\r\n      \r\n      // Get all stylesheet rules\r\n      let cssRules = '';\r\n      Array.from(document.styleSheets).forEach(sheet => {\r\n        try {\r\n          if (sheet.cssRules) {\r\n            Array.from(sheet.cssRules).forEach(rule => {\r\n              cssRules += rule.cssText + '\\n';\r\n            });\r\n          }\r\n        } catch (e) {\r\n          // Skip cross-origin stylesheets\r\n        }\r\n      });\r\n      \r\n      // Build complete HTML document with interactive features\r\n      const html = `<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Timeline Export - ${(moment as any)().format('YYYY-MM-DD HH:mm')}</title>\r\n  <style>\r\n    * { margin: 0; padding: 0; box-sizing: border-box; }\r\n    body { \r\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\r\n      background: #f5f5f5;\r\n      padding: 20px;\r\n    }\r\n    .container {\r\n      max-width: 100%;\r\n      background: white;\r\n      box-shadow: 0 2px 10px rgba(0,0,0,0.1);\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n    }\r\n    .header {\r\n      background: #2c3e50;\r\n      color: white;\r\n      padding: 15px 20px;\r\n      font-size: 18px;\r\n      font-weight: 600;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n    }\r\n    .controls {\r\n      display: flex;\r\n      gap: 10px;\r\n      align-items: center;\r\n    }\r\n    .controls button {\r\n      background: #34495e;\r\n      color: white;\r\n      border: none;\r\n      padding: 6px 12px;\r\n      border-radius: 4px;\r\n      cursor: pointer;\r\n      font-size: 12px;\r\n    }\r\n    .controls button:hover {\r\n      background: #415a77;\r\n    }\r\n    .timeline-wrapper {\r\n      overflow: auto;\r\n      padding: 10px;\r\n      max-height: calc(100vh - 100px);\r\n    }\r\n    .tooltip {\r\n      position: fixed;\r\n      background: rgba(0, 0, 0, 0.9);\r\n      color: white;\r\n      padding: 8px 12px;\r\n      border-radius: 4px;\r\n      font-size: 12px;\r\n      pointer-events: none;\r\n      z-index: 10000;\r\n      display: none;\r\n      max-width: 300px;\r\n      line-height: 1.4;\r\n    }\r\n    ${cssRules}\r\n    \r\n    /* Override for standalone display */\r\n    .pm-tl-outer {\r\n      width: 100% !important;\r\n      height: auto !important;\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <span>Project Timeline - Exported ${(moment as any)().format('YYYY-MM-DD HH:mm:ss')}</span>\r\n      <div class=\"controls\">\r\n        <button onclick=\"zoomIn()\">Zoom In</button>\r\n        <button onclick=\"zoomOut()\">Zoom Out</button>\r\n        <button onclick=\"resetZoom()\">Reset</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"timeline-wrapper\" id=\"timelineWrapper\">\r\n      ${clone.outerHTML}\r\n    </div>\r\n  </div>\r\n  <div class=\"tooltip\" id=\"tooltip\"></div>\r\n  \r\n  <script>\r\n    // Zoom functionality\r\n    let currentZoom = 1;\r\n    const wrapper = document.getElementById('timelineWrapper');\r\n    const outer = wrapper.querySelector('.pm-tl-outer');\r\n    \r\n    function zoomIn() {\r\n      currentZoom = Math.min(currentZoom + 0.1, 2);\r\n      applyZoom();\r\n    }\r\n    \r\n    function zoomOut() {\r\n      currentZoom = Math.max(currentZoom - 0.1, 0.5);\r\n      applyZoom();\r\n    }\r\n    \r\n    function resetZoom() {\r\n      currentZoom = 1;\r\n      applyZoom();\r\n    }\r\n    \r\n    function applyZoom() {\r\n      if (outer) {\r\n        outer.style.transform = 'scale(' + currentZoom + ')';\r\n        outer.style.transformOrigin = 'top left';\r\n      }\r\n    }\r\n    \r\n    // Tooltip functionality\r\n    const tooltip = document.getElementById('tooltip');\r\n    \r\n    // Keep left and right panes in sync\r\n    const leftPane = document.querySelector('.pm-tl-left');\r\n    const rightPane = document.querySelector('.pm-tl-right');\r\n    \r\n    if (leftPane && rightPane) {\r\n      rightPane.addEventListener('scroll', function() {\r\n        leftPane.scrollTop = rightPane.scrollTop;\r\n      });\r\n      \r\n      leftPane.addEventListener('wheel', function(ev) {\r\n        rightPane.scrollTop += ev.deltaY;\r\n        ev.preventDefault();\r\n      }, { passive: false });\r\n    }\r\n    \r\n    // Add tooltip to task bars\r\n    document.querySelectorAll('.pm-tl-bar').forEach(bar => {\r\n      bar.addEventListener('mouseenter', function(e) {\r\n        const taskText = this.getAttribute('data-task') || 'Task';\r\n        const startDate = this.getAttribute('data-start') || '';\r\n        const dueDate = this.getAttribute('data-due') || '';\r\n        \r\n        let content = '<strong>' + taskText + '</strong>';\r\n        if (startDate) content += '<br>Start: ' + startDate;\r\n        if (dueDate) content += '<br>Due: ' + dueDate;\r\n        \r\n        tooltip.innerHTML = content;\r\n        tooltip.style.display = 'block';\r\n        updateTooltipPosition(e);\r\n      });\r\n      \r\n      bar.addEventListener('mousemove', updateTooltipPosition);\r\n      \r\n      bar.addEventListener('mouseleave', function() {\r\n        tooltip.style.display = 'none';\r\n      });\r\n    });\r\n    \r\n    function updateTooltipPosition(e) {\r\n      const padding = 10;\r\n      let x = e.clientX + padding;\r\n      let y = e.clientY + padding;\r\n      \r\n      const tooltipRect = tooltip.getBoundingClientRect();\r\n      \r\n      if (x + tooltipRect.width > window.innerWidth - padding) {\r\n        x = e.clientX - tooltipRect.width - padding;\r\n      }\r\n      \r\n      if (y + tooltipRect.height > window.innerHeight - padding) {\r\n        y = e.clientY - tooltipRect.height - padding;\r\n      }\r\n      \r\n      tooltip.style.left = x + 'px';\r\n      tooltip.style.top = y + 'px';\r\n    }\r\n    \r\n    // Collapsible project rows\r\n    document.querySelectorAll('.pm-caret').forEach(caret => {\r\n      caret.addEventListener('click', function() {\r\n        const row = this.closest('.pm-tl-row');\r\n        if (row) {\r\n          row.classList.toggle('pm-collapsed');\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Initialize\r\n    console.log('Timeline loaded with interactive features');\r\n  </script>\r\n</body>\r\n</html>`;\r\n\r\n      // Create blob and download\r\n      const blob = new Blob([html], { type: 'text/html;charset=utf-8' });\r\n      const timestamp = (moment as any)().format('YYYY-MM-DD-HHmmss');\r\n      const filename = `timeline-${timestamp}.html`;\r\n      \r\n      const downloadUrl = URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.download = filename;\r\n      link.href = downloadUrl;\r\n      link.click();\r\n      URL.revokeObjectURL(downloadUrl);\r\n      \r\n      new Notice(`Timeline exported: ${filename}`);\r\n      \r\n    } catch (error) {\r\n      console.error(\"HTML export error:\", error);\r\n      new Notice(`Export failed: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n  }\r\n}\r\n","import { App, TFile, TFolder, Modal, Notice, normalizePath } from \"obsidian\";\r\n\r\n/**\r\n * Prompt the user for basic metadata and create a new project note\r\n * in the “Projects/” folder using the standard layout.\r\n */\r\nexport async function newProject(app: App, targetFolder?: TFolder) {\r\n  // Prevent accidental double‑invocation (e.g. button fires twice)\r\n  if ((app as any)._pmCreatingProject) return;\r\n  (app as any)._pmCreatingProject = true;\r\n  try {\r\n    // ── helper: quick modal to collect a single string value ────────────\r\n    const ask = (title: string, placeholder = \"\"): Promise<string | null> =>\r\n      new Promise((res) => {\r\n        new class extends Modal {\r\n          onOpen() {\r\n            this.contentEl.createEl(\"h3\", { text: title });\r\n            const input = this.contentEl.createEl(\"input\", {\r\n              type: \"text\",\r\n              placeholder,\r\n            });\r\n            input.focus();\r\n            const ok = this.contentEl.createEl(\"button\", { text: \"OK\" });\r\n            ok.onclick = () => { this.close(); res(input.value.trim() || null); };\r\n            this.contentEl.createEl(\"button\", { text: \"Cancel\" }).onclick = () => {\r\n              this.close(); res(null);\r\n            };\r\n          }\r\n        }(app).open();\r\n      });\r\n    // ── Ask for a project title ─────────────────────────────────────────\r\n    const title = await ask(\"Project title\", \"Gap Analysis\");\r\n    if (!title) return;\r\n\r\n    // ── Ask for a project number (optional) ─────────────────────────────\r\n    const projNum = await ask(\"Project Number (optional)\", \"1.1.2\");\r\n\r\n    // ── Date helpers ────────────────────────────────────────────────────\r\n    const momentFn = (window as any).moment;\r\n    const startDate = momentFn().format(\"YYYY-MM-DD\");\r\n    const endDate   = momentFn().add(2, \"months\").endOf(\"month\").format(\"YYYY-MM-DD\");\r\n\r\n    // Front‑matter key that marks a Project note\r\n    const pmPlugin = (app as any).plugins?.getPlugin?.(\"project-management\");\r\n    const flagKey: string = pmPlugin?.settings?.projectFlagProperty?.trim?.() || \"project\";\r\n\r\n    const baseDir = targetFolder ? targetFolder.path : \"Projects\";\r\n\r\n    /* If the user typed a project number, prepend it to the file name */\r\n    const safeNum = projNum ? projNum.replace(/[^\\w.-]/g, \"-\") : \"\";\r\n    const safeNumDot =\r\n      safeNum && !safeNum.endsWith(\".\") ? `${safeNum}.` : safeNum;\r\n    const fileName = safeNum\r\n      ? `${safeNumDot} ${title}.md`\r\n      : `${title}.md`;\r\n    const filePath = `${baseDir}/${fileName}`;\r\n\r\n    let template = `---\r\nStart Date: ${startDate}\r\nEnd Date: ${endDate}\r\nProject Number: \"${projNum ?? \"\"}\"\r\nDescription: \"This is a description of the project.\"\r\nPriority (1-5): \"1\"\r\nArea: Work\r\ncssclasses:\r\n  - wide-page\r\n${flagKey}: true\r\n---\r\n\r\n## 🗂️ Epics\r\n\r\n| ID  | Title           | Assignee | Start              | Due              | Description |\r\n| --- | --------------- | -------- | ------------------ | ---------------- | ----------- |\r\n| E-1 | - [ ] Main Task | assignee:: Me | start:: ${startDate} | due:: ${endDate} | Main Epic   |\r\n\r\n### 📄 Stories\r\n\r\n| ID  | Epic | Title       | Depends          | Assignee      | Priority | Start              | Due              | Description |\r\n| --- | ---- | ----------- | ---------------- | ------------- | -------- | ------------------ | ---------------- | ----------- |\r\n| S-1 | E-1  | - [ ] To Do | depends:: SS:E-1 | assignee:: Me | 1        | start:: ${startDate} | due:: 2025-07-25 | A Story     |\r\n\r\n#### 🔧 Sub-tasks\r\n\r\n| ID   | Story | Title            | Depends          | Assignee      | Start              | Due              | Description            |\r\n| ---- | ----- | ---------------- | ---------------- | ------------- | ------------------ | ---------------- | ---------------------- |\r\n| SB-1 | S-1   | - [ ] Sub Task 1 | depends:: SF:S-1 | assignee:: Me | start:: ${startDate} | due:: ${endDate} | How to do the sub task |\r\n| SB-2 | S-1   | - [ ] Sub Task 2 | depends:: SS:S-1 | assignee:: Me | start:: ${startDate} | due:: ${endDate} | How to do the sub task |\r\n| SB-3 | S-1   | - [ ] Sub Task 3 | depends:: FF:S-1 | assignee:: Me | start:: ${startDate} | due:: ${endDate} | How to do the sub task |\r\n| SB-4 | S-1   | - [ ] Sub Task 4 | depends:: FS:S-1 | assignee:: Me | start:: ${startDate} | due:: ${endDate} | How to do the sub task |\r\n\r\n## 🎯 Milestones\r\n| ID  | Title       | Date       | Description        |\r\n| --- | ----------- | ---------- | ------------------ |\r\n| M-1 | Milestone 1 | ${endDate} | Milestone Number 1 |\r\n\r\n## ⚠️ Risks\r\n*None logged.*\r\n\r\n## 📋 Action-Item Backlog\r\n*No action items yet.*\r\n`;\r\n\r\n    /* ── Override with user‑defined template if the setting is non‑blank ── */\r\n    const tplPath: string =\r\n      pmPlugin?.settings?.projectTemplate?.trim?.() ?? \"\";\r\n\r\n    if (tplPath) {\r\n      const tplFile = app.vault.getFileByPath(tplPath);\r\n      if (tplFile instanceof TFile) {\r\n        template = await app.vault.cachedRead(tplFile);\r\n\r\n        /* ── If the template's front‑matter contains the project flag set to false\r\n           flip it to true so the new note is recognised. */\r\n        const flagRE = new RegExp(`(^|\\\\n)([ \\\\t]*${flagKey}[ \\\\t]*:[ \\\\t]*)([\\\"']?false[\\\"']?)([ \\\\t]*\\\\r?\\\\n)`, \"i\");\r\n        template = template.replace(flagRE, (_m, p1, p2, _pFalse, p4) => `${p1}${p2}true${p4}`);\r\n      } else {\r\n        new Notice(`Template “${tplPath}” not found – using default.`);\r\n      }\r\n    }\r\n\r\n    // ── Create or update the note ───────────────────────────────────────\r\n    let file: TFile | null = null;\r\n    const dirPath  = targetFolder ? targetFolder.path : \"Projects\";\r\n    const fullPath = normalizePath(`${dirPath}/${fileName}`);\r\n\r\n    const existing = app.vault.getFileByPath(fullPath);\r\n    if (!existing) {\r\n      file = await app.vault.create(fullPath, template);\r\n    } else if (existing instanceof TFile) {\r\n      file = existing;\r\n      await app.vault.modify(existing, template);\r\n    }\r\n\r\n    // If file wasn't assigned (shouldn't happen), find it now\r\n    if (!file) {\r\n      const foundFile = app.vault.getFileByPath(fullPath);\r\n      file = foundFile instanceof TFile ? foundFile : null;\r\n    }\r\n    if (!file) {\r\n      throw new Error(\"Failed to create project file\");\r\n    }\r\n    // ── Open the new note in a fresh pane ───────────────────────────────\r\n    await app.workspace.getLeaf(true).openFile(file);\r\n  } finally {\r\n    delete (app as any)._pmCreatingProject;   // release the lock\r\n  }\r\n}","import { App, TFile, TFolder, Notice, Modal, Setting, DropdownComponent } from \"obsidian\";\r\nimport { ProjectCache } from \"./services/cache\";\r\n\r\ninterface ActionItemData {\r\n  project: string;\r\n  type: \"epic\" | \"story\" | \"subtask\";\r\n  title: string;\r\n  startDate: string;\r\n  dueDate: string;\r\n  description: string;\r\n  assignee: string;\r\n  priority: string;\r\n  parentEpic?: string;\r\n  parentStory?: string;\r\n  dependency?: string;\r\n  dependencyType?: \"FF\" | \"FS\" | \"SF\" | \"SS\" | \"\";\r\n}\r\n\r\nexport async function newActionItem(app: App, cache: ProjectCache) {\r\n  const modal = new ActionItemModal(app, cache);\r\n  modal.open();\r\n}\r\n\r\nclass ActionItemModal extends Modal {\r\n  private data: ActionItemData = {\r\n    project: \"\",\r\n    type: \"epic\",\r\n    title: \"\",\r\n    startDate: \"\",\r\n    dueDate: \"\",\r\n    description: \"\",\r\n    assignee: \"\",\r\n    priority: \"\",\r\n    parentEpic: \"\",\r\n    parentStory: \"\",\r\n    dependency: \"\",\r\n    dependencyType: \"FF\"\r\n  };\r\n  \r\n  private projects: Array<{ path: string; name: string }> = [];\r\n  private assignees: string[] = [];\r\n  private projectTasks: Map<string, Array<{ id: string; text: string }>> = new Map();\r\n  private cache: ProjectCache;\r\n  private dependencySetting?: Setting;\r\n  private dependencyDropdown?: DropdownComponent;\r\n  private parentEpicSetting?: Setting;\r\n  private parentEpicDropdown?: DropdownComponent;\r\n  private parentStorySetting?: Setting;\r\n  private parentStoryDropdown?: DropdownComponent;\r\n\r\n  constructor(app: App, cache: ProjectCache) {\r\n    super(app);\r\n    this.cache = cache;\r\n    this.loadProjects();\r\n    this.loadAssignees();\r\n    this.loadProjectTasks();\r\n  }\r\n\r\n  private loadProjects() {\r\n    // Get all project files from the cache synchronously and sort alphabetically\r\n    this.projects = Array.from(this.cache.projects.values())\r\n      .map(project => ({\r\n        path: project.file.path,\r\n        name: project.file.basename\r\n      }))\r\n      .sort((a, b) => a.name.localeCompare(b.name));\r\n  }\r\n\r\n  private loadAssignees() {\r\n    // Get all unique assignees from existing tasks and sort alphabetically\r\n    const assigneeSet = new Set<string>();\r\n    \r\n    this.cache.projects.forEach(project => {\r\n      project.tasks.forEach(task => {\r\n        const assignee = task.props[\"assignee\"];\r\n        if (assignee && assignee.trim()) {\r\n          assigneeSet.add(assignee.trim());\r\n        }\r\n      });\r\n    });\r\n    \r\n    this.assignees = Array.from(assigneeSet).sort((a, b) => a.localeCompare(b));\r\n  }\r\n\r\n  private loadProjectTasks() {\r\n    // Load tasks for each project and sort alphabetically\r\n    this.cache.projects.forEach(project => {\r\n      const tasks = project.tasks\r\n        .map(task => ({\r\n          id: task.id,\r\n          text: task.text\r\n        }))\r\n        .sort((a, b) => a.id.localeCompare(b.id));\r\n      \r\n      this.projectTasks.set(project.file.path, tasks);\r\n    });\r\n  }\r\n\r\n  private updateDependencyDropdown() {\r\n    if (!this.dependencyDropdown) return;\r\n\r\n    // Clear existing options\r\n    this.dependencyDropdown.selectEl.empty();\r\n    this.dependencyDropdown.addOption(\"\", \"Select a dependency...\");\r\n\r\n    // Add tasks from selected project\r\n    if (this.data.project) {\r\n      const tasks = this.projectTasks.get(this.data.project);\r\n      if (tasks) {\r\n        tasks.forEach(task => {\r\n          const displayText = `${task.id} - ${task.text.split('\\n')[0].trim()}`;\r\n          this.dependencyDropdown!.addOption(task.id, displayText);\r\n        });\r\n      }\r\n    }\r\n\r\n    // Reset the value\r\n    this.dependencyDropdown.setValue(this.data.dependency || \"\");\r\n  }\r\n\r\n  private getEpicsForProject(projectPath: string): Array<{ id: string; displayText: string }> {\r\n    const project = this.cache.projects.get(projectPath);\r\n    if (!project) return [];\r\n\r\n    return project.tasks\r\n      .filter(task => task.id.toLowerCase().startsWith('e'))\r\n      .map(task => ({\r\n        id: task.id,\r\n        displayText: `${task.id} - ${task.text.split('\\n')[0].trim()}`\r\n      }))\r\n      .sort((a, b) => a.id.localeCompare(b.id));\r\n  }\r\n\r\n  private getStoriesForEpic(projectPath: string, epicId: string): Array<{ id: string; displayText: string }> {\r\n    const project = this.cache.projects.get(projectPath);\r\n    if (!project) return [];\r\n\r\n    return project.tasks\r\n      .filter(task => {\r\n        const taskId = task.id.toLowerCase();\r\n        return taskId.startsWith('s') && !taskId.startsWith('sb');\r\n      })\r\n      .map(task => ({\r\n        id: task.id,\r\n        displayText: `${task.id} - ${task.text.split('\\n')[0].trim()}`\r\n      }))\r\n      .sort((a, b) => a.id.localeCompare(b.id));\r\n  }\r\n\r\n  private updateParentEpicDropdown() {\r\n    if (!this.parentEpicDropdown) return;\r\n\r\n    // Clear existing options\r\n    this.parentEpicDropdown.selectEl.empty();\r\n    this.parentEpicDropdown.addOption(\"\", \"Select an epic...\");\r\n\r\n    // Add epics from selected project\r\n    if (this.data.project) {\r\n      const epics = this.getEpicsForProject(this.data.project);\r\n      epics.forEach(epic => {\r\n        this.parentEpicDropdown!.addOption(epic.id, epic.displayText);\r\n      });\r\n    }\r\n\r\n    // Reset the value\r\n    this.parentEpicDropdown.setValue(this.data.parentEpic || \"\");\r\n  }\r\n\r\n  private updateParentStoryDropdown() {\r\n    if (!this.parentStoryDropdown || !this.data.parentEpic) return;\r\n\r\n    // Clear existing options\r\n    this.parentStoryDropdown.selectEl.empty();\r\n    this.parentStoryDropdown.addOption(\"\", \"Select a story...\");\r\n\r\n    // Add stories from the selected project\r\n    if (this.data.project) {\r\n      const stories = this.getStoriesForEpic(this.data.project, this.data.parentEpic);\r\n      stories.forEach(story => {\r\n        this.parentStoryDropdown!.addOption(story.id, story.displayText);\r\n      });\r\n    }\r\n\r\n    // Reset the value\r\n    this.parentStoryDropdown.setValue(this.data.parentStory || \"\");\r\n  }\r\n\r\n  private updateParentControlsVisibility() {\r\n    // Show/hide parent epic based on type\r\n    if (this.parentEpicSetting) {\r\n      if (this.data.type === \"story\" || this.data.type === \"subtask\") {\r\n        this.parentEpicSetting.settingEl.style.display = \"\";\r\n      } else {\r\n        this.parentEpicSetting.settingEl.style.display = \"none\";\r\n      }\r\n    }\r\n\r\n    // Show/hide parent story based on type\r\n    if (this.parentStorySetting) {\r\n      if (this.data.type === \"subtask\") {\r\n        this.parentStorySetting.settingEl.style.display = \"\";\r\n      } else {\r\n        this.parentStorySetting.settingEl.style.display = \"none\";\r\n      }\r\n    }\r\n  }\r\n\r\n  onOpen() {\r\n    const { contentEl } = this;\r\n    contentEl.createEl(\"h2\", { text: \"Create New Action Item\" });\r\n\r\n    // Step 1: Project Selection\r\n    new Setting(contentEl)\r\n      .setName(\"Project\")\r\n      .setDesc(\"Select the project for this action item\")\r\n      .addDropdown((dropdown: DropdownComponent) => {\r\n        dropdown.addOption(\"\", \"Select a project...\");\r\n        this.projects.forEach(project => {\r\n          dropdown.addOption(project.path, project.name);\r\n        });\r\n        dropdown.setValue(this.data.project);\r\n        dropdown.onChange((value) => {\r\n          this.data.project = value;\r\n          // Update dependency dropdown when project changes\r\n          this.updateDependencyDropdown();\r\n          // Update parent dropdowns when project changes\r\n          this.updateParentEpicDropdown();\r\n          if (this.data.type === \"subtask\") {\r\n            this.updateParentStoryDropdown();\r\n          }\r\n        });\r\n      });\r\n\r\n    // Step 2: Type Selection\r\n    new Setting(contentEl)\r\n      .setName(\"Type\")\r\n      .setDesc(\"Select the type of action item\")\r\n      .addDropdown((dropdown: DropdownComponent) => {\r\n        dropdown.addOption(\"epic\", \"Epic\");\r\n        dropdown.addOption(\"story\", \"Story\");\r\n        dropdown.addOption(\"subtask\", \"Subtask\");\r\n        dropdown.setValue(this.data.type);\r\n        dropdown.onChange((value) => {\r\n          this.data.type = value as \"epic\" | \"story\" | \"subtask\";\r\n          // Update parent controls visibility\r\n          this.updateParentControlsVisibility();\r\n        });\r\n      });\r\n\r\n    // Step 3: Title\r\n    new Setting(contentEl)\r\n      .setName(\"Title\")\r\n      .setDesc(\"Enter a short, descriptive title for this action item\")\r\n      .addText((text) => {\r\n        text.setPlaceholder(\"e.g., Design new user interface\");\r\n        text.setValue(this.data.title);\r\n        text.onChange((value) => {\r\n          this.data.title = value;\r\n        });\r\n      });\r\n\r\n    // Step 4: Parent Epic (for Stories and Subtasks)\r\n    this.parentEpicSetting = new Setting(contentEl)\r\n      .setName(\"Parent Epic\")\r\n      .setDesc(\"Select which epic this story/subtask belongs to\")\r\n      .addDropdown((dropdown: DropdownComponent) => {\r\n        this.parentEpicDropdown = dropdown;\r\n        dropdown.addOption(\"\", \"Select an epic...\");\r\n        if (this.data.project) {\r\n          const epics = this.getEpicsForProject(this.data.project);\r\n          epics.forEach(epic => {\r\n            dropdown.addOption(epic.id, epic.displayText);\r\n          });\r\n        }\r\n        dropdown.setValue(this.data.parentEpic || \"\");\r\n        dropdown.onChange((value) => {\r\n          this.data.parentEpic = value;\r\n          // Update parent story dropdown if this is a subtask\r\n          if (this.data.type === \"subtask\") {\r\n            this.updateParentStoryDropdown();\r\n          }\r\n        });\r\n      });\r\n\r\n    // Step 5: Parent Story (for Subtasks only)\r\n    this.parentStorySetting = new Setting(contentEl)\r\n      .setName(\"Parent Story\")\r\n      .setDesc(\"Select which story this subtask belongs to\")\r\n      .addDropdown((dropdown: DropdownComponent) => {\r\n        this.parentStoryDropdown = dropdown;\r\n        dropdown.addOption(\"\", \"Select a story...\");\r\n        dropdown.setValue(this.data.parentStory || \"\");\r\n        dropdown.onChange((value) => {\r\n          this.data.parentStory = value;\r\n        });\r\n      });\r\n    \r\n    // Set initial visibility\r\n    this.updateParentControlsVisibility();\r\n\r\n    // Step 6: Start Date\r\n    new Setting(contentEl)\r\n      .setName(\"Start Date\")\r\n      .setDesc(\"Optional: When should this action item start?\")\r\n      .addText((text) => {\r\n        text.setPlaceholder(\"YYYY-MM-DD (optional)\");\r\n        text.setValue(this.data.startDate);\r\n        text.onChange((value) => {\r\n          this.data.startDate = value;\r\n        });\r\n      });\r\n\r\n    // Step 7: Due Date\r\n    new Setting(contentEl)\r\n      .setName(\"Due Date\")\r\n      .setDesc(\"Optional: When should this action item be completed?\")\r\n      .addText((text) => {\r\n        text.setPlaceholder(\"YYYY-MM-DD (optional)\");\r\n        text.setValue(this.data.dueDate);\r\n        text.onChange((value) => {\r\n          this.data.dueDate = value;\r\n        });\r\n      });\r\n\r\n    // Step 8: Description\r\n    new Setting(contentEl)\r\n      .setName(\"Description\")\r\n      .setDesc(\"Describe what this action item is about\")\r\n      .addTextArea((text) => {\r\n        text.setPlaceholder(\"Enter a description...\");\r\n        text.setValue(this.data.description);\r\n        text.onChange((value) => {\r\n          this.data.description = value;\r\n        });\r\n        text.inputEl.rows = 3;\r\n      });\r\n\r\n    // Step 9: Assignee\r\n    new Setting(contentEl)\r\n      .setName(\"Assignee\")\r\n      .setDesc(\"Who is responsible for this action item? (Type a new name or select from existing)\")\r\n      .addText((text) => {\r\n        text.setPlaceholder(\"Enter or select assignee...\");\r\n        text.setValue(this.data.assignee);\r\n        text.onChange((value) => {\r\n          this.data.assignee = value;\r\n        });\r\n        \r\n        // Add datalist for autocomplete\r\n        const datalistId = \"assignee-datalist\";\r\n        const datalist = text.inputEl.parentElement?.createEl(\"datalist\");\r\n        if (datalist) {\r\n          datalist.id = datalistId;\r\n          this.assignees.forEach(assignee => {\r\n            datalist.createEl(\"option\", { value: assignee });\r\n          });\r\n          text.inputEl.setAttribute(\"list\", datalistId);\r\n        }\r\n      });\r\n\r\n    // Step 10: Priority\r\n    new Setting(contentEl)\r\n      .setName(\"Priority\")\r\n      .setDesc(\"Set the priority level for this action item\")\r\n      .addDropdown((dropdown: DropdownComponent) => {\r\n        dropdown.addOption(\"\", \"No priority\");\r\n        dropdown.addOption(\"critical\", \"Critical\");\r\n        dropdown.addOption(\"high\", \"High\");\r\n        dropdown.addOption(\"medium\", \"Medium\");\r\n        dropdown.addOption(\"low\", \"Low\");\r\n        dropdown.setValue(this.data.priority);\r\n        dropdown.onChange((value) => {\r\n          this.data.priority = value;\r\n        });\r\n      });\r\n\r\n    // Step 11: Dependency Type (Optional)\r\n    new Setting(contentEl)\r\n      .setName(\"Dependency Type\")\r\n      .setDesc(\"Optional: Type of dependency relationship\")\r\n      .addDropdown((dropdown: DropdownComponent) => {\r\n        dropdown.addOption(\"\", \"No dependency\");\r\n        dropdown.addOption(\"FF\", \"FF - Finish to Finish\");\r\n        dropdown.addOption(\"FS\", \"FS - Finish to Start\");\r\n        dropdown.addOption(\"SF\", \"SF - Start to Finish\");\r\n        dropdown.addOption(\"SS\", \"SS - Start to Start\");\r\n        dropdown.setValue(this.data.dependencyType || \"\");\r\n        dropdown.onChange((value) => {\r\n          this.data.dependencyType = value as \"FF\" | \"FS\" | \"SF\" | \"SS\" | \"\";\r\n        });\r\n      });\r\n\r\n    // Step 12: Dependency (Optional)\r\n    this.dependencySetting = new Setting(contentEl)\r\n      .setName(\"Dependency\")\r\n      .setDesc(\"Optional: What does this action item depend on?\")\r\n      .addDropdown((dropdown: DropdownComponent) => {\r\n        this.dependencyDropdown = dropdown;\r\n        dropdown.addOption(\"\", \"Select a dependency...\");\r\n        dropdown.setValue(this.data.dependency || \"\");\r\n        dropdown.onChange((value) => {\r\n          this.data.dependency = value;\r\n        });\r\n      });\r\n\r\n    // Buttons\r\n    const buttonContainer = contentEl.createEl(\"div\", { cls: \"modal-button-container\" });\r\n    \r\n    buttonContainer.createEl(\"button\", { text: \"Cancel\" }).addEventListener(\"click\", () => {\r\n      this.close();\r\n    });\r\n    \r\n    buttonContainer.createEl(\"button\", { text: \"Create Action Item\", cls: \"mod-cta\" }).addEventListener(\"click\", () => {\r\n      this.createActionItem();\r\n    });\r\n  }\r\n\r\n  private async createActionItem() {\r\n    // Validate required fields\r\n    if (!this.data.project) {\r\n      new Notice(\"Please select a project\");\r\n      return;\r\n    }\r\n    if (!this.data.title.trim()) {\r\n      new Notice(\"Please enter a title\");\r\n      return;\r\n    }\r\n    if (!this.data.description.trim()) {\r\n      new Notice(\"Please enter a description\");\r\n      return;\r\n    }\r\n    if (!this.data.assignee) {\r\n      new Notice(\"Please select an assignee\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Get the project file\r\n      const projectFile = this.app.vault.getFileByPath(this.data.project);\r\n      if (!projectFile || !(projectFile instanceof TFile)) {\r\n        new Notice(\"Project file not found\");\r\n        return;\r\n      }\r\n\r\n      // Read the current content\r\n      const content = await this.app.vault.read(projectFile);\r\n      const lines = content.split(\"\\n\");\r\n\r\n      // Generate the task ID based on type\r\n      const taskId = this.generateTaskId(projectFile, this.data.type);\r\n\r\n      // Create the task line based on type\r\n      const taskLine = this.createTaskLine(taskId);\r\n\r\n      // Find the appropriate table and insert the task\r\n      const updatedLines = this.insertTaskIntoTable(lines, taskLine, this.data.type);\r\n\r\n      // Write back to the file\r\n      await this.app.vault.modify(projectFile, updatedLines.join(\"\\n\"));\r\n\r\n      // Re-index the cache\r\n      await this.cache.reindex();\r\n\r\n      new Notice(`Created ${this.data.type} ${taskId}`);\r\n      this.close();\r\n\r\n    } catch (error) {\r\n      console.error(\"Error creating action item:\", error);\r\n      new Notice(\"Error creating action item\");\r\n    }\r\n  }\r\n\r\n  private generateTaskId(projectFile: TFile, type: string): string {\r\n    // Get existing tasks to find the next available ID\r\n    const existingTasks = this.cache.getProjectTasks(projectFile.path) || [];\r\n    \r\n    let nextNumber = 1;\r\n    const prefix = type === \"epic\" ? \"E\" : type === \"story\" ? \"S\" : \"SB\";\r\n    \r\n    // Find the highest existing number for this type\r\n    existingTasks.forEach(task => {\r\n      const taskId = task.id.toLowerCase();\r\n      if (taskId.startsWith(prefix.toLowerCase())) {\r\n        const match = taskId.match(new RegExp(`^${prefix.toLowerCase()}-(\\\\d+)`, 'i'));\r\n        if (match) {\r\n          const num = parseInt(match[1]);\r\n          if (num >= nextNumber) {\r\n            nextNumber = num + 1;\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    return `${prefix}-${nextNumber}`;\r\n  }\r\n\r\n  private createTaskLine(taskId: string): string {\r\n    const parts = [\r\n      `- [ ] ${taskId} ${this.data.title}`\r\n    ];\r\n\r\n    // Add start date if provided\r\n    if (this.data.startDate && this.data.startDate.trim()) {\r\n      parts.push(`  start:: ${this.data.startDate}`);\r\n    }\r\n\r\n    // Add due date if provided\r\n    if (this.data.dueDate && this.data.dueDate.trim()) {\r\n      parts.push(`  due:: ${this.data.dueDate}`);\r\n    }\r\n\r\n    // Add assignee\r\n    parts.push(`  assignee:: ${this.data.assignee}`);\r\n\r\n    // Add priority if provided\r\n    if (this.data.priority && this.data.priority.trim()) {\r\n      parts.push(`  priority:: ${this.data.priority}`);\r\n    }\r\n\r\n    // Add dependency if provided\r\n    if (this.data.dependency && this.data.dependency.trim()) {\r\n      let dependencyLine = `  depends:: ${this.data.dependency.trim()}`;\r\n      if (this.data.dependencyType && this.data.dependencyType.length > 0) {\r\n        dependencyLine = `  depends:: ${this.data.dependencyType}:${this.data.dependency.trim()}`;\r\n      }\r\n      parts.push(dependencyLine);\r\n    }\r\n\r\n    return parts.join(\"\\n\");\r\n  }\r\n\r\n  private insertTaskIntoTable(lines: string[], taskLine: string, type: string): string[] {\r\n    const newLines = [...lines];\r\n    \r\n    // Find the appropriate table based on type\r\n    let tableStart = -1;\r\n    let tableEnd = -1;\r\n    \r\n    if (type === \"epic\") {\r\n      // Find the Epics table\r\n      for (let i = 0; i < newLines.length; i++) {\r\n        if (newLines[i].includes(\"## 🗂️ Epics\")) {\r\n          tableStart = i;\r\n          break;\r\n        }\r\n      }\r\n    } else if (type === \"story\") {\r\n      // Find the Stories table\r\n      for (let i = 0; i < newLines.length; i++) {\r\n        if (newLines[i].includes(\"### 📄 Stories\")) {\r\n          tableStart = i;\r\n          break;\r\n        }\r\n      }\r\n    } else if (type === \"subtask\") {\r\n      // Find the Sub-tasks table\r\n      for (let i = 0; i < newLines.length; i++) {\r\n        if (newLines[i].includes(\"#### 🔧 Sub-tasks\")) {\r\n          tableStart = i;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (tableStart === -1) {\r\n      // If table not found, insert after frontmatter\r\n      for (let i = 0; i < newLines.length; i++) {\r\n        if (newLines[i].startsWith(\"---\")) {\r\n          tableStart = i + 1;\r\n          break;\r\n        }\r\n      }\r\n      newLines.splice(tableStart, 0, taskLine);\r\n      return newLines;\r\n    }\r\n    \r\n    // Find the end of the table (next section or end of file)\r\n    for (let i = tableStart + 1; i < newLines.length; i++) {\r\n      if (newLines[i].startsWith(\"## \") || newLines[i].startsWith(\"### \") || newLines[i].startsWith(\"#### \")) {\r\n        tableEnd = i;\r\n        break;\r\n      }\r\n    }\r\n    \r\n    if (tableEnd === -1) {\r\n      tableEnd = newLines.length;\r\n    }\r\n    \r\n    // Find the last row in the table (before the closing)\r\n    let insertIndex = tableEnd;\r\n    for (let i = tableStart; i < tableEnd; i++) {\r\n      if (newLines[i].includes(\"|\") && !newLines[i].includes(\"---\")) {\r\n        insertIndex = i + 1;\r\n      }\r\n    }\r\n    \r\n    // Create the table row based on type\r\n    const tableRow = this.createTableRow(taskLine, type);\r\n    \r\n    // Insert the new row\r\n    newLines.splice(insertIndex, 0, tableRow);\r\n    \r\n    return newLines;\r\n  }\r\n\r\n  private createTableRow(taskLine: string, type: string): string {\r\n    const taskId = taskLine.match(/- \\[ \\] ([A-Z]+-\\d+)/)?.[1] || \"\";\r\n    const title = `- [ ] ${this.data.title}`;\r\n    const assignee = `assignee:: ${this.data.assignee}`;\r\n    const startDate = this.data.startDate && this.data.startDate.trim() ? `start:: ${this.data.startDate}` : \"\";\r\n    const dueDate = this.data.dueDate && this.data.dueDate.trim() ? `due:: ${this.data.dueDate}` : \"\";\r\n    const description = this.data.description;\r\n    const priority = this.data.priority && this.data.priority.trim() ? this.data.priority : \"\";\r\n    \r\n    let dependency = \"\";\r\n    if (this.data.dependency && this.data.dependency.trim()) {\r\n      dependency = this.data.dependencyType && this.data.dependencyType.length > 0 \r\n        ? `depends:: ${this.data.dependencyType}:${this.data.dependency.trim()}`\r\n        : `depends:: ${this.data.dependency.trim()}`;\r\n    }\r\n    \r\n    if (type === \"epic\") {\r\n      return `| ${taskId} | ${title} | ${assignee} | ${priority} | ${startDate} | ${dueDate} | ${description} |`;\r\n    } else if (type === \"story\") {\r\n      const parentEpic = this.data.parentEpic || \"E-1\";\r\n      return `| ${taskId} | ${parentEpic} | ${title} | ${dependency} | ${assignee} | ${priority} | 1 | ${startDate} | ${dueDate} | ${description} |`;\r\n    } else if (type === \"subtask\") {\r\n      const parentStory = this.data.parentStory || \"S-1\";\r\n      return `| ${taskId} | ${parentStory} | ${title} | ${dependency} | ${assignee} | ${priority} | ${startDate} | ${dueDate} | ${description} |`;\r\n    }\r\n    \r\n    return taskLine;\r\n  }\r\n\r\n  onClose() {\r\n    const { contentEl } = this;\r\n    contentEl.empty();\r\n  }\r\n}\r\n","import {\r\n  ItemView,\r\n  WorkspaceLeaf,\r\n  setIcon,\r\n  TFile,\r\n} from \"obsidian\";\r\n/* Moment.js is available globally in Obsidian */\r\ndeclare const moment: any;\r\nimport type { ViewStateResult } from \"obsidian\";\r\nimport { ProjectCache, TaskItem, ProjectEntry } from \"../services/cache\";\r\nimport { PmSettings } from \"../../settings\";\r\n\r\n// Extended task interface for task weeks view\r\ninterface ExtendedTaskItem extends TaskItem {\r\n  done?: boolean | string;\r\n  percentComplete?: number;\r\n  raw?: string;\r\n  project?: { file?: { basename?: string } };\r\n  projectName?: string;\r\n  _isProjectDivider?: boolean;\r\n  _projectName?: string;\r\n}\r\n\r\n// Load dashboard-specific stylesheet\r\nimport \"../../styles/styles-task-weeks.css\";\r\n\r\n/** Helper: format a date or return an em-dash if undefined */\r\nfunction formatDate(d: string | number | Date | undefined): string {\r\n  if (!d) return \"—\";\r\n  return new Date(d).toLocaleDateString();\r\n}\r\n\r\n/** \"2025-W27\" → \"W27 2025 (30 Jun – 6 Jul)\" */\r\nfunction weekLabel(key: string): string {\r\n  const m = key.match(/^(\\d{4})-W(\\d{2})$/);\r\n  if (!m) return key;\r\n  const [ , yr, wk ] = m;\r\n  // @ts-ignore moment global\r\n  const start = moment().isoWeekYear(+yr).isoWeek(+wk).startOf(\"isoWeek\");\r\n  const end   = start.clone().endOf(\"isoWeek\");\r\n  return `W${wk} ${yr} (${start.format(\"D MMM\")} – ${end.format(\"D MMM\")})`;\r\n}\r\n\r\n/** Helper: determine status badge label and CSS class */\r\nfunction projectStatus(\r\n  nextDue?: string,\r\n  pct = 0\r\n): { label: string; cls: string } {\r\n  if (pct >= 1) return { label: \"Completed\", cls: \"complete\" };\r\n  if (!nextDue) return { label: \"No date\", cls: \"no-date\" };\r\n\r\n  const today   = new Date();\r\n  const due     = new Date(nextDue);\r\n  const msInDay = 86_400_000;\r\n  const diff    = (due.getTime() - today.getTime()) / msInDay;\r\n\r\n  if (diff < 0)  return { label: \"Off track\", cls: \"off-track\" }; // red\r\n  if (diff <= 10) return { label: \"Warning\",  cls: \"warning\"   }; // orange\r\n  return { label: \"On track\", cls: \"on-track\" };\r\n}\r\n\r\n\r\n/** Progress bar colour bucket */\r\nfunction progressClass(pct: number): string {\r\n  if (pct >= 100) return \"done\";\r\n  if (pct >= 75)  return \"high\";\r\n  if (pct >= 40)  return \"medium\";\r\n  return \"low\";\r\n}\r\n\r\n/** Tooltip explaining status */\r\nfunction statusTooltip(nextDue?: string, pct = 0): string {\r\n  if (pct >= 1) return \"Task reached 100 % completion\";\r\n  if (!nextDue) return \"No due date set\";\r\n  const today   = new Date();\r\n  const due     = new Date(nextDue);\r\n  const msInDay = 86_400_000;\r\n  const diff    = Math.ceil((due.getTime() - today.getTime()) / msInDay);\r\n\r\n  if (diff < 0)  return `Past due by ${-diff} day${diff === -1 ? \"\" : \"s\"} (due ${formatDate(due)})`;\r\n  if (diff === 0) return \"Due today\";\r\n  if (diff <= 10) return `Due in ${diff} day${diff === 1 ? \"\" : \"s\"} (${formatDate(due)})`;\r\n  return `Due on ${formatDate(due)}`;\r\n}\r\n\r\n/** Detect whether a task is completed */\r\nfunction isTaskDone(t: ExtendedTaskItem): boolean {\r\n  /* explicit flags from parsers */\r\n  if (t.done === true || t.checked === true) return true;\r\n  if (typeof t.done === \"string\" && t.done.toLowerCase() === \"done\") return true;\r\n\r\n  /* explicit status strings */\r\n  if (typeof t.status === \"string\") {\r\n    const s = t.status.toLowerCase();\r\n    if ([\"done\", \"complete\", \"completed\"].includes(s)) return true;\r\n  }\r\n\r\n  /* percent-complete field */\r\n  if (typeof t.percentComplete === \"number\" && t.percentComplete >= 1) return true;\r\n\r\n  /* markdown checkbox or bullet */\r\n  const raw = (t.raw ?? t.text ?? \"\").toString();\r\n  if (/^\\s*-\\s*\\[[xX]\\]/.test(raw)) return true;\r\n\r\n  /* completed:: 2025‑05‑01 inline field or front‑matter */\r\n  if (t.props?.completed || t.props?.[\"completionDate\"]) return true;\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Return tasks ordered as in Timeline:\r\n *   • Epics (E‑) first\r\n *   • then Stories (S‑) each followed by their SB‑ sub‑tasks\r\n *   • anything else afterwards in original order\r\n */\r\nfunction orderTasksDash(tasks: ExtendedTaskItem[]): ExtendedTaskItem[] {\r\n  const done = new Set<ExtendedTaskItem>();\r\n  const out: ExtendedTaskItem[] = [];\r\n\r\n  /* Quick look‑ups by epic and story properties */\r\n  const storiesByEpic = new Map<string, ExtendedTaskItem[]>();\r\n  const subsByStory = new Map<string, ExtendedTaskItem[]>();\r\n\r\n  tasks.forEach((t) => {\r\n    const id = (t.id ?? \"\").toString();\r\n    \r\n    if (/^s\\b/i.test(id) && !/^sb\\b/i.test(id)) {\r\n      // Group stories by their epic property\r\n      const epicRef = (t.props?.epic ?? \"\").toString().trim().toLowerCase();\r\n      if (epicRef) {\r\n        (storiesByEpic.get(epicRef) ?? storiesByEpic.set(epicRef, []).get(epicRef)!).push(t);\r\n      }\r\n    } else if (/^sb\\b/i.test(id)) {\r\n      // Group subtasks by their story property\r\n      const storyRef = (t.props?.story ?? \"\").toString().trim().toLowerCase();\r\n      if (storyRef) {\r\n        (subsByStory.get(storyRef) ?? subsByStory.set(storyRef, []).get(storyRef)!).push(t);\r\n      }\r\n    }\r\n  });\r\n\r\n  const pushWithSubs = (t: ExtendedTaskItem) => {\r\n    if (done.has(t)) return;\r\n    done.add(t);\r\n    out.push(t);\r\n\r\n    const id = (t.id ?? \"\").toString().toLowerCase();\r\n\r\n    if (/^e\\b/i.test(id)) {\r\n      /* Push Stories that belong to this epic */\r\n      const stories = storiesByEpic.get(id) ?? [];\r\n      stories.forEach(pushWithSubs);\r\n    }\r\n\r\n    if (/^s\\b/i.test(id) && !/^sb\\b/i.test(id)) {\r\n      /* Push SB‑tasks that belong to this story */\r\n      const subtasks = subsByStory.get(id) ?? [];\r\n      subtasks.forEach(pushWithSubs);\r\n    }\r\n\r\n    // Also push SB tasks that depend on this Story (fallback for dependency-based relationships)\r\n    tasks.forEach((sb) => {\r\n      if (done.has(sb)) return;\r\n      const sbId = (sb.id ?? \"\").toLowerCase();\r\n      if (!sbId.startsWith(\"sb\")) return;\r\n      const deps = (sb.depends ?? []).map((d: string) => d.toLowerCase());\r\n      if (deps.includes(id)) pushWithSubs(sb);\r\n    });\r\n  };\r\n\r\n  tasks.forEach((t) => {\r\n    if (done.has(t)) return;\r\n    const id = (t.id ?? \"\").toLowerCase();\r\n\r\n    if (id.startsWith(\"e\")) {          // Epics first\r\n      pushWithSubs(t);\r\n    } else if (id.startsWith(\"s\") && !id.startsWith(\"sb\")) { // Stories next\r\n      pushWithSubs(t);\r\n    }\r\n  });\r\n\r\n  // Append any remaining tasks (including standalone SB or others)\r\n  tasks.forEach((t) => { if (!done.has(t)) out.push(t); });\r\n\r\n  return out;\r\n}\r\n\r\nexport const VIEW_TYPE_PM_TASKWEEKS = \"pm-task-weeks-view\";\r\n\r\nexport class TaskWeeksView extends ItemView {\r\n  /** icon shown on the view tab */\r\n  public icon = \"calendar-check\";\r\n  /** Optional set of project file paths to display (injected by Portfolio view) */\r\n  private filterPaths?: Set<string>;\r\n  /** Optional name of the portfolio that opened this dashboard */\r\n  private filterName?: string;\r\n  /** The initial project paths passed in from Portfolio (null = no portfolio) */\r\n  private originalPaths: string[] | null = null;\r\n  private sortField: string | null = null;\r\n  private sortAsc = true;\r\n  private collapsed = new Set<string>();\r\n  private firstRender = true;\r\n  private totalGroups = 0;        // number of week rows in current render\r\n  private currentPaths: string[] = [];   // paths (week keys) shown in latest render\r\n  private visibleWeekPaths: string[] = [];   // paths of weeks that passed filters in last render\r\n  private showEpics = true;                // show/hide epics\r\n  private showStories = true;              // show/hide stories\r\n  private showSubTasks = true;             // show/hide sub-tasks\r\n  private displayMode: 'start' | 'due' = 'start';  // display tasks by start date or due date\r\n  private sortMode: 'project' | 'hierarchical' | 'alphabetical' = 'project';  // project grouping, hierarchical, or alphabetical\r\n  private collapsedProjects = new Set<string>();  // track collapsed project dividers (format: \"weekPath:projectName\")\r\n\r\n  private cache: ProjectCache;\r\n  private settings: PmSettings;\r\n  private container!: HTMLElement;\r\n  private detachFn: (() => void) | null = null;\r\n\r\n  private filterText = \"\";                 // live text in the quick-filter box\r\n  /** Optional set of assignee names to display */\r\n  private assigneeFilter: Set<string> | null = null;\r\n\r\n  constructor(\r\n    leaf: WorkspaceLeaf,\r\n    cache: ProjectCache,\r\n    settings: PmSettings\r\n  ) {\r\n    super(leaf);\r\n    this.cache = cache;\r\n    this.settings = settings;\r\n  }\r\n\r\n  /** Called when leaf.setViewState({ state }) is invoked */\r\n  async setState(state: { filterProjects?: string[]; filterName?: string } | undefined, result: ViewStateResult): Promise<void> {\r\n    if (\r\n      state &&\r\n      Array.isArray(state.filterProjects) &&\r\n      state.filterProjects.length > 0\r\n    ) {\r\n      this.filterPaths   = new Set(state.filterProjects as string[]);\r\n      this.originalPaths = [...state.filterProjects];     // remember portfolio set\r\n    } else {\r\n      this.filterPaths   = undefined;          // empty array or undefined ⇒ show all\r\n      this.originalPaths = null;\r\n    }\r\n    if (typeof state?.filterName === \"string\" && state.filterName.trim() !== \"\") {\r\n      this.filterName = state.filterName.trim();\r\n    } else {\r\n      this.filterName = undefined;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Update project filter & re-render.\r\n      Pass `null` => show ALL projects.                         */\r\n  public updateFilter(paths: string[] | null, name = \"\") {\r\n    if (paths === null) {\r\n      /* Show ALL projects */\r\n      this.filterPaths = undefined;\r\n    } else if (Array.isArray(paths)) {\r\n      /* Show NONE if empty array, else selected set */\r\n      this.filterPaths = paths.length ? new Set(paths) : new Set<string>();\r\n    }\r\n    this.filterName = name;\r\n    this.render();\r\n  }\r\n\r\n  getViewType(): string {\r\n    return VIEW_TYPE_PM_TASKWEEKS;\r\n  }\r\n  getDisplayText(): string {\r\n    return this.filterName\r\n      ? `Tasks – ${this.filterName}`\r\n      : \"Tasks\";\r\n  }\r\n\r\n  getIcon(): string {\r\n    return \"calendar-check\";\r\n  }\r\n\r\n  async onOpen() {\r\n    this.container = this.contentEl;\r\n\r\n    /* Apply initial filterProjects / filterName passed via view‑state */\r\n    const st = (this.leaf.getViewState() as any).state ?? {};\r\n    if (Array.isArray(st.filterProjects) && st.filterProjects.length) {\r\n      this.filterPaths   = new Set(st.filterProjects);\r\n      this.originalPaths = [...st.filterProjects];        // keep original list\r\n    } else {\r\n      this.filterPaths   = undefined;\r\n      this.originalPaths = null;\r\n    }\r\n    this.filterName = typeof st.filterName === \"string\" ? st.filterName.trim() : \"\";\r\n\r\n    this.render();\r\n    this.detachFn = this.cache.onChange(() => this.render());\r\n  }\r\n  async onClose() {\r\n    this.detachFn?.();\r\n  }\r\n\r\n  /** Returns true if every project row is collapsed */\r\n  private allCollapsed(): boolean {\r\n    // If we have visible week paths, check if they're all collapsed\r\n    if (this.visibleWeekPaths.length > 0) {\r\n      return this.visibleWeekPaths.every(path => this.collapsed.has(path));\r\n    }\r\n    // If no visible week paths yet, check if we have any collapsed items\r\n    // This handles the initial state where everything starts collapsed\r\n    return this.collapsed.size > 0;\r\n  }\r\n\r\n  /** Collapse or expand all projects at once */\r\n  private toggleAll() {\r\n    // Use the visible week paths captured during the latest render\r\n    const visiblePaths = this.visibleWeekPaths;\r\n    \r\n    const allCollapsed = visiblePaths.length > 0 && visiblePaths.every(path => this.collapsed.has(path));\r\n    \r\n    if (allCollapsed) {\r\n      // Expand: remove visible paths from collapsed set\r\n      visiblePaths.forEach(path => this.collapsed.delete(path));\r\n    } else {\r\n      // Collapse: add visible paths to collapsed set\r\n      visiblePaths.forEach(path => this.collapsed.add(path));\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Toggle fold / unfold for one project and re-render */\r\n  private toggle(path: string) {\r\n    if (this.collapsed.has(path)) this.collapsed.delete(path);\r\n    else this.collapsed.add(path);\r\n    this.render();\r\n  }\r\n\r\n  /** Check if all projects are currently collapsed */\r\n  private areAllProjectsCollapsed(): boolean {\r\n    if (this.sortMode !== 'project' && this.sortMode !== 'hierarchical' && this.sortMode !== 'alphabetical') {\r\n      return false; // Not applicable for other modes\r\n    }\r\n    \r\n    // Get only the visible/filtered project names\r\n    const visibleProjectNames = new Set<string>();\r\n    this.cache.projects.forEach((project: ProjectEntry) => {\r\n      // Only include projects that match the current filter\r\n      if (!this.filterPaths || this.filterPaths.has(project.file.path)) {\r\n        const projectName = project.file.basename ?? \"Unknown Project\";\r\n        visibleProjectNames.add(projectName);\r\n      }\r\n    });\r\n    \r\n    // Check if all visible projects are in the collapsed set (for any week)\r\n    return Array.from(visibleProjectNames).every(projectName => {\r\n      // Check if this project is collapsed in any week\r\n      return Array.from(this.collapsedProjects).some(collapsedKey => \r\n        collapsedKey.endsWith(`:${projectName}`)\r\n      );\r\n    });\r\n  }\r\n\r\n  /** Collapse all projects */\r\n  private collapseAllProjects(): void {\r\n    if (this.sortMode !== 'project' && this.sortMode !== 'hierarchical' && this.sortMode !== 'alphabetical') {\r\n      return; // Not applicable for other modes\r\n    }\r\n    \r\n    // Get only the visible/filtered project names and add them to collapsed set\r\n    this.cache.projects.forEach((project: ProjectEntry) => {\r\n      // Only collapse projects that match the current filter\r\n      if (!this.filterPaths || this.filterPaths.has(project.file.path)) {\r\n        const projectName = project.file.basename ?? \"Unknown Project\";\r\n        // Add to collapsed set for this specific week\r\n        const collapsedKey = `${project.file.path}:${projectName}`;\r\n        this.collapsedProjects.add(collapsedKey);\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Toggle task completion status */\r\n  private async toggleTaskCompletion(task: ExtendedTaskItem, done: boolean): Promise<void> {\r\n    const file = (task as any).file;\r\n    if (!file) return;\r\n\r\n    const content = await this.app.vault.read(file);\r\n    const lines = content.split(/\\r?\\n/);\r\n    const checkboxRegex = /\\[[ xX\\/-]\\]/;\r\n\r\n    // Find the task line\r\n    let lineIdx = typeof task.line === \"number\" ? task.line : -1;\r\n    if (!(lineIdx >= 0 && checkboxRegex.test(lines[lineIdx]))) {\r\n      lineIdx = lines.findIndex(\r\n        (line) => line.includes(task.text ?? \"\") && checkboxRegex.test(line)\r\n      );\r\n    }\r\n\r\n    if (lineIdx >= 0) {\r\n      const match = lines[lineIdx].match(/\\[[ xX\\/-]\\]/);\r\n      if (match) {\r\n        const replacement = done ? \"[x]\" : \"[ ]\";\r\n        lines[lineIdx] = lines[lineIdx].replace(/\\[[ xX\\/-]\\]/, replacement);\r\n        await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n        this.render();\r\n      }\r\n    }\r\n  }\r\n\r\n  private render() {\r\n    this.container.empty();\r\n    this.container.addClass(\"pm-task-weeks-view\");\r\n\r\n    // Clear any lingering tooltips\r\n    document.querySelectorAll('.pm-dash-tooltip').forEach((el) => el.remove());\r\n\r\n    /* ── Fold/Unfold top bar ───────────────────────── */\r\n    const topbar = this.container.createEl(\"div\", { cls: \"pm-dash-topbar\" });\r\n    const globalCaret = topbar.createEl(\"span\", { cls: \"pm-global-caret\" });\r\n    globalCaret.style.cursor = \"pointer\";\r\n    globalCaret.setAttr(\"aria-label\", \"Toggle all weeks\");\r\n    setIcon(globalCaret, \"chevron-right\"); // Will be updated later after processing weeks\r\n    globalCaret.onclick = () => this.toggleAll();\r\n    topbar.createEl(\"span\", { text: \"Weeks\" });\r\n\r\n    /* Display mode toggle */\r\n    const modeToggle = topbar.createEl(\"button\", { \r\n      cls: \"pm-mode-toggle\"\r\n    });\r\n    setIcon(modeToggle, this.displayMode === 'start' ? 'clock' : 'check-circle');\r\n    \r\n    // Custom tooltip functionality\r\n    let tooltip: HTMLElement | null = null;\r\n    let tooltipTimeout: NodeJS.Timeout | null = null;\r\n    \r\n    const showTooltip = (event: MouseEvent) => {\r\n      if (tooltip) return;\r\n      \r\n      tooltip = document.createElement('div');\r\n      tooltip.className = 'pm-dash-tooltip';\r\n      tooltip.textContent = `Currently showing tasks by ${this.displayMode} date. Click to switch.`;\r\n      \r\n      document.body.appendChild(tooltip);\r\n      \r\n      // Position tooltip near the button\r\n      const rect = (event.target as HTMLElement).getBoundingClientRect();\r\n      tooltip.style.left = `${rect.left}px`;\r\n      tooltip.style.top = `${rect.bottom + 8}px`;\r\n    };\r\n    \r\n    const hideTooltip = () => {\r\n      if (tooltip) {\r\n        tooltip.remove();\r\n        tooltip = null;\r\n      }\r\n      if (tooltipTimeout) {\r\n        clearTimeout(tooltipTimeout);\r\n        tooltipTimeout = null;\r\n      }\r\n    };\r\n    \r\n    modeToggle.addEventListener('mouseenter', (event) => {\r\n      tooltipTimeout = setTimeout(() => showTooltip(event), 500);\r\n    });\r\n    \r\n    modeToggle.addEventListener('mouseleave', hideTooltip);\r\n    \r\n    modeToggle.onclick = () => {\r\n      hideTooltip();\r\n      this.displayMode = this.displayMode === 'start' ? 'due' : 'start';\r\n      setIcon(modeToggle, this.displayMode === 'start' ? 'clock' : 'check-circle');\r\n      // Update tooltip text for next hover\r\n      const newTooltipText = `Currently showing tasks by ${this.displayMode} date. Click to switch.`;\r\n      modeToggle.setAttribute('data-tooltip', newTooltipText);\r\n      \r\n      // Preserve current collapsed state before re-rendering\r\n      const wasAllCollapsed = this.allCollapsed();\r\n      this.render();\r\n      \r\n      // If it was all collapsed before, collapse all again after re-render\r\n      if (wasAllCollapsed) {\r\n        this.visibleWeekPaths.forEach(path => this.collapsed.add(path));\r\n        // Also immediately reflect the caret icon to match the restored state\r\n        const caretEl = this.container.querySelector<HTMLElement>(\".pm-global-caret\");\r\n        if (caretEl) setIcon(caretEl, this.allCollapsed() ? \"chevron-right\" : \"chevron-down\");\r\n      }\r\n    };\r\n\r\n    /* Task sorting toggle */\r\n    const sortToggle = topbar.createEl(\"button\", { \r\n      cls: \"pm-mode-toggle\"\r\n    });\r\n    setIcon(sortToggle, this.sortMode === 'project' ? 'folder' : this.sortMode === 'hierarchical' ? 'list-tree' : 'sort-asc');\r\n    \r\n    // Custom tooltip functionality for sort toggle\r\n    let sortTooltip: HTMLElement | null = null;\r\n    let sortTooltipTimeout: NodeJS.Timeout | null = null;\r\n    \r\n    const showSortTooltip = (event: MouseEvent) => {\r\n      if (sortTooltip) return;\r\n      \r\n      sortTooltip = document.createElement('div');\r\n      sortTooltip.className = 'pm-dash-tooltip';\r\n      sortTooltip.textContent = this.sortMode === 'project' \r\n        ? \"Currently grouping by project. Click for hierarchical sorting.\"\r\n        : this.sortMode === 'hierarchical'\r\n        ? \"Currently sorting hierarchically. Click for alphabetical sorting.\"\r\n        : \"Currently sorting alphabetically. Click for project grouping.\";\r\n      \r\n      document.body.appendChild(sortTooltip);\r\n      \r\n      const rect = (event.target as HTMLElement).getBoundingClientRect();\r\n      sortTooltip.style.left = `${rect.left}px`;\r\n      sortTooltip.style.top = `${rect.bottom + 8}px`;\r\n    };\r\n    \r\n    const hideSortTooltip = () => {\r\n      if (sortTooltip) {\r\n        sortTooltip.remove();\r\n        sortTooltip = null;\r\n      }\r\n      if (sortTooltipTimeout) {\r\n        clearTimeout(sortTooltipTimeout);\r\n        sortTooltipTimeout = null;\r\n      }\r\n    };\r\n    \r\n    sortToggle.addEventListener('mouseenter', (event) => {\r\n      sortTooltipTimeout = setTimeout(() => showSortTooltip(event), 500);\r\n    });\r\n    \r\n    sortToggle.addEventListener('mouseleave', hideSortTooltip);\r\n    \r\n    sortToggle.onclick = () => {\r\n      hideSortTooltip();\r\n      // Cycle through the three modes: project → hierarchical → alphabetical → project\r\n      this.sortMode = this.sortMode === 'project' ? 'hierarchical' : \r\n                     this.sortMode === 'hierarchical' ? 'alphabetical' : 'project';\r\n      setIcon(sortToggle, this.sortMode === 'project' ? 'folder' : this.sortMode === 'hierarchical' ? 'list-tree' : 'sort-asc');\r\n      this.render();\r\n    };\r\n\r\n    /* Global project collapse/expand toggle */\r\n    const globalProjectToggle = topbar.createEl(\"button\", { \r\n      cls: \"pm-mode-toggle\"\r\n    });\r\n    setIcon(globalProjectToggle, \"chevrons-down-up\");\r\n    \r\n    // Global project toggle tooltip\r\n    let globalTooltip: HTMLElement | null = null;\r\n    let globalTooltipTimeout: NodeJS.Timeout | null = null;\r\n    \r\n    const showGlobalTooltip = (event: MouseEvent) => {\r\n      if (globalTooltip) return;\r\n      \r\n      globalTooltip = document.createElement('div');\r\n      globalTooltip.className = 'pm-dash-tooltip';\r\n      globalTooltip.textContent = \"Toggle all projects expand/collapse\";\r\n      \r\n      document.body.appendChild(globalTooltip);\r\n      \r\n      const rect = (event.target as HTMLElement).getBoundingClientRect();\r\n      globalTooltip.style.left = `${rect.left}px`;\r\n      globalTooltip.style.top = `${rect.bottom + 8}px`;\r\n    };\r\n    \r\n    const hideGlobalTooltip = () => {\r\n      if (globalTooltip) {\r\n        globalTooltip.remove();\r\n        globalTooltip = null;\r\n      }\r\n      if (globalTooltipTimeout) {\r\n        clearTimeout(globalTooltipTimeout);\r\n        globalTooltipTimeout = null;\r\n      }\r\n    };\r\n    \r\n    globalProjectToggle.addEventListener('mouseenter', (event) => {\r\n      globalTooltipTimeout = setTimeout(() => showGlobalTooltip(event), 500);\r\n    });\r\n    \r\n    globalProjectToggle.addEventListener('mouseleave', hideGlobalTooltip);\r\n    \r\n    globalProjectToggle.onclick = () => {\r\n      hideGlobalTooltip();\r\n      \r\n      // Preserve scroll position\r\n      const tableContainer = this.container.querySelector('.pm-table-container');\r\n      const scrollTop = tableContainer?.scrollTop || 0;\r\n      const scrollHeight = tableContainer?.scrollHeight || 0;\r\n      \r\n      // Check if all projects are currently collapsed\r\n      const allCollapsed = this.areAllProjectsCollapsed();\r\n      \r\n      // Only toggle if there are multiple visible projects\r\n      const visibleProjectNames = new Set<string>();\r\n      this.cache.projects.forEach((project: ProjectEntry) => {\r\n        if (!this.filterPaths || this.filterPaths.has(project.file.path)) {\r\n          const projectName = project.file.basename ?? \"Unknown Project\";\r\n          visibleProjectNames.add(projectName);\r\n        }\r\n      });\r\n      \r\n      // If there's only one project visible, don't toggle - just maintain its current state\r\n      if (visibleProjectNames.size <= 1) {\r\n        return;\r\n      }\r\n      \r\n      if (allCollapsed) {\r\n        // Expand all projects - remove all collapsed keys for visible projects\r\n        const keysToRemove: string[] = [];\r\n        this.collapsedProjects.forEach(key => {\r\n          const projectName = key.split(':').pop(); // Get project name from \"weekPath:projectName\"\r\n          if (projectName && visibleProjectNames.has(projectName)) {\r\n            keysToRemove.push(key);\r\n          }\r\n        });\r\n        keysToRemove.forEach(key => this.collapsedProjects.delete(key));\r\n      } else {\r\n        // Collapse all projects - add collapsed keys for all visible projects in all weeks\r\n        // We need to add keys for each week that contains these projects\r\n        const weekPaths = new Set<string>();\r\n        \r\n        // Collect all week paths that contain visible projects\r\n        this.cache.projects.forEach((project: ProjectEntry) => {\r\n          if (!this.filterPaths || this.filterPaths.has(project.file.path)) {\r\n            weekPaths.add(project.file.path);\r\n          }\r\n        });\r\n        \r\n        // Add collapsed keys for each visible project in each week\r\n        weekPaths.forEach(weekPath => {\r\n          this.cache.projects.forEach((project: ProjectEntry) => {\r\n            if (!this.filterPaths || this.filterPaths.has(project.file.path)) {\r\n              const projectName = project.file.basename ?? \"Unknown Project\";\r\n              const collapsedKey = `${weekPath}:${projectName}`;\r\n              this.collapsedProjects.add(collapsedKey);\r\n            }\r\n          });\r\n        });\r\n      }\r\n      \r\n      this.render();\r\n      \r\n      // Restore scroll position with adjustment for content height changes\r\n      const restoreScroll = () => {\r\n        const newTableContainer = this.container.querySelector('.pm-table-container');\r\n        if (newTableContainer) {\r\n          const newScrollHeight = newTableContainer.scrollHeight;\r\n          const heightRatio = scrollHeight > 0 ? newScrollHeight / scrollHeight : 1;\r\n          const adjustedScrollTop = scrollTop * heightRatio;\r\n          newTableContainer.scrollTop = adjustedScrollTop;\r\n        }\r\n      };\r\n      \r\n      // Try immediately, then with delays\r\n      restoreScroll();\r\n      setTimeout(restoreScroll, 10);\r\n      setTimeout(restoreScroll, 50);\r\n      setTimeout(restoreScroll, 100);\r\n    };\r\n\r\n    /* Task filter input now lives in the top bar */\r\n    const searchInput = topbar.createEl(\"input\", {\r\n      type: \"search\",\r\n      placeholder: \"Filter tasks…\",\r\n      cls: \"pm-search-input\",\r\n      value: this.filterText,\r\n    });\r\n\r\n    searchInput.oninput = () => {\r\n      this.filterText = searchInput.value.toLowerCase();\r\n      const caretPos = searchInput.selectionStart ?? searchInput.value.length;\r\n      this.render();\r\n\r\n      const again = this.container.querySelector<HTMLInputElement>(\".pm-search-input\");\r\n      if (again) {\r\n        again.focus();\r\n        again.setSelectionRange(caretPos, caretPos);\r\n      }\r\n    };\r\n\r\n    /* ── Projects dropdown (checkbox list) ─────────────────── */\r\n    const projBtn = topbar.createEl(\"button\", { cls: \"pm-proj-btn\" });\r\n    projBtn.createSpan({ text: \"Projects \" });\r\n    const projCaret = projBtn.createSpan();\r\n    setIcon(projCaret, \"chevron-down\");\r\n\r\n    let ddOpen = false;\r\n    let ddEl: HTMLElement | null = null;\r\n\r\n    const buildDropdown = (projectList: ProjectEntry[]) => {\r\n      ddEl = document.createElement(\"div\");\r\n      ddEl.className = \"pm-proj-dd\";\r\n\r\n      /* Select/Deselect controls */\r\n      const controls = ddEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n      /* ALL */\r\n      controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        closeDropdown();\r\n        /* Keep current portfolio name so middle option remains visible */\r\n        this.updateFilter(null, this.filterName ?? \"\");\r\n        setTimeout(() => this.container.querySelector<HTMLButtonElement>(\".pm-proj-btn\")?.click(), 0);\r\n      };\r\n\r\n      /* PORTFOLIO (only if originalPaths present) */\r\n      if (this.originalPaths && this.originalPaths.length) {\r\n        controls.createSpan({ text: \" | \" });\r\n        controls.createEl(\"a\", { text: this.filterName ?? \"Portfolio\" }).onclick = (e) => {\r\n          e.preventDefault();\r\n          closeDropdown();\r\n          this.updateFilter([...this.originalPaths!], this.filterName ?? \"\");\r\n          setTimeout(() => this.container.querySelector<HTMLButtonElement>(\".pm-proj-btn\")?.click(), 0);\r\n        };\r\n      }\r\n\r\n      /* NONE */\r\n      controls.createSpan({ text: \" | \" });\r\n      controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        closeDropdown();\r\n        /* Preserve portfolio name so the middle option stays visible */\r\n        this.updateFilter([], this.filterName ?? \"\");\r\n        setTimeout(() => this.container.querySelector<HTMLButtonElement>(\".pm-proj-btn\")?.click(), 0);\r\n      };\r\n\r\n      /* Checkbox list */\r\n      projectList.forEach((p: ProjectEntry) => {\r\n        const wrap = ddEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n        const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n        cb.style.cursor = \"pointer\";\r\n        cb.style.marginRight = \"8px\";\r\n        cb.style.display = \"inline-block\";\r\n        cb.style.width = \"16px\";\r\n        cb.style.height = \"16px\";\r\n        wrap.createSpan({ text: ` ${p.file.basename}` });\r\n\r\n        const isChecked = !this.filterPaths || this.filterPaths.has(p.file.path);\r\n        setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n        \r\n        // Store the project path on the element for easy access\r\n        cb.setAttribute(\"data-project-path\", p.file.path);\r\n        cb.setAttribute(\"data-checked\", isChecked.toString());\r\n        wrap.onclick = () => {\r\n          const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n          const newChecked = !currentChecked;\r\n          \r\n          cb.setAttribute(\"data-checked\", newChecked.toString());\r\n          setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n          \r\n          /* gather all check icons to compute new filter */\r\n          const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\"));\r\n          const selected = checkIcons\r\n            .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n            .map(icon => icon.getAttribute(\"data-project-path\")!);\r\n\r\n          const newFilter =\r\n            selected.length === projectList.length ? null : selected;\r\n\r\n          /* Pass through existing filterName so it doesn’t get cleared */\r\n          this.updateFilter(newFilter, this.filterName ?? \"\");\r\n        };\r\n      });\r\n\r\n      document.body.appendChild(ddEl);\r\n      /* Position below the button, but prevent overflow */\r\n      const r   = projBtn.getBoundingClientRect();\r\n      const pad = 4;                         // minimal margin from window edge\r\n\r\n      let left = r.left;\r\n      let top  = r.bottom + pad;             // default: below button\r\n\r\n      /* Measure after insertion */\r\n      const ddW = ddEl.offsetWidth  || 240;\r\n      const ddH = ddEl.offsetHeight || 260;\r\n\r\n      /* Prevent horizontal overflow - check both left and right edges */\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      /* Prevent vertical overflow – if no room below, place above */\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        const above = r.top - ddH - pad;\r\n        top = above >= pad ? above\r\n                           : Math.max(window.innerHeight - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      ddEl.style.left = `${left}px`;\r\n      ddEl.style.top  = `${top}px`;\r\n    };\r\n\r\n    const closeDropdown = () => {\r\n      ddEl?.remove();\r\n      ddEl = null;\r\n      ddOpen = false;\r\n      setIcon(projCaret, \"chevron-down\");\r\n    };\r\n\r\n    projBtn.onclick = () => {\r\n      if (ddOpen) {\r\n        closeDropdown();\r\n        return;\r\n      }\r\n      ddOpen = true;\r\n      setIcon(projCaret, \"chevron-up\");\r\n\r\n      /* Build project list based on current cache + initial portfolio filter */\r\n      const projectList = Array.from(this.cache.projects.values())   // list every project\r\n        .sort((a, b) => a.file.basename.localeCompare(b.file.basename)); // sort A-Z\r\n      buildDropdown(projectList);\r\n\r\n      /* Close on outside click */\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (ddEl && !ddEl.contains(e.target as Node) && e.target !== projBtn) {\r\n          closeDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    /* ── Assignees dropdown (checkbox list) ─────────────────── */\r\n    const asnBtn = topbar.createEl(\"button\", { cls: \"pm-ass-btn\" });\r\n    asnBtn.createSpan({ text: \"Assignees \" });\r\n    const asnCaret = asnBtn.createSpan();\r\n    setIcon(asnCaret, \"chevron-down\");\r\n\r\n    let adOpen = false;\r\n    let adEl: HTMLElement | null = null;\r\n\r\n    const buildAssigneeDropdown = (list: string[]) => {\r\n      adEl = document.createElement(\"div\");\r\n      adEl.className = \"pm-proj-dd\";               // reuse same styles\r\n\r\n      /* Controls: All | None */\r\n      /* Controls: All | <Portfolio> | None */\r\n      const ctl = adEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n      /* ALL */\r\n      ctl.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        closeAssigneeDropdown();\r\n        this.assigneeFilter = null;          // clear filter ⇒ show ALL tasks\r\n        this.render();\r\n        setTimeout(() =>\r\n          this.container.querySelector<HTMLButtonElement>(\".pm-ass-btn\")?.click(), 0);\r\n      };\r\n\r\n      /* PORTFOLIO (if present) */\r\n      if (this.originalPaths && this.originalPaths.length) {\r\n        ctl.createSpan({ text: \" | \" });\r\n        ctl.createEl(\"a\", { text: this.filterName || \"Portfolio\" }).onclick = (e) => {\r\n          e.preventDefault();\r\n          closeAssigneeDropdown();\r\n\r\n          /* Assignees only from portfolio projects */\r\n          const port = new Set<string>();\r\n          this.cache.projects.forEach((p: ProjectEntry) => {\r\n            if (!this.originalPaths!.includes(p.file.path)) return;\r\n            (p.tasks ?? []).forEach((t: TaskItem) => {\r\n              const a = (t.props?.assignee ?? t.props?.owner ?? \"\")\r\n                .toString()\r\n                .trim();\r\n              if (a) port.add(a.toLowerCase());\r\n            });\r\n          });\r\n          this.assigneeFilter = port.size ? port : null;\r\n          this.render();\r\n          setTimeout(() =>\r\n            this.container.querySelector<HTMLButtonElement>(\".pm-ass-btn\")?.click(), 0);\r\n        };\r\n      }\r\n\r\n      /* NONE */\r\n      ctl.createSpan({ text: \" | \" });\r\n      ctl.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        closeAssigneeDropdown();\r\n        this.assigneeFilter = new Set<string>();   // hide all (empty set)\r\n        this.render();\r\n        setTimeout(() =>\r\n          this.container.querySelector<HTMLButtonElement>(\".pm-ass-btn\")?.click(), 0);\r\n      };\r\n\r\n      /* Collect assignees from projects currently visible with the current Project filter */\r\n      const visibleAss = new Set<string>();\r\n      this.cache.projects.forEach((p: ProjectEntry) => {\r\n        if (this.filterPaths && !this.filterPaths.has(p.file.path)) return;  // only projects in view\r\n        (p.tasks ?? []).forEach((t: TaskItem) => {\r\n          const a = (t.props?.assignee ?? t.props?.owner ?? \"\")\r\n            .toString()\r\n            .trim()\r\n            .toLowerCase();\r\n          if (a) visibleAss.add(a);\r\n        });\r\n      });\r\n\r\n      /* Checkbox list */\r\n      list.forEach((name) => {\r\n        const nameKey = name.trim().toLowerCase();\r\n        const wrap = adEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n        const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n        cb.style.cursor = \"pointer\";\r\n        cb.style.marginRight = \"8px\";\r\n        cb.style.display = \"inline-block\";\r\n        cb.style.width = \"16px\";\r\n        cb.style.height = \"16px\";\r\n        \r\n        const autoChecked = this.assigneeFilter\r\n          ? this.assigneeFilter.has(nameKey)      // keep existing selection if user changed it\r\n          : visibleAss.has(nameKey);              // default = assignees from visible projects\r\n        \r\n        setIcon(cb, autoChecked ? \"check-circle\" : \"circle\");\r\n        \r\n        // Store the assignee name on the element for easy access\r\n        cb.setAttribute(\"data-assignee\", nameKey);\r\n        cb.setAttribute(\"data-checked\", autoChecked.toString());\r\n        \r\n        wrap.createSpan({ text: name });\r\n        \r\n        wrap.onclick = () => {\r\n          const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n          const newChecked = !currentChecked;\r\n          \r\n          cb.setAttribute(\"data-checked\", newChecked.toString());\r\n          setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n          \r\n          /* gather all check icons to compute new filter */\r\n          const checkIcons = Array.from(adEl!.querySelectorAll(\".pm-dd-check\"));\r\n          const selected = checkIcons\r\n            .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n            .map(icon => icon.getAttribute(\"data-assignee\")!);\r\n\r\n          this.assigneeFilter =\r\n            selected.length === list.length ? null : new Set(selected);\r\n          this.render();\r\n        };\r\n      });\r\n\r\n      document.body.appendChild(adEl);\r\n      const r   = asnBtn.getBoundingClientRect();\r\n      const pad = 4;\r\n\r\n      let left = r.left;\r\n      let top  = r.bottom + pad;\r\n\r\n      /* Prevent horizontal overflow - check both left and right edges */\r\n      if (left + adEl.offsetWidth > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - adEl.offsetWidth - pad, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      /* Prevent vertical overflow – if no room below, place above */\r\n      if (top + adEl.offsetHeight > window.innerHeight - pad) {\r\n        const above = r.top - adEl.offsetHeight - pad;\r\n        top = above >= pad ? above\r\n                           : Math.max(window.innerHeight - adEl.offsetHeight - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      adEl.style.left = `${left}px`;\r\n      adEl.style.top  = `${top}px`;\r\n    };\r\n\r\n    const closeAssigneeDropdown = () => {\r\n      adEl?.remove();\r\n      adEl = null;\r\n      adOpen = false;\r\n      setIcon(asnCaret, \"chevron-down\");\r\n    };\r\n\r\n    asnBtn.onclick = () => {\r\n      if (adOpen) {\r\n        closeAssigneeDropdown();\r\n        return;\r\n      }\r\n      adOpen = true;\r\n      setIcon(asnCaret, \"chevron-up\");\r\n\r\n      /* Build unique assignee list from current cache */\r\n      const uniq = new Set<string>();\r\n      this.cache.projects.forEach((p: ProjectEntry) => {\r\n        (p.tasks ?? []).forEach((t: TaskItem) => {\r\n          const a = (t.props?.assignee ?? t.props?.owner ?? \"\").toString().trim();\r\n          if (a) uniq.add(a);\r\n        });\r\n      });\r\n      buildAssigneeDropdown(Array.from(uniq).sort());\r\n\r\n      /* Close on outside click */\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (adEl && !adEl.contains(e.target as Node) && e.target !== asnBtn) {\r\n          closeAssigneeDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    /* ── Epic, Story, and Sub-task visibility toggles ─────────────────── */\r\n    const epicIcon = topbar.createEl(\"span\", { cls: \"pm-toggle-icon\" });\r\n    epicIcon.style.marginLeft = \"16px\";\r\n    epicIcon.style.cursor = \"pointer\";\r\n    setIcon(epicIcon, \"crown\");\r\n    epicIcon.style.opacity = this.showEpics ? \"1\" : \"0.3\";\r\n    epicIcon.setAttr(\"aria-label\", this.showEpics ? \"Hide Epics\" : \"Show Epics\");\r\n    \r\n    // Epic icon tooltip\r\n    let epicTip: HTMLElement | null = null;\r\n    epicIcon.addEventListener(\"mouseenter\", () => {\r\n      if (epicTip) {\r\n        epicTip.remove();\r\n        epicTip = null;\r\n      }\r\n      epicTip = document.createElement(\"div\");\r\n      epicTip.classList.add(\"pm-dash-tooltip\");\r\n      epicTip.textContent = this.showEpics ? \"Hide Epics\" : \"Show Epics\";\r\n      document.body.appendChild(epicTip);\r\n      \r\n      const r = epicIcon.getBoundingClientRect();\r\n      const pad = 6;\r\n      \r\n      let left = r.left;\r\n      let top = r.bottom + pad;\r\n      \r\n      /* Prevent horizontal overflow */\r\n      if (left + epicTip.offsetWidth > window.innerWidth - pad) {\r\n        left = Math.max(r.left - pad - epicTip.offsetWidth, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n      \r\n      /* Prevent vertical overflow */\r\n      if (top + epicTip.offsetHeight > window.innerHeight - pad) {\r\n        const above = r.top - epicTip.offsetHeight - pad;\r\n        top = above >= pad ? above : Math.max(window.innerHeight - epicTip.offsetHeight - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n      \r\n      epicTip.style.left = `${left}px`;\r\n      epicTip.style.top = `${top}px`;\r\n    });\r\n    epicIcon.addEventListener(\"mouseleave\", () => { \r\n      if (epicTip) {\r\n        epicTip.remove(); \r\n        epicTip = null; \r\n      }\r\n    });\r\n    \r\n    epicIcon.onclick = () => {\r\n      if (epicTip) {\r\n        epicTip.remove();\r\n        epicTip = null;\r\n      }\r\n      this.showEpics = !this.showEpics;\r\n      this.render();\r\n    };\r\n\r\n    const storyIcon = topbar.createEl(\"span\", { cls: \"pm-toggle-icon\" });\r\n    storyIcon.style.marginLeft = \"8px\";\r\n    storyIcon.style.cursor = \"pointer\";\r\n    setIcon(storyIcon, \"file-text\");\r\n    storyIcon.style.opacity = this.showStories ? \"1\" : \"0.3\";\r\n    storyIcon.setAttr(\"aria-label\", this.showStories ? \"Hide Stories\" : \"Show Stories\");\r\n    \r\n    // Story icon tooltip\r\n    let storyTip: HTMLElement | null = null;\r\n    storyIcon.addEventListener(\"mouseenter\", () => {\r\n      if (storyTip) {\r\n        storyTip.remove();\r\n        storyTip = null;\r\n      }\r\n      storyTip = document.createElement(\"div\");\r\n      storyTip.classList.add(\"pm-dash-tooltip\");\r\n      storyTip.textContent = this.showStories ? \"Hide Stories\" : \"Show Stories\";\r\n      document.body.appendChild(storyTip);\r\n      \r\n      const r = storyIcon.getBoundingClientRect();\r\n      const pad = 6;\r\n      \r\n      let left = r.left;\r\n      let top = r.bottom + pad;\r\n      \r\n      /* Prevent horizontal overflow */\r\n      if (left + storyTip.offsetWidth > window.innerWidth - pad) {\r\n        left = Math.max(r.left - pad - storyTip.offsetWidth, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n      \r\n      /* Prevent vertical overflow */\r\n      if (top + storyTip.offsetHeight > window.innerHeight - pad) {\r\n        const above = r.top - storyTip.offsetHeight - pad;\r\n        top = above >= pad ? above : Math.max(window.innerHeight - storyTip.offsetHeight - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n      \r\n      storyTip.style.left = `${left}px`;\r\n      storyTip.style.top = `${top}px`;\r\n    });\r\n    storyIcon.addEventListener(\"mouseleave\", () => { \r\n      if (storyTip) {\r\n        storyTip.remove(); \r\n        storyTip = null; \r\n      }\r\n    });\r\n    \r\n    storyIcon.onclick = () => {\r\n      if (storyTip) {\r\n        storyTip.remove();\r\n        storyTip = null;\r\n      }\r\n      this.showStories = !this.showStories;\r\n      this.render();\r\n    };\r\n\r\n    const subTasksIcon = topbar.createEl(\"span\", { cls: \"pm-toggle-icon\" });\r\n    subTasksIcon.style.marginLeft = \"8px\";\r\n    subTasksIcon.style.cursor = \"pointer\";\r\n    setIcon(subTasksIcon, \"list\");\r\n    subTasksIcon.style.opacity = this.showSubTasks ? \"1\" : \"0.3\";\r\n    subTasksIcon.setAttr(\"aria-label\", this.showSubTasks ? \"Hide Sub-tasks\" : \"Show Sub-tasks\");\r\n    \r\n    // Sub-tasks icon tooltip\r\n    let subTasksTip: HTMLElement | null = null;\r\n    subTasksIcon.addEventListener(\"mouseenter\", () => {\r\n      if (subTasksTip) {\r\n        subTasksTip.remove();\r\n        subTasksTip = null;\r\n      }\r\n      subTasksTip = document.createElement(\"div\");\r\n      subTasksTip.classList.add(\"pm-dash-tooltip\");\r\n      subTasksTip.textContent = this.showSubTasks ? \"Hide Sub-tasks\" : \"Show Sub-tasks\";\r\n      document.body.appendChild(subTasksTip);\r\n      \r\n      const r = subTasksIcon.getBoundingClientRect();\r\n      const pad = 6;\r\n      \r\n      let left = r.left;\r\n      let top = r.bottom + pad;\r\n      \r\n      /* Prevent horizontal overflow */\r\n      if (left + subTasksTip.offsetWidth > window.innerWidth - pad) {\r\n        left = Math.max(r.left - pad - subTasksTip.offsetWidth, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n      \r\n      /* Prevent vertical overflow */\r\n      if (top + subTasksTip.offsetHeight > window.innerHeight - pad) {\r\n        const above = r.top - subTasksTip.offsetHeight - pad;\r\n        top = above >= pad ? above : Math.max(window.innerHeight - subTasksTip.offsetHeight - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n      \r\n      subTasksTip.style.left = `${left}px`;\r\n      subTasksTip.style.top = `${top}px`;\r\n    });\r\n    subTasksIcon.addEventListener(\"mouseleave\", () => { \r\n      if (subTasksTip) {\r\n        subTasksTip.remove(); \r\n        subTasksTip = null; \r\n      }\r\n    });\r\n    \r\n    subTasksIcon.onclick = () => {\r\n      if (subTasksTip) {\r\n        subTasksTip.remove();\r\n        subTasksTip = null;\r\n      }\r\n      this.showSubTasks = !this.showSubTasks;\r\n      this.render();\r\n    };\r\n    \r\n    /* ── Table + header ─────────────────────────────── */\r\n    const tableContainer = this.container.createEl(\"div\", { cls: \"pm-table-container\" });\r\n    const table = tableContainer.createEl(\"table\", { cls: \"pm-table\" });\r\n    /* Column widths: Project widest, Tasks & Status thinner */\r\n    const colgroup = table.createEl(\"colgroup\");\r\n    [\"48%\", \"12%\", \"8%\", \"8%\", \"24%\"].forEach((w) =>\r\n      colgroup.createEl(\"col\", { attr: { style: `width:${w}` } })\r\n    );\r\n    const thead = table.createEl(\"thead\");\r\n    const headerRow = thead.createEl(\"tr\");\r\n\r\n    const headers: [string, string][] = [\r\n      [\"project\",  \"Week\"],\r\n      [\"assignee\", \"Assignee\"],\r\n      [\"tasks\",    \"Tasks\"],\r\n      [\"status\",   \"Status\"],\r\n      [\"origin\",   \"Project\"],\r\n    ];\r\n\r\n    headers.forEach(([field, label]) => {\r\n      const th = headerRow.createEl(\"th\", { cls: \"pm-sortable\" });\r\n      th.style.cursor = \"pointer\";\r\n\r\n      /* Label text */\r\n      th.createSpan({ text: label });\r\n\r\n      /* Chevron icon */\r\n      const ico = th.createSpan({ cls: \"pm-sort-ico\" });\r\n\r\n      if (this.sortField === field) {\r\n        setIcon(ico, this.sortAsc ? \"chevron-up\" : \"chevron-down\");\r\n      } else {\r\n        setIcon(ico, \"chevrons-up-down\");\r\n        ico.style.opacity = \"0.5\";               /* dim when inactive */\r\n      }\r\n\r\n      th.onclick = () => {\r\n        if (this.sortField === field) this.sortAsc = !this.sortAsc;\r\n        else {\r\n          this.sortField = field;\r\n          this.sortAsc = true;\r\n        }\r\n        this.render();\r\n      };\r\n    });\r\n\r\n    const tbody = table.createEl(\"tbody\");\r\n\r\n    /* ── Sort projects ─────────────────────────────── */\r\n    let projects = Array.from(this.cache.projects.values()).filter(\r\n      (p) => !this.filterPaths || this.filterPaths.has(p.file.path)\r\n    );\r\n\r\n    /* ── Regroup by ISO week instead of per‑project ─────────────── */\r\n    const weekMap = new Map<string, any>();\r\n\r\n    projects.forEach((proj: any) => {\r\n      orderTasksDash((proj as any).tasks ?? []).forEach((t: any) => {\r\n        /* Use selected display mode to determine which date to use for week grouping */\r\n        const dateToUse = this.displayMode === 'start' \r\n          ? (t.props?.start ?? t.props?.due ?? \"\").toString().trim()\r\n          : (t.props?.due ?? t.props?.start ?? \"\").toString().trim();\r\n        \r\n        if (!dateToUse) return;\r\n\r\n        // @ts-ignore  moment is global in Obsidian\r\n        const d = (moment as any)(dateToUse, \"YYYY-MM-DD\");\r\n        if (!d.isValid()) return;\r\n\r\n        const wkKey = `${d.isoWeekYear()}-W${String(d.isoWeek()).padStart(2,\"0\")}`;\r\n\r\n        /* create wrapper (once per week) */\r\n        if (!weekMap.has(wkKey)) {\r\n          weekMap.set(wkKey, {\r\n            file: {           // mimic TFile shape\r\n              basename: wkKey,\r\n              path:     wkKey,\r\n              stat:     { mtime: d.valueOf() }\r\n            },\r\n            tasks: [],\r\n            percentComplete: 0,\r\n            totalTasks: 0,\r\n            completedTasks: 0,\r\n            nextDue: undefined,\r\n          });\r\n        }\r\n\r\n        const wk = weekMap.get(wkKey);\r\n        t.projectName = proj.file.basename;   // store originating project\r\n        t.projectPath = proj.file.path;       // store project note path\r\n        wk.tasks.push(t);\r\n        /* Only count SB‑ sub‑tasks in weekly tallies */\r\n        const idLow = ((t.id ?? \"\") as string).toLowerCase();\r\n        if (idLow.startsWith(\"sb\")) {\r\n          wk.totalTasks++;\r\n          if (isTaskDone(t)) wk.completedTasks++;\r\n        }\r\n\r\n        const due = t.props?.due ?? t.props?.start;\r\n        if (due && (!wk.nextDue || String(due) < wk.nextDue)) wk.nextDue = String(due);\r\n      });\r\n    });\r\n\r\n    /* compute percentComplete for each week */\r\n    weekMap.forEach((wk) => {\r\n      wk.percentComplete = wk.totalTasks === 0 ? 0 : wk.completedTasks / wk.totalTasks;\r\n    });\r\n\r\n    /* Replace original project list with week wrappers */\r\n    projects = Array.from(weekMap.values());\r\n    \r\n    /* Add today's date row at the beginning */\r\n    const today = moment().startOf(\"day\");\r\n    const todayKey = \"today\";\r\n    const todayTasks: any[] = [];\r\n    \r\n    // Collect all tasks due today\r\n    projects.forEach((week) => {\r\n      (week.tasks as any[]).forEach((task) => {\r\n        const dueDate = task.props?.due ?? task.props?.start;\r\n        if (dueDate) {\r\n          const taskDate = moment(dueDate, \"YYYY-MM-DD\").startOf(\"day\");\r\n          if (taskDate.isSame(today)) {\r\n            todayTasks.push(task);\r\n          }\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Always create today's row (even if no tasks due today)\r\n    const todayWeek: any = {\r\n      file: {\r\n        basename: todayKey,\r\n        path: todayKey,\r\n        stat: { mtime: today.valueOf() }\r\n      },\r\n      tasks: todayTasks,\r\n      percentComplete: 0,\r\n      totalTasks: 0,\r\n      completedTasks: 0,\r\n      nextDue: today.format(\"YYYY-MM-DD\"),\r\n    };\r\n    \r\n    // Calculate today's stats\r\n    const sbTasks = todayTasks.filter(t => \r\n      ((t.id ?? \"\") as string).toLowerCase().startsWith(\"sb\")\r\n    );\r\n    todayWeek.totalTasks = sbTasks.length;\r\n    todayWeek.completedTasks = sbTasks.filter(isTaskDone).length;\r\n    todayWeek.percentComplete = todayWeek.totalTasks === 0 ? 0 : todayWeek.completedTasks / todayWeek.totalTasks;\r\n    \r\n    // Don't add today row yet - we'll insert it after sorting\r\n    // projects.unshift(todayWeek);\r\n    \r\n    this.currentPaths = projects.map(p => p.file.path);\r\n    this.totalGroups = projects.length;        // remember for caret logic\r\n\r\n    /* Default order on first render = nearest upcoming ISO‑week first\r\n       (only when user hasn't clicked a sortable header) */\r\n    if (!this.sortField) {\r\n      const today = moment().startOf(\"day\");\r\n      projects.sort((a, b) => {\r\n        const sa = moment(a.file.basename, \"YYYY-[W]WW\").startOf(\"isoWeek\");\r\n        const sb = moment(b.file.basename, \"YYYY-[W]WW\").startOf(\"isoWeek\");\r\n        return sa.diff(today) - sb.diff(today);\r\n      });\r\n    }\r\n\r\n    // Auto‑collapse only on the very first render; afterwards respect user toggles\r\n    if (this.firstRender) {\r\n      // Initialize collapsed set with all weeks on first render\r\n      projects.forEach(p => this.collapsed.add(p.file.path));\r\n      // Also collapse the today row on first render\r\n      this.collapsed.add(todayWeek.file.path);\r\n      this.firstRender = false;\r\n    }\r\n    // (Defer setting caret icon until after we know how many rows are visible)\r\n    \r\n    if (this.sortField) {\r\n      const dir = this.sortAsc ? 1 : -1;\r\n      const statusRank = (p: typeof projects[number]) => {\r\n        const { label } = projectStatus(p.nextDue, p.percentComplete);\r\n        return [\"Off track\", \"Warning\", \"On track\", \"Completed\", \"No date\"].indexOf(\r\n          label\r\n        );\r\n      };\r\n\r\n      projects.sort((a, b) => {\r\n        switch (this.sortField) {\r\n          case \"project\":\r\n            return a.file.basename.localeCompare(b.file.basename) * dir;\r\n          case \"progress\":\r\n            return (a.percentComplete - b.percentComplete) * dir;\r\n          case \"tasks\":\r\n            const ratio = (p: typeof a) =>\r\n              (p.completedTasks ?? 0) / Math.max(p.totalTasks ?? 1, 1);\r\n            return (ratio(a) - ratio(b)) * dir;\r\n          case \"status\":\r\n            return (statusRank(a) - statusRank(b)) * dir;\r\n          case \"nextDue\": {\r\n            const dv = (d?: string) =>\r\n              d ? new Date(d).getTime() : Number.POSITIVE_INFINITY;\r\n            return (dv(a.nextDue) - dv(b.nextDue)) * dir;\r\n          }\r\n          case \"lastUpdated\":\r\n            return (\r\n              ((a.file.stat?.mtime ?? 0) - (b.file.stat?.mtime ?? 0)) * dir\r\n            );\r\n          default:\r\n            return 0;\r\n        }\r\n      });\r\n    }\r\n\r\n    /* Now insert today row in the correct chronological position */\r\n    const todayDate = moment().startOf(\"day\");\r\n    let insertIndex = 0;\r\n\r\n    if (this.sortField === \"nextDue\") {\r\n      const dir = this.sortAsc ? 1 : -1;\r\n      if (dir === 1) { // Ascending\r\n        insertIndex = projects.findIndex(p => {\r\n          const weekDate = p.nextDue ? moment(p.nextDue, \"YYYY-MM-DD\").startOf(\"day\") : moment().add(1, \"year\");\r\n          return weekDate.isSameOrAfter(todayDate);\r\n        });\r\n        if (insertIndex === -1) insertIndex = projects.length;\r\n      } else { // Descending\r\n        insertIndex = projects.findIndex(p => {\r\n          const weekDate = p.nextDue ? moment(p.nextDue, \"YYYY-MM-DD\").startOf(\"day\") : moment().subtract(1, \"year\");\r\n          return weekDate.isSameOrBefore(todayDate);\r\n        });\r\n        if (insertIndex === -1) insertIndex = projects.length;\r\n      }\r\n    } else {\r\n      insertIndex = 0; // For other sorts, place today at the beginning\r\n    }\r\n\r\n    projects.splice(insertIndex, 0, todayWeek);\r\n    \r\n    // Update total groups count after adding today row\r\n    this.totalGroups = projects.length;\r\n\r\n    /* Helper: show styled tooltip for status cells */\r\n    const attachStatusPopup = (cell: HTMLElement, msg: string) => {\r\n      let tip: HTMLElement | null = null;\r\n      cell.addEventListener(\"mouseenter\", (ev) => {\r\n        const mouse = ev as MouseEvent;\r\n        tip = document.createElement(\"div\");\r\n        tip.className = \"pm-dash-tooltip\";\r\n        tip.textContent = msg;\r\n        document.body.appendChild(tip);\r\n\r\n        const pad = 8;\r\n\r\n        /* default: below-right of cursor */\r\n        let left = mouse.clientX + pad;\r\n        let top  = mouse.clientY + pad;\r\n\r\n        /* Horizontal overflow – flip to left of cursor */\r\n        if (left + tip.offsetWidth > window.innerWidth - pad) {\r\n          left = mouse.clientX - tip.offsetWidth - pad;\r\n        }\r\n        /* Vertical overflow – flip above cursor */\r\n        if (top + tip.offsetHeight > window.innerHeight - pad) {\r\n          top = mouse.clientY - tip.offsetHeight - pad;\r\n        }\r\n        if (left < pad) left = pad;\r\n        if (top < pad)  top  = pad;\r\n\r\n        tip.style.left = `${left}px`;\r\n        tip.style.top  = `${top}px`;\r\n      });\r\n      cell.addEventListener(\"mouseleave\", () => {\r\n        tip?.remove();\r\n        tip = null;\r\n      });\r\n    };\r\n\r\n    /* ── Project rows ─────────────────────────────── */\r\n    let visibleWeeks = 0;\r\n    let collapsedWeeks = 0;\r\n    this.visibleWeekPaths = [];\r\n    for (const project of projects) {\r\n      /* ── Evaluate filters *before* rendering this week ── */\r\n      const matchesFilter = this.filterText\r\n        ? (project.tasks as any[]).some(t => {\r\n            const hay = `${t.text ?? \"\"} ${(t.id ?? \"\")}`.toLowerCase();\r\n            return hay.includes(this.filterText);\r\n          })\r\n        : true;                                   // no quick‑filter ⇒ match\r\n\r\n      // Special handling for today's row - always show it regardless of assignee filter\r\n      const isToday = project.file.basename === \"today\";\r\n      \r\n      const matchesAssignees = isToday \r\n        ? true                                    // always show today's row\r\n        : this.assigneeFilter === null\r\n        ? true                                    // no assignee filter ⇒ match\r\n        : this.assigneeFilter.size === 0\r\n          ? false                                 // “None” ⇒ hide week\r\n          : (project.tasks as any[]).some(t => {\r\n              const a = (t.assignee ??\r\n                         t.props?.assignee ??\r\n                         t.owner ??\r\n                         t.props?.owner ??\r\n                         \"\")\r\n                .toString()\r\n                .trim()\r\n                .toLowerCase();\r\n              return this.assigneeFilter!.has(a);\r\n            });\r\n\r\n      /* Skip this week entirely if it fails either filter */\r\n      if (!matchesFilter || !matchesAssignees) continue;\r\n\r\n      visibleWeeks++;\r\n      this.visibleWeekPaths.push(project.file.path);\r\n\r\n      const row = tbody.createEl(\"tr\");\r\n\r\n      /* Auto‑expand only when a quick‑filter is active *and* this week matches it */\r\n      const autoExpand =\r\n        this.filterText && matchesFilter;\r\n\r\n      const isCollapsed =\r\n        this.collapsed.has(project.file.path) && !autoExpand;\r\n\r\n      if (isCollapsed) collapsedWeeks++;\r\n\r\n      if (isToday) {\r\n        // Simple today row without chevron or clickable link\r\n        const nameCell = row.createEl(\"td\", { cls: \"pm-dash-name\" });\r\n        nameCell.createEl(\"span\", { \r\n          text: `Today (${today.format(\"D MMM YYYY\")})`,\r\n          cls: \"pm-today-label\"\r\n        });\r\n      } else {\r\n        // Regular week row with chevron and clickable link\r\n        const nameCell = row.createEl(\"td\", { cls: \"pm-dash-name\" });\r\n        const caret = nameCell.createEl(\"span\");\r\n        setIcon(caret, isCollapsed ? \"chevron-right\" : \"chevron-down\");\r\n        caret.style.marginRight = \"4px\";\r\n        caret.style.cursor = \"pointer\";\r\n        caret.onclick = (e) => {\r\n          e.stopPropagation();\r\n          this.toggle(project.file.path);\r\n        };\r\n\r\n        const displayText = weekLabel(project.file.basename);\r\n        nameCell.createEl(\"span\", {\r\n          text: displayText,\r\n        });\r\n      }\r\n\r\n      /* Calculate task tally – fall back to pre‑computed cache fields */\r\n      let totalTasks: number;\r\n      let doneTasks:  number;\r\n\r\n      if (Array.isArray((project as any).tasks)) {\r\n        const projTasks: any[] = (project as any).tasks;\r\n        const subTasks = projTasks.filter((tk) =>\r\n          ((tk.id ?? \"\") as string).toUpperCase().startsWith(\"SB\")\r\n        );\r\n        totalTasks = subTasks.length;\r\n        doneTasks  = subTasks.filter(isTaskDone).length;\r\n      } else {\r\n        totalTasks = (project as any).totalTasks ?? 0;\r\n        doneTasks  = (project as any).completedTasks ?? 0;\r\n      }\r\n\r\n      /* Assignee column (leave blank for week rows) */\r\n      row.createEl(\"td\");   // empty cell\r\n\r\n      /* Use project.percentComplete for status calculations */\r\n      const pctNum = Math.round((project as any).percentComplete * 100);\r\n\r\n      /* Tasks ✓/total (+ red ! if total > 20) – skip for Today row */\r\n      if (!isToday) {\r\n        const tasksCell = row.createEl(\"td\", {\r\n          text: `${doneTasks} / ${totalTasks}`,\r\n        });\r\n\r\n                        if (totalTasks > this.settings.taskWeeksOverloadThreshold) {\r\n          tasksCell.createEl(\"span\", {\r\n            text: \" !\",\r\n            cls: \"pm-overload\",\r\n          });\r\n        }\r\n      } else {\r\n        row.createEl(\"td\"); // empty cell for Today\r\n      }\r\n\r\n      /* Status – skip for Today row */\r\n      if (!isToday) {\r\n        const { label, cls } = projectStatus(\r\n          project.nextDue,\r\n          pctNum / 100      // 1 ⇒ “Completed”\r\n        );\r\n        const wTd = row.createEl(\"td\");\r\n        wTd.createEl(\"span\", {\r\n          cls:  `pm-badge ${cls}`,\r\n          text: label,\r\n        });\r\n        attachStatusPopup(wTd, statusTooltip(project.nextDue, pctNum / 100));\r\n      } else {\r\n        row.createEl(\"td\"); // empty cell for Today\r\n      }\r\n\r\n      /* Project column (blank for week rows) */\r\n      row.createEl(\"td\");\r\n\r\n\r\n      /* ── Task sub-rows ─────────────────────────── */\r\n      if (!isToday && !isCollapsed && Array.isArray((project as any).tasks)) {\r\n        /* Sort tasks based on toggle setting */\r\n        let tasks: any[];\r\n        if (this.sortMode === 'project') {\r\n          // Group tasks by project, then sort by type within each project\r\n          const projectGroups = new Map<string, any[]>();\r\n          \r\n          // Group tasks by their project\r\n          (project as any).tasks.forEach((t: any) => {\r\n            const projectName = t.projectName ?? t.project?.file?.basename ?? \"Unknown Project\";\r\n            if (!projectGroups.has(projectName)) {\r\n              projectGroups.set(projectName, []);\r\n            }\r\n            projectGroups.get(projectName)!.push(t);\r\n          });\r\n          \r\n          // Sort projects alphabetically, then sort tasks within each project\r\n          const sortedProjects = Array.from(projectGroups.keys()).sort();\r\n          tasks = [];\r\n          \r\n          for (let i = 0; i < sortedProjects.length; i++) {\r\n            const projectName = sortedProjects[i];\r\n            const projectTasks = projectGroups.get(projectName)!;\r\n            \r\n            // Add project divider for all projects\r\n            tasks.push({ \r\n              _isProjectDivider: true, \r\n              _projectName: projectName,\r\n              _originalTasks: projectTasks \r\n            });\r\n            \r\n            // Sort tasks within this project by type (Epics → Stories → Subtasks)\r\n            const sortedProjectTasks = orderTasksDash(projectTasks);\r\n            tasks.push(...sortedProjectTasks);\r\n          }\r\n        } else if (this.sortMode === 'hierarchical') {\r\n          // Group tasks by project, then sort hierarchically within each project\r\n          const projectGroups = new Map<string, any[]>();\r\n          \r\n          // Group tasks by their project\r\n          (project as any).tasks.forEach((t: any) => {\r\n            const projectName = t.projectName ?? t.project?.file?.basename ?? \"Unknown Project\";\r\n            if (!projectGroups.has(projectName)) {\r\n              projectGroups.set(projectName, []);\r\n            }\r\n            projectGroups.get(projectName)!.push(t);\r\n          });\r\n          \r\n          // Sort projects alphabetically, then sort tasks hierarchically within each project\r\n          const sortedProjects = Array.from(projectGroups.keys()).sort();\r\n          tasks = [];\r\n          \r\n          for (let i = 0; i < sortedProjects.length; i++) {\r\n            const projectName = sortedProjects[i];\r\n            const projectTasks = projectGroups.get(projectName)!;\r\n            \r\n            // Add project divider for all projects\r\n            tasks.push({ \r\n              _isProjectDivider: true, \r\n              _projectName: projectName,\r\n              _originalTasks: projectTasks \r\n            });\r\n            \r\n            // Sort tasks within this project hierarchically (Epics → Stories → Subtasks)\r\n            const sortedProjectTasks = orderTasksDash(projectTasks);\r\n            tasks.push(...sortedProjectTasks);\r\n          }\r\n        } else {\r\n          // Sort alphabetically by task text, but still group by project\r\n          const projectGroups = new Map<string, any[]>();\r\n          \r\n          // Group tasks by their project\r\n          (project as any).tasks.forEach((t: any) => {\r\n            const projectName = t.projectName ?? t.project?.file?.basename ?? \"Unknown Project\";\r\n            if (!projectGroups.has(projectName)) {\r\n              projectGroups.set(projectName, []);\r\n            }\r\n            projectGroups.get(projectName)!.push(t);\r\n          });\r\n          \r\n          // Sort projects alphabetically, then sort tasks alphabetically within each project\r\n          const sortedProjects = Array.from(projectGroups.keys()).sort();\r\n          tasks = [];\r\n          \r\n          for (let i = 0; i < sortedProjects.length; i++) {\r\n            const projectName = sortedProjects[i];\r\n            const projectTasks = projectGroups.get(projectName)!;\r\n            \r\n            // Add project divider\r\n            tasks.push({ \r\n              _isProjectDivider: true, \r\n              _projectName: projectName,\r\n              _originalTasks: projectTasks \r\n            });\r\n            \r\n            // Sort tasks within this project alphabetically\r\n            const sortedProjectTasks = projectTasks.sort((a, b) => {\r\n              const textA = (a.text ?? \"\").toLowerCase();\r\n              const textB = (b.text ?? \"\").toLowerCase();\r\n              return textA.localeCompare(textB);\r\n            });\r\n            tasks.push(...sortedProjectTasks);\r\n          }\r\n        }\r\n        for (const t of tasks) {\r\n          // Handle project divider rows\r\n          if ((t as any)._isProjectDivider) {\r\n            const projectName = (t as any)._projectName;\r\n            const collapsedKey = `${project.file.path}:${projectName}`;\r\n            const isProjectCollapsed = this.collapsedProjects.has(collapsedKey);\r\n            \r\n            const dividerRow = tbody.createEl(\"tr\", { cls: \"pm-project-divider\" });\r\n            \r\n            // Create a full-width divider cell\r\n            const dividerCell = dividerRow.createEl(\"td\", { \r\n              cls: \"pm-project-divider-cell\",\r\n              attr: { colspan: \"5\" }\r\n            });\r\n            \r\n            // Create the divider content with chevron\r\n            const dividerContent = dividerCell.createEl(\"div\", { cls: \"pm-project-divider-content\" });\r\n            \r\n            // Chevron button\r\n            const chevron = dividerContent.createEl(\"span\", { cls: \"pm-project-chevron\" });\r\n            setIcon(chevron, isProjectCollapsed ? \"chevron-right\" : \"chevron-down\");\r\n            chevron.style.cursor = \"pointer\";\r\n            chevron.style.marginRight = \"8px\";\r\n            \r\n            // Project name\r\n            const projectText = dividerContent.createEl(\"span\", { \r\n              cls: \"pm-project-divider-text\",\r\n              text: projectName\r\n            });\r\n            \r\n            // Visual separator line\r\n            const dividerLine = dividerContent.createEl(\"div\", { cls: \"pm-project-divider-line\" });\r\n            \r\n            // Click handler for the entire divider row\r\n            dividerRow.style.cursor = \"pointer\";\r\n            dividerRow.onclick = () => {\r\n              // Preserve scroll position\r\n              const tableContainer = this.container.querySelector('.pm-table-container');\r\n              const scrollTop = tableContainer?.scrollTop || 0;\r\n              const scrollHeight = tableContainer?.scrollHeight || 0;\r\n              \r\n              // Create week-specific project key\r\n              const collapsedKey = `${project.file.path}:${projectName}`;\r\n              \r\n              if (this.collapsedProjects.has(collapsedKey)) {\r\n                this.collapsedProjects.delete(collapsedKey);\r\n              } else {\r\n                this.collapsedProjects.add(collapsedKey);\r\n              }\r\n              \r\n              this.render();\r\n              \r\n              // Restore scroll position with adjustment for content height changes\r\n              const restoreScroll = () => {\r\n                const newTableContainer = this.container.querySelector('.pm-table-container');\r\n                if (newTableContainer) {\r\n                  const newScrollHeight = newTableContainer.scrollHeight;\r\n                  const heightRatio = scrollHeight > 0 ? newScrollHeight / scrollHeight : 1;\r\n                  const adjustedScrollTop = scrollTop * heightRatio;\r\n                  newTableContainer.scrollTop = adjustedScrollTop;\r\n                }\r\n              };\r\n              \r\n              // Try immediately, then with delays\r\n              restoreScroll();\r\n              setTimeout(restoreScroll, 10);\r\n              setTimeout(restoreScroll, 50);\r\n              setTimeout(restoreScroll, 100);\r\n            };\r\n            \r\n            continue;\r\n          }\r\n          \r\n          /* Skip tasks if their project is collapsed in this week */\r\n          if (this.sortMode === 'project' || this.sortMode === 'hierarchical' || this.sortMode === 'alphabetical') {\r\n            const taskProjectName = t.projectName ?? t.project?.file?.basename ?? \"Unknown Project\";\r\n            const collapsedKey = `${project.file.path}:${taskProjectName}`;\r\n            if (this.collapsedProjects.has(collapsedKey)) {\r\n              continue;\r\n            }\r\n          }\r\n          /* ── Skip tasks based on visibility settings ─────────────────── */\r\n          const taskIdUpper = ((t as any).id ?? \"\").toUpperCase();\r\n          const isEpic = taskIdUpper.startsWith(\"E\");\r\n          const isStory = taskIdUpper.startsWith(\"S\") && !taskIdUpper.startsWith(\"SB\");\r\n          const isSubTask = taskIdUpper.startsWith(\"SB\");\r\n          \r\n          if (isEpic && !this.showEpics) continue;\r\n          if (isStory && !this.showStories) continue;\r\n          if (isSubTask && !this.showSubTasks) continue;\r\n\r\n          /* Skip tasks not in assignee filter */\r\n          if (this.assigneeFilter !== null) {\r\n            if (this.assigneeFilter.size === 0) continue;   // \"None\" ⇒ skip all\r\n            const aName = (t.assignee ??\r\n                           t.props?.assignee ??\r\n                           t.owner ??\r\n                           t.props?.owner ??\r\n                           \"\")\r\n              .toString()\r\n              .trim()\r\n              .toLowerCase();\r\n            if (!this.assigneeFilter.has(aName)) continue;\r\n          }\r\n          /* Skip tasks that don’t match filter */\r\n          if (this.filterText) {\r\n            const hay = `${t.text ?? \"\"} ${(t.id ?? \"\")}`.toLowerCase();\r\n            if (!hay.includes(this.filterText)) continue;\r\n          }\r\n          \r\n          const tRow = tbody.createEl(\"tr\", { cls: \"pm-task-row\" });\r\n\r\n          /* Task name (clickable link) */\r\n          const tName = tRow.createEl(\"td\", { cls: \"pm-task-name\" });\r\n\r\n          const idTag = ((t as any).id ?? \"\").toUpperCase();\r\n          const indentLevel =\r\n            idTag.startsWith(\"E\") ? 0 :                     // Epics\r\n            (idTag.startsWith(\"S\") && !idTag.startsWith(\"SB\")) ? 1 : 2;  // Stories vs. SB-tasks\r\n\r\n          /* 20 px base + 12 px per indent level */\r\n          tName.style.paddingLeft = `${20 + indentLevel * 12}px`;\r\n\r\n          /* Determine completion */\r\n          let done = isTaskDone(t);\r\n\r\n          /* percentComplete: prefer explicit field, else done → 100 or 0 */\r\n          const tPct =\r\n            typeof (t as any).percentComplete === \"number\"\r\n              ? Math.round((t as any).percentComplete * 100)\r\n              : done ? 100 : 0;\r\n\r\n          /* Bullet or check icon depending on completion */\r\n          if (done) {\r\n            const chk = tName.createEl(\"span\");\r\n            setIcon(chk, \"check-circle\");\r\n            chk.addClass(\"pm-task-check\");\r\n            chk.style.marginRight = \"4px\";\r\n          } else {\r\n            tName.createEl(\"span\", { text: \"• \", cls: \"pm-task-bullet\" });\r\n          }\r\n\r\n          /* Show ID prefix (E‑, S‑, SB‑) before the task name */\r\n          const prefix = (() => {\r\n            const id: string = (t as any).id ?? \"\";\r\n            if (!id) return \"\";\r\n            const match = id.match(/^(E|SB?|S)-?\\d+/i); // captures E‑, S‑, SB‑\r\n            return match ? `${match[0].toUpperCase()} ` : \"\";\r\n          })();\r\n\r\n          const anchor = tName.createEl(\"a\", {\r\n            text: `${prefix}${t.text ?? \"(untitled)\"}`,\r\n            href: (t as any).file?.path ?? \"\",\r\n            cls: \"pm-task-weeks-link\",\r\n          });\r\n          \r\n          // Force the color styling with inline styles using CSS variables\r\n          anchor.style.color = \"var(--text-muted)\";\r\n          \r\n          // Ensure styles are applied after a brief delay\r\n          setTimeout(() => {\r\n            anchor.style.color = \"var(--text-muted)\";\r\n          }, 10);\r\n          \r\n          anchor.addEventListener(\"mouseenter\", () => {\r\n            anchor.style.color = \"var(--interactive-accent)\";\r\n          });\r\n          anchor.addEventListener(\"mouseleave\", () => {\r\n            anchor.style.color = \"var(--text-muted)\";\r\n          });\r\n\r\n          /* ── Hover tooltip for task meta ─────────────────────────── */\r\n          let hoverTip: HTMLElement | null = null;\r\n\r\n          anchor.addEventListener(\"mouseenter\", () => {\r\n            const props = (t as any).props ?? {};\r\n            const val = (k: string) => props[k] ?? props[k.toLowerCase()] ?? \"—\";\r\n\r\n            const who = (\r\n              t.assignee ??\r\n              t.props?.assignee ??\r\n              t.owner ??\r\n              t.props?.owner ??\r\n              \"—\"\r\n            ).toString().trim() || \"—\";\r\n\r\n            const html = `\r\n              <strong>${prefix}${t.text ?? \"(untitled)\"}</strong><br>\r\n              <em>${val(\"description\") || (t.description ?? \"\").toString().trim() || \"—\"}</em><br>\r\n              <span>Start: ${val(\"start\")}</span><br>\r\n              <span>Due&nbsp;&nbsp;: ${val(\"due\") || val(\"end\")}</span><br>\r\n              <span>Assignee: ${who}</span>\r\n            `;\r\n\r\n            hoverTip = document.createElement(\"div\");\r\n            hoverTip.className = \"pm-dash-tooltip\";\r\n            hoverTip.innerHTML = html;\r\n            document.body.appendChild(hoverTip);\r\n\r\n            const r = anchor.getBoundingClientRect();\r\n            const pad = 8;\r\n            \r\n            let left = r.right + pad;\r\n            let top = r.top;\r\n            \r\n            /* Prevent horizontal overflow */\r\n            if (left + hoverTip.offsetWidth > window.innerWidth - pad) {\r\n              left = Math.max(r.left - pad - hoverTip.offsetWidth, pad);\r\n            }\r\n            if (left < pad) {\r\n              left = pad;\r\n            }\r\n            \r\n            /* Prevent vertical overflow */\r\n            if (top + hoverTip.offsetHeight > window.innerHeight - pad) {\r\n              const above = r.top - hoverTip.offsetHeight - pad;\r\n              top = above >= pad ? above : Math.max(window.innerHeight - hoverTip.offsetHeight - pad, pad);\r\n            }\r\n            if (top < pad) {\r\n              top = pad;\r\n            }\r\n            \r\n            hoverTip.style.left = `${left}px`;\r\n            hoverTip.style.top = `${top}px`;\r\n          });\r\n\r\n          anchor.addEventListener(\"mouseleave\", () => {\r\n            hoverTip?.remove();\r\n            hoverTip = null;\r\n          });\r\n          \r\n          /* Bold for Epics (E‑) and Stories (S‑) but not SB‑ sub‑tasks */\r\n          const idUpper = ((t as any).id ?? \"\").toUpperCase();\r\n          if (idUpper.startsWith(\"E\") ||\r\n             (idUpper.startsWith(\"S\") && !idUpper.startsWith(\"SB\"))) {\r\n            anchor.addClass(\"pm-task-bold\");\r\n          }\r\n\r\n          anchor.style.cursor = \"pointer\";\r\n          anchor.onclick = (e) => {\r\n            e.preventDefault();\r\n            const filePath = (t as any).file?.path;\r\n            if (filePath) this.app.workspace.openLinkText(filePath, \"\", false);\r\n          };\r\n\r\n\r\n          /* Assignee column */\r\n          tRow.createEl(\"td\", {\r\n            text:\r\n              (t.assignee ??\r\n               t.props?.assignee ??\r\n               t.owner ??\r\n               t.props?.owner ??\r\n               \"—\").toString(),\r\n            cls: \"pm-assignee-cell\",\r\n          });\r\n\r\n          // For SB tasks, add completion toggle in the Tasks column\r\n          const isSB = ((t as any).id ?? \"\").toUpperCase().startsWith(\"SB\");\r\n          if (isSB) {\r\n            // Create the tasks cell with completion toggle\r\n            const tasksCell = tRow.createEl(\"td\");\r\n            \r\n            // Create clickable completion toggle\r\n            const toggleBtn = tasksCell.createEl(\"span\");\r\n            setIcon(toggleBtn, done ? \"check-circle\" : \"circle\");\r\n            toggleBtn.style.cursor = \"pointer\";\r\n            \r\n            // Add tooltip\r\n            let tooltip: HTMLElement | null = null;\r\n            toggleBtn.addEventListener(\"mouseenter\", () => {\r\n              tooltip = document.createElement(\"div\");\r\n              tooltip.className = \"pm-dash-tooltip\";\r\n              tooltip.textContent = done ? \"Mark as incomplete\" : \"Mark as complete\";\r\n              document.body.appendChild(tooltip);\r\n              \r\n              const rect = toggleBtn.getBoundingClientRect();\r\n              const pad = 4;\r\n              \r\n              let left = rect.left;\r\n              let top = rect.bottom + pad;\r\n              \r\n              /* Prevent horizontal overflow */\r\n              if (left + tooltip.offsetWidth > window.innerWidth - pad) {\r\n                left = Math.max(window.innerWidth - tooltip.offsetWidth - pad, pad);\r\n              }\r\n              if (left < pad) {\r\n                left = pad;\r\n              }\r\n              \r\n              /* Prevent vertical overflow */\r\n              if (top + tooltip.offsetHeight > window.innerHeight - pad) {\r\n                const above = rect.top - tooltip.offsetHeight - pad;\r\n                top = above >= pad ? above : Math.max(window.innerHeight - tooltip.offsetHeight - pad, pad);\r\n              }\r\n              if (top < pad) {\r\n                top = pad;\r\n              }\r\n              \r\n              tooltip.style.left = `${left}px`;\r\n              tooltip.style.top = `${top}px`;\r\n            });\r\n            \r\n            toggleBtn.addEventListener(\"mouseleave\", () => {\r\n              tooltip?.remove();\r\n              tooltip = null;\r\n            });\r\n            \r\n            toggleBtn.addEventListener(\"click\", async (e) => {\r\n              e.stopPropagation();\r\n              await this.toggleTaskCompletion(t, !done);\r\n              tooltip?.remove();\r\n              tooltip = null;\r\n            });\r\n            \r\n            // Also hide tooltip on scroll\r\n            this.container.addEventListener(\"scroll\", () => {\r\n              tooltip?.remove();\r\n              tooltip = null;\r\n            });\r\n          } else {\r\n            // For non-SB tasks, use the existing logic\r\n            (() => {\r\n              const idUp = ((t as any).id ?? \"\").toUpperCase();\r\n              const isEpic = idUp.startsWith(\"E\");\r\n              const isStory = idUp.startsWith(\"S\") && !idUp.startsWith(\"SB\");\r\n              let taskText = \"—\";\r\n\r\n              if (isEpic || isStory) {\r\n                /* Gather descendant tasks (recursive for Epics,\r\n                   direct SB-children for Stories) */\r\n\r\n                const gatherDescendants = (rootId: string): any[] => {\r\n                  const desc: any[] = [];\r\n                  const seen = new Set<string>();\r\n                  const queue = [rootId];\r\n                  while (queue.length) {\r\n                    const pid = queue.shift()!;\r\n                    tasks.forEach((candidate) => {\r\n                      const deps = (candidate.depends ?? []).map((d: string) => d.toUpperCase());\r\n                      if (deps.includes(pid)) {\r\n                        const cid = ((candidate.id ?? \"\") as string).toUpperCase();\r\n                        if (!seen.has(cid)) {\r\n                          seen.add(cid);\r\n                          desc.push(candidate);\r\n                          queue.push(cid);   // explore deeper levels\r\n                        }\r\n                      }\r\n                    });\r\n                  }\r\n                  return desc;\r\n                };\r\n\r\n                let childTasks: any[] = [];\r\n\r\n                if (isStory) {\r\n                  /* Only direct SB‑children for Stories */\r\n                  childTasks = tasks.filter((candidate) => {\r\n                    const deps = (candidate.depends ?? []).map((d: string) => d.toUpperCase());\r\n                    if (!deps.includes(idUp)) return false;\r\n                    const cid = ((candidate.id ?? \"\") as string).toUpperCase();\r\n                    return cid.startsWith(\"SB\");\r\n                  });\r\n                } else if (isEpic) {\r\n                  /* All descendant tasks across every depth for Epics */\r\n                  childTasks = gatherDescendants(idUp).filter((cand) => {\r\n                    const cid = ((cand.id ?? \"\") as string).toUpperCase();\r\n                    return cid.startsWith(\"SB\");          // only SB‑tasks\r\n                  });\r\n                }\r\n\r\n                if (childTasks.length > 0) {\r\n                  const doneCnt = childTasks.filter(isTaskDone).length;\r\n                  taskText = `${doneCnt} / ${childTasks.length}`;\r\n                }\r\n              }\r\n              tRow.createEl(\"td\", { text: taskText });\r\n            })();\r\n          }\r\n\r\n          /* Status + dates — mirror Timeline logic */\r\n          const taskDueIso = ((t as any).props?.[\"due\"] ?? \"\")\r\n            .toString()\r\n            .replace(/\\u00A0/g, \" \")\r\n            .trim();\r\n\r\n          const taskStartIso = ((t as any).props?.[\"start\"] ?? \"\")\r\n            .toString()\r\n            .replace(/\\u00A0/g, \" \")\r\n            .trim();\r\n\r\n          /* prefer due::, fall back to start:: */\r\n          const taskDue = taskDueIso || taskStartIso || undefined;\r\n\r\n          /* last‑modified: note file mtime if present */\r\n          const taskMtime =\r\n            (t as any).file?.stat?.mtime ??\r\n            (t as any).mtime ??\r\n            (t as any).updated ??\r\n            undefined;\r\n\r\n          /* Status badge logic: any task at 100 % or marked done ⇒ Completed */\r\n          const pctForStatus = (done || tPct === 100) ? 1 : (tPct / 100);\r\n          const { label: tLabel0, cls: tCls0 } = projectStatus(taskDue, pctForStatus);\r\n\r\n          /* Force label “Completed” when pct == 100 */\r\n          const tLabel = (tPct === 100) ? \"Completed\" : tLabel0;\r\n          const tCls   = (tPct === 100) ? \"complete\"   : tCls0;\r\n\r\n          /* Status */\r\n          const sTd = tRow.createEl(\"td\");\r\n\r\n          // Only render play/pause button and status dot logic for SB-tasks\r\n          if (t?.id?.toUpperCase().startsWith(\"SB\")) {\r\n            // Wrapper div for all status elements (badge, dot, button)\r\n            const statusWrapper = sTd.createDiv({ cls: \"pm-status-cell-wrapper\" });\r\n\r\n            // Status badge (copied from Dashboard)\r\n            statusWrapper.createEl(\"span\", { cls: `pm-badge ${tCls}`, text: tLabel });\r\n            attachStatusPopup(statusWrapper, statusTooltip(taskDueIso || taskStartIso, pctForStatus));\r\n\r\n            // Status dot\r\n            if (t.status === \"in-progress\") {\r\n              statusWrapper.createEl(\"span\", { text: \"●\", cls: \"pm-in-progress-dot\" });\r\n            } else if (t.status === \"on-hold\") {\r\n              statusWrapper.createEl(\"span\", { text: \"●\", cls: \"pm-on-hold-dot\" });\r\n            }\r\n\r\n            // Determine task status for play/pause icon\r\n            let taskStatusVal: \"not-started\" | \"in-progress\" | \"on-hold\" | \"done\" = \"not-started\";\r\n            if (typeof t.status === \"string\") {\r\n              const s = t.status.toLowerCase();\r\n              if ([\"done\", \"complete\", \"completed\"].includes(s)) {\r\n                taskStatusVal = \"done\";\r\n              } else if (s === \"in-progress\") {\r\n                taskStatusVal = \"in-progress\";\r\n              } else if (s === \"on-hold\") {\r\n                taskStatusVal = \"on-hold\";\r\n              }\r\n            }\r\n\r\n            // Play/pause button (only if not done)\r\n            if (taskStatusVal !== \"done\") {\r\n              const iconBtn = statusWrapper.createEl(\"span\", { cls: `pm-status-btn ${taskStatusVal}` });\r\n              iconBtn.style.cursor = \"pointer\";\r\n              setIcon(iconBtn, taskStatusVal === \"in-progress\" ? \"pause\" : \"play\");\r\n              \r\n              // Add custom tooltip for play/pause button\r\n              let tooltip: HTMLElement | null = null;\r\n              iconBtn.addEventListener(\"mouseenter\", () => {\r\n                tooltip = document.createElement(\"div\");\r\n                tooltip.className = \"pm-dash-tooltip\";\r\n                tooltip.textContent = taskStatusVal === \"in-progress\" ? \"Mark as on hold\" : \"Mark as in progress\";\r\n                document.body.appendChild(tooltip);\r\n                const rect = iconBtn.getBoundingClientRect();\r\n                tooltip.style.left = `${rect.left}px`;\r\n                tooltip.style.top = `${rect.top - 30}px`;\r\n              });\r\n              const hideTooltip = () => { tooltip?.remove(); tooltip = null; };\r\n              iconBtn.addEventListener(\"mouseleave\", hideTooltip);\r\n              document.addEventListener(\"scroll\", hideTooltip, { capture: true, once: true });\r\n\r\n              iconBtn.onclick = async (ev) => {\r\n                ev.stopPropagation();\r\n                hideTooltip();\r\n                const file = (t as any).file;\r\n                if (!file) return;\r\n\r\n                const content = await this.app.vault.read(file);\r\n                const lines = content.split(/\\r?\\n/);\r\n                const checkboxRegex = /\\[[ xX\\/-]\\]/;\r\n\r\n                // Find the task line\r\n                let lineIdx = typeof t.line === \"number\" ? t.line : -1;\r\n                if (!(lineIdx >= 0 && checkboxRegex.test(lines[lineIdx]))) {\r\n                  lineIdx = lines.findIndex(\r\n                    (line) => line.includes(t.text ?? \"\") && checkboxRegex.test(line)\r\n                  );\r\n                }\r\n\r\n                if (lineIdx >= 0) {\r\n                  const match = lines[lineIdx].match(/\\[[ xX\\/-]\\]/);\r\n                  if (match) {\r\n                    let replacement = match[0];\r\n                    if (replacement === \"[ ]\") replacement = \"[/]\";\r\n                    else if (replacement === \"[/]\") replacement = \"[-]\";\r\n                    else if (replacement === \"[-]\") replacement = \"[/]\";\r\n                    lines[lineIdx] = lines[lineIdx].replace(/\\[[ xX\\/-]\\]/, replacement);\r\n                    await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n                    this.render();\r\n                    const popup = iconBtn.closest(\".pm-status-popup\");\r\n                    if (popup) popup.remove();\r\n                    const tip = document.querySelector(\".pm-dash-tooltip\");\r\n                    if (tip) tip.remove();\r\n                  }\r\n                }\r\n              };\r\n            }\r\n          } else {\r\n            // For non-SB tasks, render only the default badge and status dot, no play/pause button.\r\n            sTd.createEl(\"span\", {\r\n              cls:  `pm-badge ${tCls}`,\r\n              text: tLabel,\r\n            });\r\n            // Add colored dot for status\r\n            if (t.status === \"in-progress\") {\r\n              sTd.createEl(\"span\", { text: \"●\", cls: \"pm-in-progress-dot\" });\r\n            } else if (t.status === \"on-hold\") {\r\n              sTd.createEl(\"span\", { text: \"●\", cls: \"pm-on-hold-dot\" });\r\n            }\r\n            attachStatusPopup(sTd, statusTooltip(taskDueIso || taskStartIso, pctForStatus));\r\n            // (No play/pause button for non-SB tasks)\r\n          }\r\n\r\n          /* Project column (link to project note) */\r\n          const projCell = tRow.createEl(\"td\", { cls: \"pm-text-muted\" });\r\n          if (t.projectPath) {\r\n            const link = projCell.createEl(\"a\", {\r\n              text: (t.projectName ?? \"—\").toString(),\r\n              href: t.projectPath,\r\n            });\r\n            link.style.cursor = \"pointer\";\r\n            link.style.color = \"var(--text-muted)\";\r\n            \r\n            // Ensure styles are applied after a brief delay\r\n            setTimeout(() => {\r\n              link.style.color = \"var(--text-muted)\";\r\n            }, 10);\r\n            \r\n            link.addEventListener(\"mouseenter\", () => {\r\n              link.style.color = \"var(--interactive-accent)\";\r\n            });\r\n            link.addEventListener(\"mouseleave\", () => {\r\n              link.style.color = \"var(--text-muted)\";\r\n            });\r\n            \r\n            link.onclick = (e) => {\r\n              e.preventDefault();\r\n              this.app.workspace.openLinkText(t.projectPath, \"\", false);\r\n            };\r\n            /* Hover tooltip showing project front‑matter */\r\n            let projHover: HTMLElement | null = null;\r\n\r\n            link.addEventListener(\"mouseenter\", () => {\r\n              /* Front‑matter: prefer full file cache (if TFile is ready),\r\n                 else fall back to path cache.                                   */\r\n              const tFile = this.app.vault.getFileByPath(t.projectPath);\r\n              const fm: Record<string, any> =\r\n                (tFile instanceof TFile\r\n                  ? this.app.metadataCache.getFileCache(tFile)?.frontmatter\r\n                  : undefined) ??\r\n                this.app.metadataCache.getCache(t.projectPath)?.frontmatter ??\r\n                {};\r\n\r\n              /* Normalise keys: ignore case, spaces, underscores                */\r\n              const fmVal = (k: string) => {\r\n                const norm  = (s: string) => s.replace(/[\\s_]+/g, \"\").toLowerCase();\r\n                const target = norm(k);\r\n                for (const key in fm) {\r\n                  if (norm(key) === target) return fm[key];\r\n                }\r\n                return \"—\";\r\n              };\r\n\r\n              /* Always show name; append meta only if front‑matter present */\r\n              let html = `<strong>${t.projectName}</strong>`;\r\n\r\n              if (Object.keys(fm).length > 0) {\r\n                html += `<br><em>${fmVal(\"description\")}</em>\r\n                         <br><span>Start: ${fmVal(\"start date\")}</span>\r\n                         <br><span>Due  : ${fmVal(\"end date\") || fmVal(\"due date\")}</span>`;\r\n              }\r\n\r\n              projHover = document.createElement(\"div\");\r\n              projHover.className = \"pm-dash-tooltip\";\r\n              projHover.innerHTML = html;\r\n              document.body.appendChild(projHover);\r\n\r\n              /* Position tooltip beside link, stay on screen */\r\n              const r   = link.getBoundingClientRect();\r\n              const pad = 8;\r\n              const hdr = 40;\r\n              \r\n              let left = r.right + pad;\r\n              let top = Math.max(r.top, hdr + pad);\r\n              \r\n              /* Prevent horizontal overflow */\r\n              if (left + projHover.offsetWidth > window.innerWidth - pad) {\r\n                left = Math.max(r.left - pad - projHover.offsetWidth, pad);\r\n              }\r\n              if (left < pad) {\r\n                left = pad;\r\n              }\r\n              \r\n              /* Prevent vertical overflow */\r\n              if (top + projHover.offsetHeight > window.innerHeight - pad) {\r\n                const above = r.top - projHover.offsetHeight - pad;\r\n                top = above >= pad ? above : Math.max(window.innerHeight - projHover.offsetHeight - pad, pad);\r\n              }\r\n              if (top < pad) {\r\n                top = pad;\r\n              }\r\n              \r\n              projHover.style.left = `${left}px`;\r\n              projHover.style.top = `${top}px`;\r\n            });\r\n\r\n            link.addEventListener(\"mouseleave\", () => {\r\n              projHover?.remove();\r\n              projHover = null;\r\n            });\r\n          } else {\r\n            projCell.setText((t.projectName ?? \"—\").toString());\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.cache.projects.size === 0) {\r\n      this.container.createEl(\"p\", {\r\n        text: `No project notes found (front-matter \\`${this.settings.projectFlagProperty}: true\\`).`,\r\n      });\r\n    }\r\n\r\n    // Update caret icon based on current state after processing all weeks\r\n    setIcon(globalCaret, this.allCollapsed() ? \"chevron-right\" : \"chevron-down\");\r\n  }\r\n\r\n  public focusSearch() {\r\n  this.container\r\n    .querySelector<HTMLInputElement>(\".pm-search-input\")\r\n    ?.focus();\r\n  }\r\n}","import {\r\n  ItemView,\r\n  WorkspaceLeaf,\r\n  setIcon,\r\n  Notice,\r\n} from \"obsidian\";\r\nimport { TFile } from \"obsidian\";\r\n/* Moment.js is available globally in Obsidian */\r\ndeclare const moment: any;\r\nimport type { ViewStateResult } from \"obsidian\";\r\nimport { ProjectCache, TaskItem, ProjectEntry } from \"../services/cache\";\r\nimport { PmSettings } from \"../../settings\";\r\n\r\n// Extended task interface for resources view\r\ninterface ExtendedTaskItem extends TaskItem {\r\n  done?: boolean | string;\r\n  percentComplete?: number;\r\n  raw?: string;\r\n}\r\n\r\n/* ── Minimal in‑memory resource registry (people only) ─────────── */\r\ninterface PersonResource {\r\n  id: string;\r\n  name: string;\r\n  weeklyCapacity: number;\r\n  skills?: string[];\r\n}\r\n\r\nclass ResourceRegistry {\r\n  private people = new Map<string, PersonResource>();\r\n\r\n  listPeople(): PersonResource[] { return Array.from(this.people.values()); }\r\n\r\n  addPerson(p: PersonResource) { this.people.set(p.id.toLowerCase(), p); }\r\n}\r\n\r\n/** Singleton registry (replace later with real data load) */\r\nexport const registry = new ResourceRegistry();\r\n\r\n// Load dashboard-specific stylesheet\r\nimport \"../../styles/styles-resources.css\";\r\n\r\n/** Helper: format a date or return an em-dash if undefined */\r\nfunction formatDate(d: string | number | Date | undefined): string {\r\n  if (!d) return \"—\";\r\n  return new Date(d).toLocaleDateString();\r\n}\r\n\r\n/** \"2025-W27\" → \"W27 2025 (30 Jun – 6 Jul)\" */\r\nfunction weekLabel(key: string): string {\r\n  const m = key.match(/^(\\d{4})-W(\\d{2})$/);\r\n  if (!m) return key;\r\n  const [ , yr, wk ] = m;\r\n  // @ts-ignore moment global\r\n  const start = moment().isoWeekYear(+yr).isoWeek(+wk).startOf(\"isoWeek\");\r\n  const end   = start.clone().endOf(\"isoWeek\");\r\n  return `W${wk} ${yr} (${start.format(\"D MMM\")} – ${end.format(\"D MMM\")})`;\r\n}\r\n\r\n/** Helper: determine status badge label and CSS class */\r\nfunction projectStatus(\r\n  nextDue?: string,\r\n  pct = 0\r\n): { label: string; cls: string } {\r\n  if (pct >= 1) return { label: \"Completed\", cls: \"complete\" };\r\n  if (!nextDue) return { label: \"On track\", cls: \"on-track\" };\r\n\r\n  const today   = new Date();\r\n  const due     = new Date(nextDue);\r\n  const msInDay = 86_400_000;\r\n  const diff    = (due.getTime() - today.getTime()) / msInDay;\r\n\r\n  if (diff < 0)  return { label: \"Off track\", cls: \"off-track\" }; // red\r\n  if (diff <= 10) return { label: \"Warning\",  cls: \"warning\"   }; // orange\r\n  return { label: \"On track\", cls: \"on-track\" };\r\n}\r\n\r\n/** Progress bar colour bucket */\r\nfunction progressClass(pct: number): string {\r\n  if (pct >= 100) return \"done\";\r\n  if (pct >= 75)  return \"high\";\r\n  if (pct >= 40)  return \"medium\";\r\n  return \"low\";\r\n}\r\n\r\n/** Tooltip explaining status (same logic as Task Weeks view) */\r\nfunction statusTooltip(nextDue?: string, pct = 0): string {\r\n  if (pct >= 1) return \"Task reached 100 % completion\";\r\n  if (!nextDue) return \"No due date set\";\r\n  const today   = new Date();\r\n  const due     = new Date(nextDue);\r\n  const msInDay = 86_400_000;\r\n  const diff    = Math.ceil((due.getTime() - today.getTime()) / msInDay);\r\n\r\n  if (diff < 0)  return `Past due by ${-diff} day${diff === -1 ? \"\" : \"s\"} (due ${formatDate(due)})`;\r\n  if (diff === 0) return \"Due today\";\r\n  if (diff <= 10) return `Due in ${diff} day${diff === 1 ? \"\" : \"s\"} (${formatDate(due)})`;\r\n  return `Due on ${formatDate(due)}`;\r\n}\r\n\r\n/** Detect whether a task is completed */\r\nfunction isTaskDone(t: ExtendedTaskItem): boolean {\r\n  /* explicit flags from parsers */\r\n  if (t.done === true || t.checked === true) return true;\r\n  if (typeof t.done === \"string\" && t.done.toLowerCase() === \"done\") return true;\r\n\r\n  /* explicit status strings */\r\n  if (typeof t.status === \"string\") {\r\n    const s = t.status.toLowerCase();\r\n    if ([\"done\", \"complete\", \"completed\"].includes(s)) return true;\r\n  }\r\n\r\n  /* percent-complete field */\r\n  if (typeof t.percentComplete === \"number\" && t.percentComplete >= 1) return true;\r\n\r\n  /* markdown checkbox or bullet */\r\n  const raw = (t.raw ?? t.text ?? \"\").toString();\r\n  if (/^\\s*-\\s*\\[[xX]\\]/.test(raw)) return true;\r\n\r\n  /* completed:: 2025‑05‑01 inline field or front‑matter */\r\n  if (t.props?.completed || t.props?.[\"completionDate\"]) return true;\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Return tasks ordered as in Timeline:\r\n *   • Epics (E‑) first\r\n *   • then Stories (S‑) each followed by their SB‑ sub‑tasks\r\n *   • anything else afterwards in original order\r\n */\r\nfunction orderTasksDash(tasks: ExtendedTaskItem[]): ExtendedTaskItem[] {\r\n  const done = new Set<ExtendedTaskItem>();\r\n  const out: ExtendedTaskItem[] = [];\r\n\r\n  /** quick helpers */\r\n  const idLower = (t: ExtendedTaskItem) => t.id.toLowerCase();\r\n  const isEpic  = (t: ExtendedTaskItem) => idLower(t).startsWith(\"e\");\r\n  const isStory = (t: ExtendedTaskItem) =>\r\n    idLower(t).startsWith(\"s\") && !idLower(t).startsWith(\"sb\");\r\n  const isSub   = (t: ExtendedTaskItem) => idLower(t).startsWith(\"sb\");\r\n\r\n  /** map Story‑id → [sub‑tasks]  (reuse existing Story column + depends logic) */\r\n  const subsByStory = new Map<string, ExtendedTaskItem[]>();\r\n  const stripType = (raw: string) =>\r\n    raw.trim().toLowerCase().replace(/^(fs|ss|ff|sf):/, \"\"); // drop link‑type\r\n\r\n  tasks.forEach(t => {\r\n    if (!isSub(t)) return;\r\n\r\n    /* 1️⃣  Preferred: explicit Story column */\r\n    let storyKey = (t.props[\"story\"] ?? \"\").toString().trim();\r\n    storyKey = storyKey ? storyKey.toLowerCase() : \"\";\r\n\r\n    /* 2️⃣  Fallback: first depends:: entry, minus any FS/SS/FF/SF prefix */\r\n    if (!storyKey && Array.isArray(t.depends) && t.depends.length) {\r\n      storyKey = stripType(String(t.depends[0]));\r\n    }\r\n\r\n    if (!storyKey) return;\r\n\r\n    if (!subsByStory.has(storyKey)) subsByStory.set(storyKey, []);\r\n    subsByStory.get(storyKey)!.push(t);\r\n  });\r\n\r\n  /** map Epic‑id → [stories] (Story.Epic column) */\r\n  const storiesByEpic = new Map<string, ExtendedTaskItem[]>();\r\n  tasks.forEach(t => {\r\n    if (!isStory(t)) return;\r\n    const epicField = (t.props[\"epic\"] ?? \"\").toString().trim().toLowerCase();\r\n    if (!epicField) return;\r\n    if (!storiesByEpic.has(epicField)) storiesByEpic.set(epicField, []);\r\n    storiesByEpic.get(epicField)!.push(t);\r\n  });\r\n\r\n  /** helper to push Story + its subs */\r\n  const pushStoryWithSubs = (s: ExtendedTaskItem) => {\r\n    if (done.has(s)) return;\r\n    done.add(s);\r\n    out.push(s);\r\n    const kids = subsByStory.get(idLower(s));\r\n    if (kids) kids.forEach(k => {\r\n      if (!done.has(k)) {\r\n        done.add(k);\r\n        out.push(k);\r\n      }\r\n    });\r\n  };\r\n\r\n  /** 1️⃣ Epics in original order, each followed by its Stories + Subs */\r\n  tasks.forEach(t => {\r\n    if (!isEpic(t) || done.has(t)) return;\r\n    done.add(t);\r\n    out.push(t);\r\n    const stories = storiesByEpic.get(idLower(t));\r\n    if (stories) {\r\n      stories.forEach(pushStoryWithSubs);\r\n    }\r\n  });\r\n\r\n  /** 2️⃣ Standalone Stories (no Epic) */\r\n  tasks.forEach(t => {\r\n    if (!isStory(t) || done.has(t)) return;\r\n    pushStoryWithSubs(t);\r\n  });\r\n\r\n  /** 3️⃣ Remaining tasks (subs w/out story, plain rows, etc.) */\r\n  tasks.forEach(t => {\r\n    if (!done.has(t)) {\r\n      done.add(t);\r\n      out.push(t);\r\n    }\r\n  });\r\n\r\n  return out;\r\n}\r\n\r\nexport const VIEW_TYPE_PM_RESOURCES = \"pm-resources-view\";\r\n\r\nexport class ResourcesView extends ItemView {\r\n  /** icon shown on the view tab */\r\n  public icon = \"users\";\r\n  /** Optional set of project file paths to display (injected by Portfolio view) */\r\n  private filterPaths?: Set<string>;\r\n  /** Optional name of the portfolio that opened this dashboard */\r\n  private filterName?: string;\r\n  /** The initial project paths passed in from Portfolio (null = no portfolio) */\r\n  private originalPaths: string[] | null = null;\r\n  private sortField: string | null = \"assignee\";\r\n  private sortAsc = true;\r\n  private collapsed = new Set<string>();\r\n  private collapsedProjects = new Set<string>();  // track collapsed project dividers\r\n  private firstRender = true;\r\n  private totalGroups = 0;        // number of week rows in current render\r\n  private currentPaths: string[] = [];   // paths (week keys) shown in latest render\r\n  private visibleGroupIds: string[] = [];   // ids of groups visible in the last render\r\n\r\n  private cache: ProjectCache;\r\n  private settings: PmSettings;\r\n  private container!: HTMLElement;\r\n  private detachFn: (() => void) | null = null;\r\n\r\n  private filterText = \"\";                 // live text in the quick-filter box\r\n  private filterAssignees?: Set<string>;   // filtered assignees (undefined = all)\r\n  private showEpics = true;                // show/hide epics\r\n  private showStories = true;              // show/hide stories\r\n  private showSubTasks = true;             // show/hide sub-tasks\r\n  private sortMode: 'project' | 'hierarchical' | 'alphabetical' = 'project';  // project grouping, hierarchical, or alphabetical\r\n\r\n  constructor(\r\n    leaf: WorkspaceLeaf,\r\n    cache: ProjectCache,\r\n    settings: PmSettings\r\n  ) {\r\n    super(leaf);\r\n    this.cache = cache;\r\n    this.settings = settings;\r\n  }\r\n\r\n  /** Called when leaf.setViewState({ state }) is invoked */\r\n  async setState(state: { filterProjects?: string[]; filterName?: string } | undefined, result: ViewStateResult): Promise<void> {\r\n    if (\r\n      state &&\r\n      Array.isArray(state.filterProjects) &&\r\n      state.filterProjects.length > 0\r\n    ) {\r\n      this.filterPaths   = new Set(state.filterProjects as string[]);\r\n      this.originalPaths = [...state.filterProjects];     // remember portfolio set\r\n    } else {\r\n      this.filterPaths   = undefined;          // empty array or undefined ⇒ show all\r\n      this.originalPaths = null;\r\n    }\r\n    if (typeof state?.filterName === \"string\" && state.filterName.trim() !== \"\") {\r\n      this.filterName = state.filterName.trim();\r\n    } else {\r\n      this.filterName = undefined;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Update project filter & re-render.\r\n      Pass `null` => show ALL projects.                         */\r\n  public updateFilter(paths: string[] | null, name = \"\") {\r\n    if (paths === null) {\r\n      /* Show ALL projects */\r\n      this.filterPaths = undefined;\r\n    } else if (Array.isArray(paths)) {\r\n      /* Show NONE if empty array, else selected set */\r\n      this.filterPaths = paths.length ? new Set(paths) : new Set<string>();\r\n    }\r\n    this.filterName = name;\r\n    this.render();\r\n  }\r\n\r\n  getViewType(): string {\r\n    return VIEW_TYPE_PM_RESOURCES;\r\n  }\r\n  getDisplayText(): string {\r\n    return this.filterName\r\n      ? `Resources – ${this.filterName}`\r\n      : \"Resources\";\r\n  }\r\n\r\n  getIcon(): string {\r\n    return \"users\";\r\n  }\r\n\r\n  async onOpen() {\r\n    this.container = this.contentEl;\r\n\r\n    /* Apply initial filterProjects / filterName passed via view‑state */\r\n    const st = (this.leaf.getViewState() as any).state ?? {};\r\n    if (Array.isArray(st.filterProjects) && st.filterProjects.length) {\r\n      this.filterPaths   = new Set(st.filterProjects);\r\n      this.originalPaths = [...st.filterProjects];        // keep original list\r\n    } else {\r\n      this.filterPaths   = undefined;\r\n      this.originalPaths = null;\r\n    }\r\n    this.filterName = typeof st.filterName === \"string\" ? st.filterName.trim() : \"\";\r\n\r\n    this.render();\r\n    this.detachFn = this.cache.onChange(() => this.render());\r\n  }\r\n  async onClose() {\r\n    this.detachFn?.();\r\n  }\r\n\r\n  /** Returns true if every project row is collapsed */\r\n  private allCollapsed(): boolean {\r\n    return this.totalGroups > 0 && this.collapsed.size === this.totalGroups;\r\n  }\r\n\r\n  /** Collapse or expand all projects at once */\r\n  private toggleAll() {\r\n    const visible = this.visibleGroupIds;\r\n    const allCollapsed = visible.length > 0 && visible.every(id => this.collapsed.has(id));\r\n    if (allCollapsed) {\r\n      visible.forEach(id => this.collapsed.delete(id));\r\n    } else {\r\n      visible.forEach(id => this.collapsed.add(id));\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Check if all currently visible projects are collapsed */\r\n  private areAllProjectsCollapsed(): boolean {\r\n    if (this.sortMode !== 'project' && this.sortMode !== 'hierarchical') {\r\n      return false; // Not applicable for alphabetical mode\r\n    }\r\n    \r\n    // Get all unique project names from the currently visible/filtered data\r\n    const visibleProjectNames = new Set<string>();\r\n    \r\n    // Get filtered projects (same logic as in render method)\r\n    let projects: any[] = Array.from(this.cache.projects.values())\r\n      .sort((a, b) => a.file.basename.localeCompare(b.file.basename))\r\n      .filter((p) => !this.filterPaths || this.filterPaths.has(p.file.path));\r\n\r\n    projects.forEach((proj: any) => {\r\n      (proj as any).tasks?.forEach((t: any) => {\r\n        const projectName = proj.file?.basename ?? proj.name ?? \"Untitled\";\r\n        visibleProjectNames.add(projectName);\r\n      });\r\n    });\r\n    \r\n    // Check if all visible projects are in the collapsed set\r\n    return visibleProjectNames.size > 0 && Array.from(visibleProjectNames).every(projectName => \r\n      this.collapsedProjects.has(projectName)\r\n    );\r\n  }\r\n\r\n  /** Collapse all currently visible projects */\r\n  private collapseAllProjects(): void {\r\n    if (this.sortMode !== 'project' && this.sortMode !== 'hierarchical') {\r\n      return; // Not applicable for alphabetical mode\r\n    }\r\n    \r\n    // Only add project names that are currently visible/filtered\r\n    const visibleProjectNames = new Set<string>();\r\n    \r\n    // Get filtered projects (same logic as in render method)\r\n    let projects: any[] = Array.from(this.cache.projects.values())\r\n      .sort((a, b) => a.file.basename.localeCompare(b.file.basename))\r\n      .filter((p) => !this.filterPaths || this.filterPaths.has(p.file.path));\r\n\r\n    projects.forEach((proj: any) => {\r\n      (proj as any).tasks?.forEach((t: any) => {\r\n        const projectName = proj.file?.basename ?? proj.name ?? \"Untitled\";\r\n        visibleProjectNames.add(projectName);\r\n      });\r\n    });\r\n    \r\n    // Only add visible project names to the collapsed set\r\n    visibleProjectNames.forEach(projectName => {\r\n      this.collapsedProjects.add(projectName);\r\n    });\r\n  }\r\n\r\n  /** Toggle fold / unfold for one project and re-render */\r\n  private toggle(path: string) {\r\n    if (this.collapsed.has(path)) this.collapsed.delete(path);\r\n    else this.collapsed.add(path);\r\n    this.render();\r\n  }\r\n\r\n  private render() {\r\n    this.container.empty();\r\n    this.container.addClass(\"pm-resources-view\");\r\n\r\n    // Clear any lingering tooltips and status popups\r\n    document.querySelectorAll('.pm-dash-tooltip').forEach((el) => el.remove());\r\n    document.querySelectorAll('.pm-status-popup').forEach((el) => el.remove());\r\n\r\n    /* ── Fold/Unfold top bar ───────────────────────── */\r\n    const topbar = this.container.createEl(\"div\", { cls: \"pm-dash-topbar\" });\r\n    const globalCaret = topbar.createEl(\"span\");\r\n    globalCaret.style.cursor = \"pointer\";\r\n    globalCaret.setAttr(\"aria-label\", \"Toggle all groups\");\r\n    setIcon(globalCaret, \"chevron-right\");\r\n    globalCaret.onclick = () => this.toggleAll();\r\n    topbar.createEl(\"span\", { text: \"Resources\" });\r\n\r\n    /* Task sorting toggle */\r\n    const sortToggle = topbar.createEl(\"button\", { \r\n      cls: \"pm-mode-toggle\"\r\n    });\r\n    setIcon(sortToggle, this.sortMode === 'project' ? 'folder' : this.sortMode === 'hierarchical' ? 'list-tree' : 'sort-asc');\r\n    \r\n    // Custom tooltip functionality\r\n    let tooltip: HTMLElement | null = null;\r\n    let tooltipTimeout: NodeJS.Timeout | null = null;\r\n    \r\n    const showTooltip = (event: MouseEvent) => {\r\n      if (tooltip) return;\r\n      \r\n      tooltip = document.createElement('div');\r\n      tooltip.className = 'pm-dash-tooltip';\r\n      tooltip.textContent = this.sortMode === 'project' \r\n        ? \"Currently grouping by project. Click for hierarchical sorting.\"\r\n        : this.sortMode === 'hierarchical'\r\n        ? \"Currently sorting hierarchically. Click for alphabetical sorting.\"\r\n        : \"Currently sorting alphabetically. Click for project grouping.\";\r\n      \r\n      document.body.appendChild(tooltip);\r\n      \r\n      // Position tooltip near the button\r\n      const rect = (event.target as HTMLElement).getBoundingClientRect();\r\n      tooltip.style.left = `${rect.left}px`;\r\n      tooltip.style.top = `${rect.bottom + 8}px`;\r\n    };\r\n    \r\n    const hideTooltip = () => {\r\n      if (tooltip) {\r\n        tooltip.remove();\r\n        tooltip = null;\r\n      }\r\n      if (tooltipTimeout) {\r\n        clearTimeout(tooltipTimeout);\r\n        tooltipTimeout = null;\r\n      }\r\n    };\r\n    \r\n    sortToggle.addEventListener('mouseenter', (event) => {\r\n      tooltipTimeout = setTimeout(() => showTooltip(event), 500);\r\n    });\r\n    \r\n    sortToggle.addEventListener('mouseleave', hideTooltip);\r\n    \r\n    sortToggle.onclick = () => {\r\n      hideTooltip();\r\n      // Cycle through the three modes: project → hierarchical → alphabetical → project\r\n      this.sortMode = this.sortMode === 'project' ? 'hierarchical' : \r\n                     this.sortMode === 'hierarchical' ? 'alphabetical' : 'project';\r\n      setIcon(sortToggle, this.sortMode === 'project' ? 'folder' : this.sortMode === 'hierarchical' ? 'list-tree' : 'sort-asc');\r\n      this.render();\r\n    };\r\n\r\n    /* Global project collapse/expand toggle */\r\n    const globalProjectToggle = topbar.createEl(\"button\", { \r\n      cls: \"pm-mode-toggle\"\r\n    });\r\n    setIcon(globalProjectToggle, \"chevrons-down-up\");\r\n    \r\n    // Global project toggle tooltip\r\n    let globalTooltip: HTMLElement | null = null;\r\n    let globalTooltipTimeout: NodeJS.Timeout | null = null;\r\n    \r\n    const showGlobalTooltip = (event: MouseEvent) => {\r\n      if (globalTooltip) return;\r\n      \r\n      globalTooltip = document.createElement('div');\r\n      globalTooltip.className = 'pm-dash-tooltip';\r\n      globalTooltip.textContent = \"Toggle all projects expand/collapse\";\r\n      \r\n      document.body.appendChild(globalTooltip);\r\n      \r\n      const rect = (event.target as HTMLElement).getBoundingClientRect();\r\n      globalTooltip.style.left = `${rect.left}px`;\r\n      globalTooltip.style.top = `${rect.bottom + 8}px`;\r\n    };\r\n    \r\n    const hideGlobalTooltip = () => {\r\n      if (globalTooltip) {\r\n        globalTooltip.remove();\r\n        globalTooltip = null;\r\n      }\r\n      if (globalTooltipTimeout) {\r\n        clearTimeout(globalTooltipTimeout);\r\n        globalTooltipTimeout = null;\r\n      }\r\n    };\r\n    \r\n    globalProjectToggle.addEventListener('mouseenter', (event) => {\r\n      globalTooltipTimeout = setTimeout(() => showGlobalTooltip(event), 500);\r\n    });\r\n    \r\n    globalProjectToggle.addEventListener('mouseleave', hideGlobalTooltip);\r\n    \r\n    globalProjectToggle.onclick = () => {\r\n      hideGlobalTooltip();\r\n      \r\n      // Preserve scroll position\r\n      const tableContainer = this.container.querySelector('.pm-table-container');\r\n      const scrollTop = tableContainer?.scrollTop || 0;\r\n      const scrollHeight = tableContainer?.scrollHeight || 0;\r\n      \r\n      // Check if all projects are currently collapsed\r\n      const allCollapsed = this.areAllProjectsCollapsed();\r\n      \r\n      if (allCollapsed) {\r\n        // Expand all projects\r\n        this.collapsedProjects.clear();\r\n      } else {\r\n        // Collapse all projects\r\n        this.collapseAllProjects();\r\n      }\r\n      \r\n      this.render();\r\n      \r\n      // Restore scroll position with adjustment for content height changes\r\n      const restoreScroll = () => {\r\n        const newTableContainer = this.container.querySelector('.pm-table-container');\r\n        if (newTableContainer) {\r\n          const newScrollHeight = newTableContainer.scrollHeight;\r\n          const heightRatio = scrollHeight > 0 ? newScrollHeight / scrollHeight : 1;\r\n          const adjustedScrollTop = scrollTop * heightRatio;\r\n          newTableContainer.scrollTop = adjustedScrollTop;\r\n        }\r\n      };\r\n      \r\n      // Try immediately, then with delays\r\n      restoreScroll();\r\n      setTimeout(restoreScroll, 10);\r\n      setTimeout(restoreScroll, 50);\r\n      setTimeout(restoreScroll, 100);\r\n    };\r\n\r\n    /* Task filter input now lives in the top bar */\r\n    const searchInput = topbar.createEl(\"input\", {\r\n      type: \"search\",\r\n      placeholder: \"Filter tasks…\",\r\n      cls: \"pm-search-input\",\r\n      value: this.filterText,\r\n    });\r\n\r\n    searchInput.oninput = () => {\r\n      this.filterText = searchInput.value.toLowerCase();\r\n      const caretPos = searchInput.selectionStart ?? searchInput.value.length;\r\n      this.render();\r\n\r\n      const again = this.container.querySelector<HTMLInputElement>(\".pm-search-input\");\r\n      if (again) {\r\n        again.focus();\r\n        again.setSelectionRange(caretPos, caretPos);\r\n      }\r\n    };\r\n\r\n    /* ── Projects dropdown (checkbox list) ─────────────────── */\r\n    const projBtn = topbar.createEl(\"button\", { cls: \"pm-proj-btn\" });\r\n    /* Label */\r\n    projBtn.createSpan({ text: \"Projects \" });\r\n    /* Lucide chevron-down icon */\r\n    const caret = projBtn.createSpan();\r\n    setIcon(caret, \"chevron-down\");\r\n\r\n    let ddOpen = false;\r\n    let ddEl: HTMLElement | null = null;\r\n\r\n    const buildDropdown = (projectList: any[]) => {\r\n      ddEl = document.createElement(\"div\");\r\n      ddEl.className = \"pm-proj-dd\";\r\n\r\n      /* Select/Deselect controls */\r\n      const controls = ddEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n      /* ALL */\r\n      controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        /* Keep current portfolio name so middle option remains visible */\r\n        this.updateFilter(null, this.filterName ?? \"\");\r\n      };\r\n\r\n      /* PORTFOLIO (only if originalPaths present) */\r\n      if (this.originalPaths && this.originalPaths.length) {\r\n        controls.createSpan({ text: \" | \" });\r\n        controls.createEl(\"a\", { text: this.filterName ?? \"Portfolio\" }).onclick = (e) => {\r\n          e.preventDefault();\r\n          this.updateFilter([...this.originalPaths!], this.filterName ?? \"\");\r\n        };\r\n      }\r\n\r\n      /* NONE */\r\n      controls.createSpan({ text: \" | \" });\r\n      controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        /* Preserve portfolio name so the middle option stays visible */\r\n        this.updateFilter([], this.filterName ?? \"\");\r\n      };\r\n\r\n      /* Checkbox list */\r\n      projectList.forEach((p: any) => {\r\n        const wrap = ddEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n        const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n        cb.style.cursor = \"pointer\";\r\n        cb.style.marginRight = \"8px\";\r\n        cb.style.display = \"inline-block\";\r\n        cb.style.width = \"16px\";\r\n        cb.style.height = \"16px\";\r\n        \r\n        const isChecked = !this.filterPaths || this.filterPaths.has(p.file.path);\r\n        setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n        \r\n        // Store the project path on the element for easy access\r\n        cb.setAttribute(\"data-project-path\", p.file.path);\r\n        cb.setAttribute(\"data-checked\", isChecked.toString());\r\n        \r\n        wrap.createSpan({ text: p.file.basename });\r\n        \r\n        wrap.onclick = (e) => {\r\n          e.stopPropagation(); // Prevent dropdown from closing\r\n          const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n          const newChecked = !currentChecked;\r\n          \r\n          cb.setAttribute(\"data-checked\", newChecked.toString());\r\n          setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n          \r\n          /* gather all check icons to compute new filter */\r\n          const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\"));\r\n          const selected = checkIcons\r\n            .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n            .map(icon => icon.getAttribute(\"data-project-path\")!);\r\n\r\n          this.updateFilter(selected.length === projectList.length ? null : selected);\r\n        };\r\n      });\r\n\r\n      document.body.appendChild(ddEl);\r\n\r\n      /* Position dropdown and ensure it stays within the viewport */\r\n      const r   = projBtn.getBoundingClientRect();\r\n      const pad = 4;                           // minimal gap from window edges\r\n\r\n      let left = r.left;\r\n      let top  = r.bottom + pad;               // default: just below button\r\n\r\n      /* Measure after insertion */\r\n      const ddW = ddEl.offsetWidth  || 240;\r\n      const ddH = ddEl.offsetHeight || 260;\r\n\r\n      /* Prevent horizontal overflow */\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      } else if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      /* Prevent vertical overflow – if not enough space below, flip above;\r\n         if still too tall, clamp to bottom edge */\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        const above = r.top - ddH - pad;\r\n        top = above >= pad ? above\r\n                           : Math.max(window.innerHeight - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      ddEl.style.left = `${left}px`;\r\n      ddEl.style.top  = `${top}px`;\r\n    };\r\n\r\n    const closeDropdown = () => {\r\n      ddEl?.remove();\r\n      ddEl = null;\r\n      ddOpen = false;\r\n    };\r\n\r\n    projBtn.onclick = () => {\r\n      if (ddOpen) {\r\n        closeDropdown();\r\n        return;\r\n      }\r\n      ddOpen = true;\r\n\r\n      /* Build project list based on current cache + initial portfolio filter */\r\n      const projectList = Array.from(this.cache.projects.values())   // list every project\r\n        .sort((a, b) => a.file.basename.localeCompare(b.file.basename)); // sort A-Z\r\n      buildDropdown(projectList);\r\n\r\n      /* Close on outside click */\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (ddEl && !ddEl.contains(e.target as Node) && e.target !== projBtn) {\r\n          closeDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    /* ── Assignees dropdown (checkbox list) ─────────────────── */\r\n    const assigneesBtn = topbar.createEl(\"button\", { cls: \"pm-proj-btn\" });\r\n    /* Label */\r\n    assigneesBtn.createSpan({ text: \"Assignees \" });\r\n    /* Lucide chevron-down icon */\r\n    const assigneesCaret = assigneesBtn.createSpan();\r\n    setIcon(assigneesCaret, \"chevron-down\");\r\n\r\n    let assigneesDdOpen = false;\r\n    let assigneesDdEl: HTMLElement | null = null;\r\n\r\n    const buildAssigneesDropdown = (assigneesList: { id: string; name: string }[]) => {\r\n      assigneesDdEl = document.createElement(\"div\");\r\n      assigneesDdEl.className = \"pm-proj-dd\";\r\n\r\n      /* Select/Deselect controls */\r\n      const controls = assigneesDdEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n      /* ALL */\r\n      controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        this.filterAssignees = undefined;\r\n        this.render();\r\n      };\r\n\r\n      /* PORTFOLIO (only if originalPaths present) */\r\n      if (this.originalPaths && this.originalPaths.length) {\r\n        controls.createSpan({ text: \" | \" });\r\n        controls.createEl(\"a\", { text: this.filterName ?? \"Portfolio\" }).onclick = (e) => {\r\n          e.preventDefault();\r\n          // Filter assignees to only those who have tasks in the current portfolio projects\r\n          const portfolioAssignees = new Set<string>();\r\n          this.cache.projects.forEach((proj) => {\r\n            if (this.originalPaths!.includes(proj.file.path)) {\r\n              (proj as any).tasks?.forEach((t: any) => {\r\n                const raw = (t.assignee ?? t.props?.assignee ?? t.owner ?? t.props?.owner ?? \"Unassigned\").toString();\r\n                raw.split(\",\").forEach((s: string) => {\r\n                  const n = s.trim();\r\n                  if (n && n !== \"-\") {\r\n                    const cleaned = /^[-‑—–]+$/.test(n) ? \"Unassigned\" : n;\r\n                    portfolioAssignees.add(cleaned.toLowerCase());\r\n                  }\r\n                });\r\n              });\r\n            }\r\n          });\r\n          this.filterAssignees = portfolioAssignees.size > 0 ? portfolioAssignees : undefined;\r\n          this.render();\r\n        };\r\n      }\r\n\r\n      /* NONE */\r\n      controls.createSpan({ text: \" | \" });\r\n      controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        this.filterAssignees = new Set<string>();\r\n        this.render();\r\n      };\r\n\r\n      /* Checkbox list */\r\n      assigneesList.forEach((assignee) => {\r\n        const wrap = assigneesDdEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n        const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n        cb.style.cursor = \"pointer\";\r\n        cb.style.marginRight = \"8px\";\r\n        cb.style.display = \"inline-block\";\r\n        cb.style.width = \"16px\";\r\n        cb.style.height = \"16px\";\r\n        \r\n        const isChecked = !this.filterAssignees || this.filterAssignees.has(assignee.id);\r\n        setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n        \r\n        // Store the assignee id on the element for easy access\r\n        cb.setAttribute(\"data-assignee-id\", assignee.id);\r\n        cb.setAttribute(\"data-checked\", isChecked.toString());\r\n        \r\n        wrap.createSpan({ text: assignee.name });\r\n        \r\n        wrap.onclick = (e) => {\r\n          e.stopPropagation(); // Prevent dropdown from closing\r\n          const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n          const newChecked = !currentChecked;\r\n          \r\n          cb.setAttribute(\"data-checked\", newChecked.toString());\r\n          setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n          \r\n          /* gather all check icons to compute new filter */\r\n          const checkIcons = Array.from(assigneesDdEl!.querySelectorAll(\".pm-dd-check\"));\r\n          const selected = checkIcons\r\n            .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n            .map(icon => icon.getAttribute(\"data-assignee-id\")!);\r\n\r\n          this.filterAssignees = selected.length === assigneesList.length ? undefined : new Set(selected);\r\n          this.render();\r\n        };\r\n      });\r\n\r\n      document.body.appendChild(assigneesDdEl);\r\n\r\n      /* Position dropdown and ensure it stays within the viewport */\r\n      const r   = assigneesBtn.getBoundingClientRect();\r\n      const pad = 4;                           // minimal gap from window edges\r\n\r\n      let left = r.left;\r\n      let top  = r.bottom + pad;               // default: just below button\r\n\r\n      /* Measure after insertion */\r\n      const ddW = assigneesDdEl.offsetWidth  || 240;\r\n      const ddH = assigneesDdEl.offsetHeight || 260;\r\n\r\n      /* Prevent horizontal overflow */\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      } else if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      /* Prevent vertical overflow – if not enough space below, flip above;\r\n         if still too tall, clamp to bottom edge */\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        const above = r.top - ddH - pad;\r\n        top = above >= pad ? above\r\n                           : Math.max(window.innerHeight - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      assigneesDdEl.style.left = `${left}px`;\r\n      assigneesDdEl.style.top  = `${top}px`;\r\n    };\r\n\r\n    const closeAssigneesDropdown = () => {\r\n      assigneesDdEl?.remove();\r\n      assigneesDdEl = null;\r\n      assigneesDdOpen = false;\r\n    };\r\n\r\n    assigneesBtn.onclick = () => {\r\n      if (assigneesDdOpen) {\r\n        closeAssigneesDropdown();\r\n        return;\r\n      }\r\n      assigneesDdOpen = true;\r\n\r\n      /* Build assignees list from current cache */\r\n      const assigneesMap = new Map<string, string>();\r\n      this.cache.projects.forEach((proj) => {\r\n        (proj as any).tasks?.forEach((t: any) => {\r\n          const raw = (t.assignee ?? t.props?.assignee ?? t.owner ?? t.props?.owner ?? \"Unassigned\").toString();\r\n          raw.split(\",\").forEach((s: string) => {\r\n            const n = s.trim();\r\n            if (n && n !== \"-\") {\r\n              const cleaned = /^[-‑—–]+$/.test(n) ? \"Unassigned\" : n;\r\n              assigneesMap.set(cleaned.toLowerCase(), cleaned);\r\n            }\r\n          });\r\n        });\r\n      });\r\n      if (assigneesMap.size === 0) assigneesMap.set(\"unassigned\", \"Unassigned\");\r\n      \r\n      const assigneesList = Array.from(assigneesMap.entries())\r\n        .map(([id, name]) => ({ id, name }))\r\n        .sort((a, b) => a.name.localeCompare(b.name)); // sort A-Z\r\n      \r\n      buildAssigneesDropdown(assigneesList);\r\n\r\n      /* Close on outside click */\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (assigneesDdEl && !assigneesDdEl.contains(e.target as Node) && e.target !== assigneesBtn) {\r\n          closeAssigneesDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    /* ── Epic and Story visibility toggles ─────────────────── */\r\n    const epicIcon = topbar.createEl(\"span\", { cls: \"pm-toggle-icon\" });\r\n    epicIcon.style.marginLeft = \"8px\";\r\n    epicIcon.style.cursor = \"pointer\";\r\n    setIcon(epicIcon, \"crown\");\r\n    epicIcon.style.opacity = this.showEpics ? \"1\" : \"0.3\";\r\n    epicIcon.setAttr(\"aria-label\", this.showEpics ? \"Hide Epics\" : \"Show Epics\");\r\n    \r\n    // Epic icon tooltip\r\n    let epicTip: HTMLElement | null = null;\r\n    epicIcon.addEventListener(\"mouseenter\", () => {\r\n      if (epicTip) {\r\n        epicTip.remove();\r\n        epicTip = null;\r\n      }\r\n      epicTip = document.createElement(\"div\");\r\n      epicTip.classList.add(\"pm-dash-tooltip\");\r\n      epicTip.textContent = this.showEpics ? \"Hide Epics\" : \"Show Epics\";\r\n      document.body.appendChild(epicTip);\r\n      const r = epicIcon.getBoundingClientRect();\r\n      epicTip.style.left = `${r.left}px`;\r\n      epicTip.style.top = `${r.bottom + 6}px`;\r\n    });\r\n    epicIcon.addEventListener(\"mouseleave\", () => { \r\n      if (epicTip) {\r\n        epicTip.remove(); \r\n        epicTip = null; \r\n      }\r\n    });\r\n    \r\n    epicIcon.onclick = () => {\r\n      if (epicTip) {\r\n        epicTip.remove();\r\n        epicTip = null;\r\n      }\r\n      this.showEpics = !this.showEpics;\r\n      this.render();\r\n    };\r\n\r\n    const storyIcon = topbar.createEl(\"span\", { cls: \"pm-toggle-icon\" });\r\n    storyIcon.style.marginLeft = \"8px\";\r\n    storyIcon.style.cursor = \"pointer\";\r\n    setIcon(storyIcon, \"file-text\");\r\n    storyIcon.style.opacity = this.showStories ? \"1\" : \"0.3\";\r\n    storyIcon.setAttr(\"aria-label\", this.showStories ? \"Hide Stories\" : \"Show Stories\");\r\n    \r\n    // Story icon tooltip\r\n    let storyTip: HTMLElement | null = null;\r\n    storyIcon.addEventListener(\"mouseenter\", () => {\r\n      if (storyTip) {\r\n        storyTip.remove();\r\n        storyTip = null;\r\n      }\r\n      storyTip = document.createElement(\"div\");\r\n      storyTip.classList.add(\"pm-dash-tooltip\");\r\n      storyTip.textContent = this.showStories ? \"Hide Stories\" : \"Show Stories\";\r\n      document.body.appendChild(storyTip);\r\n      const r = storyIcon.getBoundingClientRect();\r\n      storyTip.style.left = `${r.left}px`;\r\n      storyTip.style.top = `${r.bottom + 6}px`;\r\n    });\r\n    storyIcon.addEventListener(\"mouseleave\", () => { \r\n      if (storyTip) {\r\n        storyTip.remove(); \r\n        storyTip = null; \r\n      }\r\n    });\r\n    \r\n    storyIcon.onclick = () => {\r\n      if (storyTip) {\r\n        storyTip.remove();\r\n        storyTip = null;\r\n      }\r\n      this.showStories = !this.showStories;\r\n      this.render();\r\n    };\r\n\r\n    /* ── Sub-tasks visibility toggle ─────────────────── */\r\n    const subTasksIcon = topbar.createEl(\"span\", { cls: \"pm-toggle-icon\" });\r\n    subTasksIcon.style.marginLeft = \"8px\";\r\n    subTasksIcon.style.cursor = \"pointer\";\r\n    setIcon(subTasksIcon, \"list\");\r\n    subTasksIcon.style.opacity = this.showSubTasks ? \"1\" : \"0.3\";\r\n    subTasksIcon.setAttr(\"aria-label\", this.showSubTasks ? \"Hide Sub-tasks\" : \"Show Sub-tasks\");\r\n    \r\n    // Sub-tasks icon tooltip\r\n    let subTasksTip: HTMLElement | null = null;\r\n    subTasksIcon.addEventListener(\"mouseenter\", () => {\r\n      if (subTasksTip) {\r\n        subTasksTip.remove();\r\n        subTasksTip = null;\r\n      }\r\n      subTasksTip = document.createElement(\"div\");\r\n      subTasksTip.classList.add(\"pm-dash-tooltip\");\r\n      subTasksTip.textContent = this.showSubTasks ? \"Hide Sub-tasks\" : \"Show Sub-tasks\";\r\n      document.body.appendChild(subTasksTip);\r\n      const r = subTasksIcon.getBoundingClientRect();\r\n      subTasksTip.style.left = `${r.left}px`;\r\n      subTasksTip.style.top = `${r.bottom + 6}px`;\r\n    });\r\n    subTasksIcon.addEventListener(\"mouseleave\", () => { \r\n      if (subTasksTip) {\r\n        subTasksTip.remove(); \r\n        subTasksTip = null; \r\n      }\r\n    });\r\n    \r\n    subTasksIcon.onclick = () => {\r\n      if (subTasksTip) {\r\n        subTasksTip.remove();\r\n        subTasksTip = null;\r\n      }\r\n      this.showSubTasks = !this.showSubTasks;\r\n      this.render();\r\n    };\r\n    \r\n    /* ── Table + header ─────────────────────────────── */\r\n    const tableContainer = this.container.createEl(\"div\", { cls: \"pm-table-container\" });\r\n    const table = tableContainer.createEl(\"table\", { cls: \"pm-table\" });\r\n    /* Column widths: Assignee widest, then Tasks/Status/Project */\r\n    const colgroup = table.createEl(\"colgroup\");\r\n    [\"48%\", \"12%\", \"12%\", \"28%\"].forEach((w) =>\r\n      colgroup.createEl(\"col\", { attr: { style: `width:${w}` } })\r\n    );\r\n    const thead = table.createEl(\"thead\");\r\n    /* Helper: attach a tooltip that clamps to window */\r\n    const attachTip = (icon: HTMLElement, text: string) => {\r\n      let tip: HTMLElement | null = null;\r\n      icon.addEventListener(\"mouseenter\", () => {\r\n        tip = document.createElement(\"div\");\r\n        tip.classList.add(\"pm-dash-tooltip\");\r\n        tip.textContent = text;\r\n        document.body.appendChild(tip);\r\n\r\n        const r   = icon.getBoundingClientRect();\r\n        const pad = 8;\r\n        let left  = r.right + 6;\r\n        let top   = r.top + (r.height - tip.offsetHeight) / 2;\r\n\r\n        const w = tip.offsetWidth  || 140;\r\n        const h = tip.offsetHeight || 40;\r\n\r\n        if (left + w > window.innerWidth - pad) left = Math.max(r.left - w - 6, pad);\r\n        if (top + h > window.innerHeight - pad) top  = window.innerHeight - h - pad;\r\n        if (top < pad) top = pad;\r\n\r\n        tip.style.left = `${left}px`;\r\n        tip.style.top  = `${top}px`;\r\n      });\r\n      icon.addEventListener(\"mouseleave\", () => { tip?.remove(); tip = null; });\r\n    };\r\n    const headerRow = thead.createEl(\"tr\");\r\n\r\n    const headers: [string, string][] = [\r\n      [\"assignee\", \"Assignee\"],\r\n      [\"tasks\",    \"Tasks\"],\r\n      [\"status\",   \"Status\"],\r\n      [\"origin\",   \"Project\"],\r\n    ];\r\n\r\n    headers.forEach(([field, label]) => {\r\n      const th = headerRow.createEl(\"th\", { cls: \"pm-sortable\" });\r\n      th.style.cursor = \"pointer\";\r\n\r\n      /* Label text */\r\n      th.createSpan({ text: label });\r\n\r\n      /* Chevron icon */\r\n      const ico = th.createSpan({ cls: \"pm-sort-ico\" });\r\n\r\n      if (this.sortField === field) {\r\n        setIcon(ico, this.sortAsc ? \"chevron-up\" : \"chevron-down\");\r\n      } else {\r\n        setIcon(ico, \"chevrons-up-down\");\r\n        ico.style.opacity = \"0.5\";          /* dim when inactive */\r\n      }\r\n\r\n      th.onclick = () => {\r\n        if (this.sortField === field) this.sortAsc = !this.sortAsc;\r\n        else {\r\n          this.sortField = field;\r\n          this.sortAsc = true;\r\n        }\r\n        this.render();\r\n      };\r\n    });\r\n\r\n    const tbody = table.createEl(\"tbody\");\r\n\r\n    /* Helper: custom tooltip for Status cells */\r\n    const attachStatusPopup = (cell: HTMLElement, msg: string) => {\r\n      let tip: HTMLElement | null = null;\r\n      let blockTooltip = false;\r\n      cell.addEventListener(\"mouseenter\", (ev) => {\r\n        if (blockTooltip) return;\r\n        const mouse = ev as MouseEvent;\r\n        tip = document.createElement(\"div\");\r\n        tip.className = \"pm-dash-tooltip\";\r\n        tip.textContent = msg;\r\n        document.body.appendChild(tip);\r\n\r\n        const pad = 8;\r\n        const w   = tip.offsetWidth  || 140;\r\n        const h   = tip.offsetHeight || 40;\r\n\r\n        /* default position: bottom‑right of pointer */\r\n        let left = mouse.clientX + pad;\r\n        let top  = mouse.clientY + pad;\r\n\r\n        if (left + w > window.innerWidth - pad) left = mouse.clientX - w - pad;\r\n        if (top  + h > window.innerHeight - pad) top  = mouse.clientY - h - pad;\r\n        if (left < pad) left = pad;\r\n        if (top  < pad) top  = pad;\r\n\r\n        tip.style.left = `${left}px`;\r\n        tip.style.top  = `${top}px`;\r\n      });\r\n      cell.addEventListener(\"mouseleave\", () => { \r\n        tip?.remove(); \r\n        tip = null; \r\n        blockTooltip = false;\r\n      });\r\n      // Remove tooltip immediately on click and block until mouse leaves\r\n      cell.addEventListener(\"click\", () => {\r\n        if (tip) {\r\n          tip.remove();\r\n          tip = null;\r\n        }\r\n        blockTooltip = true; // block until mouse leaves\r\n      });\r\n    };\r\n\r\n    /* ── Group tasks by ASSIGNEE ─────────────────────────────────── */\r\n    let projects: any[] = Array.from(this.cache.projects.values())\r\n      .sort((a, b) => a.file.basename.localeCompare(b.file.basename)) // sort A-Z\r\n      .filter(\r\n        (p) => !this.filterPaths || this.filterPaths.has(p.file.path)\r\n      );\r\n    interface AssigneeGroup {\r\n      id:    string;          // lower‑case id\r\n      label: string;          // original casing\r\n      tasks: any[];\r\n      totalTasks: number;\r\n      completedTasks: number;\r\n      percentComplete: number;\r\n      nextDue?: string;\r\n      projects: Set<string>;  // distinct project names this assignee touches\r\n    }\r\n    const agMap = new Map<string, AssigneeGroup>();\r\n\r\n    projects.forEach((proj: any) => {\r\n      (proj as any).tasks?.forEach((t: any) => {\r\n        /* Attach project metadata for later display */\r\n        t.projectName = proj.file?.basename ?? proj.name ?? \"Untitled\";\r\n        t.projectPath = proj.file?.path     ?? \"\";\r\n        /* Support multiple assignees separated by commas */\r\n        let rawAssignee: any =\r\n          t.assignee ?? t.props?.assignee ?? t.owner ?? t.props?.owner ?? \"Unassigned\";\r\n\r\n        let assignees: string[];\r\n        if (Array.isArray(rawAssignee)) {\r\n          assignees = rawAssignee.map((s: any) => String(s).trim());\r\n        } else {\r\n          assignees = String(rawAssignee)\r\n            .split(\",\")\r\n            .map((s) => s.trim())\r\n            .filter((s) => s.length && s !== \"-\");   // ignore placeholder dash\r\n        }\r\n        /* If nothing valid remains (or raw was just \"-\"), treat as unassigned */\r\n        if (assignees.length === 0) assignees = [\"Unassigned\"];\r\n\r\n        assignees.forEach((raw0) => {\r\n          /* Treat any dash-only token as \"Unassigned\" */\r\n          const raw = /^[-‑—–]+$/.test(raw0) ? \"Unassigned\" : raw0;   // covers -, –, —\r\n          const id  = raw.toLowerCase();\r\n\r\n          if (!agMap.has(id)) {\r\n            agMap.set(id, {\r\n              id,\r\n              label: raw,\r\n              tasks: [],\r\n              totalTasks: 0,\r\n              completedTasks: 0,\r\n              percentComplete: 0,\r\n              projects: new Set<string>(),\r\n            });\r\n          }\r\n          const grp = agMap.get(id)!;\r\n          grp.tasks.push(t);\r\n          if (t.projectName) grp.projects.add(String(t.projectName));\r\n\r\n          /* Count only sub-tasks (SB-) */\r\n          const idUp = ((t.id ?? \"\") as string).toUpperCase();\r\n          const isSubTask = idUp.startsWith(\"SB\");\r\n          if (isSubTask) {\r\n            grp.totalTasks++;\r\n            if (isTaskDone(t)) grp.completedTasks++;\r\n          }\r\n\r\n          const due = t.props?.due ?? t.props?.start;\r\n          if (due && (!grp.nextDue || String(due) < grp.nextDue)) grp.nextDue = String(due);\r\n        });\r\n      });\r\n    });\r\n\r\n    /* finalize percentComplete */\r\n    agMap.forEach((g) => {\r\n      g.percentComplete = g.totalTasks === 0 ? 0 : g.completedTasks / g.totalTasks;\r\n    });\r\n\r\n    /* replace projects array with assignee groups */\r\n    projects = Array.from(agMap.values()) as any[];\r\n    \r\n    /* Apply assignee filter */\r\n    if (this.filterAssignees) {\r\n      projects = projects.filter(p => this.filterAssignees!.has(p.id));\r\n    }\r\n    \r\n    this.currentPaths = projects.map(p => p.id);\r\n    this.totalGroups  = projects.length;\r\n\r\n    // Sorting logic adapted for assignee groups\r\n    if (this.sortField) {\r\n      const dir = this.sortAsc ? 1 : -1;\r\n      const statusRank = (p: typeof projects[number]) => {\r\n        const { label } = projectStatus(p.nextDue, p.percentComplete);\r\n        return [\"Off track\", \"Warning\", \"On track\", \"Completed\", \"No date\"].indexOf(\r\n          label\r\n        );\r\n      };\r\n      projects.sort((a, b) => {\r\n        switch (this.sortField) {\r\n          case \"assignee\":\r\n            return (a.label ?? \"\").localeCompare(b.label ?? \"\") * dir;\r\n          case \"tasks\":\r\n            const ratio = (p: typeof a) =>\r\n              (p.completedTasks ?? 0) / Math.max(p.totalTasks ?? 1, 1);\r\n            return (ratio(a) - ratio(b)) * dir;\r\n          case \"status\":\r\n            return (statusRank(a) - statusRank(b)) * dir;\r\n          case \"origin\":\r\n            // Sort by nextDue\r\n            const dv = (d?: string) =>\r\n              d ? new Date(d).getTime() : Number.POSITIVE_INFINITY;\r\n            return (dv(a.nextDue) - dv(b.nextDue)) * dir;\r\n          default:\r\n            return 0;\r\n        }\r\n      });\r\n    }\r\n    // Auto‑collapse only on the very first render; afterwards respect user toggles\r\n    if (this.firstRender) {\r\n      this.collapsed = new Set(projects.map(p => p.id));\r\n      this.firstRender = false;\r\n    }\r\n    // Refresh caret icon now that collapsed set is final\r\n    setIcon(globalCaret, this.allCollapsed() ? \"chevron-right\" : \"chevron-down\");\r\n\r\n    /* ── Project rows ─────────────────────────────── */\r\n    this.visibleGroupIds = [];\r\n    for (const project of projects) {\r\n      const row = tbody.createEl(\"tr\");\r\n\r\n      /* Auto‑expand assignee if any task matches the current quick‑filter */\r\n      const matchesFilter = this.filterText\r\n        ? (project.tasks as any[]).some(t => {\r\n            const hay = `${t.text ?? \"\"} ${(t.id ?? \"\")}`.toLowerCase();\r\n            return hay.includes(this.filterText);\r\n          })\r\n        : false;\r\n\r\n      /* Collapsed if user collapsed it AND (no filter or no match)   */\r\n      const isCollapsed =\r\n        this.collapsed.has(project.id) && (!this.filterText || !matchesFilter);\r\n\r\n      // This group is visible in the table regardless of collapsed state\r\n      this.visibleGroupIds.push(project.id);\r\n\r\n      /* Name + caret */\r\n      const nameCell = row.createEl(\"td\", { cls: \"pm-dash-name\" });\r\n      const caret = nameCell.createEl(\"span\");\r\n      setIcon(caret, isCollapsed ? \"chevron-right\" : \"chevron-down\");\r\n      caret.style.marginRight = \"4px\";\r\n      caret.style.cursor = \"pointer\";\r\n      caret.onclick = (e) => {\r\n        e.stopPropagation();\r\n        this.toggle(project.id);\r\n      };\r\n\r\n      nameCell.createSpan({ text: project.label });\r\n\r\n      /* Calculate task tally – fall back to pre‑computed cache fields */\r\n      let totalTasks: number;\r\n      let doneTasks:  number;\r\n      if (Array.isArray((project as any).tasks)) {\r\n        const projTasks: any[] = (project as any).tasks;\r\n        const counted = projTasks.filter((tk) => {\r\n          const idUp = ((tk.id ?? \"\") as string).toUpperCase();\r\n          return idUp.startsWith(\"SB\");      // include only sub-tasks (SB-)\r\n        });\r\n        totalTasks = counted.length;\r\n        doneTasks  = counted.filter(isTaskDone).length;\r\n      } else {\r\n        totalTasks = (project as any).totalTasks ?? 0;\r\n        doneTasks  = (project as any).completedTasks ?? 0;\r\n      }\r\n\r\n      /* Tasks ✓/total (+ red ! if total exceeds threshold from settings) */\r\n      const tasksCell = row.createEl(\"td\", {\r\n        text: `${doneTasks} / ${totalTasks}`,\r\n      });\r\n      const overload = Number(this.settings.resourcesOverloadThreshold ?? 20);\r\n      if (totalTasks > overload) {\r\n        tasksCell.createEl(\"span\", {\r\n          text: \" !\",\r\n          cls: \"pm-overload\",\r\n        });\r\n      }\r\n\r\n      /* Status */\r\n      const pctNum = Math.round((project as any).percentComplete * 100);\r\n      const { label, cls } = projectStatus(\r\n        project.nextDue,\r\n        pctNum / 100\r\n      );\r\n      const stTd = row.createEl(\"td\", { cls: \"pm-status-cell\" });\r\n      // 1. Status badge (always shown)\r\n      stTd.createEl(\"span\", { cls: `pm-badge ${cls}`, text: label });\r\n      attachStatusPopup(stTd, statusTooltip(project.nextDue, pctNum / 100));\r\n\r\n      /* Project column left blank for group rows */\r\n      row.createEl(\"td\");\r\n\r\n      /* If filter active and no task matches, hide the entire group row */\r\n      if (this.filterText && !matchesFilter) continue;\r\n\r\n      /* ── Task sub-rows ─────────────────────────── */\r\n      if (!isCollapsed && Array.isArray((project as any).tasks)) {\r\n        /* Sort tasks based on toggle setting */\r\n        let tasks: any[];\r\n        if (this.sortMode === 'project') {\r\n          // Group tasks by project, then sort by type within each project\r\n          const projectGroups = new Map<string, any[]>();\r\n          \r\n          // Group tasks by their project\r\n          (project as any).tasks.forEach((t: any) => {\r\n            const projectName = t.projectName ?? t.project?.file?.basename ?? \"Unknown Project\";\r\n            if (!projectGroups.has(projectName)) {\r\n              projectGroups.set(projectName, []);\r\n            }\r\n            projectGroups.get(projectName)!.push(t);\r\n          });\r\n          \r\n          // Sort projects alphabetically, then sort tasks within each project\r\n          const sortedProjects = Array.from(projectGroups.keys()).sort();\r\n          tasks = [];\r\n          \r\n          for (let i = 0; i < sortedProjects.length; i++) {\r\n            const projectName = sortedProjects[i];\r\n            const projectTasks = projectGroups.get(projectName)!;\r\n            \r\n            // Add project divider for all projects\r\n            tasks.push({ \r\n              _isProjectDivider: true, \r\n              _projectName: projectName,\r\n              _originalTasks: projectTasks \r\n            });\r\n            \r\n            // Sort tasks within this project by type (Epics → Stories → Subtasks)\r\n            const sortedProjectTasks = orderTasksDash(projectTasks);\r\n            tasks.push(...sortedProjectTasks);\r\n          }\r\n        } else if (this.sortMode === 'hierarchical') {\r\n          // Group tasks by project, then sort hierarchically within each project\r\n          const projectGroups = new Map<string, any[]>();\r\n          \r\n          // Group tasks by their project\r\n          (project as any).tasks.forEach((t: any) => {\r\n            const projectName = t.projectName ?? t.project?.file?.basename ?? \"Unknown Project\";\r\n            if (!projectGroups.has(projectName)) {\r\n              projectGroups.set(projectName, []);\r\n            }\r\n            projectGroups.get(projectName)!.push(t);\r\n          });\r\n          \r\n          // Sort projects alphabetically, then sort tasks hierarchically within each project\r\n          const sortedProjects = Array.from(projectGroups.keys()).sort();\r\n          tasks = [];\r\n          \r\n          for (let i = 0; i < sortedProjects.length; i++) {\r\n            const projectName = sortedProjects[i];\r\n            const projectTasks = projectGroups.get(projectName)!;\r\n            \r\n            // Add project divider for all projects\r\n            tasks.push({ \r\n              _isProjectDivider: true, \r\n              _projectName: projectName,\r\n              _originalTasks: projectTasks \r\n            });\r\n            \r\n            // Sort tasks within this project hierarchically (Epics → Stories → Subtasks)\r\n            const sortedProjectTasks = orderTasksDash(projectTasks);\r\n            tasks.push(...sortedProjectTasks);\r\n          }\r\n        } else {\r\n          // Sort alphabetically by task text\r\n          tasks = [...(project as any).tasks as any[]].sort((a, b) => {\r\n            const textA = (a.text ?? \"\").toLowerCase();\r\n            const textB = (b.text ?? \"\").toLowerCase();\r\n            return textA.localeCompare(textB);\r\n          });\r\n        }\r\n        for (const t of tasks) {\r\n          // Handle project divider rows\r\n          if ((t as any)._isProjectDivider) {\r\n            const projectName = (t as any)._projectName;\r\n            const isProjectCollapsed = this.collapsedProjects.has(projectName);\r\n            \r\n            const dividerRow = tbody.createEl(\"tr\", { cls: \"pm-project-divider\" });\r\n            \r\n            // Create a full-width divider cell\r\n            const dividerCell = dividerRow.createEl(\"td\", { \r\n              cls: \"pm-project-divider-cell\",\r\n              attr: { colspan: \"4\" }\r\n            });\r\n            \r\n            // Create the divider content with chevron\r\n            const dividerContent = dividerCell.createEl(\"div\", { cls: \"pm-project-divider-content\" });\r\n            \r\n            // Chevron button\r\n            const chevron = dividerContent.createEl(\"span\", { cls: \"pm-project-chevron\" });\r\n            setIcon(chevron, isProjectCollapsed ? \"chevron-right\" : \"chevron-down\");\r\n            chevron.style.cursor = \"pointer\";\r\n            chevron.style.marginRight = \"8px\";\r\n            \r\n            // Project name\r\n            const projectText = dividerContent.createEl(\"span\", { \r\n              cls: \"pm-project-divider-text\",\r\n              text: projectName\r\n            });\r\n            \r\n            // Visual separator line\r\n            const dividerLine = dividerContent.createEl(\"div\", { cls: \"pm-project-divider-line\" });\r\n            \r\n            // Click handler for the entire divider row\r\n            dividerRow.style.cursor = \"pointer\";\r\n            dividerRow.onclick = () => {\r\n              // Preserve scroll position\r\n              const tableContainer = this.container.querySelector('.pm-table-container');\r\n              const scrollTop = tableContainer?.scrollTop || 0;\r\n              \r\n              if (this.collapsedProjects.has(projectName)) {\r\n                this.collapsedProjects.delete(projectName);\r\n              } else {\r\n                this.collapsedProjects.add(projectName);\r\n              }\r\n              \r\n              this.render();\r\n              \r\n              // Restore scroll position with multiple attempts\r\n              const restoreScroll = () => {\r\n                const newTableContainer = this.container.querySelector('.pm-table-container');\r\n                if (newTableContainer) {\r\n                  newTableContainer.scrollTop = scrollTop;\r\n                }\r\n              };\r\n              \r\n              // Try immediately, then with delays\r\n              restoreScroll();\r\n              setTimeout(restoreScroll, 10);\r\n              setTimeout(restoreScroll, 50);\r\n              setTimeout(restoreScroll, 100);\r\n            };\r\n            \r\n            continue;\r\n          }\r\n          \r\n          /* Skip tasks if their project is collapsed */\r\n          if (this.sortMode === 'project' || this.sortMode === 'hierarchical') {\r\n            const taskProjectName = t.projectName ?? t.project?.file?.basename ?? \"Unknown Project\";\r\n            if (this.collapsedProjects.has(taskProjectName)) {\r\n              continue;\r\n            }\r\n          }\r\n          \r\n          /* Skip tasks that don't match filter */\r\n          if (this.filterText) {\r\n            const hay = `${t.text ?? \"\"} ${(t.id ?? \"\")}`.toLowerCase();\r\n            if (!hay.includes(this.filterText)) continue;\r\n          }\r\n\r\n          /* Skip tasks based on visibility settings */\r\n          const taskIdUpper = ((t as any).id ?? \"\").toUpperCase();\r\n          const isEpic = taskIdUpper.startsWith(\"E\");\r\n          const isStory = taskIdUpper.startsWith(\"S\") && !taskIdUpper.startsWith(\"SB\");\r\n          const isSubTask = taskIdUpper.startsWith(\"SB\");\r\n          \r\n          if (isEpic && !this.showEpics) continue;\r\n          if (isStory && !this.showStories) continue;\r\n          if (isSubTask && !this.showSubTasks) continue;\r\n\r\n          const tRow = tbody.createEl(\"tr\", { cls: \"pm-task-row\" });\r\n\r\n          /* Task name (clickable link) */\r\n          const tName = tRow.createEl(\"td\", { cls: \"pm-task-name\" });\r\n\r\n          const idTag = ((t as any).id ?? \"\").toUpperCase();\r\n          const indentLevel =\r\n            idTag.startsWith(\"E\") ? 0 :\r\n            (idTag.startsWith(\"S\") && !idTag.startsWith(\"SB\")) ? 1 : 2;\r\n          tName.style.paddingLeft = `${20 + indentLevel * 12}px`;\r\n\r\n          let done = isTaskDone(t);\r\n          const tPct =\r\n            typeof (t as any).percentComplete === \"number\"\r\n              ? Math.round((t as any).percentComplete * 100)\r\n              : done ? 100 : 0;\r\n\r\n          if (done) {\r\n            const chk = tName.createEl(\"span\");\r\n            setIcon(chk, \"check-circle\");\r\n            chk.addClass(\"pm-task-check\");\r\n            chk.style.marginRight = \"4px\";\r\n          } else {\r\n            tName.createEl(\"span\", { text: \"• \", cls: \"pm-task-bullet\" });\r\n          }\r\n\r\n          const prefix = (() => {\r\n            const id: string = (t as any).id ?? \"\";\r\n            if (!id) return \"\";\r\n            const match = id.match(/^(E|SB?|S)-?\\d+/i);\r\n            return match ? `${match[0].toUpperCase()} ` : \"\";\r\n          })();\r\n\r\n          const anchor = tName.createEl(\"a\", {\r\n            text: `${prefix}${t.text ?? \"(untitled)\"}`,\r\n            href: (t as any).file?.path ?? \"\",\r\n          });\r\n          /* pencil icon to reassign (placed after the task link) */\r\n          const editBtn = tName.createSpan({ cls: \"pm-assignee-edit\" });\r\n          setIcon(editBtn, \"user\");\r\n          attachTip(editBtn, \"Reassign Assignee\");\r\n          editBtn.style.cssText =\r\n            \"margin-left:6px; cursor:pointer; position:relative; z-index:10;\";\r\n          const onEdit = (ev: MouseEvent) => {\r\n            ev.preventDefault();\r\n            ev.stopPropagation();\r\n            /* DEBUG: confirm the pencil was clicked */\r\n\r\n            this.showAssigneePicker(t, editBtn);\r\n          };\r\n          /* Use mousedown to catch event before anchor row intercepts; also bind click */\r\n          editBtn.addEventListener(\"mousedown\", onEdit);\r\n          editBtn.addEventListener(\"click\",      onEdit);\r\n\r\n          /* ── Hover tooltip for task meta ─────────────────────────── */\r\n          let hoverTip: HTMLElement | null = null;\r\n          anchor.addEventListener(\"mouseenter\", () => {\r\n            const props = (t as any).props ?? {};\r\n            const val = (k: string) => props[k] ?? props[k.toLowerCase()] ?? \"—\";\r\n            const html = `\r\n              <strong>${prefix}${t.text ?? \"(untitled)\"}</strong><br>\r\n              <em>${val(\"description\") || (t.description ?? \"\").toString().trim() || \"—\"}</em><br>\r\n              <span>Start: ${val(\"start\")}</span><br>\r\n              <span>Due  : ${val(\"due\") || val(\"end\")}</span><br>\r\n              <span>Assignee: ${val(\"assignee\") || val(\"owner\") || (t.assignee ?? t.owner ?? \"—\")}</span>\r\n            `;\r\n            hoverTip = document.createElement(\"div\");\r\n            hoverTip.className = \"pm-dash-tooltip\";\r\n            hoverTip.innerHTML = html;\r\n            document.body.appendChild(hoverTip);\r\n            // Tooltip positioning with window clamping\r\n            const r   = anchor.getBoundingClientRect();\r\n            const pad = 8;                       // gap from window edges\r\n\r\n            /* Default position: to the right of the anchor */\r\n            let left = r.right + 8;\r\n            let top  = r.top;\r\n\r\n            /* Measure tooltip after it's in the DOM */\r\n            const tipW = hoverTip.offsetWidth  || 220;  // fallback width\r\n            const tipH = hoverTip.offsetHeight || 140;  // fallback height\r\n\r\n            /* Horizontal overflow – flip to left side */\r\n            if (left + tipW > window.innerWidth - pad) {\r\n              left = Math.max(r.left - tipW - 8, pad);\r\n            }\r\n\r\n            /* Vertical overflow – clamp within viewport */\r\n            if (top + tipH > window.innerHeight - pad) {\r\n              top = Math.max(window.innerHeight - tipH - pad, pad);\r\n            }\r\n\r\n            hoverTip.style.left = `${left}px`;\r\n            hoverTip.style.top  = `${top}px`;\r\n          });\r\n          anchor.addEventListener(\"mouseleave\", () => {\r\n            hoverTip?.remove();\r\n            hoverTip = null;\r\n          });\r\n          const idUpper = ((t as any).id ?? \"\").toUpperCase();\r\n          if (idUpper.startsWith(\"E\") ||\r\n             (idUpper.startsWith(\"S\") && !idUpper.startsWith(\"SB\"))) {\r\n            anchor.addClass(\"pm-task-bold\");\r\n          }\r\n          anchor.style.cursor = \"pointer\";\r\n          anchor.onclick = (e) => {\r\n            e.preventDefault();\r\n            const filePath = (t as any).file?.path;\r\n            if (filePath) this.app.workspace.openLinkText(filePath, \"\", false);\r\n          };\r\n\r\n          /* Tasks column: tally sub-tasks for Epics and Stories, with completion toggle for SB tasks */\r\n          (() => {\r\n            const idUp = ((t as any).id ?? \"\").toUpperCase();\r\n            const isEpic = idUp.startsWith(\"E\");\r\n            const isStory = idUp.startsWith(\"S\") && !idUp.startsWith(\"SB\");\r\n            const isSB = idUp.startsWith(\"SB\");\r\n            let taskText = \"—\";\r\n            \r\n            if (isEpic || isStory) {\r\n              const gatherDescendants = (rootId: string): any[] => {\r\n                const desc: any[] = [];\r\n                const seen = new Set<string>();\r\n                const queue = [rootId];\r\n                while (queue.length) {\r\n                  const pid = queue.shift()!;\r\n                  tasks.forEach((candidate) => {\r\n                    const deps = (candidate.depends ?? []).map((d: string) => d.toUpperCase());\r\n                    if (deps.includes(pid)) {\r\n                      const cid = ((candidate.id ?? \"\") as string).toUpperCase();\r\n                      if (!seen.has(cid)) {\r\n                        seen.add(cid);\r\n                        desc.push(candidate);\r\n                        queue.push(cid);\r\n                      }\r\n                    }\r\n                  });\r\n                }\r\n                return desc;\r\n              };\r\n              let childTasks: any[] = [];\r\n              if (isStory) {\r\n                childTasks = tasks.filter((candidate) => {\r\n                  const deps = (candidate.depends ?? []).map((d: string) => d.toUpperCase());\r\n                  if (!deps.includes(idUp)) return false;\r\n                  const cid = ((candidate.id ?? \"\") as string).toUpperCase();\r\n                  return cid.startsWith(\"SB\");\r\n                });\r\n              } else if (isEpic) {\r\n                childTasks = gatherDescendants(idUp);\r\n              }\r\n              if (childTasks.length > 0) {\r\n                const doneCnt = childTasks.filter(isTaskDone).length;\r\n                taskText = `${doneCnt} / ${childTasks.length}`;\r\n              }\r\n            }\r\n            \r\n            // Create Tasks column with clickable check/X icon for SB tasks\r\n            const tasksCell = tRow.createEl(\"td\");\r\n            \r\n            if (isSB) {\r\n              // For SB tasks, add clickable completion toggle\r\n              const isDone = isTaskDone(t);\r\n              const toggleBtn = tasksCell.createEl(\"span\");\r\n              toggleBtn.style.cursor = \"pointer\";\r\n              toggleBtn.style.marginRight = \"4px\";\r\n              \r\n              if (isDone) {\r\n                setIcon(toggleBtn, \"check-circle\");\r\n                let tooltip: HTMLElement | null = null;\r\n                toggleBtn.addEventListener(\"mouseenter\", () => {\r\n                  tooltip = document.createElement(\"div\");\r\n                  tooltip.className = \"pm-dash-tooltip\";\r\n                  tooltip.textContent = \"Mark as incomplete\";\r\n                  document.body.appendChild(tooltip);\r\n                  const rect = toggleBtn.getBoundingClientRect();\r\n                  tooltip.style.left = `${rect.left}px`;\r\n                  tooltip.style.top = `${rect.top - 30}px`;\r\n                });\r\n                const hideToggleTip = () => { tooltip?.remove(); tooltip = null; };\r\n                toggleBtn.addEventListener(\"mouseleave\", hideToggleTip);\r\n                document.addEventListener(\"scroll\", hideToggleTip, { capture: true, once: true });\r\n                toggleBtn.onclick = async (e) => {\r\n                  e.stopPropagation();\r\n                  hideToggleTip();\r\n                  await this.toggleTaskCompletion(t, false);\r\n                  // Clean up any remaining popups after task completion\r\n                  document.querySelectorAll(\".pm-dash-tooltip\").forEach(el => el.remove());\r\n                  document.querySelectorAll(\".pm-status-popup\").forEach(el => el.remove());\r\n                };\r\n              } else {\r\n                setIcon(toggleBtn, \"circle\");\r\n                let tooltip: HTMLElement | null = null;\r\n                toggleBtn.addEventListener(\"mouseenter\", () => {\r\n                  tooltip = document.createElement(\"div\");\r\n                  tooltip.className = \"pm-dash-tooltip\";\r\n                  tooltip.textContent = \"Mark as complete\";\r\n                  document.body.appendChild(tooltip);\r\n                  const rect = toggleBtn.getBoundingClientRect();\r\n                  tooltip.style.left = `${rect.left}px`;\r\n                  tooltip.style.top = `${rect.top - 30}px`;\r\n                });\r\n                const hideToggleTip2 = () => { tooltip?.remove(); tooltip = null; };\r\n                toggleBtn.addEventListener(\"mouseleave\", hideToggleTip2);\r\n                document.addEventListener(\"scroll\", hideToggleTip2, { capture: true, once: true });\r\n                toggleBtn.onclick = async (e) => {\r\n                  e.stopPropagation();\r\n                  hideToggleTip2();\r\n                  await this.toggleTaskCompletion(t, true);\r\n                  // Clean up any remaining popups after task completion\r\n                  document.querySelectorAll(\".pm-dash-tooltip\").forEach(el => el.remove());\r\n                  document.querySelectorAll(\".pm-status-popup\").forEach(el => el.remove());\r\n                };\r\n              }\r\n              // No text for SB tasks, just the icon\r\n            } else {\r\n              // For non-SB tasks (Epics/Stories), just show the text\r\n              tasksCell.setText(taskText);\r\n            }\r\n          })();\r\n\r\n          /* Status + dates — mirror Timeline logic */\r\n          const taskDueIso = ((t as any).props?.[\"due\"] ?? \"\")\r\n            .toString()\r\n            .replace(/\\u00A0/g, \" \")\r\n            .trim();\r\n          const taskStartIso = ((t as any).props?.[\"start\"] ?? \"\")\r\n            .toString()\r\n            .replace(/\\u00A0/g, \" \")\r\n            .trim();\r\n          const taskDue = taskDueIso || taskStartIso || undefined;\r\n          const taskMtime =\r\n            (t as any).file?.stat?.mtime ??\r\n            (t as any).mtime ??\r\n            (t as any).updated ??\r\n            undefined;\r\n          const pctForStatus = (done || tPct === 100) ? 1 : (tPct / 100);\r\n          const { label: tLabel0, cls: tCls0 } = projectStatus(taskDue, pctForStatus);\r\n          const tLabel = (tPct === 100) ? \"Completed\" : tLabel0;\r\n          const tCls   = (tPct === 100) ? \"complete\"   : tCls0;\r\n          const stCell = tRow.createEl(\"td\");\r\n\r\n          // Only render play/pause button and status dot logic for SB-tasks (like weekly view)\r\n          if (t?.id?.toUpperCase().startsWith(\"SB\")) {\r\n            // Wrapper div for all status elements (badge, dot, button)\r\n            const statusWrapper = stCell.createDiv({ cls: \"pm-status-cell-wrapper\" });\r\n\r\n            // Status badge (copied from Dashboard)\r\n            statusWrapper.createEl(\"span\", { cls: `pm-badge ${tCls}`, text: tLabel });\r\n            attachStatusPopup(statusWrapper, statusTooltip(taskDueIso || taskStartIso, pctForStatus));\r\n\r\n  // Status dot\r\n  if (t.status === \"in-progress\") {\r\n    statusWrapper.createEl(\"span\", { text: \"●\", cls: \"pm-in-progress-dot\" });\r\n  } else if (t.status === \"on-hold\") {\r\n    statusWrapper.createEl(\"span\", { text: \"●\", cls: \"pm-on-hold-dot\" });\r\n  }\r\n\r\n  // Determine task status for play/pause icon\r\n  let taskStatusVal: \"not-started\" | \"in-progress\" | \"on-hold\" | \"done\" = \"not-started\";\r\n  if (typeof t.status === \"string\") {\r\n    const s = t.status.toLowerCase();\r\n    if ([\"done\", \"complete\", \"completed\"].includes(s)) {\r\n      taskStatusVal = \"done\";\r\n    } else if (s === \"in-progress\") {\r\n      taskStatusVal = \"in-progress\";\r\n    } else if (s === \"on-hold\") {\r\n      taskStatusVal = \"on-hold\";\r\n    }\r\n  }\r\n\r\n  // Play/pause button (only if not done)\r\n  if (taskStatusVal !== \"done\") {\r\n    const iconBtn = statusWrapper.createEl(\"span\", { cls: `pm-status-btn ${taskStatusVal}` });\r\n    iconBtn.style.cursor = \"pointer\";\r\n    setIcon(iconBtn, taskStatusVal === \"in-progress\" ? \"pause\" : \"play\");\r\n    \r\n    // Add custom tooltip for play/pause button\r\n    let tooltip: HTMLElement | null = null;\r\n    iconBtn.addEventListener(\"mouseenter\", () => {\r\n      tooltip = document.createElement(\"div\");\r\n      tooltip.className = \"pm-dash-tooltip\";\r\n      tooltip.textContent = taskStatusVal === \"in-progress\" ? \"Mark as on hold\" : \"Mark as in progress\";\r\n      document.body.appendChild(tooltip);\r\n      const rect = iconBtn.getBoundingClientRect();\r\n      tooltip.style.left = `${rect.left}px`;\r\n      tooltip.style.top = `${rect.top - 30}px`;\r\n    });\r\n    const hideTooltip = () => { tooltip?.remove(); tooltip = null; };\r\n    iconBtn.addEventListener(\"mouseleave\", hideTooltip);\r\n    document.addEventListener(\"scroll\", hideTooltip, { capture: true, once: true });\r\n\r\n    iconBtn.onclick = async (ev) => {\r\n      ev.stopPropagation();\r\n      hideTooltip();\r\n      const file = (t as any).file;\r\n      if (!file) return;\r\n\r\n      const content = await this.app.vault.read(file);\r\n      const lines = content.split(/\\r?\\n/);\r\n      const checkboxRegex = /\\[[ xX\\/-]\\]/;\r\n\r\n      // Find the task line\r\n      let lineIdx = typeof t.line === \"number\" ? t.line : -1;\r\n      if (!(lineIdx >= 0 && checkboxRegex.test(lines[lineIdx]))) {\r\n        lineIdx = lines.findIndex(\r\n          (line) => line.includes(t.text ?? \"\") && checkboxRegex.test(line)\r\n        );\r\n      }\r\n\r\n      if (lineIdx >= 0) {\r\n        const match = lines[lineIdx].match(/\\[[ xX\\/-]\\]/);\r\n        if (match) {\r\n          let replacement = match[0];\r\n          if (replacement === \"[ ]\") replacement = \"[/]\";\r\n          else if (replacement === \"[/]\") replacement = \"[-]\";\r\n          else if (replacement === \"[-]\") replacement = \"[/]\";\r\n          lines[lineIdx] = lines[lineIdx].replace(/\\[[ xX\\/-]\\]/, replacement);\r\n          await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n          // Close custom status tooltip if open\r\n          document.querySelectorAll(\".pm-dash-tooltip\").forEach(el => el.remove());\r\n          // Also close any pm-status-popup if open\r\n          document.querySelectorAll(\".pm-status-popup\").forEach(el => el.remove());\r\n          this.render();\r\n        }\r\n      }\r\n    };\r\n  }\r\n} else {\r\n  // For non-SB tasks, render only the default badge and status dot, no play/pause button.\r\n  stCell.createEl(\"span\", {\r\n    cls:  `pm-badge ${tCls}`,\r\n    text: tLabel,\r\n  });\r\n  // Add colored dot for status\r\n  if (t.status === \"in-progress\") {\r\n    stCell.createEl(\"span\", { text: \"●\", cls: \"pm-in-progress-dot\" });\r\n  } else if (t.status === \"on-hold\") {\r\n    stCell.createEl(\"span\", { text: \"●\", cls: \"pm-on-hold-dot\" });\r\n  }\r\n  attachStatusPopup(stCell, statusTooltip(taskDueIso || taskStartIso, pctForStatus));\r\n}\r\n\r\n          /* Project column (link to project note) */\r\n          const projCell = tRow.createEl(\"td\", { cls: \"pm-text-muted\" });\r\n          if (t.projectPath) {\r\n            const link = projCell.createEl(\"a\", {\r\n              text: (t.projectName ?? \"—\").toString(),\r\n              href: t.projectPath,\r\n            });\r\n            link.style.cursor = \"pointer\";\r\n            link.onclick = (e) => {\r\n              e.preventDefault();\r\n              this.app.workspace.openLinkText(t.projectPath, \"\", false);\r\n            };\r\n            let projHover: HTMLElement | null = null;\r\n            link.addEventListener(\"mouseenter\", () => {\r\n              const tFile = this.app.vault.getFileByPath(t.projectPath);\r\n              const fm: Record<string, any> =\r\n                (tFile instanceof TFile\r\n                  ? this.app.metadataCache.getFileCache(tFile)?.frontmatter\r\n                  : undefined) ??\r\n                this.app.metadataCache.getCache(t.projectPath)?.frontmatter ??\r\n                {};\r\n              const fmVal = (k: string) => {\r\n                const norm  = (s: string) => s.replace(/[\\s_]+/g, \"\").toLowerCase();\r\n                const target = norm(k);\r\n                for (const key in fm) {\r\n                  if (norm(key) === target) return fm[key];\r\n                }\r\n                return \"—\";\r\n              };\r\n              let html = `<strong>${t.projectName}</strong>`;\r\n              if (Object.keys(fm).length > 0) {\r\n                html += `<br><em>${fmVal(\"description\")}</em>\r\n                         <br><span>Start: ${fmVal(\"start date\")}</span>\r\n                         <br><span>Due  : ${fmVal(\"end date\") || fmVal(\"due date\")}</span>`;\r\n              }\r\n              projHover = document.createElement(\"div\");\r\n              projHover.className = \"pm-dash-tooltip\";\r\n              projHover.innerHTML = html;\r\n              document.body.appendChild(projHover);\r\n              // --- New window-clamping logic for tooltip positioning ---\r\n              const r   = link.getBoundingClientRect();\r\n              const pad = 8;                          // minimal gap from edges\r\n              const tipW = projHover.offsetWidth  || 220;\r\n              const tipH = projHover.offsetHeight || 120;\r\n\r\n              /* Default position: to the right of the link */\r\n              let left = r.right + pad;\r\n              let top  = r.top;\r\n\r\n              /* Horizontal overflow – flip to left side */\r\n              if (left + tipW > window.innerWidth - pad) {\r\n                left = Math.max(r.left - pad - tipW, pad);\r\n              }\r\n\r\n              /* Vertical overflow – clamp within viewport */\r\n              if (top + tipH > window.innerHeight - pad) {\r\n                top = Math.max(window.innerHeight - tipH - pad, pad);\r\n              }\r\n              if (top < pad) top = pad;\r\n\r\n              projHover.style.left = `${left}px`;\r\n              projHover.style.top  = `${top}px`;\r\n            });\r\n            link.addEventListener(\"mouseleave\", () => {\r\n              projHover?.remove();\r\n              projHover = null;\r\n            });\r\n          } else {\r\n            projCell.setText((t.projectName ?? \"—\").toString());\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.cache.projects.size === 0) {\r\n      this.container.createEl(\"p\", {\r\n        text: `No project notes found (front-matter \\`${this.settings.projectFlagProperty}: true\\`).`,\r\n      });\r\n    }\r\n\r\n    // Set caret icon based on currently visible groups' collapsed state\r\n    const vis = this.visibleGroupIds;\r\n    const visAllCollapsed = vis.length > 0 && vis.every(id => this.collapsed.has(id));\r\n    setIcon(globalCaret, visAllCollapsed ? \"chevron-right\" : \"chevron-down\");\r\n  }\r\n\r\n  public focusSearch() {\r\n    this.container\r\n      .querySelector<HTMLInputElement>(\".pm-search-input\")\r\n      ?.focus();\r\n  }\r\n\r\n  /* ── Inline reassignment picker ───────────────────────────── */\r\n\r\n  /** Extract every unique assignee name found in current cache\r\n      (fallback when registry has no people). */\r\n  private gatherAssigneesFromTasks(): { id: string; name: string }[] {\r\n    const map = new Map<string, string>();\r\n    this.cache.projects.forEach((proj) => {\r\n      (proj as any).tasks?.forEach((t: any) => {\r\n        const raw = (t.assignee ?? t.props?.assignee ?? \"\").toString();\r\n        raw.split(\",\").forEach((s: string) => {\r\n          const n = s.trim();\r\n          if (n && n !== \"-\") map.set(n.toLowerCase(), n);\r\n        });\r\n      });\r\n    });\r\n    return Array.from(map.entries()).map(([id, name]) => ({ id, name }));\r\n  }\r\n\r\n  /** Show dropdown of all people under the clicked element. */\r\n  private showAssigneePicker(task: any, anchor: HTMLElement) {\r\n    const old = document.querySelector(\".pm-picker\");\r\n    if (old) old.remove();\r\n\r\n    const picker = document.createElement(\"div\");\r\n    picker.className = \"pm-picker\";\r\n\r\n    picker.createEl(\"div\", { text: \"Reassign Assignee\", cls: \"pm-picker-title\" });\r\n\r\n    const listWrap = picker.createEl(\"div\", { cls: \"pm-picker-list\" });\r\n\r\n    const currentRaw =\r\n      (task.assignee ??\r\n       task.props?.assignee ??\r\n       task.owner ??\r\n       task.props?.owner ??\r\n       \"Unassigned\").toString();\r\n    const currentAssignee = currentRaw.split(\",\")[0].trim() || \"Unassigned\";\r\n\r\n    const footer  = picker.createEl(\"div\", { cls: \"pm-picker-footer\" });\r\n    const summary = footer.createEl(\"span\", { text: `${currentAssignee} → —` });\r\n    const btnWrap = footer.createEl(\"span\");\r\n\r\n    const btnOk = btnWrap.createSpan({ cls: \"pm-btn\" });\r\n    setIcon(btnOk, \"check\");\r\n    const btnCancel = btnWrap.createSpan({ cls: \"pm-btn\" });\r\n    setIcon(btnCancel, \"x\");\r\n\r\n    const seen = new Map<string, string>();\r\n    registry.listPeople().forEach((p) => seen.set(p.id.toLowerCase(), p.name));\r\n    this.gatherAssigneesFromTasks().forEach((p) => {\r\n      if (!seen.has(p.id.toLowerCase())) seen.set(p.id.toLowerCase(), p.name);\r\n    });\r\n    const people = Array.from(seen.entries()).map(([id, name]) => ({ id, name }))\r\n      .sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n    let selectedId:   string | null = null;   // lower‑case key\r\n    let selectedName: string | null = null;   // preserve original casing\r\n    people.forEach((p) => {\r\n      const opt = listWrap.createEl(\"div\", { text: p.name, cls: \"pm-picker-item\" });\r\n      opt.onclick = () => {\r\n        listWrap.querySelectorAll(\".pm-picker-item.selected\")\r\n                .forEach((el) => el.removeClass(\"selected\"));\r\n        opt.addClass(\"selected\");\r\n\r\n        selectedId   = p.id;\r\n        selectedName = p.name;\r\n        summary.setText(`${currentAssignee} → ${p.name}`);\r\n      };\r\n    });\r\n\r\n    btnOk.onclick = () => {\r\n      if (selectedName && selectedName.toLowerCase() !== currentAssignee.toLowerCase()) {\r\n        this.reassignTask(task, selectedName);\r\n      }\r\n      picker.remove();\r\n    };\r\n    btnCancel.onclick = () => picker.remove();\r\n\r\n    const onDoc = (e: MouseEvent) => {\r\n      if (!picker.contains(e.target as Node)) {\r\n        picker.remove();\r\n        document.removeEventListener(\"mousedown\", onDoc);\r\n      }\r\n    };\r\n    setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n\r\n    document.body.appendChild(picker);\r\n\r\n    const r       = anchor.getBoundingClientRect();\r\n    const pad     = 8;\r\n    const pickerW = picker.offsetWidth  || 220;   // fallback width\r\n    const pickerH = picker.offsetHeight || 300;   // fallback height\r\n\r\n    /* Default position: below anchor */\r\n    let left = r.left;\r\n    let top  = r.bottom + 6;\r\n\r\n    /* Prevent horizontal overflow */\r\n    if (left + pickerW > window.innerWidth - pad) {\r\n      left = Math.max(window.innerWidth - pickerW - pad, pad);\r\n    } else if (left < pad) {\r\n      left = pad;\r\n    }\r\n\r\n    /* Prevent vertical overflow – if no room below, try above; if still no room,\r\n       clamp to bottom edge minus padding */\r\n    if (top + pickerH > window.innerHeight - pad) {\r\n      const above = r.top - pickerH - 6;\r\n      top = above >= pad ? above\r\n                         : Math.max(window.innerHeight - pickerH - pad, pad);\r\n    }\r\n\r\n    picker.style.left = `${left}px`;\r\n    picker.style.top  = `${top}px`;\r\n  }\r\n\r\n  /** Replace or add `assignee:: <new>` for the *specific* task block. */\r\n  private async reassignTask(task: any, newId: string) {\r\n    /* Resolve underlying TFile from task */\r\n    let file: TFile | null = null;\r\n    if (task.file instanceof TFile) {\r\n      file = task.file;\r\n    } else if (task.file?.path) {\r\n      const f = this.app.vault.getFileByPath(task.file.path);\r\n      if (f instanceof TFile) file = f;\r\n    } else if (task.projectPath) {\r\n      const f = this.app.vault.getFileByPath(task.projectPath);\r\n      if (f instanceof TFile) file = f;\r\n    }\r\n\r\n    if (!file) { new Notice(\"File not found for task\"); return; }\r\n\r\n    // Read note and split into lines\r\n    const note   = await this.app.vault.read(file);\r\n    const idUpper = String(task.id ?? \"\").trim().toUpperCase();\r\n    /* Always use assignee:: as the canonical field.\r\n       When updating, we will overwrite either `assignee::` or `owner::`\r\n       whichever is already present, otherwise append `assignee::`. */\r\n    const field = \"assignee\";\r\n    const lines  = note.split(/\\r?\\n/);\r\n\r\n    /* ── Locate the task bullet ───────────────────────────────────── */\r\n\r\n    // 0‑based index of the bullet line\r\n    let start = -1;\r\n\r\n    /* Dataview 0.5+ provides `.line` (0‑based).\r\n       Older snapshots may expose `.lineNumber` (1‑based). */\r\n    const dvLine = task.line ?? task.lineNumber;\r\n    if (typeof dvLine === \"number\") {\r\n      if (dvLine >= 0 && dvLine < lines.length) {\r\n        // Treat as 0‑based position\r\n        start = dvLine;\r\n      } else if (dvLine - 1 >= 0 && dvLine - 1 < lines.length) {\r\n        // Fallback: assume 1‑based and convert\r\n        start = dvLine - 1;\r\n      }\r\n    }\r\n\r\n    // Helper: bullet regexp and text snippet\r\n    const bulletRE = /^\\s*-\\s*(?:\\[[ xX]\\]\\s*)?/;\r\n    const snippet  = String(task.text ?? \"\")\r\n      .replace(/\\s+/g, \" \")\r\n      .trim()\r\n      .slice(0, 120)\r\n      .toLowerCase();\r\n\r\n    // 2️⃣ Bullet line containing task text\r\n    if (start === -1 && snippet) {\r\n      start = lines.findIndex(\r\n        (ln) => bulletRE.test(ln) && ln.toLowerCase().includes(snippet)\r\n      );\r\n    }\r\n\r\n    // 3️⃣ Fallback: ID + snippet search\r\n    if (start === -1) {\r\n      const id = String(task.id ?? \"\").trim();\r\n      start = lines.findIndex(\r\n        (ln) =>\r\n          (id && ln.includes(id)) ||\r\n          (snippet && ln.toLowerCase().includes(snippet))\r\n      );\r\n    }\r\n\r\n    /* If we found a line but it is a table row (contains pipes) – update table cell instead */\r\n    if (start !== -1 && /\\|/.test(lines[start])) {\r\n      const rowIdx = start;\r\n\r\n      let cells = lines[rowIdx].split(\"|\").map((c) => c.trim());\r\n\r\n      const hasLead  = /^\\s*\\|/.test(lines[rowIdx]);\r\n      const hasTrail = /\\|\\s*$/.test(lines[rowIdx]);\r\n\r\n      /* drop leading / trailing empty cell caused by outer pipes */\r\n      if (hasLead  && cells.length && cells[0] === \"\")       cells = cells.slice(1);\r\n      if (hasTrail && cells.length && cells[cells.length-1]===\"\") cells = cells.slice(0, -1);\r\n\r\n      /* locate assignee / owner column */\r\n      let col = cells.findIndex((c) => /^(assignee|owner)::/i.test(c));\r\n      if (col === -1) col = 4;           // fallback \"Assignee\" column (0‑based after trim)\r\n\r\n      cells[col] = cells[col].replace(\r\n        /^(?:assignee|owner)::\\s*[^|]*/i,\r\n        `assignee:: ${newId}`\r\n      );\r\n\r\n      let newRow = cells.join(\" | \");\r\n      if (hasLead)  newRow = \"| \" + newRow;\r\n      if (hasTrail) newRow = newRow + \" |\";\r\n\r\n      lines[rowIdx] = newRow;\r\n      await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n      new Notice(`Re‑assigned to ${newId}`);\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    /* ── Fallback: try table row (markdown pipe table) ─────────────── */\r\n    if (start === -1) {\r\n      const rowIdx = lines.findIndex((ln) =>\r\n        ln.includes(`| ${idUpper}`) || ln.startsWith(`| ${idUpper}`)\r\n      );\r\n      if (rowIdx === -1) {\r\n        new Notice(\"Could not locate task in file\");\r\n        return;\r\n      }\r\n\r\n      /* Split the row into cells, trim spaces */\r\n      let cells = lines[rowIdx].split(\"|\").map((c) => c.trim());\r\n\r\n      const hasLead  = /^\\s*\\|/.test(lines[rowIdx]);\r\n      const hasTrail = /\\|\\s*$/.test(lines[rowIdx]);\r\n\r\n      /* drop leading / trailing empty cell caused by outer pipes */\r\n      if (hasLead  && cells.length && cells[0] === \"\")       cells = cells.slice(1);\r\n      if (hasTrail && cells.length && cells[cells.length-1]===\"\") cells = cells.slice(0, -1);\r\n\r\n      /* Heuristic: find first cell that starts with assignee:: or owner:: */\r\n      let col = cells.findIndex((c) => /^(assignee|owner)::/i.test(c));\r\n      if (col === -1) {\r\n        /* Fallback: assume \"Assignee\" column is the 5th cell (index 4 after trim) */\r\n        col = 4;\r\n      }\r\n\r\n      /* Build new cell text */\r\n      cells[col] = cells[col].replace(\r\n        /^(?:assignee|owner)::\\s*[^|]*/i,\r\n        `assignee:: ${newId}`\r\n      );\r\n\r\n      /* Re‑join with pipes, preserving leading/trailing pipe if present */\r\n      let newRow = cells.join(\" | \");\r\n      if (hasLead)  newRow = \"| \" + newRow;\r\n      if (hasTrail) newRow = newRow + \" |\";\r\n\r\n      lines[rowIdx] = newRow;\r\n      await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n      new Notice(`Re‑assigned to ${newId}`);\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    /* ── Determine the end of the task block (until next list item) ─ */\r\n    let end = start;\r\n    while (\r\n      end + 1 < lines.length &&\r\n      !bulletRE.test(lines[end + 1]) &&\r\n      lines[end + 1].trim() !== \"\"\r\n    ) {\r\n      end++;\r\n    }\r\n\r\n    // Extract block and indentation\r\n    const block    = lines.slice(start, end + 1);\r\n    /* ── Replace any existing assignee:: or owner:: line ─ */\r\n    let replaced = false;\r\n    for (let i = 0; i < block.length; i++) {\r\n      if (/^(?:\\s*)(assignee|owner)\\s*::/i.test(block[i])) {\r\n        block[i] = block[i].replace(\r\n          /^(?:\\s*)(assignee|owner)\\s*::\\s*([^|<\\n\\r]*)/i,\r\n          (_, pKey) => `${pKey.replace(/owner/i, \"assignee\")}:: ${newId}`\r\n        );\r\n        replaced = true;\r\n      }\r\n    }\r\n    if (replaced) {\r\n      lines.splice(start, end - start + 1, ...block);\r\n      await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n      new Notice(`Re‑assigned to ${newId}`);\r\n      this.render();\r\n      return;\r\n    }\r\n    const indent   = block[0].match(/^\\s*/)?.[0] ?? \"\";\r\n    const newLine  = `${indent}  ${field}:: ${newId}`;\r\n\r\n    // Replace existing assignee/owner line or append\r\n    const idx = block.findIndex((ln) => new RegExp(`^\\\\s*${field}\\\\s*::`, \"i\").test(ln));\r\n    if (idx !== -1) block[idx] = newLine;\r\n    else            block.push(newLine);\r\n\r\n    // Splice updated block back into note\r\n    lines.splice(start, end - start + 1, ...block);\r\n    await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n\r\n    new Notice(`Re‑assigned to ${newId}`);\r\n    this.render();                      // refresh view\r\n  }\r\n\r\n  private async toggleTaskCompletion(task: any, done: boolean) {\r\n    const file = task.file;\r\n    if (!file) return;\r\n\r\n    const content = await this.app.vault.read(file);\r\n    const lines = content.split(/\\r?\\n/);\r\n    const taskText = (task.text ?? \"\").toString();\r\n    const checkboxRegex = /\\[[ xX\\/-]\\]/;\r\n\r\n    let lineIdx = typeof task.line === \"number\" ? task.line : -1;\r\n\r\n    if (lineIdx >= 0 && lines[lineIdx] && checkboxRegex.test(lines[lineIdx])) {\r\n      // Use this line\r\n    } else {\r\n      // Search for the first line with a checkbox and matching task text\r\n      lineIdx = -1;\r\n      for (let i = 0; i < lines.length; i++) {\r\n        if (lines[i].includes(taskText) && checkboxRegex.test(lines[i])) {\r\n          lineIdx = i;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (lineIdx >= 0) {\r\n      const match = lines[lineIdx].match(/\\[[ xX\\/-]\\]/);\r\n      if (match) {\r\n        const box = match[0];\r\n        let replacement = box;\r\n        if (done) {\r\n          // Mark as complete\r\n          if (box === \"[ ]\" || box === \"[/]\" || box === \"[-]\") {\r\n            replacement = \"[x]\";\r\n          }\r\n        } else {\r\n          // Mark as incomplete\r\n          if (box === \"[x]\" || box === \"[X]\") {\r\n            replacement = \"[ ]\";\r\n          }\r\n        }\r\n        lines[lineIdx] = lines[lineIdx].replace(/\\[[ xX\\/-]\\]/, replacement);\r\n        await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n        this.render();\r\n      }\r\n    }\r\n  }\r\n}","/*!\r\n * @kurkle/color v0.3.4\r\n * https://github.com/kurkle/color#readme\r\n * (c) 2024 Jukka Kurkela\r\n * Released under the MIT License\r\n */\r\nfunction round(v) {\r\n  return v + 0.5 | 0;\r\n}\r\nconst lim = (v, l, h) => Math.max(Math.min(v, h), l);\r\nfunction p2b(v) {\r\n  return lim(round(v * 2.55), 0, 255);\r\n}\r\nfunction b2p(v) {\r\n  return lim(round(v / 2.55), 0, 100);\r\n}\r\nfunction n2b(v) {\r\n  return lim(round(v * 255), 0, 255);\r\n}\r\nfunction b2n(v) {\r\n  return lim(round(v / 2.55) / 100, 0, 1);\r\n}\r\nfunction n2p(v) {\r\n  return lim(round(v * 100), 0, 100);\r\n}\r\n\r\nconst map$1 = {0: 0, 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, 8: 8, 9: 9, A: 10, B: 11, C: 12, D: 13, E: 14, F: 15, a: 10, b: 11, c: 12, d: 13, e: 14, f: 15};\r\nconst hex = [...'0123456789ABCDEF'];\r\nconst h1 = b => hex[b & 0xF];\r\nconst h2 = b => hex[(b & 0xF0) >> 4] + hex[b & 0xF];\r\nconst eq = b => ((b & 0xF0) >> 4) === (b & 0xF);\r\nconst isShort = v => eq(v.r) && eq(v.g) && eq(v.b) && eq(v.a);\r\nfunction hexParse(str) {\r\n  var len = str.length;\r\n  var ret;\r\n  if (str[0] === '#') {\r\n    if (len === 4 || len === 5) {\r\n      ret = {\r\n        r: 255 & map$1[str[1]] * 17,\r\n        g: 255 & map$1[str[2]] * 17,\r\n        b: 255 & map$1[str[3]] * 17,\r\n        a: len === 5 ? map$1[str[4]] * 17 : 255\r\n      };\r\n    } else if (len === 7 || len === 9) {\r\n      ret = {\r\n        r: map$1[str[1]] << 4 | map$1[str[2]],\r\n        g: map$1[str[3]] << 4 | map$1[str[4]],\r\n        b: map$1[str[5]] << 4 | map$1[str[6]],\r\n        a: len === 9 ? (map$1[str[7]] << 4 | map$1[str[8]]) : 255\r\n      };\r\n    }\r\n  }\r\n  return ret;\r\n}\r\nconst alpha = (a, f) => a < 255 ? f(a) : '';\r\nfunction hexString(v) {\r\n  var f = isShort(v) ? h1 : h2;\r\n  return v\r\n    ? '#' + f(v.r) + f(v.g) + f(v.b) + alpha(v.a, f)\r\n    : undefined;\r\n}\r\n\r\nconst HUE_RE = /^(hsla?|hwb|hsv)\\(\\s*([-+.e\\d]+)(?:deg)?[\\s,]+([-+.e\\d]+)%[\\s,]+([-+.e\\d]+)%(?:[\\s,]+([-+.e\\d]+)(%)?)?\\s*\\)$/;\r\nfunction hsl2rgbn(h, s, l) {\r\n  const a = s * Math.min(l, 1 - l);\r\n  const f = (n, k = (n + h / 30) % 12) => l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);\r\n  return [f(0), f(8), f(4)];\r\n}\r\nfunction hsv2rgbn(h, s, v) {\r\n  const f = (n, k = (n + h / 60) % 6) => v - v * s * Math.max(Math.min(k, 4 - k, 1), 0);\r\n  return [f(5), f(3), f(1)];\r\n}\r\nfunction hwb2rgbn(h, w, b) {\r\n  const rgb = hsl2rgbn(h, 1, 0.5);\r\n  let i;\r\n  if (w + b > 1) {\r\n    i = 1 / (w + b);\r\n    w *= i;\r\n    b *= i;\r\n  }\r\n  for (i = 0; i < 3; i++) {\r\n    rgb[i] *= 1 - w - b;\r\n    rgb[i] += w;\r\n  }\r\n  return rgb;\r\n}\r\nfunction hueValue(r, g, b, d, max) {\r\n  if (r === max) {\r\n    return ((g - b) / d) + (g < b ? 6 : 0);\r\n  }\r\n  if (g === max) {\r\n    return (b - r) / d + 2;\r\n  }\r\n  return (r - g) / d + 4;\r\n}\r\nfunction rgb2hsl(v) {\r\n  const range = 255;\r\n  const r = v.r / range;\r\n  const g = v.g / range;\r\n  const b = v.b / range;\r\n  const max = Math.max(r, g, b);\r\n  const min = Math.min(r, g, b);\r\n  const l = (max + min) / 2;\r\n  let h, s, d;\r\n  if (max !== min) {\r\n    d = max - min;\r\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n    h = hueValue(r, g, b, d, max);\r\n    h = h * 60 + 0.5;\r\n  }\r\n  return [h | 0, s || 0, l];\r\n}\r\nfunction calln(f, a, b, c) {\r\n  return (\r\n    Array.isArray(a)\r\n      ? f(a[0], a[1], a[2])\r\n      : f(a, b, c)\r\n  ).map(n2b);\r\n}\r\nfunction hsl2rgb(h, s, l) {\r\n  return calln(hsl2rgbn, h, s, l);\r\n}\r\nfunction hwb2rgb(h, w, b) {\r\n  return calln(hwb2rgbn, h, w, b);\r\n}\r\nfunction hsv2rgb(h, s, v) {\r\n  return calln(hsv2rgbn, h, s, v);\r\n}\r\nfunction hue(h) {\r\n  return (h % 360 + 360) % 360;\r\n}\r\nfunction hueParse(str) {\r\n  const m = HUE_RE.exec(str);\r\n  let a = 255;\r\n  let v;\r\n  if (!m) {\r\n    return;\r\n  }\r\n  if (m[5] !== v) {\r\n    a = m[6] ? p2b(+m[5]) : n2b(+m[5]);\r\n  }\r\n  const h = hue(+m[2]);\r\n  const p1 = +m[3] / 100;\r\n  const p2 = +m[4] / 100;\r\n  if (m[1] === 'hwb') {\r\n    v = hwb2rgb(h, p1, p2);\r\n  } else if (m[1] === 'hsv') {\r\n    v = hsv2rgb(h, p1, p2);\r\n  } else {\r\n    v = hsl2rgb(h, p1, p2);\r\n  }\r\n  return {\r\n    r: v[0],\r\n    g: v[1],\r\n    b: v[2],\r\n    a: a\r\n  };\r\n}\r\nfunction rotate(v, deg) {\r\n  var h = rgb2hsl(v);\r\n  h[0] = hue(h[0] + deg);\r\n  h = hsl2rgb(h);\r\n  v.r = h[0];\r\n  v.g = h[1];\r\n  v.b = h[2];\r\n}\r\nfunction hslString(v) {\r\n  if (!v) {\r\n    return;\r\n  }\r\n  const a = rgb2hsl(v);\r\n  const h = a[0];\r\n  const s = n2p(a[1]);\r\n  const l = n2p(a[2]);\r\n  return v.a < 255\r\n    ? `hsla(${h}, ${s}%, ${l}%, ${b2n(v.a)})`\r\n    : `hsl(${h}, ${s}%, ${l}%)`;\r\n}\r\n\r\nconst map = {\r\n\tx: 'dark',\r\n\tZ: 'light',\r\n\tY: 're',\r\n\tX: 'blu',\r\n\tW: 'gr',\r\n\tV: 'medium',\r\n\tU: 'slate',\r\n\tA: 'ee',\r\n\tT: 'ol',\r\n\tS: 'or',\r\n\tB: 'ra',\r\n\tC: 'lateg',\r\n\tD: 'ights',\r\n\tR: 'in',\r\n\tQ: 'turquois',\r\n\tE: 'hi',\r\n\tP: 'ro',\r\n\tO: 'al',\r\n\tN: 'le',\r\n\tM: 'de',\r\n\tL: 'yello',\r\n\tF: 'en',\r\n\tK: 'ch',\r\n\tG: 'arks',\r\n\tH: 'ea',\r\n\tI: 'ightg',\r\n\tJ: 'wh'\r\n};\r\nconst names$1 = {\r\n\tOiceXe: 'f0f8ff',\r\n\tantiquewEte: 'faebd7',\r\n\taqua: 'ffff',\r\n\taquamarRe: '7fffd4',\r\n\tazuY: 'f0ffff',\r\n\tbeige: 'f5f5dc',\r\n\tbisque: 'ffe4c4',\r\n\tblack: '0',\r\n\tblanKedOmond: 'ffebcd',\r\n\tXe: 'ff',\r\n\tXeviTet: '8a2be2',\r\n\tbPwn: 'a52a2a',\r\n\tburlywood: 'deb887',\r\n\tcaMtXe: '5f9ea0',\r\n\tKartYuse: '7fff00',\r\n\tKocTate: 'd2691e',\r\n\tcSO: 'ff7f50',\r\n\tcSnflowerXe: '6495ed',\r\n\tcSnsilk: 'fff8dc',\r\n\tcrimson: 'dc143c',\r\n\tcyan: 'ffff',\r\n\txXe: '8b',\r\n\txcyan: '8b8b',\r\n\txgTMnPd: 'b8860b',\r\n\txWay: 'a9a9a9',\r\n\txgYF: '6400',\r\n\txgYy: 'a9a9a9',\r\n\txkhaki: 'bdb76b',\r\n\txmagFta: '8b008b',\r\n\txTivegYF: '556b2f',\r\n\txSange: 'ff8c00',\r\n\txScEd: '9932cc',\r\n\txYd: '8b0000',\r\n\txsOmon: 'e9967a',\r\n\txsHgYF: '8fbc8f',\r\n\txUXe: '483d8b',\r\n\txUWay: '2f4f4f',\r\n\txUgYy: '2f4f4f',\r\n\txQe: 'ced1',\r\n\txviTet: '9400d3',\r\n\tdAppRk: 'ff1493',\r\n\tdApskyXe: 'bfff',\r\n\tdimWay: '696969',\r\n\tdimgYy: '696969',\r\n\tdodgerXe: '1e90ff',\r\n\tfiYbrick: 'b22222',\r\n\tflSOwEte: 'fffaf0',\r\n\tfoYstWAn: '228b22',\r\n\tfuKsia: 'ff00ff',\r\n\tgaRsbSo: 'dcdcdc',\r\n\tghostwEte: 'f8f8ff',\r\n\tgTd: 'ffd700',\r\n\tgTMnPd: 'daa520',\r\n\tWay: '808080',\r\n\tgYF: '8000',\r\n\tgYFLw: 'adff2f',\r\n\tgYy: '808080',\r\n\thoneyMw: 'f0fff0',\r\n\thotpRk: 'ff69b4',\r\n\tRdianYd: 'cd5c5c',\r\n\tRdigo: '4b0082',\r\n\tivSy: 'fffff0',\r\n\tkhaki: 'f0e68c',\r\n\tlavFMr: 'e6e6fa',\r\n\tlavFMrXsh: 'fff0f5',\r\n\tlawngYF: '7cfc00',\r\n\tNmoncEffon: 'fffacd',\r\n\tZXe: 'add8e6',\r\n\tZcSO: 'f08080',\r\n\tZcyan: 'e0ffff',\r\n\tZgTMnPdLw: 'fafad2',\r\n\tZWay: 'd3d3d3',\r\n\tZgYF: '90ee90',\r\n\tZgYy: 'd3d3d3',\r\n\tZpRk: 'ffb6c1',\r\n\tZsOmon: 'ffa07a',\r\n\tZsHgYF: '20b2aa',\r\n\tZskyXe: '87cefa',\r\n\tZUWay: '778899',\r\n\tZUgYy: '778899',\r\n\tZstAlXe: 'b0c4de',\r\n\tZLw: 'ffffe0',\r\n\tlime: 'ff00',\r\n\tlimegYF: '32cd32',\r\n\tlRF: 'faf0e6',\r\n\tmagFta: 'ff00ff',\r\n\tmaPon: '800000',\r\n\tVaquamarRe: '66cdaa',\r\n\tVXe: 'cd',\r\n\tVScEd: 'ba55d3',\r\n\tVpurpN: '9370db',\r\n\tVsHgYF: '3cb371',\r\n\tVUXe: '7b68ee',\r\n\tVsprRggYF: 'fa9a',\r\n\tVQe: '48d1cc',\r\n\tVviTetYd: 'c71585',\r\n\tmidnightXe: '191970',\r\n\tmRtcYam: 'f5fffa',\r\n\tmistyPse: 'ffe4e1',\r\n\tmoccasR: 'ffe4b5',\r\n\tnavajowEte: 'ffdead',\r\n\tnavy: '80',\r\n\tTdlace: 'fdf5e6',\r\n\tTive: '808000',\r\n\tTivedBb: '6b8e23',\r\n\tSange: 'ffa500',\r\n\tSangeYd: 'ff4500',\r\n\tScEd: 'da70d6',\r\n\tpOegTMnPd: 'eee8aa',\r\n\tpOegYF: '98fb98',\r\n\tpOeQe: 'afeeee',\r\n\tpOeviTetYd: 'db7093',\r\n\tpapayawEp: 'ffefd5',\r\n\tpHKpuff: 'ffdab9',\r\n\tperu: 'cd853f',\r\n\tpRk: 'ffc0cb',\r\n\tplum: 'dda0dd',\r\n\tpowMrXe: 'b0e0e6',\r\n\tpurpN: '800080',\r\n\tYbeccapurpN: '663399',\r\n\tYd: 'ff0000',\r\n\tPsybrown: 'bc8f8f',\r\n\tPyOXe: '4169e1',\r\n\tsaddNbPwn: '8b4513',\r\n\tsOmon: 'fa8072',\r\n\tsandybPwn: 'f4a460',\r\n\tsHgYF: '2e8b57',\r\n\tsHshell: 'fff5ee',\r\n\tsiFna: 'a0522d',\r\n\tsilver: 'c0c0c0',\r\n\tskyXe: '87ceeb',\r\n\tUXe: '6a5acd',\r\n\tUWay: '708090',\r\n\tUgYy: '708090',\r\n\tsnow: 'fffafa',\r\n\tsprRggYF: 'ff7f',\r\n\tstAlXe: '4682b4',\r\n\ttan: 'd2b48c',\r\n\tteO: '8080',\r\n\ttEstN: 'd8bfd8',\r\n\ttomato: 'ff6347',\r\n\tQe: '40e0d0',\r\n\tviTet: 'ee82ee',\r\n\tJHt: 'f5deb3',\r\n\twEte: 'ffffff',\r\n\twEtesmoke: 'f5f5f5',\r\n\tLw: 'ffff00',\r\n\tLwgYF: '9acd32'\r\n};\r\nfunction unpack() {\r\n  const unpacked = {};\r\n  const keys = Object.keys(names$1);\r\n  const tkeys = Object.keys(map);\r\n  let i, j, k, ok, nk;\r\n  for (i = 0; i < keys.length; i++) {\r\n    ok = nk = keys[i];\r\n    for (j = 0; j < tkeys.length; j++) {\r\n      k = tkeys[j];\r\n      nk = nk.replace(k, map[k]);\r\n    }\r\n    k = parseInt(names$1[ok], 16);\r\n    unpacked[nk] = [k >> 16 & 0xFF, k >> 8 & 0xFF, k & 0xFF];\r\n  }\r\n  return unpacked;\r\n}\r\n\r\nlet names;\r\nfunction nameParse(str) {\r\n  if (!names) {\r\n    names = unpack();\r\n    names.transparent = [0, 0, 0, 0];\r\n  }\r\n  const a = names[str.toLowerCase()];\r\n  return a && {\r\n    r: a[0],\r\n    g: a[1],\r\n    b: a[2],\r\n    a: a.length === 4 ? a[3] : 255\r\n  };\r\n}\r\n\r\nconst RGB_RE = /^rgba?\\(\\s*([-+.\\d]+)(%)?[\\s,]+([-+.e\\d]+)(%)?[\\s,]+([-+.e\\d]+)(%)?(?:[\\s,/]+([-+.e\\d]+)(%)?)?\\s*\\)$/;\r\nfunction rgbParse(str) {\r\n  const m = RGB_RE.exec(str);\r\n  let a = 255;\r\n  let r, g, b;\r\n  if (!m) {\r\n    return;\r\n  }\r\n  if (m[7] !== r) {\r\n    const v = +m[7];\r\n    a = m[8] ? p2b(v) : lim(v * 255, 0, 255);\r\n  }\r\n  r = +m[1];\r\n  g = +m[3];\r\n  b = +m[5];\r\n  r = 255 & (m[2] ? p2b(r) : lim(r, 0, 255));\r\n  g = 255 & (m[4] ? p2b(g) : lim(g, 0, 255));\r\n  b = 255 & (m[6] ? p2b(b) : lim(b, 0, 255));\r\n  return {\r\n    r: r,\r\n    g: g,\r\n    b: b,\r\n    a: a\r\n  };\r\n}\r\nfunction rgbString(v) {\r\n  return v && (\r\n    v.a < 255\r\n      ? `rgba(${v.r}, ${v.g}, ${v.b}, ${b2n(v.a)})`\r\n      : `rgb(${v.r}, ${v.g}, ${v.b})`\r\n  );\r\n}\r\n\r\nconst to = v => v <= 0.0031308 ? v * 12.92 : Math.pow(v, 1.0 / 2.4) * 1.055 - 0.055;\r\nconst from = v => v <= 0.04045 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);\r\nfunction interpolate(rgb1, rgb2, t) {\r\n  const r = from(b2n(rgb1.r));\r\n  const g = from(b2n(rgb1.g));\r\n  const b = from(b2n(rgb1.b));\r\n  return {\r\n    r: n2b(to(r + t * (from(b2n(rgb2.r)) - r))),\r\n    g: n2b(to(g + t * (from(b2n(rgb2.g)) - g))),\r\n    b: n2b(to(b + t * (from(b2n(rgb2.b)) - b))),\r\n    a: rgb1.a + t * (rgb2.a - rgb1.a)\r\n  };\r\n}\r\n\r\nfunction modHSL(v, i, ratio) {\r\n  if (v) {\r\n    let tmp = rgb2hsl(v);\r\n    tmp[i] = Math.max(0, Math.min(tmp[i] + tmp[i] * ratio, i === 0 ? 360 : 1));\r\n    tmp = hsl2rgb(tmp);\r\n    v.r = tmp[0];\r\n    v.g = tmp[1];\r\n    v.b = tmp[2];\r\n  }\r\n}\r\nfunction clone(v, proto) {\r\n  return v ? Object.assign(proto || {}, v) : v;\r\n}\r\nfunction fromObject(input) {\r\n  var v = {r: 0, g: 0, b: 0, a: 255};\r\n  if (Array.isArray(input)) {\r\n    if (input.length >= 3) {\r\n      v = {r: input[0], g: input[1], b: input[2], a: 255};\r\n      if (input.length > 3) {\r\n        v.a = n2b(input[3]);\r\n      }\r\n    }\r\n  } else {\r\n    v = clone(input, {r: 0, g: 0, b: 0, a: 1});\r\n    v.a = n2b(v.a);\r\n  }\r\n  return v;\r\n}\r\nfunction functionParse(str) {\r\n  if (str.charAt(0) === 'r') {\r\n    return rgbParse(str);\r\n  }\r\n  return hueParse(str);\r\n}\r\nclass Color {\r\n  constructor(input) {\r\n    if (input instanceof Color) {\r\n      return input;\r\n    }\r\n    const type = typeof input;\r\n    let v;\r\n    if (type === 'object') {\r\n      v = fromObject(input);\r\n    } else if (type === 'string') {\r\n      v = hexParse(input) || nameParse(input) || functionParse(input);\r\n    }\r\n    this._rgb = v;\r\n    this._valid = !!v;\r\n  }\r\n  get valid() {\r\n    return this._valid;\r\n  }\r\n  get rgb() {\r\n    var v = clone(this._rgb);\r\n    if (v) {\r\n      v.a = b2n(v.a);\r\n    }\r\n    return v;\r\n  }\r\n  set rgb(obj) {\r\n    this._rgb = fromObject(obj);\r\n  }\r\n  rgbString() {\r\n    return this._valid ? rgbString(this._rgb) : undefined;\r\n  }\r\n  hexString() {\r\n    return this._valid ? hexString(this._rgb) : undefined;\r\n  }\r\n  hslString() {\r\n    return this._valid ? hslString(this._rgb) : undefined;\r\n  }\r\n  mix(color, weight) {\r\n    if (color) {\r\n      const c1 = this.rgb;\r\n      const c2 = color.rgb;\r\n      let w2;\r\n      const p = weight === w2 ? 0.5 : weight;\r\n      const w = 2 * p - 1;\r\n      const a = c1.a - c2.a;\r\n      const w1 = ((w * a === -1 ? w : (w + a) / (1 + w * a)) + 1) / 2.0;\r\n      w2 = 1 - w1;\r\n      c1.r = 0xFF & w1 * c1.r + w2 * c2.r + 0.5;\r\n      c1.g = 0xFF & w1 * c1.g + w2 * c2.g + 0.5;\r\n      c1.b = 0xFF & w1 * c1.b + w2 * c2.b + 0.5;\r\n      c1.a = p * c1.a + (1 - p) * c2.a;\r\n      this.rgb = c1;\r\n    }\r\n    return this;\r\n  }\r\n  interpolate(color, t) {\r\n    if (color) {\r\n      this._rgb = interpolate(this._rgb, color._rgb, t);\r\n    }\r\n    return this;\r\n  }\r\n  clone() {\r\n    return new Color(this.rgb);\r\n  }\r\n  alpha(a) {\r\n    this._rgb.a = n2b(a);\r\n    return this;\r\n  }\r\n  clearer(ratio) {\r\n    const rgb = this._rgb;\r\n    rgb.a *= 1 - ratio;\r\n    return this;\r\n  }\r\n  greyscale() {\r\n    const rgb = this._rgb;\r\n    const val = round(rgb.r * 0.3 + rgb.g * 0.59 + rgb.b * 0.11);\r\n    rgb.r = rgb.g = rgb.b = val;\r\n    return this;\r\n  }\r\n  opaquer(ratio) {\r\n    const rgb = this._rgb;\r\n    rgb.a *= 1 + ratio;\r\n    return this;\r\n  }\r\n  negate() {\r\n    const v = this._rgb;\r\n    v.r = 255 - v.r;\r\n    v.g = 255 - v.g;\r\n    v.b = 255 - v.b;\r\n    return this;\r\n  }\r\n  lighten(ratio) {\r\n    modHSL(this._rgb, 2, ratio);\r\n    return this;\r\n  }\r\n  darken(ratio) {\r\n    modHSL(this._rgb, 2, -ratio);\r\n    return this;\r\n  }\r\n  saturate(ratio) {\r\n    modHSL(this._rgb, 1, ratio);\r\n    return this;\r\n  }\r\n  desaturate(ratio) {\r\n    modHSL(this._rgb, 1, -ratio);\r\n    return this;\r\n  }\r\n  rotate(deg) {\r\n    rotate(this._rgb, deg);\r\n    return this;\r\n  }\r\n}\r\n\r\nfunction index_esm(input) {\r\n  return new Color(input);\r\n}\r\n\r\nexport { Color, b2n, b2p, index_esm as default, hexParse, hexString, hsl2rgb, hslString, hsv2rgb, hueParse, hwb2rgb, lim, n2b, n2p, nameParse, p2b, rgb2hsl, rgbParse, rgbString, rotate, round };\r\n","/*!\r\n * Chart.js v4.5.0\r\n * https://www.chartjs.org\r\n * (c) 2025 Chart.js Contributors\r\n * Released under the MIT License\r\n */\r\nimport { Color } from '@kurkle/color';\r\n\r\n/**\r\n * @namespace Chart.helpers\r\n */ /**\r\n * An empty function that can be used, for example, for optional callback.\r\n */ function noop() {\r\n/* noop */ }\r\n/**\r\n * Returns a unique id, sequentially generated from a global variable.\r\n */ const uid = (()=>{\r\n    let id = 0;\r\n    return ()=>id++;\r\n})();\r\n/**\r\n * Returns true if `value` is neither null nor undefined, else returns false.\r\n * @param value - The value to test.\r\n * @since 2.7.0\r\n */ function isNullOrUndef(value) {\r\n    return value === null || value === undefined;\r\n}\r\n/**\r\n * Returns true if `value` is an array (including typed arrays), else returns false.\r\n * @param value - The value to test.\r\n * @function\r\n */ function isArray(value) {\r\n    if (Array.isArray && Array.isArray(value)) {\r\n        return true;\r\n    }\r\n    const type = Object.prototype.toString.call(value);\r\n    if (type.slice(0, 7) === '[object' && type.slice(-6) === 'Array]') {\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n/**\r\n * Returns true if `value` is an object (excluding null), else returns false.\r\n * @param value - The value to test.\r\n * @since 2.7.0\r\n */ function isObject(value) {\r\n    return value !== null && Object.prototype.toString.call(value) === '[object Object]';\r\n}\r\n/**\r\n * Returns true if `value` is a finite number, else returns false\r\n * @param value  - The value to test.\r\n */ function isNumberFinite(value) {\r\n    return (typeof value === 'number' || value instanceof Number) && isFinite(+value);\r\n}\r\n/**\r\n * Returns `value` if finite, else returns `defaultValue`.\r\n * @param value - The value to return if defined.\r\n * @param defaultValue - The value to return if `value` is not finite.\r\n */ function finiteOrDefault(value, defaultValue) {\r\n    return isNumberFinite(value) ? value : defaultValue;\r\n}\r\n/**\r\n * Returns `value` if defined, else returns `defaultValue`.\r\n * @param value - The value to return if defined.\r\n * @param defaultValue - The value to return if `value` is undefined.\r\n */ function valueOrDefault(value, defaultValue) {\r\n    return typeof value === 'undefined' ? defaultValue : value;\r\n}\r\nconst toPercentage = (value, dimension)=>typeof value === 'string' && value.endsWith('%') ? parseFloat(value) / 100 : +value / dimension;\r\nconst toDimension = (value, dimension)=>typeof value === 'string' && value.endsWith('%') ? parseFloat(value) / 100 * dimension : +value;\r\n/**\r\n * Calls `fn` with the given `args` in the scope defined by `thisArg` and returns the\r\n * value returned by `fn`. If `fn` is not a function, this method returns undefined.\r\n * @param fn - The function to call.\r\n * @param args - The arguments with which `fn` should be called.\r\n * @param [thisArg] - The value of `this` provided for the call to `fn`.\r\n */ function callback(fn, args, thisArg) {\r\n    if (fn && typeof fn.call === 'function') {\r\n        return fn.apply(thisArg, args);\r\n    }\r\n}\r\nfunction each(loopable, fn, thisArg, reverse) {\r\n    let i, len, keys;\r\n    if (isArray(loopable)) {\r\n        len = loopable.length;\r\n        if (reverse) {\r\n            for(i = len - 1; i >= 0; i--){\r\n                fn.call(thisArg, loopable[i], i);\r\n            }\r\n        } else {\r\n            for(i = 0; i < len; i++){\r\n                fn.call(thisArg, loopable[i], i);\r\n            }\r\n        }\r\n    } else if (isObject(loopable)) {\r\n        keys = Object.keys(loopable);\r\n        len = keys.length;\r\n        for(i = 0; i < len; i++){\r\n            fn.call(thisArg, loopable[keys[i]], keys[i]);\r\n        }\r\n    }\r\n}\r\n/**\r\n * Returns true if the `a0` and `a1` arrays have the same content, else returns false.\r\n * @param a0 - The array to compare\r\n * @param a1 - The array to compare\r\n * @private\r\n */ function _elementsEqual(a0, a1) {\r\n    let i, ilen, v0, v1;\r\n    if (!a0 || !a1 || a0.length !== a1.length) {\r\n        return false;\r\n    }\r\n    for(i = 0, ilen = a0.length; i < ilen; ++i){\r\n        v0 = a0[i];\r\n        v1 = a1[i];\r\n        if (v0.datasetIndex !== v1.datasetIndex || v0.index !== v1.index) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n/**\r\n * Returns a deep copy of `source` without keeping references on objects and arrays.\r\n * @param source - The value to clone.\r\n */ function clone(source) {\r\n    if (isArray(source)) {\r\n        return source.map(clone);\r\n    }\r\n    if (isObject(source)) {\r\n        const target = Object.create(null);\r\n        const keys = Object.keys(source);\r\n        const klen = keys.length;\r\n        let k = 0;\r\n        for(; k < klen; ++k){\r\n            target[keys[k]] = clone(source[keys[k]]);\r\n        }\r\n        return target;\r\n    }\r\n    return source;\r\n}\r\nfunction isValidKey(key) {\r\n    return [\r\n        '__proto__',\r\n        'prototype',\r\n        'constructor'\r\n    ].indexOf(key) === -1;\r\n}\r\n/**\r\n * The default merger when Chart.helpers.merge is called without merger option.\r\n * Note(SB): also used by mergeConfig and mergeScaleConfig as fallback.\r\n * @private\r\n */ function _merger(key, target, source, options) {\r\n    if (!isValidKey(key)) {\r\n        return;\r\n    }\r\n    const tval = target[key];\r\n    const sval = source[key];\r\n    if (isObject(tval) && isObject(sval)) {\r\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n        merge(tval, sval, options);\r\n    } else {\r\n        target[key] = clone(sval);\r\n    }\r\n}\r\nfunction merge(target, source, options) {\r\n    const sources = isArray(source) ? source : [\r\n        source\r\n    ];\r\n    const ilen = sources.length;\r\n    if (!isObject(target)) {\r\n        return target;\r\n    }\r\n    options = options || {};\r\n    const merger = options.merger || _merger;\r\n    let current;\r\n    for(let i = 0; i < ilen; ++i){\r\n        current = sources[i];\r\n        if (!isObject(current)) {\r\n            continue;\r\n        }\r\n        const keys = Object.keys(current);\r\n        for(let k = 0, klen = keys.length; k < klen; ++k){\r\n            merger(keys[k], target, current, options);\r\n        }\r\n    }\r\n    return target;\r\n}\r\nfunction mergeIf(target, source) {\r\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n    return merge(target, source, {\r\n        merger: _mergerIf\r\n    });\r\n}\r\n/**\r\n * Merges source[key] in target[key] only if target[key] is undefined.\r\n * @private\r\n */ function _mergerIf(key, target, source) {\r\n    if (!isValidKey(key)) {\r\n        return;\r\n    }\r\n    const tval = target[key];\r\n    const sval = source[key];\r\n    if (isObject(tval) && isObject(sval)) {\r\n        mergeIf(tval, sval);\r\n    } else if (!Object.prototype.hasOwnProperty.call(target, key)) {\r\n        target[key] = clone(sval);\r\n    }\r\n}\r\n/**\r\n * @private\r\n */ function _deprecated(scope, value, previous, current) {\r\n    if (value !== undefined) {\r\n        console.warn(scope + ': \"' + previous + '\" is deprecated. Please use \"' + current + '\" instead');\r\n    }\r\n}\r\n// resolveObjectKey resolver cache\r\nconst keyResolvers = {\r\n    // Chart.helpers.core resolveObjectKey should resolve empty key to root object\r\n    '': (v)=>v,\r\n    // default resolvers\r\n    x: (o)=>o.x,\r\n    y: (o)=>o.y\r\n};\r\n/**\r\n * @private\r\n */ function _splitKey(key) {\r\n    const parts = key.split('.');\r\n    const keys = [];\r\n    let tmp = '';\r\n    for (const part of parts){\r\n        tmp += part;\r\n        if (tmp.endsWith('\\\\')) {\r\n            tmp = tmp.slice(0, -1) + '.';\r\n        } else {\r\n            keys.push(tmp);\r\n            tmp = '';\r\n        }\r\n    }\r\n    return keys;\r\n}\r\nfunction _getKeyResolver(key) {\r\n    const keys = _splitKey(key);\r\n    return (obj)=>{\r\n        for (const k of keys){\r\n            if (k === '') {\r\n                break;\r\n            }\r\n            obj = obj && obj[k];\r\n        }\r\n        return obj;\r\n    };\r\n}\r\nfunction resolveObjectKey(obj, key) {\r\n    const resolver = keyResolvers[key] || (keyResolvers[key] = _getKeyResolver(key));\r\n    return resolver(obj);\r\n}\r\n/**\r\n * @private\r\n */ function _capitalize(str) {\r\n    return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\nconst defined = (value)=>typeof value !== 'undefined';\r\nconst isFunction = (value)=>typeof value === 'function';\r\n// Adapted from https://stackoverflow.com/questions/31128855/comparing-ecma6-sets-for-equality#31129384\r\nconst setsEqual = (a, b)=>{\r\n    if (a.size !== b.size) {\r\n        return false;\r\n    }\r\n    for (const item of a){\r\n        if (!b.has(item)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n};\r\n/**\r\n * @param e - The event\r\n * @private\r\n */ function _isClickEvent(e) {\r\n    return e.type === 'mouseup' || e.type === 'click' || e.type === 'contextmenu';\r\n}\r\n\r\n/**\r\n * @alias Chart.helpers.math\r\n * @namespace\r\n */ const PI = Math.PI;\r\nconst TAU = 2 * PI;\r\nconst PITAU = TAU + PI;\r\nconst INFINITY = Number.POSITIVE_INFINITY;\r\nconst RAD_PER_DEG = PI / 180;\r\nconst HALF_PI = PI / 2;\r\nconst QUARTER_PI = PI / 4;\r\nconst TWO_THIRDS_PI = PI * 2 / 3;\r\nconst log10 = Math.log10;\r\nconst sign = Math.sign;\r\nfunction almostEquals(x, y, epsilon) {\r\n    return Math.abs(x - y) < epsilon;\r\n}\r\n/**\r\n * Implementation of the nice number algorithm used in determining where axis labels will go\r\n */ function niceNum(range) {\r\n    const roundedRange = Math.round(range);\r\n    range = almostEquals(range, roundedRange, range / 1000) ? roundedRange : range;\r\n    const niceRange = Math.pow(10, Math.floor(log10(range)));\r\n    const fraction = range / niceRange;\r\n    const niceFraction = fraction <= 1 ? 1 : fraction <= 2 ? 2 : fraction <= 5 ? 5 : 10;\r\n    return niceFraction * niceRange;\r\n}\r\n/**\r\n * Returns an array of factors sorted from 1 to sqrt(value)\r\n * @private\r\n */ function _factorize(value) {\r\n    const result = [];\r\n    const sqrt = Math.sqrt(value);\r\n    let i;\r\n    for(i = 1; i < sqrt; i++){\r\n        if (value % i === 0) {\r\n            result.push(i);\r\n            result.push(value / i);\r\n        }\r\n    }\r\n    if (sqrt === (sqrt | 0)) {\r\n        result.push(sqrt);\r\n    }\r\n    result.sort((a, b)=>a - b).pop();\r\n    return result;\r\n}\r\n/**\r\n * Verifies that attempting to coerce n to string or number won't throw a TypeError.\r\n */ function isNonPrimitive(n) {\r\n    return typeof n === 'symbol' || typeof n === 'object' && n !== null && !(Symbol.toPrimitive in n || 'toString' in n || 'valueOf' in n);\r\n}\r\nfunction isNumber(n) {\r\n    return !isNonPrimitive(n) && !isNaN(parseFloat(n)) && isFinite(n);\r\n}\r\nfunction almostWhole(x, epsilon) {\r\n    const rounded = Math.round(x);\r\n    return rounded - epsilon <= x && rounded + epsilon >= x;\r\n}\r\n/**\r\n * @private\r\n */ function _setMinAndMaxByKey(array, target, property) {\r\n    let i, ilen, value;\r\n    for(i = 0, ilen = array.length; i < ilen; i++){\r\n        value = array[i][property];\r\n        if (!isNaN(value)) {\r\n            target.min = Math.min(target.min, value);\r\n            target.max = Math.max(target.max, value);\r\n        }\r\n    }\r\n}\r\nfunction toRadians(degrees) {\r\n    return degrees * (PI / 180);\r\n}\r\nfunction toDegrees(radians) {\r\n    return radians * (180 / PI);\r\n}\r\n/**\r\n * Returns the number of decimal places\r\n * i.e. the number of digits after the decimal point, of the value of this Number.\r\n * @param x - A number.\r\n * @returns The number of decimal places.\r\n * @private\r\n */ function _decimalPlaces(x) {\r\n    if (!isNumberFinite(x)) {\r\n        return;\r\n    }\r\n    let e = 1;\r\n    let p = 0;\r\n    while(Math.round(x * e) / e !== x){\r\n        e *= 10;\r\n        p++;\r\n    }\r\n    return p;\r\n}\r\n// Gets the angle from vertical upright to the point about a centre.\r\nfunction getAngleFromPoint(centrePoint, anglePoint) {\r\n    const distanceFromXCenter = anglePoint.x - centrePoint.x;\r\n    const distanceFromYCenter = anglePoint.y - centrePoint.y;\r\n    const radialDistanceFromCenter = Math.sqrt(distanceFromXCenter * distanceFromXCenter + distanceFromYCenter * distanceFromYCenter);\r\n    let angle = Math.atan2(distanceFromYCenter, distanceFromXCenter);\r\n    if (angle < -0.5 * PI) {\r\n        angle += TAU; // make sure the returned angle is in the range of (-PI/2, 3PI/2]\r\n    }\r\n    return {\r\n        angle,\r\n        distance: radialDistanceFromCenter\r\n    };\r\n}\r\nfunction distanceBetweenPoints(pt1, pt2) {\r\n    return Math.sqrt(Math.pow(pt2.x - pt1.x, 2) + Math.pow(pt2.y - pt1.y, 2));\r\n}\r\n/**\r\n * Shortest distance between angles, in either direction.\r\n * @private\r\n */ function _angleDiff(a, b) {\r\n    return (a - b + PITAU) % TAU - PI;\r\n}\r\n/**\r\n * Normalize angle to be between 0 and 2*PI\r\n * @private\r\n */ function _normalizeAngle(a) {\r\n    return (a % TAU + TAU) % TAU;\r\n}\r\n/**\r\n * @private\r\n */ function _angleBetween(angle, start, end, sameAngleIsFullCircle) {\r\n    const a = _normalizeAngle(angle);\r\n    const s = _normalizeAngle(start);\r\n    const e = _normalizeAngle(end);\r\n    const angleToStart = _normalizeAngle(s - a);\r\n    const angleToEnd = _normalizeAngle(e - a);\r\n    const startToAngle = _normalizeAngle(a - s);\r\n    const endToAngle = _normalizeAngle(a - e);\r\n    return a === s || a === e || sameAngleIsFullCircle && s === e || angleToStart > angleToEnd && startToAngle < endToAngle;\r\n}\r\n/**\r\n * Limit `value` between `min` and `max`\r\n * @param value\r\n * @param min\r\n * @param max\r\n * @private\r\n */ function _limitValue(value, min, max) {\r\n    return Math.max(min, Math.min(max, value));\r\n}\r\n/**\r\n * @param {number} value\r\n * @private\r\n */ function _int16Range(value) {\r\n    return _limitValue(value, -32768, 32767);\r\n}\r\n/**\r\n * @param value\r\n * @param start\r\n * @param end\r\n * @param [epsilon]\r\n * @private\r\n */ function _isBetween(value, start, end, epsilon = 1e-6) {\r\n    return value >= Math.min(start, end) - epsilon && value <= Math.max(start, end) + epsilon;\r\n}\r\n\r\nfunction _lookup(table, value, cmp) {\r\n    cmp = cmp || ((index)=>table[index] < value);\r\n    let hi = table.length - 1;\r\n    let lo = 0;\r\n    let mid;\r\n    while(hi - lo > 1){\r\n        mid = lo + hi >> 1;\r\n        if (cmp(mid)) {\r\n            lo = mid;\r\n        } else {\r\n            hi = mid;\r\n        }\r\n    }\r\n    return {\r\n        lo,\r\n        hi\r\n    };\r\n}\r\n/**\r\n * Binary search\r\n * @param table - the table search. must be sorted!\r\n * @param key - property name for the value in each entry\r\n * @param value - value to find\r\n * @param last - lookup last index\r\n * @private\r\n */ const _lookupByKey = (table, key, value, last)=>_lookup(table, value, last ? (index)=>{\r\n        const ti = table[index][key];\r\n        return ti < value || ti === value && table[index + 1][key] === value;\r\n    } : (index)=>table[index][key] < value);\r\n/**\r\n * Reverse binary search\r\n * @param table - the table search. must be sorted!\r\n * @param key - property name for the value in each entry\r\n * @param value - value to find\r\n * @private\r\n */ const _rlookupByKey = (table, key, value)=>_lookup(table, value, (index)=>table[index][key] >= value);\r\n/**\r\n * Return subset of `values` between `min` and `max` inclusive.\r\n * Values are assumed to be in sorted order.\r\n * @param values - sorted array of values\r\n * @param min - min value\r\n * @param max - max value\r\n */ function _filterBetween(values, min, max) {\r\n    let start = 0;\r\n    let end = values.length;\r\n    while(start < end && values[start] < min){\r\n        start++;\r\n    }\r\n    while(end > start && values[end - 1] > max){\r\n        end--;\r\n    }\r\n    return start > 0 || end < values.length ? values.slice(start, end) : values;\r\n}\r\nconst arrayEvents = [\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'splice',\r\n    'unshift'\r\n];\r\nfunction listenArrayEvents(array, listener) {\r\n    if (array._chartjs) {\r\n        array._chartjs.listeners.push(listener);\r\n        return;\r\n    }\r\n    Object.defineProperty(array, '_chartjs', {\r\n        configurable: true,\r\n        enumerable: false,\r\n        value: {\r\n            listeners: [\r\n                listener\r\n            ]\r\n        }\r\n    });\r\n    arrayEvents.forEach((key)=>{\r\n        const method = '_onData' + _capitalize(key);\r\n        const base = array[key];\r\n        Object.defineProperty(array, key, {\r\n            configurable: true,\r\n            enumerable: false,\r\n            value (...args) {\r\n                const res = base.apply(this, args);\r\n                array._chartjs.listeners.forEach((object)=>{\r\n                    if (typeof object[method] === 'function') {\r\n                        object[method](...args);\r\n                    }\r\n                });\r\n                return res;\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction unlistenArrayEvents(array, listener) {\r\n    const stub = array._chartjs;\r\n    if (!stub) {\r\n        return;\r\n    }\r\n    const listeners = stub.listeners;\r\n    const index = listeners.indexOf(listener);\r\n    if (index !== -1) {\r\n        listeners.splice(index, 1);\r\n    }\r\n    if (listeners.length > 0) {\r\n        return;\r\n    }\r\n    arrayEvents.forEach((key)=>{\r\n        delete array[key];\r\n    });\r\n    delete array._chartjs;\r\n}\r\n/**\r\n * @param items\r\n */ function _arrayUnique(items) {\r\n    const set = new Set(items);\r\n    if (set.size === items.length) {\r\n        return items;\r\n    }\r\n    return Array.from(set);\r\n}\r\n\r\nfunction fontString(pixelSize, fontStyle, fontFamily) {\r\n    return fontStyle + ' ' + pixelSize + 'px ' + fontFamily;\r\n}\r\n/**\r\n* Request animation polyfill\r\n*/ const requestAnimFrame = function() {\r\n    if (typeof window === 'undefined') {\r\n        return function(callback) {\r\n            return callback();\r\n        };\r\n    }\r\n    return window.requestAnimationFrame;\r\n}();\r\n/**\r\n * Throttles calling `fn` once per animation frame\r\n * Latest arguments are used on the actual call\r\n */ function throttled(fn, thisArg) {\r\n    let argsToUse = [];\r\n    let ticking = false;\r\n    return function(...args) {\r\n        // Save the args for use later\r\n        argsToUse = args;\r\n        if (!ticking) {\r\n            ticking = true;\r\n            requestAnimFrame.call(window, ()=>{\r\n                ticking = false;\r\n                fn.apply(thisArg, argsToUse);\r\n            });\r\n        }\r\n    };\r\n}\r\n/**\r\n * Debounces calling `fn` for `delay` ms\r\n */ function debounce(fn, delay) {\r\n    let timeout;\r\n    return function(...args) {\r\n        if (delay) {\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(fn, delay, args);\r\n        } else {\r\n            fn.apply(this, args);\r\n        }\r\n        return delay;\r\n    };\r\n}\r\n/**\r\n * Converts 'start' to 'left', 'end' to 'right' and others to 'center'\r\n * @private\r\n */ const _toLeftRightCenter = (align)=>align === 'start' ? 'left' : align === 'end' ? 'right' : 'center';\r\n/**\r\n * Returns `start`, `end` or `(start + end) / 2` depending on `align`. Defaults to `center`\r\n * @private\r\n */ const _alignStartEnd = (align, start, end)=>align === 'start' ? start : align === 'end' ? end : (start + end) / 2;\r\n/**\r\n * Returns `left`, `right` or `(left + right) / 2` depending on `align`. Defaults to `left`\r\n * @private\r\n */ const _textX = (align, left, right, rtl)=>{\r\n    const check = rtl ? 'left' : 'right';\r\n    return align === check ? right : align === 'center' ? (left + right) / 2 : left;\r\n};\r\n/**\r\n * Return start and count of visible points.\r\n * @private\r\n */ function _getStartAndCountOfVisiblePoints(meta, points, animationsDisabled) {\r\n    const pointCount = points.length;\r\n    let start = 0;\r\n    let count = pointCount;\r\n    if (meta._sorted) {\r\n        const { iScale , vScale , _parsed  } = meta;\r\n        const spanGaps = meta.dataset ? meta.dataset.options ? meta.dataset.options.spanGaps : null : null;\r\n        const axis = iScale.axis;\r\n        const { min , max , minDefined , maxDefined  } = iScale.getUserBounds();\r\n        if (minDefined) {\r\n            start = Math.min(// @ts-expect-error Need to type _parsed\r\n            _lookupByKey(_parsed, axis, min).lo, // @ts-expect-error Need to fix types on _lookupByKey\r\n            animationsDisabled ? pointCount : _lookupByKey(points, axis, iScale.getPixelForValue(min)).lo);\r\n            if (spanGaps) {\r\n                const distanceToDefinedLo = _parsed.slice(0, start + 1).reverse().findIndex((point)=>!isNullOrUndef(point[vScale.axis]));\r\n                start -= Math.max(0, distanceToDefinedLo);\r\n            }\r\n            start = _limitValue(start, 0, pointCount - 1);\r\n        }\r\n        if (maxDefined) {\r\n            let end = Math.max(// @ts-expect-error Need to type _parsed\r\n            _lookupByKey(_parsed, iScale.axis, max, true).hi + 1, // @ts-expect-error Need to fix types on _lookupByKey\r\n            animationsDisabled ? 0 : _lookupByKey(points, axis, iScale.getPixelForValue(max), true).hi + 1);\r\n            if (spanGaps) {\r\n                const distanceToDefinedHi = _parsed.slice(end - 1).findIndex((point)=>!isNullOrUndef(point[vScale.axis]));\r\n                end += Math.max(0, distanceToDefinedHi);\r\n            }\r\n            count = _limitValue(end, start, pointCount) - start;\r\n        } else {\r\n            count = pointCount - start;\r\n        }\r\n    }\r\n    return {\r\n        start,\r\n        count\r\n    };\r\n}\r\n/**\r\n * Checks if the scale ranges have changed.\r\n * @param {object} meta - dataset meta.\r\n * @returns {boolean}\r\n * @private\r\n */ function _scaleRangesChanged(meta) {\r\n    const { xScale , yScale , _scaleRanges  } = meta;\r\n    const newRanges = {\r\n        xmin: xScale.min,\r\n        xmax: xScale.max,\r\n        ymin: yScale.min,\r\n        ymax: yScale.max\r\n    };\r\n    if (!_scaleRanges) {\r\n        meta._scaleRanges = newRanges;\r\n        return true;\r\n    }\r\n    const changed = _scaleRanges.xmin !== xScale.min || _scaleRanges.xmax !== xScale.max || _scaleRanges.ymin !== yScale.min || _scaleRanges.ymax !== yScale.max;\r\n    Object.assign(_scaleRanges, newRanges);\r\n    return changed;\r\n}\r\n\r\nconst atEdge = (t)=>t === 0 || t === 1;\r\nconst elasticIn = (t, s, p)=>-(Math.pow(2, 10 * (t -= 1)) * Math.sin((t - s) * TAU / p));\r\nconst elasticOut = (t, s, p)=>Math.pow(2, -10 * t) * Math.sin((t - s) * TAU / p) + 1;\r\n/**\r\n * Easing functions adapted from Robert Penner's easing equations.\r\n * @namespace Chart.helpers.easing.effects\r\n * @see http://www.robertpenner.com/easing/\r\n */ const effects = {\r\n    linear: (t)=>t,\r\n    easeInQuad: (t)=>t * t,\r\n    easeOutQuad: (t)=>-t * (t - 2),\r\n    easeInOutQuad: (t)=>(t /= 0.5) < 1 ? 0.5 * t * t : -0.5 * (--t * (t - 2) - 1),\r\n    easeInCubic: (t)=>t * t * t,\r\n    easeOutCubic: (t)=>(t -= 1) * t * t + 1,\r\n    easeInOutCubic: (t)=>(t /= 0.5) < 1 ? 0.5 * t * t * t : 0.5 * ((t -= 2) * t * t + 2),\r\n    easeInQuart: (t)=>t * t * t * t,\r\n    easeOutQuart: (t)=>-((t -= 1) * t * t * t - 1),\r\n    easeInOutQuart: (t)=>(t /= 0.5) < 1 ? 0.5 * t * t * t * t : -0.5 * ((t -= 2) * t * t * t - 2),\r\n    easeInQuint: (t)=>t * t * t * t * t,\r\n    easeOutQuint: (t)=>(t -= 1) * t * t * t * t + 1,\r\n    easeInOutQuint: (t)=>(t /= 0.5) < 1 ? 0.5 * t * t * t * t * t : 0.5 * ((t -= 2) * t * t * t * t + 2),\r\n    easeInSine: (t)=>-Math.cos(t * HALF_PI) + 1,\r\n    easeOutSine: (t)=>Math.sin(t * HALF_PI),\r\n    easeInOutSine: (t)=>-0.5 * (Math.cos(PI * t) - 1),\r\n    easeInExpo: (t)=>t === 0 ? 0 : Math.pow(2, 10 * (t - 1)),\r\n    easeOutExpo: (t)=>t === 1 ? 1 : -Math.pow(2, -10 * t) + 1,\r\n    easeInOutExpo: (t)=>atEdge(t) ? t : t < 0.5 ? 0.5 * Math.pow(2, 10 * (t * 2 - 1)) : 0.5 * (-Math.pow(2, -10 * (t * 2 - 1)) + 2),\r\n    easeInCirc: (t)=>t >= 1 ? t : -(Math.sqrt(1 - t * t) - 1),\r\n    easeOutCirc: (t)=>Math.sqrt(1 - (t -= 1) * t),\r\n    easeInOutCirc: (t)=>(t /= 0.5) < 1 ? -0.5 * (Math.sqrt(1 - t * t) - 1) : 0.5 * (Math.sqrt(1 - (t -= 2) * t) + 1),\r\n    easeInElastic: (t)=>atEdge(t) ? t : elasticIn(t, 0.075, 0.3),\r\n    easeOutElastic: (t)=>atEdge(t) ? t : elasticOut(t, 0.075, 0.3),\r\n    easeInOutElastic (t) {\r\n        const s = 0.1125;\r\n        const p = 0.45;\r\n        return atEdge(t) ? t : t < 0.5 ? 0.5 * elasticIn(t * 2, s, p) : 0.5 + 0.5 * elasticOut(t * 2 - 1, s, p);\r\n    },\r\n    easeInBack (t) {\r\n        const s = 1.70158;\r\n        return t * t * ((s + 1) * t - s);\r\n    },\r\n    easeOutBack (t) {\r\n        const s = 1.70158;\r\n        return (t -= 1) * t * ((s + 1) * t + s) + 1;\r\n    },\r\n    easeInOutBack (t) {\r\n        let s = 1.70158;\r\n        if ((t /= 0.5) < 1) {\r\n            return 0.5 * (t * t * (((s *= 1.525) + 1) * t - s));\r\n        }\r\n        return 0.5 * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2);\r\n    },\r\n    easeInBounce: (t)=>1 - effects.easeOutBounce(1 - t),\r\n    easeOutBounce (t) {\r\n        const m = 7.5625;\r\n        const d = 2.75;\r\n        if (t < 1 / d) {\r\n            return m * t * t;\r\n        }\r\n        if (t < 2 / d) {\r\n            return m * (t -= 1.5 / d) * t + 0.75;\r\n        }\r\n        if (t < 2.5 / d) {\r\n            return m * (t -= 2.25 / d) * t + 0.9375;\r\n        }\r\n        return m * (t -= 2.625 / d) * t + 0.984375;\r\n    },\r\n    easeInOutBounce: (t)=>t < 0.5 ? effects.easeInBounce(t * 2) * 0.5 : effects.easeOutBounce(t * 2 - 1) * 0.5 + 0.5\r\n};\r\n\r\nfunction isPatternOrGradient(value) {\r\n    if (value && typeof value === 'object') {\r\n        const type = value.toString();\r\n        return type === '[object CanvasPattern]' || type === '[object CanvasGradient]';\r\n    }\r\n    return false;\r\n}\r\nfunction color(value) {\r\n    return isPatternOrGradient(value) ? value : new Color(value);\r\n}\r\nfunction getHoverColor(value) {\r\n    return isPatternOrGradient(value) ? value : new Color(value).saturate(0.5).darken(0.1).hexString();\r\n}\r\n\r\nconst numbers = [\r\n    'x',\r\n    'y',\r\n    'borderWidth',\r\n    'radius',\r\n    'tension'\r\n];\r\nconst colors = [\r\n    'color',\r\n    'borderColor',\r\n    'backgroundColor'\r\n];\r\nfunction applyAnimationsDefaults(defaults) {\r\n    defaults.set('animation', {\r\n        delay: undefined,\r\n        duration: 1000,\r\n        easing: 'easeOutQuart',\r\n        fn: undefined,\r\n        from: undefined,\r\n        loop: undefined,\r\n        to: undefined,\r\n        type: undefined\r\n    });\r\n    defaults.describe('animation', {\r\n        _fallback: false,\r\n        _indexable: false,\r\n        _scriptable: (name)=>name !== 'onProgress' && name !== 'onComplete' && name !== 'fn'\r\n    });\r\n    defaults.set('animations', {\r\n        colors: {\r\n            type: 'color',\r\n            properties: colors\r\n        },\r\n        numbers: {\r\n            type: 'number',\r\n            properties: numbers\r\n        }\r\n    });\r\n    defaults.describe('animations', {\r\n        _fallback: 'animation'\r\n    });\r\n    defaults.set('transitions', {\r\n        active: {\r\n            animation: {\r\n                duration: 400\r\n            }\r\n        },\r\n        resize: {\r\n            animation: {\r\n                duration: 0\r\n            }\r\n        },\r\n        show: {\r\n            animations: {\r\n                colors: {\r\n                    from: 'transparent'\r\n                },\r\n                visible: {\r\n                    type: 'boolean',\r\n                    duration: 0\r\n                }\r\n            }\r\n        },\r\n        hide: {\r\n            animations: {\r\n                colors: {\r\n                    to: 'transparent'\r\n                },\r\n                visible: {\r\n                    type: 'boolean',\r\n                    easing: 'linear',\r\n                    fn: (v)=>v | 0\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction applyLayoutsDefaults(defaults) {\r\n    defaults.set('layout', {\r\n        autoPadding: true,\r\n        padding: {\r\n            top: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n            left: 0\r\n        }\r\n    });\r\n}\r\n\r\nconst intlCache = new Map();\r\nfunction getNumberFormat(locale, options) {\r\n    options = options || {};\r\n    const cacheKey = locale + JSON.stringify(options);\r\n    let formatter = intlCache.get(cacheKey);\r\n    if (!formatter) {\r\n        formatter = new Intl.NumberFormat(locale, options);\r\n        intlCache.set(cacheKey, formatter);\r\n    }\r\n    return formatter;\r\n}\r\nfunction formatNumber(num, locale, options) {\r\n    return getNumberFormat(locale, options).format(num);\r\n}\r\n\r\nconst formatters = {\r\n values (value) {\r\n        return isArray(value) ?  value : '' + value;\r\n    },\r\n numeric (tickValue, index, ticks) {\r\n        if (tickValue === 0) {\r\n            return '0';\r\n        }\r\n        const locale = this.chart.options.locale;\r\n        let notation;\r\n        let delta = tickValue;\r\n        if (ticks.length > 1) {\r\n            const maxTick = Math.max(Math.abs(ticks[0].value), Math.abs(ticks[ticks.length - 1].value));\r\n            if (maxTick < 1e-4 || maxTick > 1e+15) {\r\n                notation = 'scientific';\r\n            }\r\n            delta = calculateDelta(tickValue, ticks);\r\n        }\r\n        const logDelta = log10(Math.abs(delta));\r\n        const numDecimal = isNaN(logDelta) ? 1 : Math.max(Math.min(-1 * Math.floor(logDelta), 20), 0);\r\n        const options = {\r\n            notation,\r\n            minimumFractionDigits: numDecimal,\r\n            maximumFractionDigits: numDecimal\r\n        };\r\n        Object.assign(options, this.options.ticks.format);\r\n        return formatNumber(tickValue, locale, options);\r\n    },\r\n logarithmic (tickValue, index, ticks) {\r\n        if (tickValue === 0) {\r\n            return '0';\r\n        }\r\n        const remain = ticks[index].significand || tickValue / Math.pow(10, Math.floor(log10(tickValue)));\r\n        if ([\r\n            1,\r\n            2,\r\n            3,\r\n            5,\r\n            10,\r\n            15\r\n        ].includes(remain) || index > 0.8 * ticks.length) {\r\n            return formatters.numeric.call(this, tickValue, index, ticks);\r\n        }\r\n        return '';\r\n    }\r\n};\r\nfunction calculateDelta(tickValue, ticks) {\r\n    let delta = ticks.length > 3 ? ticks[2].value - ticks[1].value : ticks[1].value - ticks[0].value;\r\n    if (Math.abs(delta) >= 1 && tickValue !== Math.floor(tickValue)) {\r\n        delta = tickValue - Math.floor(tickValue);\r\n    }\r\n    return delta;\r\n}\r\n var Ticks = {\r\n    formatters\r\n};\r\n\r\nfunction applyScaleDefaults(defaults) {\r\n    defaults.set('scale', {\r\n        display: true,\r\n        offset: false,\r\n        reverse: false,\r\n        beginAtZero: false,\r\n bounds: 'ticks',\r\n        clip: true,\r\n grace: 0,\r\n        grid: {\r\n            display: true,\r\n            lineWidth: 1,\r\n            drawOnChartArea: true,\r\n            drawTicks: true,\r\n            tickLength: 8,\r\n            tickWidth: (_ctx, options)=>options.lineWidth,\r\n            tickColor: (_ctx, options)=>options.color,\r\n            offset: false\r\n        },\r\n        border: {\r\n            display: true,\r\n            dash: [],\r\n            dashOffset: 0.0,\r\n            width: 1\r\n        },\r\n        title: {\r\n            display: false,\r\n            text: '',\r\n            padding: {\r\n                top: 4,\r\n                bottom: 4\r\n            }\r\n        },\r\n        ticks: {\r\n            minRotation: 0,\r\n            maxRotation: 50,\r\n            mirror: false,\r\n            textStrokeWidth: 0,\r\n            textStrokeColor: '',\r\n            padding: 3,\r\n            display: true,\r\n            autoSkip: true,\r\n            autoSkipPadding: 3,\r\n            labelOffset: 0,\r\n            callback: Ticks.formatters.values,\r\n            minor: {},\r\n            major: {},\r\n            align: 'center',\r\n            crossAlign: 'near',\r\n            showLabelBackdrop: false,\r\n            backdropColor: 'rgba(255, 255, 255, 0.75)',\r\n            backdropPadding: 2\r\n        }\r\n    });\r\n    defaults.route('scale.ticks', 'color', '', 'color');\r\n    defaults.route('scale.grid', 'color', '', 'borderColor');\r\n    defaults.route('scale.border', 'color', '', 'borderColor');\r\n    defaults.route('scale.title', 'color', '', 'color');\r\n    defaults.describe('scale', {\r\n        _fallback: false,\r\n        _scriptable: (name)=>!name.startsWith('before') && !name.startsWith('after') && name !== 'callback' && name !== 'parser',\r\n        _indexable: (name)=>name !== 'borderDash' && name !== 'tickBorderDash' && name !== 'dash'\r\n    });\r\n    defaults.describe('scales', {\r\n        _fallback: 'scale'\r\n    });\r\n    defaults.describe('scale.ticks', {\r\n        _scriptable: (name)=>name !== 'backdropPadding' && name !== 'callback',\r\n        _indexable: (name)=>name !== 'backdropPadding'\r\n    });\r\n}\r\n\r\nconst overrides = Object.create(null);\r\nconst descriptors = Object.create(null);\r\n function getScope$1(node, key) {\r\n    if (!key) {\r\n        return node;\r\n    }\r\n    const keys = key.split('.');\r\n    for(let i = 0, n = keys.length; i < n; ++i){\r\n        const k = keys[i];\r\n        node = node[k] || (node[k] = Object.create(null));\r\n    }\r\n    return node;\r\n}\r\nfunction set(root, scope, values) {\r\n    if (typeof scope === 'string') {\r\n        return merge(getScope$1(root, scope), values);\r\n    }\r\n    return merge(getScope$1(root, ''), scope);\r\n}\r\n class Defaults {\r\n    constructor(_descriptors, _appliers){\r\n        this.animation = undefined;\r\n        this.backgroundColor = 'rgba(0,0,0,0.1)';\r\n        this.borderColor = 'rgba(0,0,0,0.1)';\r\n        this.color = '#666';\r\n        this.datasets = {};\r\n        this.devicePixelRatio = (context)=>context.chart.platform.getDevicePixelRatio();\r\n        this.elements = {};\r\n        this.events = [\r\n            'mousemove',\r\n            'mouseout',\r\n            'click',\r\n            'touchstart',\r\n            'touchmove'\r\n        ];\r\n        this.font = {\r\n            family: \"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif\",\r\n            size: 12,\r\n            style: 'normal',\r\n            lineHeight: 1.2,\r\n            weight: null\r\n        };\r\n        this.hover = {};\r\n        this.hoverBackgroundColor = (ctx, options)=>getHoverColor(options.backgroundColor);\r\n        this.hoverBorderColor = (ctx, options)=>getHoverColor(options.borderColor);\r\n        this.hoverColor = (ctx, options)=>getHoverColor(options.color);\r\n        this.indexAxis = 'x';\r\n        this.interaction = {\r\n            mode: 'nearest',\r\n            intersect: true,\r\n            includeInvisible: false\r\n        };\r\n        this.maintainAspectRatio = true;\r\n        this.onHover = null;\r\n        this.onClick = null;\r\n        this.parsing = true;\r\n        this.plugins = {};\r\n        this.responsive = true;\r\n        this.scale = undefined;\r\n        this.scales = {};\r\n        this.showLine = true;\r\n        this.drawActiveElementsOnTop = true;\r\n        this.describe(_descriptors);\r\n        this.apply(_appliers);\r\n    }\r\n set(scope, values) {\r\n        return set(this, scope, values);\r\n    }\r\n get(scope) {\r\n        return getScope$1(this, scope);\r\n    }\r\n describe(scope, values) {\r\n        return set(descriptors, scope, values);\r\n    }\r\n    override(scope, values) {\r\n        return set(overrides, scope, values);\r\n    }\r\n route(scope, name, targetScope, targetName) {\r\n        const scopeObject = getScope$1(this, scope);\r\n        const targetScopeObject = getScope$1(this, targetScope);\r\n        const privateName = '_' + name;\r\n        Object.defineProperties(scopeObject, {\r\n            [privateName]: {\r\n                value: scopeObject[name],\r\n                writable: true\r\n            },\r\n            [name]: {\r\n                enumerable: true,\r\n                get () {\r\n                    const local = this[privateName];\r\n                    const target = targetScopeObject[targetName];\r\n                    if (isObject(local)) {\r\n                        return Object.assign({}, target, local);\r\n                    }\r\n                    return valueOrDefault(local, target);\r\n                },\r\n                set (value) {\r\n                    this[privateName] = value;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    apply(appliers) {\r\n        appliers.forEach((apply)=>apply(this));\r\n    }\r\n}\r\nvar defaults = /* #__PURE__ */ new Defaults({\r\n    _scriptable: (name)=>!name.startsWith('on'),\r\n    _indexable: (name)=>name !== 'events',\r\n    hover: {\r\n        _fallback: 'interaction'\r\n    },\r\n    interaction: {\r\n        _scriptable: false,\r\n        _indexable: false\r\n    }\r\n}, [\r\n    applyAnimationsDefaults,\r\n    applyLayoutsDefaults,\r\n    applyScaleDefaults\r\n]);\r\n\r\n/**\r\n * Converts the given font object into a CSS font string.\r\n * @param font - A font object.\r\n * @return The CSS font string. See https://developer.mozilla.org/en-US/docs/Web/CSS/font\r\n * @private\r\n */ function toFontString(font) {\r\n    if (!font || isNullOrUndef(font.size) || isNullOrUndef(font.family)) {\r\n        return null;\r\n    }\r\n    return (font.style ? font.style + ' ' : '') + (font.weight ? font.weight + ' ' : '') + font.size + 'px ' + font.family;\r\n}\r\n/**\r\n * @private\r\n */ function _measureText(ctx, data, gc, longest, string) {\r\n    let textWidth = data[string];\r\n    if (!textWidth) {\r\n        textWidth = data[string] = ctx.measureText(string).width;\r\n        gc.push(string);\r\n    }\r\n    if (textWidth > longest) {\r\n        longest = textWidth;\r\n    }\r\n    return longest;\r\n}\r\n/**\r\n * @private\r\n */ // eslint-disable-next-line complexity\r\nfunction _longestText(ctx, font, arrayOfThings, cache) {\r\n    cache = cache || {};\r\n    let data = cache.data = cache.data || {};\r\n    let gc = cache.garbageCollect = cache.garbageCollect || [];\r\n    if (cache.font !== font) {\r\n        data = cache.data = {};\r\n        gc = cache.garbageCollect = [];\r\n        cache.font = font;\r\n    }\r\n    ctx.save();\r\n    ctx.font = font;\r\n    let longest = 0;\r\n    const ilen = arrayOfThings.length;\r\n    let i, j, jlen, thing, nestedThing;\r\n    for(i = 0; i < ilen; i++){\r\n        thing = arrayOfThings[i];\r\n        // Undefined strings and arrays should not be measured\r\n        if (thing !== undefined && thing !== null && !isArray(thing)) {\r\n            longest = _measureText(ctx, data, gc, longest, thing);\r\n        } else if (isArray(thing)) {\r\n            // if it is an array lets measure each element\r\n            // to do maybe simplify this function a bit so we can do this more recursively?\r\n            for(j = 0, jlen = thing.length; j < jlen; j++){\r\n                nestedThing = thing[j];\r\n                // Undefined strings and arrays should not be measured\r\n                if (nestedThing !== undefined && nestedThing !== null && !isArray(nestedThing)) {\r\n                    longest = _measureText(ctx, data, gc, longest, nestedThing);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    ctx.restore();\r\n    const gcLen = gc.length / 2;\r\n    if (gcLen > arrayOfThings.length) {\r\n        for(i = 0; i < gcLen; i++){\r\n            delete data[gc[i]];\r\n        }\r\n        gc.splice(0, gcLen);\r\n    }\r\n    return longest;\r\n}\r\n/**\r\n * Returns the aligned pixel value to avoid anti-aliasing blur\r\n * @param chart - The chart instance.\r\n * @param pixel - A pixel value.\r\n * @param width - The width of the element.\r\n * @returns The aligned pixel value.\r\n * @private\r\n */ function _alignPixel(chart, pixel, width) {\r\n    const devicePixelRatio = chart.currentDevicePixelRatio;\r\n    const halfWidth = width !== 0 ? Math.max(width / 2, 0.5) : 0;\r\n    return Math.round((pixel - halfWidth) * devicePixelRatio) / devicePixelRatio + halfWidth;\r\n}\r\n/**\r\n * Clears the entire canvas.\r\n */ function clearCanvas(canvas, ctx) {\r\n    if (!ctx && !canvas) {\r\n        return;\r\n    }\r\n    ctx = ctx || canvas.getContext('2d');\r\n    ctx.save();\r\n    // canvas.width and canvas.height do not consider the canvas transform,\r\n    // while clearRect does\r\n    ctx.resetTransform();\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.restore();\r\n}\r\nfunction drawPoint(ctx, options, x, y) {\r\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n    drawPointLegend(ctx, options, x, y, null);\r\n}\r\n// eslint-disable-next-line complexity\r\nfunction drawPointLegend(ctx, options, x, y, w) {\r\n    let type, xOffset, yOffset, size, cornerRadius, width, xOffsetW, yOffsetW;\r\n    const style = options.pointStyle;\r\n    const rotation = options.rotation;\r\n    const radius = options.radius;\r\n    let rad = (rotation || 0) * RAD_PER_DEG;\r\n    if (style && typeof style === 'object') {\r\n        type = style.toString();\r\n        if (type === '[object HTMLImageElement]' || type === '[object HTMLCanvasElement]') {\r\n            ctx.save();\r\n            ctx.translate(x, y);\r\n            ctx.rotate(rad);\r\n            ctx.drawImage(style, -style.width / 2, -style.height / 2, style.width, style.height);\r\n            ctx.restore();\r\n            return;\r\n        }\r\n    }\r\n    if (isNaN(radius) || radius <= 0) {\r\n        return;\r\n    }\r\n    ctx.beginPath();\r\n    switch(style){\r\n        // Default includes circle\r\n        default:\r\n            if (w) {\r\n                ctx.ellipse(x, y, w / 2, radius, 0, 0, TAU);\r\n            } else {\r\n                ctx.arc(x, y, radius, 0, TAU);\r\n            }\r\n            ctx.closePath();\r\n            break;\r\n        case 'triangle':\r\n            width = w ? w / 2 : radius;\r\n            ctx.moveTo(x + Math.sin(rad) * width, y - Math.cos(rad) * radius);\r\n            rad += TWO_THIRDS_PI;\r\n            ctx.lineTo(x + Math.sin(rad) * width, y - Math.cos(rad) * radius);\r\n            rad += TWO_THIRDS_PI;\r\n            ctx.lineTo(x + Math.sin(rad) * width, y - Math.cos(rad) * radius);\r\n            ctx.closePath();\r\n            break;\r\n        case 'rectRounded':\r\n            // NOTE: the rounded rect implementation changed to use `arc` instead of\r\n            // `quadraticCurveTo` since it generates better results when rect is\r\n            // almost a circle. 0.516 (instead of 0.5) produces results with visually\r\n            // closer proportion to the previous impl and it is inscribed in the\r\n            // circle with `radius`. For more details, see the following PRs:\r\n            // https://github.com/chartjs/Chart.js/issues/5597\r\n            // https://github.com/chartjs/Chart.js/issues/5858\r\n            cornerRadius = radius * 0.516;\r\n            size = radius - cornerRadius;\r\n            xOffset = Math.cos(rad + QUARTER_PI) * size;\r\n            xOffsetW = Math.cos(rad + QUARTER_PI) * (w ? w / 2 - cornerRadius : size);\r\n            yOffset = Math.sin(rad + QUARTER_PI) * size;\r\n            yOffsetW = Math.sin(rad + QUARTER_PI) * (w ? w / 2 - cornerRadius : size);\r\n            ctx.arc(x - xOffsetW, y - yOffset, cornerRadius, rad - PI, rad - HALF_PI);\r\n            ctx.arc(x + yOffsetW, y - xOffset, cornerRadius, rad - HALF_PI, rad);\r\n            ctx.arc(x + xOffsetW, y + yOffset, cornerRadius, rad, rad + HALF_PI);\r\n            ctx.arc(x - yOffsetW, y + xOffset, cornerRadius, rad + HALF_PI, rad + PI);\r\n            ctx.closePath();\r\n            break;\r\n        case 'rect':\r\n            if (!rotation) {\r\n                size = Math.SQRT1_2 * radius;\r\n                width = w ? w / 2 : size;\r\n                ctx.rect(x - width, y - size, 2 * width, 2 * size);\r\n                break;\r\n            }\r\n            rad += QUARTER_PI;\r\n        /* falls through */ case 'rectRot':\r\n            xOffsetW = Math.cos(rad) * (w ? w / 2 : radius);\r\n            xOffset = Math.cos(rad) * radius;\r\n            yOffset = Math.sin(rad) * radius;\r\n            yOffsetW = Math.sin(rad) * (w ? w / 2 : radius);\r\n            ctx.moveTo(x - xOffsetW, y - yOffset);\r\n            ctx.lineTo(x + yOffsetW, y - xOffset);\r\n            ctx.lineTo(x + xOffsetW, y + yOffset);\r\n            ctx.lineTo(x - yOffsetW, y + xOffset);\r\n            ctx.closePath();\r\n            break;\r\n        case 'crossRot':\r\n            rad += QUARTER_PI;\r\n        /* falls through */ case 'cross':\r\n            xOffsetW = Math.cos(rad) * (w ? w / 2 : radius);\r\n            xOffset = Math.cos(rad) * radius;\r\n            yOffset = Math.sin(rad) * radius;\r\n            yOffsetW = Math.sin(rad) * (w ? w / 2 : radius);\r\n            ctx.moveTo(x - xOffsetW, y - yOffset);\r\n            ctx.lineTo(x + xOffsetW, y + yOffset);\r\n            ctx.moveTo(x + yOffsetW, y - xOffset);\r\n            ctx.lineTo(x - yOffsetW, y + xOffset);\r\n            break;\r\n        case 'star':\r\n            xOffsetW = Math.cos(rad) * (w ? w / 2 : radius);\r\n            xOffset = Math.cos(rad) * radius;\r\n            yOffset = Math.sin(rad) * radius;\r\n            yOffsetW = Math.sin(rad) * (w ? w / 2 : radius);\r\n            ctx.moveTo(x - xOffsetW, y - yOffset);\r\n            ctx.lineTo(x + xOffsetW, y + yOffset);\r\n            ctx.moveTo(x + yOffsetW, y - xOffset);\r\n            ctx.lineTo(x - yOffsetW, y + xOffset);\r\n            rad += QUARTER_PI;\r\n            xOffsetW = Math.cos(rad) * (w ? w / 2 : radius);\r\n            xOffset = Math.cos(rad) * radius;\r\n            yOffset = Math.sin(rad) * radius;\r\n            yOffsetW = Math.sin(rad) * (w ? w / 2 : radius);\r\n            ctx.moveTo(x - xOffsetW, y - yOffset);\r\n            ctx.lineTo(x + xOffsetW, y + yOffset);\r\n            ctx.moveTo(x + yOffsetW, y - xOffset);\r\n            ctx.lineTo(x - yOffsetW, y + xOffset);\r\n            break;\r\n        case 'line':\r\n            xOffset = w ? w / 2 : Math.cos(rad) * radius;\r\n            yOffset = Math.sin(rad) * radius;\r\n            ctx.moveTo(x - xOffset, y - yOffset);\r\n            ctx.lineTo(x + xOffset, y + yOffset);\r\n            break;\r\n        case 'dash':\r\n            ctx.moveTo(x, y);\r\n            ctx.lineTo(x + Math.cos(rad) * (w ? w / 2 : radius), y + Math.sin(rad) * radius);\r\n            break;\r\n        case false:\r\n            ctx.closePath();\r\n            break;\r\n    }\r\n    ctx.fill();\r\n    if (options.borderWidth > 0) {\r\n        ctx.stroke();\r\n    }\r\n}\r\n/**\r\n * Returns true if the point is inside the rectangle\r\n * @param point - The point to test\r\n * @param area - The rectangle\r\n * @param margin - allowed margin\r\n * @private\r\n */ function _isPointInArea(point, area, margin) {\r\n    margin = margin || 0.5; // margin - default is to match rounded decimals\r\n    return !area || point && point.x > area.left - margin && point.x < area.right + margin && point.y > area.top - margin && point.y < area.bottom + margin;\r\n}\r\nfunction clipArea(ctx, area) {\r\n    ctx.save();\r\n    ctx.beginPath();\r\n    ctx.rect(area.left, area.top, area.right - area.left, area.bottom - area.top);\r\n    ctx.clip();\r\n}\r\nfunction unclipArea(ctx) {\r\n    ctx.restore();\r\n}\r\n/**\r\n * @private\r\n */ function _steppedLineTo(ctx, previous, target, flip, mode) {\r\n    if (!previous) {\r\n        return ctx.lineTo(target.x, target.y);\r\n    }\r\n    if (mode === 'middle') {\r\n        const midpoint = (previous.x + target.x) / 2.0;\r\n        ctx.lineTo(midpoint, previous.y);\r\n        ctx.lineTo(midpoint, target.y);\r\n    } else if (mode === 'after' !== !!flip) {\r\n        ctx.lineTo(previous.x, target.y);\r\n    } else {\r\n        ctx.lineTo(target.x, previous.y);\r\n    }\r\n    ctx.lineTo(target.x, target.y);\r\n}\r\n/**\r\n * @private\r\n */ function _bezierCurveTo(ctx, previous, target, flip) {\r\n    if (!previous) {\r\n        return ctx.lineTo(target.x, target.y);\r\n    }\r\n    ctx.bezierCurveTo(flip ? previous.cp1x : previous.cp2x, flip ? previous.cp1y : previous.cp2y, flip ? target.cp2x : target.cp1x, flip ? target.cp2y : target.cp1y, target.x, target.y);\r\n}\r\nfunction setRenderOpts(ctx, opts) {\r\n    if (opts.translation) {\r\n        ctx.translate(opts.translation[0], opts.translation[1]);\r\n    }\r\n    if (!isNullOrUndef(opts.rotation)) {\r\n        ctx.rotate(opts.rotation);\r\n    }\r\n    if (opts.color) {\r\n        ctx.fillStyle = opts.color;\r\n    }\r\n    if (opts.textAlign) {\r\n        ctx.textAlign = opts.textAlign;\r\n    }\r\n    if (opts.textBaseline) {\r\n        ctx.textBaseline = opts.textBaseline;\r\n    }\r\n}\r\nfunction decorateText(ctx, x, y, line, opts) {\r\n    if (opts.strikethrough || opts.underline) {\r\n        /**\r\n     * Now that IE11 support has been dropped, we can use more\r\n     * of the TextMetrics object. The actual bounding boxes\r\n     * are unflagged in Chrome, Firefox, Edge, and Safari so they\r\n     * can be safely used.\r\n     * See https://developer.mozilla.org/en-US/docs/Web/API/TextMetrics#Browser_compatibility\r\n     */ const metrics = ctx.measureText(line);\r\n        const left = x - metrics.actualBoundingBoxLeft;\r\n        const right = x + metrics.actualBoundingBoxRight;\r\n        const top = y - metrics.actualBoundingBoxAscent;\r\n        const bottom = y + metrics.actualBoundingBoxDescent;\r\n        const yDecoration = opts.strikethrough ? (top + bottom) / 2 : bottom;\r\n        ctx.strokeStyle = ctx.fillStyle;\r\n        ctx.beginPath();\r\n        ctx.lineWidth = opts.decorationWidth || 2;\r\n        ctx.moveTo(left, yDecoration);\r\n        ctx.lineTo(right, yDecoration);\r\n        ctx.stroke();\r\n    }\r\n}\r\nfunction drawBackdrop(ctx, opts) {\r\n    const oldColor = ctx.fillStyle;\r\n    ctx.fillStyle = opts.color;\r\n    ctx.fillRect(opts.left, opts.top, opts.width, opts.height);\r\n    ctx.fillStyle = oldColor;\r\n}\r\n/**\r\n * Render text onto the canvas\r\n */ function renderText(ctx, text, x, y, font, opts = {}) {\r\n    const lines = isArray(text) ? text : [\r\n        text\r\n    ];\r\n    const stroke = opts.strokeWidth > 0 && opts.strokeColor !== '';\r\n    let i, line;\r\n    ctx.save();\r\n    ctx.font = font.string;\r\n    setRenderOpts(ctx, opts);\r\n    for(i = 0; i < lines.length; ++i){\r\n        line = lines[i];\r\n        if (opts.backdrop) {\r\n            drawBackdrop(ctx, opts.backdrop);\r\n        }\r\n        if (stroke) {\r\n            if (opts.strokeColor) {\r\n                ctx.strokeStyle = opts.strokeColor;\r\n            }\r\n            if (!isNullOrUndef(opts.strokeWidth)) {\r\n                ctx.lineWidth = opts.strokeWidth;\r\n            }\r\n            ctx.strokeText(line, x, y, opts.maxWidth);\r\n        }\r\n        ctx.fillText(line, x, y, opts.maxWidth);\r\n        decorateText(ctx, x, y, line, opts);\r\n        y += Number(font.lineHeight);\r\n    }\r\n    ctx.restore();\r\n}\r\n/**\r\n * Add a path of a rectangle with rounded corners to the current sub-path\r\n * @param ctx - Context\r\n * @param rect - Bounding rect\r\n */ function addRoundedRectPath(ctx, rect) {\r\n    const { x , y , w , h , radius  } = rect;\r\n    // top left arc\r\n    ctx.arc(x + radius.topLeft, y + radius.topLeft, radius.topLeft, 1.5 * PI, PI, true);\r\n    // line from top left to bottom left\r\n    ctx.lineTo(x, y + h - radius.bottomLeft);\r\n    // bottom left arc\r\n    ctx.arc(x + radius.bottomLeft, y + h - radius.bottomLeft, radius.bottomLeft, PI, HALF_PI, true);\r\n    // line from bottom left to bottom right\r\n    ctx.lineTo(x + w - radius.bottomRight, y + h);\r\n    // bottom right arc\r\n    ctx.arc(x + w - radius.bottomRight, y + h - radius.bottomRight, radius.bottomRight, HALF_PI, 0, true);\r\n    // line from bottom right to top right\r\n    ctx.lineTo(x + w, y + radius.topRight);\r\n    // top right arc\r\n    ctx.arc(x + w - radius.topRight, y + radius.topRight, radius.topRight, 0, -HALF_PI, true);\r\n    // line from top right to top left\r\n    ctx.lineTo(x + radius.topLeft, y);\r\n}\r\n\r\nconst LINE_HEIGHT = /^(normal|(\\d+(?:\\.\\d+)?)(px|em|%)?)$/;\r\nconst FONT_STYLE = /^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;\r\n/**\r\n * @alias Chart.helpers.options\r\n * @namespace\r\n */ /**\r\n * Converts the given line height `value` in pixels for a specific font `size`.\r\n * @param value - The lineHeight to parse (eg. 1.6, '14px', '75%', '1.6em').\r\n * @param size - The font size (in pixels) used to resolve relative `value`.\r\n * @returns The effective line height in pixels (size * 1.2 if value is invalid).\r\n * @see https://developer.mozilla.org/en-US/docs/Web/CSS/line-height\r\n * @since 2.7.0\r\n */ function toLineHeight(value, size) {\r\n    const matches = ('' + value).match(LINE_HEIGHT);\r\n    if (!matches || matches[1] === 'normal') {\r\n        return size * 1.2;\r\n    }\r\n    value = +matches[2];\r\n    switch(matches[3]){\r\n        case 'px':\r\n            return value;\r\n        case '%':\r\n            value /= 100;\r\n            break;\r\n    }\r\n    return size * value;\r\n}\r\nconst numberOrZero = (v)=>+v || 0;\r\nfunction _readValueToProps(value, props) {\r\n    const ret = {};\r\n    const objProps = isObject(props);\r\n    const keys = objProps ? Object.keys(props) : props;\r\n    const read = isObject(value) ? objProps ? (prop)=>valueOrDefault(value[prop], value[props[prop]]) : (prop)=>value[prop] : ()=>value;\r\n    for (const prop of keys){\r\n        ret[prop] = numberOrZero(read(prop));\r\n    }\r\n    return ret;\r\n}\r\n/**\r\n * Converts the given value into a TRBL object.\r\n * @param value - If a number, set the value to all TRBL component,\r\n *  else, if an object, use defined properties and sets undefined ones to 0.\r\n *  x / y are shorthands for same value for left/right and top/bottom.\r\n * @returns The padding values (top, right, bottom, left)\r\n * @since 3.0.0\r\n */ function toTRBL(value) {\r\n    return _readValueToProps(value, {\r\n        top: 'y',\r\n        right: 'x',\r\n        bottom: 'y',\r\n        left: 'x'\r\n    });\r\n}\r\n/**\r\n * Converts the given value into a TRBL corners object (similar with css border-radius).\r\n * @param value - If a number, set the value to all TRBL corner components,\r\n *  else, if an object, use defined properties and sets undefined ones to 0.\r\n * @returns The TRBL corner values (topLeft, topRight, bottomLeft, bottomRight)\r\n * @since 3.0.0\r\n */ function toTRBLCorners(value) {\r\n    return _readValueToProps(value, [\r\n        'topLeft',\r\n        'topRight',\r\n        'bottomLeft',\r\n        'bottomRight'\r\n    ]);\r\n}\r\n/**\r\n * Converts the given value into a padding object with pre-computed width/height.\r\n * @param value - If a number, set the value to all TRBL component,\r\n *  else, if an object, use defined properties and sets undefined ones to 0.\r\n *  x / y are shorthands for same value for left/right and top/bottom.\r\n * @returns The padding values (top, right, bottom, left, width, height)\r\n * @since 2.7.0\r\n */ function toPadding(value) {\r\n    const obj = toTRBL(value);\r\n    obj.width = obj.left + obj.right;\r\n    obj.height = obj.top + obj.bottom;\r\n    return obj;\r\n}\r\n/**\r\n * Parses font options and returns the font object.\r\n * @param options - A object that contains font options to be parsed.\r\n * @param fallback - A object that contains fallback font options.\r\n * @return The font object.\r\n * @private\r\n */ function toFont(options, fallback) {\r\n    options = options || {};\r\n    fallback = fallback || defaults.font;\r\n    let size = valueOrDefault(options.size, fallback.size);\r\n    if (typeof size === 'string') {\r\n        size = parseInt(size, 10);\r\n    }\r\n    let style = valueOrDefault(options.style, fallback.style);\r\n    if (style && !('' + style).match(FONT_STYLE)) {\r\n        console.warn('Invalid font style specified: \"' + style + '\"');\r\n        style = undefined;\r\n    }\r\n    const font = {\r\n        family: valueOrDefault(options.family, fallback.family),\r\n        lineHeight: toLineHeight(valueOrDefault(options.lineHeight, fallback.lineHeight), size),\r\n        size,\r\n        style,\r\n        weight: valueOrDefault(options.weight, fallback.weight),\r\n        string: ''\r\n    };\r\n    font.string = toFontString(font);\r\n    return font;\r\n}\r\n/**\r\n * Evaluates the given `inputs` sequentially and returns the first defined value.\r\n * @param inputs - An array of values, falling back to the last value.\r\n * @param context - If defined and the current value is a function, the value\r\n * is called with `context` as first argument and the result becomes the new input.\r\n * @param index - If defined and the current value is an array, the value\r\n * at `index` become the new input.\r\n * @param info - object to return information about resolution in\r\n * @param info.cacheable - Will be set to `false` if option is not cacheable.\r\n * @since 2.7.0\r\n */ function resolve(inputs, context, index, info) {\r\n    let cacheable = true;\r\n    let i, ilen, value;\r\n    for(i = 0, ilen = inputs.length; i < ilen; ++i){\r\n        value = inputs[i];\r\n        if (value === undefined) {\r\n            continue;\r\n        }\r\n        if (context !== undefined && typeof value === 'function') {\r\n            value = value(context);\r\n            cacheable = false;\r\n        }\r\n        if (index !== undefined && isArray(value)) {\r\n            value = value[index % value.length];\r\n            cacheable = false;\r\n        }\r\n        if (value !== undefined) {\r\n            if (info && !cacheable) {\r\n                info.cacheable = false;\r\n            }\r\n            return value;\r\n        }\r\n    }\r\n}\r\n/**\r\n * @param minmax\r\n * @param grace\r\n * @param beginAtZero\r\n * @private\r\n */ function _addGrace(minmax, grace, beginAtZero) {\r\n    const { min , max  } = minmax;\r\n    const change = toDimension(grace, (max - min) / 2);\r\n    const keepZero = (value, add)=>beginAtZero && value === 0 ? 0 : value + add;\r\n    return {\r\n        min: keepZero(min, -Math.abs(change)),\r\n        max: keepZero(max, change)\r\n    };\r\n}\r\nfunction createContext(parentContext, context) {\r\n    return Object.assign(Object.create(parentContext), context);\r\n}\r\n\r\n/**\r\n * Creates a Proxy for resolving raw values for options.\r\n * @param scopes - The option scopes to look for values, in resolution order\r\n * @param prefixes - The prefixes for values, in resolution order.\r\n * @param rootScopes - The root option scopes\r\n * @param fallback - Parent scopes fallback\r\n * @param getTarget - callback for getting the target for changed values\r\n * @returns Proxy\r\n * @private\r\n */ function _createResolver(scopes, prefixes = [\r\n    ''\r\n], rootScopes, fallback, getTarget = ()=>scopes[0]) {\r\n    const finalRootScopes = rootScopes || scopes;\r\n    if (typeof fallback === 'undefined') {\r\n        fallback = _resolve('_fallback', scopes);\r\n    }\r\n    const cache = {\r\n        [Symbol.toStringTag]: 'Object',\r\n        _cacheable: true,\r\n        _scopes: scopes,\r\n        _rootScopes: finalRootScopes,\r\n        _fallback: fallback,\r\n        _getTarget: getTarget,\r\n        override: (scope)=>_createResolver([\r\n                scope,\r\n                ...scopes\r\n            ], prefixes, finalRootScopes, fallback)\r\n    };\r\n    return new Proxy(cache, {\r\n        /**\r\n     * A trap for the delete operator.\r\n     */ deleteProperty (target, prop) {\r\n            delete target[prop]; // remove from cache\r\n            delete target._keys; // remove cached keys\r\n            delete scopes[0][prop]; // remove from top level scope\r\n            return true;\r\n        },\r\n        /**\r\n     * A trap for getting property values.\r\n     */ get (target, prop) {\r\n            return _cached(target, prop, ()=>_resolveWithPrefixes(prop, prefixes, scopes, target));\r\n        },\r\n        /**\r\n     * A trap for Object.getOwnPropertyDescriptor.\r\n     * Also used by Object.hasOwnProperty.\r\n     */ getOwnPropertyDescriptor (target, prop) {\r\n            return Reflect.getOwnPropertyDescriptor(target._scopes[0], prop);\r\n        },\r\n        /**\r\n     * A trap for Object.getPrototypeOf.\r\n     */ getPrototypeOf () {\r\n            return Reflect.getPrototypeOf(scopes[0]);\r\n        },\r\n        /**\r\n     * A trap for the in operator.\r\n     */ has (target, prop) {\r\n            return getKeysFromAllScopes(target).includes(prop);\r\n        },\r\n        /**\r\n     * A trap for Object.getOwnPropertyNames and Object.getOwnPropertySymbols.\r\n     */ ownKeys (target) {\r\n            return getKeysFromAllScopes(target);\r\n        },\r\n        /**\r\n     * A trap for setting property values.\r\n     */ set (target, prop, value) {\r\n            const storage = target._storage || (target._storage = getTarget());\r\n            target[prop] = storage[prop] = value; // set to top level scope + cache\r\n            delete target._keys; // remove cached keys\r\n            return true;\r\n        }\r\n    });\r\n}\r\n/**\r\n * Returns an Proxy for resolving option values with context.\r\n * @param proxy - The Proxy returned by `_createResolver`\r\n * @param context - Context object for scriptable/indexable options\r\n * @param subProxy - The proxy provided for scriptable options\r\n * @param descriptorDefaults - Defaults for descriptors\r\n * @private\r\n */ function _attachContext(proxy, context, subProxy, descriptorDefaults) {\r\n    const cache = {\r\n        _cacheable: false,\r\n        _proxy: proxy,\r\n        _context: context,\r\n        _subProxy: subProxy,\r\n        _stack: new Set(),\r\n        _descriptors: _descriptors(proxy, descriptorDefaults),\r\n        setContext: (ctx)=>_attachContext(proxy, ctx, subProxy, descriptorDefaults),\r\n        override: (scope)=>_attachContext(proxy.override(scope), context, subProxy, descriptorDefaults)\r\n    };\r\n    return new Proxy(cache, {\r\n        /**\r\n     * A trap for the delete operator.\r\n     */ deleteProperty (target, prop) {\r\n            delete target[prop]; // remove from cache\r\n            delete proxy[prop]; // remove from proxy\r\n            return true;\r\n        },\r\n        /**\r\n     * A trap for getting property values.\r\n     */ get (target, prop, receiver) {\r\n            return _cached(target, prop, ()=>_resolveWithContext(target, prop, receiver));\r\n        },\r\n        /**\r\n     * A trap for Object.getOwnPropertyDescriptor.\r\n     * Also used by Object.hasOwnProperty.\r\n     */ getOwnPropertyDescriptor (target, prop) {\r\n            return target._descriptors.allKeys ? Reflect.has(proxy, prop) ? {\r\n                enumerable: true,\r\n                configurable: true\r\n            } : undefined : Reflect.getOwnPropertyDescriptor(proxy, prop);\r\n        },\r\n        /**\r\n     * A trap for Object.getPrototypeOf.\r\n     */ getPrototypeOf () {\r\n            return Reflect.getPrototypeOf(proxy);\r\n        },\r\n        /**\r\n     * A trap for the in operator.\r\n     */ has (target, prop) {\r\n            return Reflect.has(proxy, prop);\r\n        },\r\n        /**\r\n     * A trap for Object.getOwnPropertyNames and Object.getOwnPropertySymbols.\r\n     */ ownKeys () {\r\n            return Reflect.ownKeys(proxy);\r\n        },\r\n        /**\r\n     * A trap for setting property values.\r\n     */ set (target, prop, value) {\r\n            proxy[prop] = value; // set to proxy\r\n            delete target[prop]; // remove from cache\r\n            return true;\r\n        }\r\n    });\r\n}\r\n/**\r\n * @private\r\n */ function _descriptors(proxy, defaults = {\r\n    scriptable: true,\r\n    indexable: true\r\n}) {\r\n    const { _scriptable =defaults.scriptable , _indexable =defaults.indexable , _allKeys =defaults.allKeys  } = proxy;\r\n    return {\r\n        allKeys: _allKeys,\r\n        scriptable: _scriptable,\r\n        indexable: _indexable,\r\n        isScriptable: isFunction(_scriptable) ? _scriptable : ()=>_scriptable,\r\n        isIndexable: isFunction(_indexable) ? _indexable : ()=>_indexable\r\n    };\r\n}\r\nconst readKey = (prefix, name)=>prefix ? prefix + _capitalize(name) : name;\r\nconst needsSubResolver = (prop, value)=>isObject(value) && prop !== 'adapters' && (Object.getPrototypeOf(value) === null || value.constructor === Object);\r\nfunction _cached(target, prop, resolve) {\r\n    if (Object.prototype.hasOwnProperty.call(target, prop) || prop === 'constructor') {\r\n        return target[prop];\r\n    }\r\n    const value = resolve();\r\n    // cache the resolved value\r\n    target[prop] = value;\r\n    return value;\r\n}\r\nfunction _resolveWithContext(target, prop, receiver) {\r\n    const { _proxy , _context , _subProxy , _descriptors: descriptors  } = target;\r\n    let value = _proxy[prop]; // resolve from proxy\r\n    // resolve with context\r\n    if (isFunction(value) && descriptors.isScriptable(prop)) {\r\n        value = _resolveScriptable(prop, value, target, receiver);\r\n    }\r\n    if (isArray(value) && value.length) {\r\n        value = _resolveArray(prop, value, target, descriptors.isIndexable);\r\n    }\r\n    if (needsSubResolver(prop, value)) {\r\n        // if the resolved value is an object, create a sub resolver for it\r\n        value = _attachContext(value, _context, _subProxy && _subProxy[prop], descriptors);\r\n    }\r\n    return value;\r\n}\r\nfunction _resolveScriptable(prop, getValue, target, receiver) {\r\n    const { _proxy , _context , _subProxy , _stack  } = target;\r\n    if (_stack.has(prop)) {\r\n        throw new Error('Recursion detected: ' + Array.from(_stack).join('->') + '->' + prop);\r\n    }\r\n    _stack.add(prop);\r\n    let value = getValue(_context, _subProxy || receiver);\r\n    _stack.delete(prop);\r\n    if (needsSubResolver(prop, value)) {\r\n        // When scriptable option returns an object, create a resolver on that.\r\n        value = createSubResolver(_proxy._scopes, _proxy, prop, value);\r\n    }\r\n    return value;\r\n}\r\nfunction _resolveArray(prop, value, target, isIndexable) {\r\n    const { _proxy , _context , _subProxy , _descriptors: descriptors  } = target;\r\n    if (typeof _context.index !== 'undefined' && isIndexable(prop)) {\r\n        return value[_context.index % value.length];\r\n    } else if (isObject(value[0])) {\r\n        // Array of objects, return array or resolvers\r\n        const arr = value;\r\n        const scopes = _proxy._scopes.filter((s)=>s !== arr);\r\n        value = [];\r\n        for (const item of arr){\r\n            const resolver = createSubResolver(scopes, _proxy, prop, item);\r\n            value.push(_attachContext(resolver, _context, _subProxy && _subProxy[prop], descriptors));\r\n        }\r\n    }\r\n    return value;\r\n}\r\nfunction resolveFallback(fallback, prop, value) {\r\n    return isFunction(fallback) ? fallback(prop, value) : fallback;\r\n}\r\nconst getScope = (key, parent)=>key === true ? parent : typeof key === 'string' ? resolveObjectKey(parent, key) : undefined;\r\nfunction addScopes(set, parentScopes, key, parentFallback, value) {\r\n    for (const parent of parentScopes){\r\n        const scope = getScope(key, parent);\r\n        if (scope) {\r\n            set.add(scope);\r\n            const fallback = resolveFallback(scope._fallback, key, value);\r\n            if (typeof fallback !== 'undefined' && fallback !== key && fallback !== parentFallback) {\r\n                // When we reach the descriptor that defines a new _fallback, return that.\r\n                // The fallback will resume to that new scope.\r\n                return fallback;\r\n            }\r\n        } else if (scope === false && typeof parentFallback !== 'undefined' && key !== parentFallback) {\r\n            // Fallback to `false` results to `false`, when falling back to different key.\r\n            // For example `interaction` from `hover` or `plugins.tooltip` and `animation` from `animations`\r\n            return null;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction createSubResolver(parentScopes, resolver, prop, value) {\r\n    const rootScopes = resolver._rootScopes;\r\n    const fallback = resolveFallback(resolver._fallback, prop, value);\r\n    const allScopes = [\r\n        ...parentScopes,\r\n        ...rootScopes\r\n    ];\r\n    const set = new Set();\r\n    set.add(value);\r\n    let key = addScopesFromKey(set, allScopes, prop, fallback || prop, value);\r\n    if (key === null) {\r\n        return false;\r\n    }\r\n    if (typeof fallback !== 'undefined' && fallback !== prop) {\r\n        key = addScopesFromKey(set, allScopes, fallback, key, value);\r\n        if (key === null) {\r\n            return false;\r\n        }\r\n    }\r\n    return _createResolver(Array.from(set), [\r\n        ''\r\n    ], rootScopes, fallback, ()=>subGetTarget(resolver, prop, value));\r\n}\r\nfunction addScopesFromKey(set, allScopes, key, fallback, item) {\r\n    while(key){\r\n        key = addScopes(set, allScopes, key, fallback, item);\r\n    }\r\n    return key;\r\n}\r\nfunction subGetTarget(resolver, prop, value) {\r\n    const parent = resolver._getTarget();\r\n    if (!(prop in parent)) {\r\n        parent[prop] = {};\r\n    }\r\n    const target = parent[prop];\r\n    if (isArray(target) && isObject(value)) {\r\n        // For array of objects, the object is used to store updated values\r\n        return value;\r\n    }\r\n    return target || {};\r\n}\r\nfunction _resolveWithPrefixes(prop, prefixes, scopes, proxy) {\r\n    let value;\r\n    for (const prefix of prefixes){\r\n        value = _resolve(readKey(prefix, prop), scopes);\r\n        if (typeof value !== 'undefined') {\r\n            return needsSubResolver(prop, value) ? createSubResolver(scopes, proxy, prop, value) : value;\r\n        }\r\n    }\r\n}\r\nfunction _resolve(key, scopes) {\r\n    for (const scope of scopes){\r\n        if (!scope) {\r\n            continue;\r\n        }\r\n        const value = scope[key];\r\n        if (typeof value !== 'undefined') {\r\n            return value;\r\n        }\r\n    }\r\n}\r\nfunction getKeysFromAllScopes(target) {\r\n    let keys = target._keys;\r\n    if (!keys) {\r\n        keys = target._keys = resolveKeysFromAllScopes(target._scopes);\r\n    }\r\n    return keys;\r\n}\r\nfunction resolveKeysFromAllScopes(scopes) {\r\n    const set = new Set();\r\n    for (const scope of scopes){\r\n        for (const key of Object.keys(scope).filter((k)=>!k.startsWith('_'))){\r\n            set.add(key);\r\n        }\r\n    }\r\n    return Array.from(set);\r\n}\r\nfunction _parseObjectDataRadialScale(meta, data, start, count) {\r\n    const { iScale  } = meta;\r\n    const { key ='r'  } = this._parsing;\r\n    const parsed = new Array(count);\r\n    let i, ilen, index, item;\r\n    for(i = 0, ilen = count; i < ilen; ++i){\r\n        index = i + start;\r\n        item = data[index];\r\n        parsed[i] = {\r\n            r: iScale.parse(resolveObjectKey(item, key), index)\r\n        };\r\n    }\r\n    return parsed;\r\n}\r\n\r\nconst EPSILON = Number.EPSILON || 1e-14;\r\nconst getPoint = (points, i)=>i < points.length && !points[i].skip && points[i];\r\nconst getValueAxis = (indexAxis)=>indexAxis === 'x' ? 'y' : 'x';\r\nfunction splineCurve(firstPoint, middlePoint, afterPoint, t) {\r\n    // Props to Rob Spencer at scaled innovation for his post on splining between points\r\n    // http://scaledinnovation.com/analytics/splines/aboutSplines.html\r\n    // This function must also respect \"skipped\" points\r\n    const previous = firstPoint.skip ? middlePoint : firstPoint;\r\n    const current = middlePoint;\r\n    const next = afterPoint.skip ? middlePoint : afterPoint;\r\n    const d01 = distanceBetweenPoints(current, previous);\r\n    const d12 = distanceBetweenPoints(next, current);\r\n    let s01 = d01 / (d01 + d12);\r\n    let s12 = d12 / (d01 + d12);\r\n    // If all points are the same, s01 & s02 will be inf\r\n    s01 = isNaN(s01) ? 0 : s01;\r\n    s12 = isNaN(s12) ? 0 : s12;\r\n    const fa = t * s01; // scaling factor for triangle Ta\r\n    const fb = t * s12;\r\n    return {\r\n        previous: {\r\n            x: current.x - fa * (next.x - previous.x),\r\n            y: current.y - fa * (next.y - previous.y)\r\n        },\r\n        next: {\r\n            x: current.x + fb * (next.x - previous.x),\r\n            y: current.y + fb * (next.y - previous.y)\r\n        }\r\n    };\r\n}\r\n/**\r\n * Adjust tangents to ensure monotonic properties\r\n */ function monotoneAdjust(points, deltaK, mK) {\r\n    const pointsLen = points.length;\r\n    let alphaK, betaK, tauK, squaredMagnitude, pointCurrent;\r\n    let pointAfter = getPoint(points, 0);\r\n    for(let i = 0; i < pointsLen - 1; ++i){\r\n        pointCurrent = pointAfter;\r\n        pointAfter = getPoint(points, i + 1);\r\n        if (!pointCurrent || !pointAfter) {\r\n            continue;\r\n        }\r\n        if (almostEquals(deltaK[i], 0, EPSILON)) {\r\n            mK[i] = mK[i + 1] = 0;\r\n            continue;\r\n        }\r\n        alphaK = mK[i] / deltaK[i];\r\n        betaK = mK[i + 1] / deltaK[i];\r\n        squaredMagnitude = Math.pow(alphaK, 2) + Math.pow(betaK, 2);\r\n        if (squaredMagnitude <= 9) {\r\n            continue;\r\n        }\r\n        tauK = 3 / Math.sqrt(squaredMagnitude);\r\n        mK[i] = alphaK * tauK * deltaK[i];\r\n        mK[i + 1] = betaK * tauK * deltaK[i];\r\n    }\r\n}\r\nfunction monotoneCompute(points, mK, indexAxis = 'x') {\r\n    const valueAxis = getValueAxis(indexAxis);\r\n    const pointsLen = points.length;\r\n    let delta, pointBefore, pointCurrent;\r\n    let pointAfter = getPoint(points, 0);\r\n    for(let i = 0; i < pointsLen; ++i){\r\n        pointBefore = pointCurrent;\r\n        pointCurrent = pointAfter;\r\n        pointAfter = getPoint(points, i + 1);\r\n        if (!pointCurrent) {\r\n            continue;\r\n        }\r\n        const iPixel = pointCurrent[indexAxis];\r\n        const vPixel = pointCurrent[valueAxis];\r\n        if (pointBefore) {\r\n            delta = (iPixel - pointBefore[indexAxis]) / 3;\r\n            pointCurrent[`cp1${indexAxis}`] = iPixel - delta;\r\n            pointCurrent[`cp1${valueAxis}`] = vPixel - delta * mK[i];\r\n        }\r\n        if (pointAfter) {\r\n            delta = (pointAfter[indexAxis] - iPixel) / 3;\r\n            pointCurrent[`cp2${indexAxis}`] = iPixel + delta;\r\n            pointCurrent[`cp2${valueAxis}`] = vPixel + delta * mK[i];\r\n        }\r\n    }\r\n}\r\n/**\r\n * This function calculates Bézier control points in a similar way than |splineCurve|,\r\n * but preserves monotonicity of the provided data and ensures no local extremums are added\r\n * between the dataset discrete points due to the interpolation.\r\n * See : https://en.wikipedia.org/wiki/Monotone_cubic_interpolation\r\n */ function splineCurveMonotone(points, indexAxis = 'x') {\r\n    const valueAxis = getValueAxis(indexAxis);\r\n    const pointsLen = points.length;\r\n    const deltaK = Array(pointsLen).fill(0);\r\n    const mK = Array(pointsLen);\r\n    // Calculate slopes (deltaK) and initialize tangents (mK)\r\n    let i, pointBefore, pointCurrent;\r\n    let pointAfter = getPoint(points, 0);\r\n    for(i = 0; i < pointsLen; ++i){\r\n        pointBefore = pointCurrent;\r\n        pointCurrent = pointAfter;\r\n        pointAfter = getPoint(points, i + 1);\r\n        if (!pointCurrent) {\r\n            continue;\r\n        }\r\n        if (pointAfter) {\r\n            const slopeDelta = pointAfter[indexAxis] - pointCurrent[indexAxis];\r\n            // In the case of two points that appear at the same x pixel, slopeDeltaX is 0\r\n            deltaK[i] = slopeDelta !== 0 ? (pointAfter[valueAxis] - pointCurrent[valueAxis]) / slopeDelta : 0;\r\n        }\r\n        mK[i] = !pointBefore ? deltaK[i] : !pointAfter ? deltaK[i - 1] : sign(deltaK[i - 1]) !== sign(deltaK[i]) ? 0 : (deltaK[i - 1] + deltaK[i]) / 2;\r\n    }\r\n    monotoneAdjust(points, deltaK, mK);\r\n    monotoneCompute(points, mK, indexAxis);\r\n}\r\nfunction capControlPoint(pt, min, max) {\r\n    return Math.max(Math.min(pt, max), min);\r\n}\r\nfunction capBezierPoints(points, area) {\r\n    let i, ilen, point, inArea, inAreaPrev;\r\n    let inAreaNext = _isPointInArea(points[0], area);\r\n    for(i = 0, ilen = points.length; i < ilen; ++i){\r\n        inAreaPrev = inArea;\r\n        inArea = inAreaNext;\r\n        inAreaNext = i < ilen - 1 && _isPointInArea(points[i + 1], area);\r\n        if (!inArea) {\r\n            continue;\r\n        }\r\n        point = points[i];\r\n        if (inAreaPrev) {\r\n            point.cp1x = capControlPoint(point.cp1x, area.left, area.right);\r\n            point.cp1y = capControlPoint(point.cp1y, area.top, area.bottom);\r\n        }\r\n        if (inAreaNext) {\r\n            point.cp2x = capControlPoint(point.cp2x, area.left, area.right);\r\n            point.cp2y = capControlPoint(point.cp2y, area.top, area.bottom);\r\n        }\r\n    }\r\n}\r\n/**\r\n * @private\r\n */ function _updateBezierControlPoints(points, options, area, loop, indexAxis) {\r\n    let i, ilen, point, controlPoints;\r\n    // Only consider points that are drawn in case the spanGaps option is used\r\n    if (options.spanGaps) {\r\n        points = points.filter((pt)=>!pt.skip);\r\n    }\r\n    if (options.cubicInterpolationMode === 'monotone') {\r\n        splineCurveMonotone(points, indexAxis);\r\n    } else {\r\n        let prev = loop ? points[points.length - 1] : points[0];\r\n        for(i = 0, ilen = points.length; i < ilen; ++i){\r\n            point = points[i];\r\n            controlPoints = splineCurve(prev, point, points[Math.min(i + 1, ilen - (loop ? 0 : 1)) % ilen], options.tension);\r\n            point.cp1x = controlPoints.previous.x;\r\n            point.cp1y = controlPoints.previous.y;\r\n            point.cp2x = controlPoints.next.x;\r\n            point.cp2y = controlPoints.next.y;\r\n            prev = point;\r\n        }\r\n    }\r\n    if (options.capBezierPoints) {\r\n        capBezierPoints(points, area);\r\n    }\r\n}\r\n\r\n/**\r\n * @private\r\n */ function _isDomSupported() {\r\n    return typeof window !== 'undefined' && typeof document !== 'undefined';\r\n}\r\n/**\r\n * @private\r\n */ function _getParentNode(domNode) {\r\n    let parent = domNode.parentNode;\r\n    if (parent && parent.toString() === '[object ShadowRoot]') {\r\n        parent = parent.host;\r\n    }\r\n    return parent;\r\n}\r\n/**\r\n * convert max-width/max-height values that may be percentages into a number\r\n * @private\r\n */ function parseMaxStyle(styleValue, node, parentProperty) {\r\n    let valueInPixels;\r\n    if (typeof styleValue === 'string') {\r\n        valueInPixels = parseInt(styleValue, 10);\r\n        if (styleValue.indexOf('%') !== -1) {\r\n            // percentage * size in dimension\r\n            valueInPixels = valueInPixels / 100 * node.parentNode[parentProperty];\r\n        }\r\n    } else {\r\n        valueInPixels = styleValue;\r\n    }\r\n    return valueInPixels;\r\n}\r\nconst getComputedStyle = (element)=>element.ownerDocument.defaultView.getComputedStyle(element, null);\r\nfunction getStyle(el, property) {\r\n    return getComputedStyle(el).getPropertyValue(property);\r\n}\r\nconst positions = [\r\n    'top',\r\n    'right',\r\n    'bottom',\r\n    'left'\r\n];\r\nfunction getPositionedStyle(styles, style, suffix) {\r\n    const result = {};\r\n    suffix = suffix ? '-' + suffix : '';\r\n    for(let i = 0; i < 4; i++){\r\n        const pos = positions[i];\r\n        result[pos] = parseFloat(styles[style + '-' + pos + suffix]) || 0;\r\n    }\r\n    result.width = result.left + result.right;\r\n    result.height = result.top + result.bottom;\r\n    return result;\r\n}\r\nconst useOffsetPos = (x, y, target)=>(x > 0 || y > 0) && (!target || !target.shadowRoot);\r\n/**\r\n * @param e\r\n * @param canvas\r\n * @returns Canvas position\r\n */ function getCanvasPosition(e, canvas) {\r\n    const touches = e.touches;\r\n    const source = touches && touches.length ? touches[0] : e;\r\n    const { offsetX , offsetY  } = source;\r\n    let box = false;\r\n    let x, y;\r\n    if (useOffsetPos(offsetX, offsetY, e.target)) {\r\n        x = offsetX;\r\n        y = offsetY;\r\n    } else {\r\n        const rect = canvas.getBoundingClientRect();\r\n        x = source.clientX - rect.left;\r\n        y = source.clientY - rect.top;\r\n        box = true;\r\n    }\r\n    return {\r\n        x,\r\n        y,\r\n        box\r\n    };\r\n}\r\n/**\r\n * Gets an event's x, y coordinates, relative to the chart area\r\n * @param event\r\n * @param chart\r\n * @returns x and y coordinates of the event\r\n */ function getRelativePosition(event, chart) {\r\n    if ('native' in event) {\r\n        return event;\r\n    }\r\n    const { canvas , currentDevicePixelRatio  } = chart;\r\n    const style = getComputedStyle(canvas);\r\n    const borderBox = style.boxSizing === 'border-box';\r\n    const paddings = getPositionedStyle(style, 'padding');\r\n    const borders = getPositionedStyle(style, 'border', 'width');\r\n    const { x , y , box  } = getCanvasPosition(event, canvas);\r\n    const xOffset = paddings.left + (box && borders.left);\r\n    const yOffset = paddings.top + (box && borders.top);\r\n    let { width , height  } = chart;\r\n    if (borderBox) {\r\n        width -= paddings.width + borders.width;\r\n        height -= paddings.height + borders.height;\r\n    }\r\n    return {\r\n        x: Math.round((x - xOffset) / width * canvas.width / currentDevicePixelRatio),\r\n        y: Math.round((y - yOffset) / height * canvas.height / currentDevicePixelRatio)\r\n    };\r\n}\r\nfunction getContainerSize(canvas, width, height) {\r\n    let maxWidth, maxHeight;\r\n    if (width === undefined || height === undefined) {\r\n        const container = canvas && _getParentNode(canvas);\r\n        if (!container) {\r\n            width = canvas.clientWidth;\r\n            height = canvas.clientHeight;\r\n        } else {\r\n            const rect = container.getBoundingClientRect(); // this is the border box of the container\r\n            const containerStyle = getComputedStyle(container);\r\n            const containerBorder = getPositionedStyle(containerStyle, 'border', 'width');\r\n            const containerPadding = getPositionedStyle(containerStyle, 'padding');\r\n            width = rect.width - containerPadding.width - containerBorder.width;\r\n            height = rect.height - containerPadding.height - containerBorder.height;\r\n            maxWidth = parseMaxStyle(containerStyle.maxWidth, container, 'clientWidth');\r\n            maxHeight = parseMaxStyle(containerStyle.maxHeight, container, 'clientHeight');\r\n        }\r\n    }\r\n    return {\r\n        width,\r\n        height,\r\n        maxWidth: maxWidth || INFINITY,\r\n        maxHeight: maxHeight || INFINITY\r\n    };\r\n}\r\nconst round1 = (v)=>Math.round(v * 10) / 10;\r\n// eslint-disable-next-line complexity\r\nfunction getMaximumSize(canvas, bbWidth, bbHeight, aspectRatio) {\r\n    const style = getComputedStyle(canvas);\r\n    const margins = getPositionedStyle(style, 'margin');\r\n    const maxWidth = parseMaxStyle(style.maxWidth, canvas, 'clientWidth') || INFINITY;\r\n    const maxHeight = parseMaxStyle(style.maxHeight, canvas, 'clientHeight') || INFINITY;\r\n    const containerSize = getContainerSize(canvas, bbWidth, bbHeight);\r\n    let { width , height  } = containerSize;\r\n    if (style.boxSizing === 'content-box') {\r\n        const borders = getPositionedStyle(style, 'border', 'width');\r\n        const paddings = getPositionedStyle(style, 'padding');\r\n        width -= paddings.width + borders.width;\r\n        height -= paddings.height + borders.height;\r\n    }\r\n    width = Math.max(0, width - margins.width);\r\n    height = Math.max(0, aspectRatio ? width / aspectRatio : height - margins.height);\r\n    width = round1(Math.min(width, maxWidth, containerSize.maxWidth));\r\n    height = round1(Math.min(height, maxHeight, containerSize.maxHeight));\r\n    if (width && !height) {\r\n        // https://github.com/chartjs/Chart.js/issues/4659\r\n        // If the canvas has width, but no height, default to aspectRatio of 2 (canvas default)\r\n        height = round1(width / 2);\r\n    }\r\n    const maintainHeight = bbWidth !== undefined || bbHeight !== undefined;\r\n    if (maintainHeight && aspectRatio && containerSize.height && height > containerSize.height) {\r\n        height = containerSize.height;\r\n        width = round1(Math.floor(height * aspectRatio));\r\n    }\r\n    return {\r\n        width,\r\n        height\r\n    };\r\n}\r\n/**\r\n * @param chart\r\n * @param forceRatio\r\n * @param forceStyle\r\n * @returns True if the canvas context size or transformation has changed.\r\n */ function retinaScale(chart, forceRatio, forceStyle) {\r\n    const pixelRatio = forceRatio || 1;\r\n    const deviceHeight = Math.floor(chart.height * pixelRatio);\r\n    const deviceWidth = Math.floor(chart.width * pixelRatio);\r\n    chart.height = Math.floor(chart.height);\r\n    chart.width = Math.floor(chart.width);\r\n    const canvas = chart.canvas;\r\n    // If no style has been set on the canvas, the render size is used as display size,\r\n    // making the chart visually bigger, so let's enforce it to the \"correct\" values.\r\n    // See https://github.com/chartjs/Chart.js/issues/3575\r\n    if (canvas.style && (forceStyle || !canvas.style.height && !canvas.style.width)) {\r\n        canvas.style.height = `${chart.height}px`;\r\n        canvas.style.width = `${chart.width}px`;\r\n    }\r\n    if (chart.currentDevicePixelRatio !== pixelRatio || canvas.height !== deviceHeight || canvas.width !== deviceWidth) {\r\n        chart.currentDevicePixelRatio = pixelRatio;\r\n        canvas.height = deviceHeight;\r\n        canvas.width = deviceWidth;\r\n        chart.ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n/**\r\n * Detects support for options object argument in addEventListener.\r\n * https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#Safely_detecting_option_support\r\n * @private\r\n */ const supportsEventListenerOptions = function() {\r\n    let passiveSupported = false;\r\n    try {\r\n        const options = {\r\n            get passive () {\r\n                passiveSupported = true;\r\n                return false;\r\n            }\r\n        };\r\n        if (_isDomSupported()) {\r\n            window.addEventListener('test', null, options);\r\n            window.removeEventListener('test', null, options);\r\n        }\r\n    } catch (e) {\r\n    // continue regardless of error\r\n    }\r\n    return passiveSupported;\r\n}();\r\n/**\r\n * The \"used\" size is the final value of a dimension property after all calculations have\r\n * been performed. This method uses the computed style of `element` but returns undefined\r\n * if the computed style is not expressed in pixels. That can happen in some cases where\r\n * `element` has a size relative to its parent and this last one is not yet displayed,\r\n * for example because of `display: none` on a parent node.\r\n * @see https://developer.mozilla.org/en-US/docs/Web/CSS/used_value\r\n * @returns Size in pixels or undefined if unknown.\r\n */ function readUsedSize(element, property) {\r\n    const value = getStyle(element, property);\r\n    const matches = value && value.match(/^(\\d+)(\\.\\d+)?px$/);\r\n    return matches ? +matches[1] : undefined;\r\n}\r\n\r\n/**\r\n * @private\r\n */ function _pointInLine(p1, p2, t, mode) {\r\n    return {\r\n        x: p1.x + t * (p2.x - p1.x),\r\n        y: p1.y + t * (p2.y - p1.y)\r\n    };\r\n}\r\n/**\r\n * @private\r\n */ function _steppedInterpolation(p1, p2, t, mode) {\r\n    return {\r\n        x: p1.x + t * (p2.x - p1.x),\r\n        y: mode === 'middle' ? t < 0.5 ? p1.y : p2.y : mode === 'after' ? t < 1 ? p1.y : p2.y : t > 0 ? p2.y : p1.y\r\n    };\r\n}\r\n/**\r\n * @private\r\n */ function _bezierInterpolation(p1, p2, t, mode) {\r\n    const cp1 = {\r\n        x: p1.cp2x,\r\n        y: p1.cp2y\r\n    };\r\n    const cp2 = {\r\n        x: p2.cp1x,\r\n        y: p2.cp1y\r\n    };\r\n    const a = _pointInLine(p1, cp1, t);\r\n    const b = _pointInLine(cp1, cp2, t);\r\n    const c = _pointInLine(cp2, p2, t);\r\n    const d = _pointInLine(a, b, t);\r\n    const e = _pointInLine(b, c, t);\r\n    return _pointInLine(d, e, t);\r\n}\r\n\r\nconst getRightToLeftAdapter = function(rectX, width) {\r\n    return {\r\n        x (x) {\r\n            return rectX + rectX + width - x;\r\n        },\r\n        setWidth (w) {\r\n            width = w;\r\n        },\r\n        textAlign (align) {\r\n            if (align === 'center') {\r\n                return align;\r\n            }\r\n            return align === 'right' ? 'left' : 'right';\r\n        },\r\n        xPlus (x, value) {\r\n            return x - value;\r\n        },\r\n        leftForLtr (x, itemWidth) {\r\n            return x - itemWidth;\r\n        }\r\n    };\r\n};\r\nconst getLeftToRightAdapter = function() {\r\n    return {\r\n        x (x) {\r\n            return x;\r\n        },\r\n        setWidth (w) {},\r\n        textAlign (align) {\r\n            return align;\r\n        },\r\n        xPlus (x, value) {\r\n            return x + value;\r\n        },\r\n        leftForLtr (x, _itemWidth) {\r\n            return x;\r\n        }\r\n    };\r\n};\r\nfunction getRtlAdapter(rtl, rectX, width) {\r\n    return rtl ? getRightToLeftAdapter(rectX, width) : getLeftToRightAdapter();\r\n}\r\nfunction overrideTextDirection(ctx, direction) {\r\n    let style, original;\r\n    if (direction === 'ltr' || direction === 'rtl') {\r\n        style = ctx.canvas.style;\r\n        original = [\r\n            style.getPropertyValue('direction'),\r\n            style.getPropertyPriority('direction')\r\n        ];\r\n        style.setProperty('direction', direction, 'important');\r\n        ctx.prevTextDirection = original;\r\n    }\r\n}\r\nfunction restoreTextDirection(ctx, original) {\r\n    if (original !== undefined) {\r\n        delete ctx.prevTextDirection;\r\n        ctx.canvas.style.setProperty('direction', original[0], original[1]);\r\n    }\r\n}\r\n\r\nfunction propertyFn(property) {\r\n    if (property === 'angle') {\r\n        return {\r\n            between: _angleBetween,\r\n            compare: _angleDiff,\r\n            normalize: _normalizeAngle\r\n        };\r\n    }\r\n    return {\r\n        between: _isBetween,\r\n        compare: (a, b)=>a - b,\r\n        normalize: (x)=>x\r\n    };\r\n}\r\nfunction normalizeSegment({ start , end , count , loop , style  }) {\r\n    return {\r\n        start: start % count,\r\n        end: end % count,\r\n        loop: loop && (end - start + 1) % count === 0,\r\n        style\r\n    };\r\n}\r\nfunction getSegment(segment, points, bounds) {\r\n    const { property , start: startBound , end: endBound  } = bounds;\r\n    const { between , normalize  } = propertyFn(property);\r\n    const count = points.length;\r\n    let { start , end , loop  } = segment;\r\n    let i, ilen;\r\n    if (loop) {\r\n        start += count;\r\n        end += count;\r\n        for(i = 0, ilen = count; i < ilen; ++i){\r\n            if (!between(normalize(points[start % count][property]), startBound, endBound)) {\r\n                break;\r\n            }\r\n            start--;\r\n            end--;\r\n        }\r\n        start %= count;\r\n        end %= count;\r\n    }\r\n    if (end < start) {\r\n        end += count;\r\n    }\r\n    return {\r\n        start,\r\n        end,\r\n        loop,\r\n        style: segment.style\r\n    };\r\n}\r\n function _boundSegment(segment, points, bounds) {\r\n    if (!bounds) {\r\n        return [\r\n            segment\r\n        ];\r\n    }\r\n    const { property , start: startBound , end: endBound  } = bounds;\r\n    const count = points.length;\r\n    const { compare , between , normalize  } = propertyFn(property);\r\n    const { start , end , loop , style  } = getSegment(segment, points, bounds);\r\n    const result = [];\r\n    let inside = false;\r\n    let subStart = null;\r\n    let value, point, prevValue;\r\n    const startIsBefore = ()=>between(startBound, prevValue, value) && compare(startBound, prevValue) !== 0;\r\n    const endIsBefore = ()=>compare(endBound, value) === 0 || between(endBound, prevValue, value);\r\n    const shouldStart = ()=>inside || startIsBefore();\r\n    const shouldStop = ()=>!inside || endIsBefore();\r\n    for(let i = start, prev = start; i <= end; ++i){\r\n        point = points[i % count];\r\n        if (point.skip) {\r\n            continue;\r\n        }\r\n        value = normalize(point[property]);\r\n        if (value === prevValue) {\r\n            continue;\r\n        }\r\n        inside = between(value, startBound, endBound);\r\n        if (subStart === null && shouldStart()) {\r\n            subStart = compare(value, startBound) === 0 ? i : prev;\r\n        }\r\n        if (subStart !== null && shouldStop()) {\r\n            result.push(normalizeSegment({\r\n                start: subStart,\r\n                end: i,\r\n                loop,\r\n                count,\r\n                style\r\n            }));\r\n            subStart = null;\r\n        }\r\n        prev = i;\r\n        prevValue = value;\r\n    }\r\n    if (subStart !== null) {\r\n        result.push(normalizeSegment({\r\n            start: subStart,\r\n            end,\r\n            loop,\r\n            count,\r\n            style\r\n        }));\r\n    }\r\n    return result;\r\n}\r\n function _boundSegments(line, bounds) {\r\n    const result = [];\r\n    const segments = line.segments;\r\n    for(let i = 0; i < segments.length; i++){\r\n        const sub = _boundSegment(segments[i], line.points, bounds);\r\n        if (sub.length) {\r\n            result.push(...sub);\r\n        }\r\n    }\r\n    return result;\r\n}\r\n function findStartAndEnd(points, count, loop, spanGaps) {\r\n    let start = 0;\r\n    let end = count - 1;\r\n    if (loop && !spanGaps) {\r\n        while(start < count && !points[start].skip){\r\n            start++;\r\n        }\r\n    }\r\n    while(start < count && points[start].skip){\r\n        start++;\r\n    }\r\n    start %= count;\r\n    if (loop) {\r\n        end += start;\r\n    }\r\n    while(end > start && points[end % count].skip){\r\n        end--;\r\n    }\r\n    end %= count;\r\n    return {\r\n        start,\r\n        end\r\n    };\r\n}\r\n function solidSegments(points, start, max, loop) {\r\n    const count = points.length;\r\n    const result = [];\r\n    let last = start;\r\n    let prev = points[start];\r\n    let end;\r\n    for(end = start + 1; end <= max; ++end){\r\n        const cur = points[end % count];\r\n        if (cur.skip || cur.stop) {\r\n            if (!prev.skip) {\r\n                loop = false;\r\n                result.push({\r\n                    start: start % count,\r\n                    end: (end - 1) % count,\r\n                    loop\r\n                });\r\n                start = last = cur.stop ? end : null;\r\n            }\r\n        } else {\r\n            last = end;\r\n            if (prev.skip) {\r\n                start = end;\r\n            }\r\n        }\r\n        prev = cur;\r\n    }\r\n    if (last !== null) {\r\n        result.push({\r\n            start: start % count,\r\n            end: last % count,\r\n            loop\r\n        });\r\n    }\r\n    return result;\r\n}\r\n function _computeSegments(line, segmentOptions) {\r\n    const points = line.points;\r\n    const spanGaps = line.options.spanGaps;\r\n    const count = points.length;\r\n    if (!count) {\r\n        return [];\r\n    }\r\n    const loop = !!line._loop;\r\n    const { start , end  } = findStartAndEnd(points, count, loop, spanGaps);\r\n    if (spanGaps === true) {\r\n        return splitByStyles(line, [\r\n            {\r\n                start,\r\n                end,\r\n                loop\r\n            }\r\n        ], points, segmentOptions);\r\n    }\r\n    const max = end < start ? end + count : end;\r\n    const completeLoop = !!line._fullLoop && start === 0 && end === count - 1;\r\n    return splitByStyles(line, solidSegments(points, start, max, completeLoop), points, segmentOptions);\r\n}\r\n function splitByStyles(line, segments, points, segmentOptions) {\r\n    if (!segmentOptions || !segmentOptions.setContext || !points) {\r\n        return segments;\r\n    }\r\n    return doSplitByStyles(line, segments, points, segmentOptions);\r\n}\r\n function doSplitByStyles(line, segments, points, segmentOptions) {\r\n    const chartContext = line._chart.getContext();\r\n    const baseStyle = readStyle(line.options);\r\n    const { _datasetIndex: datasetIndex , options: { spanGaps  }  } = line;\r\n    const count = points.length;\r\n    const result = [];\r\n    let prevStyle = baseStyle;\r\n    let start = segments[0].start;\r\n    let i = start;\r\n    function addStyle(s, e, l, st) {\r\n        const dir = spanGaps ? -1 : 1;\r\n        if (s === e) {\r\n            return;\r\n        }\r\n        s += count;\r\n        while(points[s % count].skip){\r\n            s -= dir;\r\n        }\r\n        while(points[e % count].skip){\r\n            e += dir;\r\n        }\r\n        if (s % count !== e % count) {\r\n            result.push({\r\n                start: s % count,\r\n                end: e % count,\r\n                loop: l,\r\n                style: st\r\n            });\r\n            prevStyle = st;\r\n            start = e % count;\r\n        }\r\n    }\r\n    for (const segment of segments){\r\n        start = spanGaps ? start : segment.start;\r\n        let prev = points[start % count];\r\n        let style;\r\n        for(i = start + 1; i <= segment.end; i++){\r\n            const pt = points[i % count];\r\n            style = readStyle(segmentOptions.setContext(createContext(chartContext, {\r\n                type: 'segment',\r\n                p0: prev,\r\n                p1: pt,\r\n                p0DataIndex: (i - 1) % count,\r\n                p1DataIndex: i % count,\r\n                datasetIndex\r\n            })));\r\n            if (styleChanged(style, prevStyle)) {\r\n                addStyle(start, i - 1, segment.loop, prevStyle);\r\n            }\r\n            prev = pt;\r\n            prevStyle = style;\r\n        }\r\n        if (start < i - 1) {\r\n            addStyle(start, i - 1, segment.loop, prevStyle);\r\n        }\r\n    }\r\n    return result;\r\n}\r\nfunction readStyle(options) {\r\n    return {\r\n        backgroundColor: options.backgroundColor,\r\n        borderCapStyle: options.borderCapStyle,\r\n        borderDash: options.borderDash,\r\n        borderDashOffset: options.borderDashOffset,\r\n        borderJoinStyle: options.borderJoinStyle,\r\n        borderWidth: options.borderWidth,\r\n        borderColor: options.borderColor\r\n    };\r\n}\r\nfunction styleChanged(style, prevStyle) {\r\n    if (!prevStyle) {\r\n        return false;\r\n    }\r\n    const cache = [];\r\n    const replacer = function(key, value) {\r\n        if (!isPatternOrGradient(value)) {\r\n            return value;\r\n        }\r\n        if (!cache.includes(value)) {\r\n            cache.push(value);\r\n        }\r\n        return cache.indexOf(value);\r\n    };\r\n    return JSON.stringify(style, replacer) !== JSON.stringify(prevStyle, replacer);\r\n}\r\n\r\nfunction getSizeForArea(scale, chartArea, field) {\r\n    return scale.options.clip ? scale[field] : chartArea[field];\r\n}\r\nfunction getDatasetArea(meta, chartArea) {\r\n    const { xScale , yScale  } = meta;\r\n    if (xScale && yScale) {\r\n        return {\r\n            left: getSizeForArea(xScale, chartArea, 'left'),\r\n            right: getSizeForArea(xScale, chartArea, 'right'),\r\n            top: getSizeForArea(yScale, chartArea, 'top'),\r\n            bottom: getSizeForArea(yScale, chartArea, 'bottom')\r\n        };\r\n    }\r\n    return chartArea;\r\n}\r\nfunction getDatasetClipArea(chart, meta) {\r\n    const clip = meta._clip;\r\n    if (clip.disabled) {\r\n        return false;\r\n    }\r\n    const area = getDatasetArea(meta, chart.chartArea);\r\n    return {\r\n        left: clip.left === false ? 0 : area.left - (clip.left === true ? 0 : clip.left),\r\n        right: clip.right === false ? chart.width : area.right + (clip.right === true ? 0 : clip.right),\r\n        top: clip.top === false ? 0 : area.top - (clip.top === true ? 0 : clip.top),\r\n        bottom: clip.bottom === false ? chart.height : area.bottom + (clip.bottom === true ? 0 : clip.bottom)\r\n    };\r\n}\r\n\r\nexport { unclipArea as $, _rlookupByKey as A, _lookupByKey as B, _isPointInArea as C, getAngleFromPoint as D, toPadding as E, each as F, getMaximumSize as G, HALF_PI as H, _getParentNode as I, readUsedSize as J, supportsEventListenerOptions as K, throttled as L, _isDomSupported as M, _factorize as N, finiteOrDefault as O, PI as P, callback as Q, _addGrace as R, _limitValue as S, TAU as T, toDegrees as U, _measureText as V, _int16Range as W, _alignPixel as X, clipArea as Y, renderText as Z, _arrayUnique as _, resolve as a, getStyle as a$, toFont as a0, _toLeftRightCenter as a1, _alignStartEnd as a2, overrides as a3, merge as a4, _capitalize as a5, descriptors as a6, isFunction as a7, _attachContext as a8, _createResolver as a9, getRtlAdapter as aA, overrideTextDirection as aB, _textX as aC, restoreTextDirection as aD, drawPointLegend as aE, distanceBetweenPoints as aF, noop as aG, _setMinAndMaxByKey as aH, niceNum as aI, almostWhole as aJ, almostEquals as aK, _decimalPlaces as aL, Ticks as aM, log10 as aN, _longestText as aO, _filterBetween as aP, _lookup as aQ, isPatternOrGradient as aR, getHoverColor as aS, clone as aT, _merger as aU, _mergerIf as aV, _deprecated as aW, _splitKey as aX, toFontString as aY, splineCurve as aZ, splineCurveMonotone as a_, _descriptors as aa, mergeIf as ab, uid as ac, debounce as ad, retinaScale as ae, clearCanvas as af, setsEqual as ag, getDatasetClipArea as ah, _elementsEqual as ai, _isClickEvent as aj, _isBetween as ak, _normalizeAngle as al, _readValueToProps as am, _updateBezierControlPoints as an, _computeSegments as ao, _boundSegments as ap, _steppedInterpolation as aq, _bezierInterpolation as ar, _pointInLine as as, _steppedLineTo as at, _bezierCurveTo as au, drawPoint as av, addRoundedRectPath as aw, toTRBL as ax, toTRBLCorners as ay, _boundSegment as az, isArray as b, fontString as b0, toLineHeight as b1, PITAU as b2, INFINITY as b3, RAD_PER_DEG as b4, QUARTER_PI as b5, TWO_THIRDS_PI as b6, _angleDiff as b7, color as c, defaults as d, effects as e, resolveObjectKey as f, isNumberFinite as g, defined as h, isObject as i, createContext as j, isNullOrUndef as k, listenArrayEvents as l, toPercentage as m, toDimension as n, formatNumber as o, _angleBetween as p, _getStartAndCountOfVisiblePoints as q, requestAnimFrame as r, sign as s, toRadians as t, unlistenArrayEvents as u, valueOrDefault as v, _scaleRangesChanged as w, isNumber as x, _parseObjectDataRadialScale as y, getRelativePosition as z };\r\n//# sourceMappingURL=helpers.dataset.js.map\r\n","/*!\r\n * Chart.js v4.5.0\r\n * https://www.chartjs.org\r\n * (c) 2025 Chart.js Contributors\r\n * Released under the MIT License\r\n */\r\nimport { r as requestAnimFrame, a as resolve, e as effects, c as color, i as isObject, d as defaults, b as isArray, v as valueOrDefault, u as unlistenArrayEvents, l as listenArrayEvents, f as resolveObjectKey, g as isNumberFinite, h as defined, s as sign, j as createContext, k as isNullOrUndef, _ as _arrayUnique, t as toRadians, m as toPercentage, n as toDimension, T as TAU, o as formatNumber, p as _angleBetween, H as HALF_PI, P as PI, q as _getStartAndCountOfVisiblePoints, w as _scaleRangesChanged, x as isNumber, y as _parseObjectDataRadialScale, z as getRelativePosition, A as _rlookupByKey, B as _lookupByKey, C as _isPointInArea, D as getAngleFromPoint, E as toPadding, F as each, G as getMaximumSize, I as _getParentNode, J as readUsedSize, K as supportsEventListenerOptions, L as throttled, M as _isDomSupported, N as _factorize, O as finiteOrDefault, Q as callback, R as _addGrace, S as _limitValue, U as toDegrees, V as _measureText, W as _int16Range, X as _alignPixel, Y as clipArea, Z as renderText, $ as unclipArea, a0 as toFont, a1 as _toLeftRightCenter, a2 as _alignStartEnd, a3 as overrides, a4 as merge, a5 as _capitalize, a6 as descriptors, a7 as isFunction, a8 as _attachContext, a9 as _createResolver, aa as _descriptors, ab as mergeIf, ac as uid, ad as debounce, ae as retinaScale, af as clearCanvas, ag as setsEqual, ah as getDatasetClipArea, ai as _elementsEqual, aj as _isClickEvent, ak as _isBetween, al as _normalizeAngle, am as _readValueToProps, an as _updateBezierControlPoints, ao as _computeSegments, ap as _boundSegments, aq as _steppedInterpolation, ar as _bezierInterpolation, as as _pointInLine, at as _steppedLineTo, au as _bezierCurveTo, av as drawPoint, aw as addRoundedRectPath, ax as toTRBL, ay as toTRBLCorners, az as _boundSegment, aA as getRtlAdapter, aB as overrideTextDirection, aC as _textX, aD as restoreTextDirection, aE as drawPointLegend, aF as distanceBetweenPoints, aG as noop, aH as _setMinAndMaxByKey, aI as niceNum, aJ as almostWhole, aK as almostEquals, aL as _decimalPlaces, aM as Ticks, aN as log10, aO as _longestText, aP as _filterBetween, aQ as _lookup } from './chunks/helpers.dataset.js';\r\nimport '@kurkle/color';\r\n\r\nclass Animator {\r\n    constructor(){\r\n        this._request = null;\r\n        this._charts = new Map();\r\n        this._running = false;\r\n        this._lastDate = undefined;\r\n    }\r\n _notify(chart, anims, date, type) {\r\n        const callbacks = anims.listeners[type];\r\n        const numSteps = anims.duration;\r\n        callbacks.forEach((fn)=>fn({\r\n                chart,\r\n                initial: anims.initial,\r\n                numSteps,\r\n                currentStep: Math.min(date - anims.start, numSteps)\r\n            }));\r\n    }\r\n _refresh() {\r\n        if (this._request) {\r\n            return;\r\n        }\r\n        this._running = true;\r\n        this._request = requestAnimFrame.call(window, ()=>{\r\n            this._update();\r\n            this._request = null;\r\n            if (this._running) {\r\n                this._refresh();\r\n            }\r\n        });\r\n    }\r\n _update(date = Date.now()) {\r\n        let remaining = 0;\r\n        this._charts.forEach((anims, chart)=>{\r\n            if (!anims.running || !anims.items.length) {\r\n                return;\r\n            }\r\n            const items = anims.items;\r\n            let i = items.length - 1;\r\n            let draw = false;\r\n            let item;\r\n            for(; i >= 0; --i){\r\n                item = items[i];\r\n                if (item._active) {\r\n                    if (item._total > anims.duration) {\r\n                        anims.duration = item._total;\r\n                    }\r\n                    item.tick(date);\r\n                    draw = true;\r\n                } else {\r\n                    items[i] = items[items.length - 1];\r\n                    items.pop();\r\n                }\r\n            }\r\n            if (draw) {\r\n                chart.draw();\r\n                this._notify(chart, anims, date, 'progress');\r\n            }\r\n            if (!items.length) {\r\n                anims.running = false;\r\n                this._notify(chart, anims, date, 'complete');\r\n                anims.initial = false;\r\n            }\r\n            remaining += items.length;\r\n        });\r\n        this._lastDate = date;\r\n        if (remaining === 0) {\r\n            this._running = false;\r\n        }\r\n    }\r\n _getAnims(chart) {\r\n        const charts = this._charts;\r\n        let anims = charts.get(chart);\r\n        if (!anims) {\r\n            anims = {\r\n                running: false,\r\n                initial: true,\r\n                items: [],\r\n                listeners: {\r\n                    complete: [],\r\n                    progress: []\r\n                }\r\n            };\r\n            charts.set(chart, anims);\r\n        }\r\n        return anims;\r\n    }\r\n listen(chart, event, cb) {\r\n        this._getAnims(chart).listeners[event].push(cb);\r\n    }\r\n add(chart, items) {\r\n        if (!items || !items.length) {\r\n            return;\r\n        }\r\n        this._getAnims(chart).items.push(...items);\r\n    }\r\n has(chart) {\r\n        return this._getAnims(chart).items.length > 0;\r\n    }\r\n start(chart) {\r\n        const anims = this._charts.get(chart);\r\n        if (!anims) {\r\n            return;\r\n        }\r\n        anims.running = true;\r\n        anims.start = Date.now();\r\n        anims.duration = anims.items.reduce((acc, cur)=>Math.max(acc, cur._duration), 0);\r\n        this._refresh();\r\n    }\r\n    running(chart) {\r\n        if (!this._running) {\r\n            return false;\r\n        }\r\n        const anims = this._charts.get(chart);\r\n        if (!anims || !anims.running || !anims.items.length) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n stop(chart) {\r\n        const anims = this._charts.get(chart);\r\n        if (!anims || !anims.items.length) {\r\n            return;\r\n        }\r\n        const items = anims.items;\r\n        let i = items.length - 1;\r\n        for(; i >= 0; --i){\r\n            items[i].cancel();\r\n        }\r\n        anims.items = [];\r\n        this._notify(chart, anims, Date.now(), 'complete');\r\n    }\r\n remove(chart) {\r\n        return this._charts.delete(chart);\r\n    }\r\n}\r\nvar animator = /* #__PURE__ */ new Animator();\r\n\r\nconst transparent = 'transparent';\r\nconst interpolators = {\r\n    boolean (from, to, factor) {\r\n        return factor > 0.5 ? to : from;\r\n    },\r\n color (from, to, factor) {\r\n        const c0 = color(from || transparent);\r\n        const c1 = c0.valid && color(to || transparent);\r\n        return c1 && c1.valid ? c1.mix(c0, factor).hexString() : to;\r\n    },\r\n    number (from, to, factor) {\r\n        return from + (to - from) * factor;\r\n    }\r\n};\r\nclass Animation {\r\n    constructor(cfg, target, prop, to){\r\n        const currentValue = target[prop];\r\n        to = resolve([\r\n            cfg.to,\r\n            to,\r\n            currentValue,\r\n            cfg.from\r\n        ]);\r\n        const from = resolve([\r\n            cfg.from,\r\n            currentValue,\r\n            to\r\n        ]);\r\n        this._active = true;\r\n        this._fn = cfg.fn || interpolators[cfg.type || typeof from];\r\n        this._easing = effects[cfg.easing] || effects.linear;\r\n        this._start = Math.floor(Date.now() + (cfg.delay || 0));\r\n        this._duration = this._total = Math.floor(cfg.duration);\r\n        this._loop = !!cfg.loop;\r\n        this._target = target;\r\n        this._prop = prop;\r\n        this._from = from;\r\n        this._to = to;\r\n        this._promises = undefined;\r\n    }\r\n    active() {\r\n        return this._active;\r\n    }\r\n    update(cfg, to, date) {\r\n        if (this._active) {\r\n            this._notify(false);\r\n            const currentValue = this._target[this._prop];\r\n            const elapsed = date - this._start;\r\n            const remain = this._duration - elapsed;\r\n            this._start = date;\r\n            this._duration = Math.floor(Math.max(remain, cfg.duration));\r\n            this._total += elapsed;\r\n            this._loop = !!cfg.loop;\r\n            this._to = resolve([\r\n                cfg.to,\r\n                to,\r\n                currentValue,\r\n                cfg.from\r\n            ]);\r\n            this._from = resolve([\r\n                cfg.from,\r\n                currentValue,\r\n                to\r\n            ]);\r\n        }\r\n    }\r\n    cancel() {\r\n        if (this._active) {\r\n            this.tick(Date.now());\r\n            this._active = false;\r\n            this._notify(false);\r\n        }\r\n    }\r\n    tick(date) {\r\n        const elapsed = date - this._start;\r\n        const duration = this._duration;\r\n        const prop = this._prop;\r\n        const from = this._from;\r\n        const loop = this._loop;\r\n        const to = this._to;\r\n        let factor;\r\n        this._active = from !== to && (loop || elapsed < duration);\r\n        if (!this._active) {\r\n            this._target[prop] = to;\r\n            this._notify(true);\r\n            return;\r\n        }\r\n        if (elapsed < 0) {\r\n            this._target[prop] = from;\r\n            return;\r\n        }\r\n        factor = elapsed / duration % 2;\r\n        factor = loop && factor > 1 ? 2 - factor : factor;\r\n        factor = this._easing(Math.min(1, Math.max(0, factor)));\r\n        this._target[prop] = this._fn(from, to, factor);\r\n    }\r\n    wait() {\r\n        const promises = this._promises || (this._promises = []);\r\n        return new Promise((res, rej)=>{\r\n            promises.push({\r\n                res,\r\n                rej\r\n            });\r\n        });\r\n    }\r\n    _notify(resolved) {\r\n        const method = resolved ? 'res' : 'rej';\r\n        const promises = this._promises || [];\r\n        for(let i = 0; i < promises.length; i++){\r\n            promises[i][method]();\r\n        }\r\n    }\r\n}\r\n\r\nclass Animations {\r\n    constructor(chart, config){\r\n        this._chart = chart;\r\n        this._properties = new Map();\r\n        this.configure(config);\r\n    }\r\n    configure(config) {\r\n        if (!isObject(config)) {\r\n            return;\r\n        }\r\n        const animationOptions = Object.keys(defaults.animation);\r\n        const animatedProps = this._properties;\r\n        Object.getOwnPropertyNames(config).forEach((key)=>{\r\n            const cfg = config[key];\r\n            if (!isObject(cfg)) {\r\n                return;\r\n            }\r\n            const resolved = {};\r\n            for (const option of animationOptions){\r\n                resolved[option] = cfg[option];\r\n            }\r\n            (isArray(cfg.properties) && cfg.properties || [\r\n                key\r\n            ]).forEach((prop)=>{\r\n                if (prop === key || !animatedProps.has(prop)) {\r\n                    animatedProps.set(prop, resolved);\r\n                }\r\n            });\r\n        });\r\n    }\r\n _animateOptions(target, values) {\r\n        const newOptions = values.options;\r\n        const options = resolveTargetOptions(target, newOptions);\r\n        if (!options) {\r\n            return [];\r\n        }\r\n        const animations = this._createAnimations(options, newOptions);\r\n        if (newOptions.$shared) {\r\n            awaitAll(target.options.$animations, newOptions).then(()=>{\r\n                target.options = newOptions;\r\n            }, ()=>{\r\n            });\r\n        }\r\n        return animations;\r\n    }\r\n _createAnimations(target, values) {\r\n        const animatedProps = this._properties;\r\n        const animations = [];\r\n        const running = target.$animations || (target.$animations = {});\r\n        const props = Object.keys(values);\r\n        const date = Date.now();\r\n        let i;\r\n        for(i = props.length - 1; i >= 0; --i){\r\n            const prop = props[i];\r\n            if (prop.charAt(0) === '$') {\r\n                continue;\r\n            }\r\n            if (prop === 'options') {\r\n                animations.push(...this._animateOptions(target, values));\r\n                continue;\r\n            }\r\n            const value = values[prop];\r\n            let animation = running[prop];\r\n            const cfg = animatedProps.get(prop);\r\n            if (animation) {\r\n                if (cfg && animation.active()) {\r\n                    animation.update(cfg, value, date);\r\n                    continue;\r\n                } else {\r\n                    animation.cancel();\r\n                }\r\n            }\r\n            if (!cfg || !cfg.duration) {\r\n                target[prop] = value;\r\n                continue;\r\n            }\r\n            running[prop] = animation = new Animation(cfg, target, prop, value);\r\n            animations.push(animation);\r\n        }\r\n        return animations;\r\n    }\r\n update(target, values) {\r\n        if (this._properties.size === 0) {\r\n            Object.assign(target, values);\r\n            return;\r\n        }\r\n        const animations = this._createAnimations(target, values);\r\n        if (animations.length) {\r\n            animator.add(this._chart, animations);\r\n            return true;\r\n        }\r\n    }\r\n}\r\nfunction awaitAll(animations, properties) {\r\n    const running = [];\r\n    const keys = Object.keys(properties);\r\n    for(let i = 0; i < keys.length; i++){\r\n        const anim = animations[keys[i]];\r\n        if (anim && anim.active()) {\r\n            running.push(anim.wait());\r\n        }\r\n    }\r\n    return Promise.all(running);\r\n}\r\nfunction resolveTargetOptions(target, newOptions) {\r\n    if (!newOptions) {\r\n        return;\r\n    }\r\n    let options = target.options;\r\n    if (!options) {\r\n        target.options = newOptions;\r\n        return;\r\n    }\r\n    if (options.$shared) {\r\n        target.options = options = Object.assign({}, options, {\r\n            $shared: false,\r\n            $animations: {}\r\n        });\r\n    }\r\n    return options;\r\n}\r\n\r\nfunction scaleClip(scale, allowedOverflow) {\r\n    const opts = scale && scale.options || {};\r\n    const reverse = opts.reverse;\r\n    const min = opts.min === undefined ? allowedOverflow : 0;\r\n    const max = opts.max === undefined ? allowedOverflow : 0;\r\n    return {\r\n        start: reverse ? max : min,\r\n        end: reverse ? min : max\r\n    };\r\n}\r\nfunction defaultClip(xScale, yScale, allowedOverflow) {\r\n    if (allowedOverflow === false) {\r\n        return false;\r\n    }\r\n    const x = scaleClip(xScale, allowedOverflow);\r\n    const y = scaleClip(yScale, allowedOverflow);\r\n    return {\r\n        top: y.end,\r\n        right: x.end,\r\n        bottom: y.start,\r\n        left: x.start\r\n    };\r\n}\r\nfunction toClip(value) {\r\n    let t, r, b, l;\r\n    if (isObject(value)) {\r\n        t = value.top;\r\n        r = value.right;\r\n        b = value.bottom;\r\n        l = value.left;\r\n    } else {\r\n        t = r = b = l = value;\r\n    }\r\n    return {\r\n        top: t,\r\n        right: r,\r\n        bottom: b,\r\n        left: l,\r\n        disabled: value === false\r\n    };\r\n}\r\nfunction getSortedDatasetIndices(chart, filterVisible) {\r\n    const keys = [];\r\n    const metasets = chart._getSortedDatasetMetas(filterVisible);\r\n    let i, ilen;\r\n    for(i = 0, ilen = metasets.length; i < ilen; ++i){\r\n        keys.push(metasets[i].index);\r\n    }\r\n    return keys;\r\n}\r\nfunction applyStack(stack, value, dsIndex, options = {}) {\r\n    const keys = stack.keys;\r\n    const singleMode = options.mode === 'single';\r\n    let i, ilen, datasetIndex, otherValue;\r\n    if (value === null) {\r\n        return;\r\n    }\r\n    let found = false;\r\n    for(i = 0, ilen = keys.length; i < ilen; ++i){\r\n        datasetIndex = +keys[i];\r\n        if (datasetIndex === dsIndex) {\r\n            found = true;\r\n            if (options.all) {\r\n                continue;\r\n            }\r\n            break;\r\n        }\r\n        otherValue = stack.values[datasetIndex];\r\n        if (isNumberFinite(otherValue) && (singleMode || value === 0 || sign(value) === sign(otherValue))) {\r\n            value += otherValue;\r\n        }\r\n    }\r\n    if (!found && !options.all) {\r\n        return 0;\r\n    }\r\n    return value;\r\n}\r\nfunction convertObjectDataToArray(data, meta) {\r\n    const { iScale , vScale  } = meta;\r\n    const iAxisKey = iScale.axis === 'x' ? 'x' : 'y';\r\n    const vAxisKey = vScale.axis === 'x' ? 'x' : 'y';\r\n    const keys = Object.keys(data);\r\n    const adata = new Array(keys.length);\r\n    let i, ilen, key;\r\n    for(i = 0, ilen = keys.length; i < ilen; ++i){\r\n        key = keys[i];\r\n        adata[i] = {\r\n            [iAxisKey]: key,\r\n            [vAxisKey]: data[key]\r\n        };\r\n    }\r\n    return adata;\r\n}\r\nfunction isStacked(scale, meta) {\r\n    const stacked = scale && scale.options.stacked;\r\n    return stacked || stacked === undefined && meta.stack !== undefined;\r\n}\r\nfunction getStackKey(indexScale, valueScale, meta) {\r\n    return `${indexScale.id}.${valueScale.id}.${meta.stack || meta.type}`;\r\n}\r\nfunction getUserBounds(scale) {\r\n    const { min , max , minDefined , maxDefined  } = scale.getUserBounds();\r\n    return {\r\n        min: minDefined ? min : Number.NEGATIVE_INFINITY,\r\n        max: maxDefined ? max : Number.POSITIVE_INFINITY\r\n    };\r\n}\r\nfunction getOrCreateStack(stacks, stackKey, indexValue) {\r\n    const subStack = stacks[stackKey] || (stacks[stackKey] = {});\r\n    return subStack[indexValue] || (subStack[indexValue] = {});\r\n}\r\nfunction getLastIndexInStack(stack, vScale, positive, type) {\r\n    for (const meta of vScale.getMatchingVisibleMetas(type).reverse()){\r\n        const value = stack[meta.index];\r\n        if (positive && value > 0 || !positive && value < 0) {\r\n            return meta.index;\r\n        }\r\n    }\r\n    return null;\r\n}\r\nfunction updateStacks(controller, parsed) {\r\n    const { chart , _cachedMeta: meta  } = controller;\r\n    const stacks = chart._stacks || (chart._stacks = {});\r\n    const { iScale , vScale , index: datasetIndex  } = meta;\r\n    const iAxis = iScale.axis;\r\n    const vAxis = vScale.axis;\r\n    const key = getStackKey(iScale, vScale, meta);\r\n    const ilen = parsed.length;\r\n    let stack;\r\n    for(let i = 0; i < ilen; ++i){\r\n        const item = parsed[i];\r\n        const { [iAxis]: index , [vAxis]: value  } = item;\r\n        const itemStacks = item._stacks || (item._stacks = {});\r\n        stack = itemStacks[vAxis] = getOrCreateStack(stacks, key, index);\r\n        stack[datasetIndex] = value;\r\n        stack._top = getLastIndexInStack(stack, vScale, true, meta.type);\r\n        stack._bottom = getLastIndexInStack(stack, vScale, false, meta.type);\r\n        const visualValues = stack._visualValues || (stack._visualValues = {});\r\n        visualValues[datasetIndex] = value;\r\n    }\r\n}\r\nfunction getFirstScaleId(chart, axis) {\r\n    const scales = chart.scales;\r\n    return Object.keys(scales).filter((key)=>scales[key].axis === axis).shift();\r\n}\r\nfunction createDatasetContext(parent, index) {\r\n    return createContext(parent, {\r\n        active: false,\r\n        dataset: undefined,\r\n        datasetIndex: index,\r\n        index,\r\n        mode: 'default',\r\n        type: 'dataset'\r\n    });\r\n}\r\nfunction createDataContext(parent, index, element) {\r\n    return createContext(parent, {\r\n        active: false,\r\n        dataIndex: index,\r\n        parsed: undefined,\r\n        raw: undefined,\r\n        element,\r\n        index,\r\n        mode: 'default',\r\n        type: 'data'\r\n    });\r\n}\r\nfunction clearStacks(meta, items) {\r\n    const datasetIndex = meta.controller.index;\r\n    const axis = meta.vScale && meta.vScale.axis;\r\n    if (!axis) {\r\n        return;\r\n    }\r\n    items = items || meta._parsed;\r\n    for (const parsed of items){\r\n        const stacks = parsed._stacks;\r\n        if (!stacks || stacks[axis] === undefined || stacks[axis][datasetIndex] === undefined) {\r\n            return;\r\n        }\r\n        delete stacks[axis][datasetIndex];\r\n        if (stacks[axis]._visualValues !== undefined && stacks[axis]._visualValues[datasetIndex] !== undefined) {\r\n            delete stacks[axis]._visualValues[datasetIndex];\r\n        }\r\n    }\r\n}\r\nconst isDirectUpdateMode = (mode)=>mode === 'reset' || mode === 'none';\r\nconst cloneIfNotShared = (cached, shared)=>shared ? cached : Object.assign({}, cached);\r\nconst createStack = (canStack, meta, chart)=>canStack && !meta.hidden && meta._stacked && {\r\n        keys: getSortedDatasetIndices(chart, true),\r\n        values: null\r\n    };\r\nclass DatasetController {\r\n static defaults = {};\r\n static datasetElementType = null;\r\n static dataElementType = null;\r\n constructor(chart, datasetIndex){\r\n        this.chart = chart;\r\n        this._ctx = chart.ctx;\r\n        this.index = datasetIndex;\r\n        this._cachedDataOpts = {};\r\n        this._cachedMeta = this.getMeta();\r\n        this._type = this._cachedMeta.type;\r\n        this.options = undefined;\r\n         this._parsing = false;\r\n        this._data = undefined;\r\n        this._objectData = undefined;\r\n        this._sharedOptions = undefined;\r\n        this._drawStart = undefined;\r\n        this._drawCount = undefined;\r\n        this.enableOptionSharing = false;\r\n        this.supportsDecimation = false;\r\n        this.$context = undefined;\r\n        this._syncList = [];\r\n        this.datasetElementType = new.target.datasetElementType;\r\n        this.dataElementType = new.target.dataElementType;\r\n        this.initialize();\r\n    }\r\n    initialize() {\r\n        const meta = this._cachedMeta;\r\n        this.configure();\r\n        this.linkScales();\r\n        meta._stacked = isStacked(meta.vScale, meta);\r\n        this.addElements();\r\n        if (this.options.fill && !this.chart.isPluginEnabled('filler')) {\r\n            console.warn(\"Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options\");\r\n        }\r\n    }\r\n    updateIndex(datasetIndex) {\r\n        if (this.index !== datasetIndex) {\r\n            clearStacks(this._cachedMeta);\r\n        }\r\n        this.index = datasetIndex;\r\n    }\r\n    linkScales() {\r\n        const chart = this.chart;\r\n        const meta = this._cachedMeta;\r\n        const dataset = this.getDataset();\r\n        const chooseId = (axis, x, y, r)=>axis === 'x' ? x : axis === 'r' ? r : y;\r\n        const xid = meta.xAxisID = valueOrDefault(dataset.xAxisID, getFirstScaleId(chart, 'x'));\r\n        const yid = meta.yAxisID = valueOrDefault(dataset.yAxisID, getFirstScaleId(chart, 'y'));\r\n        const rid = meta.rAxisID = valueOrDefault(dataset.rAxisID, getFirstScaleId(chart, 'r'));\r\n        const indexAxis = meta.indexAxis;\r\n        const iid = meta.iAxisID = chooseId(indexAxis, xid, yid, rid);\r\n        const vid = meta.vAxisID = chooseId(indexAxis, yid, xid, rid);\r\n        meta.xScale = this.getScaleForId(xid);\r\n        meta.yScale = this.getScaleForId(yid);\r\n        meta.rScale = this.getScaleForId(rid);\r\n        meta.iScale = this.getScaleForId(iid);\r\n        meta.vScale = this.getScaleForId(vid);\r\n    }\r\n    getDataset() {\r\n        return this.chart.data.datasets[this.index];\r\n    }\r\n    getMeta() {\r\n        return this.chart.getDatasetMeta(this.index);\r\n    }\r\n getScaleForId(scaleID) {\r\n        return this.chart.scales[scaleID];\r\n    }\r\n _getOtherScale(scale) {\r\n        const meta = this._cachedMeta;\r\n        return scale === meta.iScale ? meta.vScale : meta.iScale;\r\n    }\r\n    reset() {\r\n        this._update('reset');\r\n    }\r\n _destroy() {\r\n        const meta = this._cachedMeta;\r\n        if (this._data) {\r\n            unlistenArrayEvents(this._data, this);\r\n        }\r\n        if (meta._stacked) {\r\n            clearStacks(meta);\r\n        }\r\n    }\r\n _dataCheck() {\r\n        const dataset = this.getDataset();\r\n        const data = dataset.data || (dataset.data = []);\r\n        const _data = this._data;\r\n        if (isObject(data)) {\r\n            const meta = this._cachedMeta;\r\n            this._data = convertObjectDataToArray(data, meta);\r\n        } else if (_data !== data) {\r\n            if (_data) {\r\n                unlistenArrayEvents(_data, this);\r\n                const meta = this._cachedMeta;\r\n                clearStacks(meta);\r\n                meta._parsed = [];\r\n            }\r\n            if (data && Object.isExtensible(data)) {\r\n                listenArrayEvents(data, this);\r\n            }\r\n            this._syncList = [];\r\n            this._data = data;\r\n        }\r\n    }\r\n    addElements() {\r\n        const meta = this._cachedMeta;\r\n        this._dataCheck();\r\n        if (this.datasetElementType) {\r\n            meta.dataset = new this.datasetElementType();\r\n        }\r\n    }\r\n    buildOrUpdateElements(resetNewElements) {\r\n        const meta = this._cachedMeta;\r\n        const dataset = this.getDataset();\r\n        let stackChanged = false;\r\n        this._dataCheck();\r\n        const oldStacked = meta._stacked;\r\n        meta._stacked = isStacked(meta.vScale, meta);\r\n        if (meta.stack !== dataset.stack) {\r\n            stackChanged = true;\r\n            clearStacks(meta);\r\n            meta.stack = dataset.stack;\r\n        }\r\n        this._resyncElements(resetNewElements);\r\n        if (stackChanged || oldStacked !== meta._stacked) {\r\n            updateStacks(this, meta._parsed);\r\n            meta._stacked = isStacked(meta.vScale, meta);\r\n        }\r\n    }\r\n configure() {\r\n        const config = this.chart.config;\r\n        const scopeKeys = config.datasetScopeKeys(this._type);\r\n        const scopes = config.getOptionScopes(this.getDataset(), scopeKeys, true);\r\n        this.options = config.createResolver(scopes, this.getContext());\r\n        this._parsing = this.options.parsing;\r\n        this._cachedDataOpts = {};\r\n    }\r\n parse(start, count) {\r\n        const { _cachedMeta: meta , _data: data  } = this;\r\n        const { iScale , _stacked  } = meta;\r\n        const iAxis = iScale.axis;\r\n        let sorted = start === 0 && count === data.length ? true : meta._sorted;\r\n        let prev = start > 0 && meta._parsed[start - 1];\r\n        let i, cur, parsed;\r\n        if (this._parsing === false) {\r\n            meta._parsed = data;\r\n            meta._sorted = true;\r\n            parsed = data;\r\n        } else {\r\n            if (isArray(data[start])) {\r\n                parsed = this.parseArrayData(meta, data, start, count);\r\n            } else if (isObject(data[start])) {\r\n                parsed = this.parseObjectData(meta, data, start, count);\r\n            } else {\r\n                parsed = this.parsePrimitiveData(meta, data, start, count);\r\n            }\r\n            const isNotInOrderComparedToPrev = ()=>cur[iAxis] === null || prev && cur[iAxis] < prev[iAxis];\r\n            for(i = 0; i < count; ++i){\r\n                meta._parsed[i + start] = cur = parsed[i];\r\n                if (sorted) {\r\n                    if (isNotInOrderComparedToPrev()) {\r\n                        sorted = false;\r\n                    }\r\n                    prev = cur;\r\n                }\r\n            }\r\n            meta._sorted = sorted;\r\n        }\r\n        if (_stacked) {\r\n            updateStacks(this, parsed);\r\n        }\r\n    }\r\n parsePrimitiveData(meta, data, start, count) {\r\n        const { iScale , vScale  } = meta;\r\n        const iAxis = iScale.axis;\r\n        const vAxis = vScale.axis;\r\n        const labels = iScale.getLabels();\r\n        const singleScale = iScale === vScale;\r\n        const parsed = new Array(count);\r\n        let i, ilen, index;\r\n        for(i = 0, ilen = count; i < ilen; ++i){\r\n            index = i + start;\r\n            parsed[i] = {\r\n                [iAxis]: singleScale || iScale.parse(labels[index], index),\r\n                [vAxis]: vScale.parse(data[index], index)\r\n            };\r\n        }\r\n        return parsed;\r\n    }\r\n parseArrayData(meta, data, start, count) {\r\n        const { xScale , yScale  } = meta;\r\n        const parsed = new Array(count);\r\n        let i, ilen, index, item;\r\n        for(i = 0, ilen = count; i < ilen; ++i){\r\n            index = i + start;\r\n            item = data[index];\r\n            parsed[i] = {\r\n                x: xScale.parse(item[0], index),\r\n                y: yScale.parse(item[1], index)\r\n            };\r\n        }\r\n        return parsed;\r\n    }\r\n parseObjectData(meta, data, start, count) {\r\n        const { xScale , yScale  } = meta;\r\n        const { xAxisKey ='x' , yAxisKey ='y'  } = this._parsing;\r\n        const parsed = new Array(count);\r\n        let i, ilen, index, item;\r\n        for(i = 0, ilen = count; i < ilen; ++i){\r\n            index = i + start;\r\n            item = data[index];\r\n            parsed[i] = {\r\n                x: xScale.parse(resolveObjectKey(item, xAxisKey), index),\r\n                y: yScale.parse(resolveObjectKey(item, yAxisKey), index)\r\n            };\r\n        }\r\n        return parsed;\r\n    }\r\n getParsed(index) {\r\n        return this._cachedMeta._parsed[index];\r\n    }\r\n getDataElement(index) {\r\n        return this._cachedMeta.data[index];\r\n    }\r\n applyStack(scale, parsed, mode) {\r\n        const chart = this.chart;\r\n        const meta = this._cachedMeta;\r\n        const value = parsed[scale.axis];\r\n        const stack = {\r\n            keys: getSortedDatasetIndices(chart, true),\r\n            values: parsed._stacks[scale.axis]._visualValues\r\n        };\r\n        return applyStack(stack, value, meta.index, {\r\n            mode\r\n        });\r\n    }\r\n updateRangeFromParsed(range, scale, parsed, stack) {\r\n        const parsedValue = parsed[scale.axis];\r\n        let value = parsedValue === null ? NaN : parsedValue;\r\n        const values = stack && parsed._stacks[scale.axis];\r\n        if (stack && values) {\r\n            stack.values = values;\r\n            value = applyStack(stack, parsedValue, this._cachedMeta.index);\r\n        }\r\n        range.min = Math.min(range.min, value);\r\n        range.max = Math.max(range.max, value);\r\n    }\r\n getMinMax(scale, canStack) {\r\n        const meta = this._cachedMeta;\r\n        const _parsed = meta._parsed;\r\n        const sorted = meta._sorted && scale === meta.iScale;\r\n        const ilen = _parsed.length;\r\n        const otherScale = this._getOtherScale(scale);\r\n        const stack = createStack(canStack, meta, this.chart);\r\n        const range = {\r\n            min: Number.POSITIVE_INFINITY,\r\n            max: Number.NEGATIVE_INFINITY\r\n        };\r\n        const { min: otherMin , max: otherMax  } = getUserBounds(otherScale);\r\n        let i, parsed;\r\n        function _skip() {\r\n            parsed = _parsed[i];\r\n            const otherValue = parsed[otherScale.axis];\r\n            return !isNumberFinite(parsed[scale.axis]) || otherMin > otherValue || otherMax < otherValue;\r\n        }\r\n        for(i = 0; i < ilen; ++i){\r\n            if (_skip()) {\r\n                continue;\r\n            }\r\n            this.updateRangeFromParsed(range, scale, parsed, stack);\r\n            if (sorted) {\r\n                break;\r\n            }\r\n        }\r\n        if (sorted) {\r\n            for(i = ilen - 1; i >= 0; --i){\r\n                if (_skip()) {\r\n                    continue;\r\n                }\r\n                this.updateRangeFromParsed(range, scale, parsed, stack);\r\n                break;\r\n            }\r\n        }\r\n        return range;\r\n    }\r\n    getAllParsedValues(scale) {\r\n        const parsed = this._cachedMeta._parsed;\r\n        const values = [];\r\n        let i, ilen, value;\r\n        for(i = 0, ilen = parsed.length; i < ilen; ++i){\r\n            value = parsed[i][scale.axis];\r\n            if (isNumberFinite(value)) {\r\n                values.push(value);\r\n            }\r\n        }\r\n        return values;\r\n    }\r\n getMaxOverflow() {\r\n        return false;\r\n    }\r\n getLabelAndValue(index) {\r\n        const meta = this._cachedMeta;\r\n        const iScale = meta.iScale;\r\n        const vScale = meta.vScale;\r\n        const parsed = this.getParsed(index);\r\n        return {\r\n            label: iScale ? '' + iScale.getLabelForValue(parsed[iScale.axis]) : '',\r\n            value: vScale ? '' + vScale.getLabelForValue(parsed[vScale.axis]) : ''\r\n        };\r\n    }\r\n _update(mode) {\r\n        const meta = this._cachedMeta;\r\n        this.update(mode || 'default');\r\n        meta._clip = toClip(valueOrDefault(this.options.clip, defaultClip(meta.xScale, meta.yScale, this.getMaxOverflow())));\r\n    }\r\n update(mode) {}\r\n    draw() {\r\n        const ctx = this._ctx;\r\n        const chart = this.chart;\r\n        const meta = this._cachedMeta;\r\n        const elements = meta.data || [];\r\n        const area = chart.chartArea;\r\n        const active = [];\r\n        const start = this._drawStart || 0;\r\n        const count = this._drawCount || elements.length - start;\r\n        const drawActiveElementsOnTop = this.options.drawActiveElementsOnTop;\r\n        let i;\r\n        if (meta.dataset) {\r\n            meta.dataset.draw(ctx, area, start, count);\r\n        }\r\n        for(i = start; i < start + count; ++i){\r\n            const element = elements[i];\r\n            if (element.hidden) {\r\n                continue;\r\n            }\r\n            if (element.active && drawActiveElementsOnTop) {\r\n                active.push(element);\r\n            } else {\r\n                element.draw(ctx, area);\r\n            }\r\n        }\r\n        for(i = 0; i < active.length; ++i){\r\n            active[i].draw(ctx, area);\r\n        }\r\n    }\r\n getStyle(index, active) {\r\n        const mode = active ? 'active' : 'default';\r\n        return index === undefined && this._cachedMeta.dataset ? this.resolveDatasetElementOptions(mode) : this.resolveDataElementOptions(index || 0, mode);\r\n    }\r\n getContext(index, active, mode) {\r\n        const dataset = this.getDataset();\r\n        let context;\r\n        if (index >= 0 && index < this._cachedMeta.data.length) {\r\n            const element = this._cachedMeta.data[index];\r\n            context = element.$context || (element.$context = createDataContext(this.getContext(), index, element));\r\n            context.parsed = this.getParsed(index);\r\n            context.raw = dataset.data[index];\r\n            context.index = context.dataIndex = index;\r\n        } else {\r\n            context = this.$context || (this.$context = createDatasetContext(this.chart.getContext(), this.index));\r\n            context.dataset = dataset;\r\n            context.index = context.datasetIndex = this.index;\r\n        }\r\n        context.active = !!active;\r\n        context.mode = mode;\r\n        return context;\r\n    }\r\n resolveDatasetElementOptions(mode) {\r\n        return this._resolveElementOptions(this.datasetElementType.id, mode);\r\n    }\r\n resolveDataElementOptions(index, mode) {\r\n        return this._resolveElementOptions(this.dataElementType.id, mode, index);\r\n    }\r\n _resolveElementOptions(elementType, mode = 'default', index) {\r\n        const active = mode === 'active';\r\n        const cache = this._cachedDataOpts;\r\n        const cacheKey = elementType + '-' + mode;\r\n        const cached = cache[cacheKey];\r\n        const sharing = this.enableOptionSharing && defined(index);\r\n        if (cached) {\r\n            return cloneIfNotShared(cached, sharing);\r\n        }\r\n        const config = this.chart.config;\r\n        const scopeKeys = config.datasetElementScopeKeys(this._type, elementType);\r\n        const prefixes = active ? [\r\n            `${elementType}Hover`,\r\n            'hover',\r\n            elementType,\r\n            ''\r\n        ] : [\r\n            elementType,\r\n            ''\r\n        ];\r\n        const scopes = config.getOptionScopes(this.getDataset(), scopeKeys);\r\n        const names = Object.keys(defaults.elements[elementType]);\r\n        const context = ()=>this.getContext(index, active, mode);\r\n        const values = config.resolveNamedOptions(scopes, names, context, prefixes);\r\n        if (values.$shared) {\r\n            values.$shared = sharing;\r\n            cache[cacheKey] = Object.freeze(cloneIfNotShared(values, sharing));\r\n        }\r\n        return values;\r\n    }\r\n _resolveAnimations(index, transition, active) {\r\n        const chart = this.chart;\r\n        const cache = this._cachedDataOpts;\r\n        const cacheKey = `animation-${transition}`;\r\n        const cached = cache[cacheKey];\r\n        if (cached) {\r\n            return cached;\r\n        }\r\n        let options;\r\n        if (chart.options.animation !== false) {\r\n            const config = this.chart.config;\r\n            const scopeKeys = config.datasetAnimationScopeKeys(this._type, transition);\r\n            const scopes = config.getOptionScopes(this.getDataset(), scopeKeys);\r\n            options = config.createResolver(scopes, this.getContext(index, active, transition));\r\n        }\r\n        const animations = new Animations(chart, options && options.animations);\r\n        if (options && options._cacheable) {\r\n            cache[cacheKey] = Object.freeze(animations);\r\n        }\r\n        return animations;\r\n    }\r\n getSharedOptions(options) {\r\n        if (!options.$shared) {\r\n            return;\r\n        }\r\n        return this._sharedOptions || (this._sharedOptions = Object.assign({}, options));\r\n    }\r\n includeOptions(mode, sharedOptions) {\r\n        return !sharedOptions || isDirectUpdateMode(mode) || this.chart._animationsDisabled;\r\n    }\r\n _getSharedOptions(start, mode) {\r\n        const firstOpts = this.resolveDataElementOptions(start, mode);\r\n        const previouslySharedOptions = this._sharedOptions;\r\n        const sharedOptions = this.getSharedOptions(firstOpts);\r\n        const includeOptions = this.includeOptions(mode, sharedOptions) || sharedOptions !== previouslySharedOptions;\r\n        this.updateSharedOptions(sharedOptions, mode, firstOpts);\r\n        return {\r\n            sharedOptions,\r\n            includeOptions\r\n        };\r\n    }\r\n updateElement(element, index, properties, mode) {\r\n        if (isDirectUpdateMode(mode)) {\r\n            Object.assign(element, properties);\r\n        } else {\r\n            this._resolveAnimations(index, mode).update(element, properties);\r\n        }\r\n    }\r\n updateSharedOptions(sharedOptions, mode, newOptions) {\r\n        if (sharedOptions && !isDirectUpdateMode(mode)) {\r\n            this._resolveAnimations(undefined, mode).update(sharedOptions, newOptions);\r\n        }\r\n    }\r\n _setStyle(element, index, mode, active) {\r\n        element.active = active;\r\n        const options = this.getStyle(index, active);\r\n        this._resolveAnimations(index, mode, active).update(element, {\r\n            options: !active && this.getSharedOptions(options) || options\r\n        });\r\n    }\r\n    removeHoverStyle(element, datasetIndex, index) {\r\n        this._setStyle(element, index, 'active', false);\r\n    }\r\n    setHoverStyle(element, datasetIndex, index) {\r\n        this._setStyle(element, index, 'active', true);\r\n    }\r\n _removeDatasetHoverStyle() {\r\n        const element = this._cachedMeta.dataset;\r\n        if (element) {\r\n            this._setStyle(element, undefined, 'active', false);\r\n        }\r\n    }\r\n _setDatasetHoverStyle() {\r\n        const element = this._cachedMeta.dataset;\r\n        if (element) {\r\n            this._setStyle(element, undefined, 'active', true);\r\n        }\r\n    }\r\n _resyncElements(resetNewElements) {\r\n        const data = this._data;\r\n        const elements = this._cachedMeta.data;\r\n        for (const [method, arg1, arg2] of this._syncList){\r\n            this[method](arg1, arg2);\r\n        }\r\n        this._syncList = [];\r\n        const numMeta = elements.length;\r\n        const numData = data.length;\r\n        const count = Math.min(numData, numMeta);\r\n        if (count) {\r\n            this.parse(0, count);\r\n        }\r\n        if (numData > numMeta) {\r\n            this._insertElements(numMeta, numData - numMeta, resetNewElements);\r\n        } else if (numData < numMeta) {\r\n            this._removeElements(numData, numMeta - numData);\r\n        }\r\n    }\r\n _insertElements(start, count, resetNewElements = true) {\r\n        const meta = this._cachedMeta;\r\n        const data = meta.data;\r\n        const end = start + count;\r\n        let i;\r\n        const move = (arr)=>{\r\n            arr.length += count;\r\n            for(i = arr.length - 1; i >= end; i--){\r\n                arr[i] = arr[i - count];\r\n            }\r\n        };\r\n        move(data);\r\n        for(i = start; i < end; ++i){\r\n            data[i] = new this.dataElementType();\r\n        }\r\n        if (this._parsing) {\r\n            move(meta._parsed);\r\n        }\r\n        this.parse(start, count);\r\n        if (resetNewElements) {\r\n            this.updateElements(data, start, count, 'reset');\r\n        }\r\n    }\r\n    updateElements(element, start, count, mode) {}\r\n _removeElements(start, count) {\r\n        const meta = this._cachedMeta;\r\n        if (this._parsing) {\r\n            const removed = meta._parsed.splice(start, count);\r\n            if (meta._stacked) {\r\n                clearStacks(meta, removed);\r\n            }\r\n        }\r\n        meta.data.splice(start, count);\r\n    }\r\n _sync(args) {\r\n        if (this._parsing) {\r\n            this._syncList.push(args);\r\n        } else {\r\n            const [method, arg1, arg2] = args;\r\n            this[method](arg1, arg2);\r\n        }\r\n        this.chart._dataChanges.push([\r\n            this.index,\r\n            ...args\r\n        ]);\r\n    }\r\n    _onDataPush() {\r\n        const count = arguments.length;\r\n        this._sync([\r\n            '_insertElements',\r\n            this.getDataset().data.length - count,\r\n            count\r\n        ]);\r\n    }\r\n    _onDataPop() {\r\n        this._sync([\r\n            '_removeElements',\r\n            this._cachedMeta.data.length - 1,\r\n            1\r\n        ]);\r\n    }\r\n    _onDataShift() {\r\n        this._sync([\r\n            '_removeElements',\r\n            0,\r\n            1\r\n        ]);\r\n    }\r\n    _onDataSplice(start, count) {\r\n        if (count) {\r\n            this._sync([\r\n                '_removeElements',\r\n                start,\r\n                count\r\n            ]);\r\n        }\r\n        const newCount = arguments.length - 2;\r\n        if (newCount) {\r\n            this._sync([\r\n                '_insertElements',\r\n                start,\r\n                newCount\r\n            ]);\r\n        }\r\n    }\r\n    _onDataUnshift() {\r\n        this._sync([\r\n            '_insertElements',\r\n            0,\r\n            arguments.length\r\n        ]);\r\n    }\r\n}\r\n\r\nfunction getAllScaleValues(scale, type) {\r\n    if (!scale._cache.$bar) {\r\n        const visibleMetas = scale.getMatchingVisibleMetas(type);\r\n        let values = [];\r\n        for(let i = 0, ilen = visibleMetas.length; i < ilen; i++){\r\n            values = values.concat(visibleMetas[i].controller.getAllParsedValues(scale));\r\n        }\r\n        scale._cache.$bar = _arrayUnique(values.sort((a, b)=>a - b));\r\n    }\r\n    return scale._cache.$bar;\r\n}\r\n function computeMinSampleSize(meta) {\r\n    const scale = meta.iScale;\r\n    const values = getAllScaleValues(scale, meta.type);\r\n    let min = scale._length;\r\n    let i, ilen, curr, prev;\r\n    const updateMinAndPrev = ()=>{\r\n        if (curr === 32767 || curr === -32768) {\r\n            return;\r\n        }\r\n        if (defined(prev)) {\r\n            min = Math.min(min, Math.abs(curr - prev) || min);\r\n        }\r\n        prev = curr;\r\n    };\r\n    for(i = 0, ilen = values.length; i < ilen; ++i){\r\n        curr = scale.getPixelForValue(values[i]);\r\n        updateMinAndPrev();\r\n    }\r\n    prev = undefined;\r\n    for(i = 0, ilen = scale.ticks.length; i < ilen; ++i){\r\n        curr = scale.getPixelForTick(i);\r\n        updateMinAndPrev();\r\n    }\r\n    return min;\r\n}\r\n function computeFitCategoryTraits(index, ruler, options, stackCount) {\r\n    const thickness = options.barThickness;\r\n    let size, ratio;\r\n    if (isNullOrUndef(thickness)) {\r\n        size = ruler.min * options.categoryPercentage;\r\n        ratio = options.barPercentage;\r\n    } else {\r\n        size = thickness * stackCount;\r\n        ratio = 1;\r\n    }\r\n    return {\r\n        chunk: size / stackCount,\r\n        ratio,\r\n        start: ruler.pixels[index] - size / 2\r\n    };\r\n}\r\n function computeFlexCategoryTraits(index, ruler, options, stackCount) {\r\n    const pixels = ruler.pixels;\r\n    const curr = pixels[index];\r\n    let prev = index > 0 ? pixels[index - 1] : null;\r\n    let next = index < pixels.length - 1 ? pixels[index + 1] : null;\r\n    const percent = options.categoryPercentage;\r\n    if (prev === null) {\r\n        prev = curr - (next === null ? ruler.end - ruler.start : next - curr);\r\n    }\r\n    if (next === null) {\r\n        next = curr + curr - prev;\r\n    }\r\n    const start = curr - (curr - Math.min(prev, next)) / 2 * percent;\r\n    const size = Math.abs(next - prev) / 2 * percent;\r\n    return {\r\n        chunk: size / stackCount,\r\n        ratio: options.barPercentage,\r\n        start\r\n    };\r\n}\r\nfunction parseFloatBar(entry, item, vScale, i) {\r\n    const startValue = vScale.parse(entry[0], i);\r\n    const endValue = vScale.parse(entry[1], i);\r\n    const min = Math.min(startValue, endValue);\r\n    const max = Math.max(startValue, endValue);\r\n    let barStart = min;\r\n    let barEnd = max;\r\n    if (Math.abs(min) > Math.abs(max)) {\r\n        barStart = max;\r\n        barEnd = min;\r\n    }\r\n    item[vScale.axis] = barEnd;\r\n    item._custom = {\r\n        barStart,\r\n        barEnd,\r\n        start: startValue,\r\n        end: endValue,\r\n        min,\r\n        max\r\n    };\r\n}\r\nfunction parseValue(entry, item, vScale, i) {\r\n    if (isArray(entry)) {\r\n        parseFloatBar(entry, item, vScale, i);\r\n    } else {\r\n        item[vScale.axis] = vScale.parse(entry, i);\r\n    }\r\n    return item;\r\n}\r\nfunction parseArrayOrPrimitive(meta, data, start, count) {\r\n    const iScale = meta.iScale;\r\n    const vScale = meta.vScale;\r\n    const labels = iScale.getLabels();\r\n    const singleScale = iScale === vScale;\r\n    const parsed = [];\r\n    let i, ilen, item, entry;\r\n    for(i = start, ilen = start + count; i < ilen; ++i){\r\n        entry = data[i];\r\n        item = {};\r\n        item[iScale.axis] = singleScale || iScale.parse(labels[i], i);\r\n        parsed.push(parseValue(entry, item, vScale, i));\r\n    }\r\n    return parsed;\r\n}\r\nfunction isFloatBar(custom) {\r\n    return custom && custom.barStart !== undefined && custom.barEnd !== undefined;\r\n}\r\nfunction barSign(size, vScale, actualBase) {\r\n    if (size !== 0) {\r\n        return sign(size);\r\n    }\r\n    return (vScale.isHorizontal() ? 1 : -1) * (vScale.min >= actualBase ? 1 : -1);\r\n}\r\nfunction borderProps(properties) {\r\n    let reverse, start, end, top, bottom;\r\n    if (properties.horizontal) {\r\n        reverse = properties.base > properties.x;\r\n        start = 'left';\r\n        end = 'right';\r\n    } else {\r\n        reverse = properties.base < properties.y;\r\n        start = 'bottom';\r\n        end = 'top';\r\n    }\r\n    if (reverse) {\r\n        top = 'end';\r\n        bottom = 'start';\r\n    } else {\r\n        top = 'start';\r\n        bottom = 'end';\r\n    }\r\n    return {\r\n        start,\r\n        end,\r\n        reverse,\r\n        top,\r\n        bottom\r\n    };\r\n}\r\nfunction setBorderSkipped(properties, options, stack, index) {\r\n    let edge = options.borderSkipped;\r\n    const res = {};\r\n    if (!edge) {\r\n        properties.borderSkipped = res;\r\n        return;\r\n    }\r\n    if (edge === true) {\r\n        properties.borderSkipped = {\r\n            top: true,\r\n            right: true,\r\n            bottom: true,\r\n            left: true\r\n        };\r\n        return;\r\n    }\r\n    const { start , end , reverse , top , bottom  } = borderProps(properties);\r\n    if (edge === 'middle' && stack) {\r\n        properties.enableBorderRadius = true;\r\n        if ((stack._top || 0) === index) {\r\n            edge = top;\r\n        } else if ((stack._bottom || 0) === index) {\r\n            edge = bottom;\r\n        } else {\r\n            res[parseEdge(bottom, start, end, reverse)] = true;\r\n            edge = top;\r\n        }\r\n    }\r\n    res[parseEdge(edge, start, end, reverse)] = true;\r\n    properties.borderSkipped = res;\r\n}\r\nfunction parseEdge(edge, a, b, reverse) {\r\n    if (reverse) {\r\n        edge = swap(edge, a, b);\r\n        edge = startEnd(edge, b, a);\r\n    } else {\r\n        edge = startEnd(edge, a, b);\r\n    }\r\n    return edge;\r\n}\r\nfunction swap(orig, v1, v2) {\r\n    return orig === v1 ? v2 : orig === v2 ? v1 : orig;\r\n}\r\nfunction startEnd(v, start, end) {\r\n    return v === 'start' ? start : v === 'end' ? end : v;\r\n}\r\nfunction setInflateAmount(properties, { inflateAmount  }, ratio) {\r\n    properties.inflateAmount = inflateAmount === 'auto' ? ratio === 1 ? 0.33 : 0 : inflateAmount;\r\n}\r\nclass BarController extends DatasetController {\r\n    static id = 'bar';\r\n static defaults = {\r\n        datasetElementType: false,\r\n        dataElementType: 'bar',\r\n        categoryPercentage: 0.8,\r\n        barPercentage: 0.9,\r\n        grouped: true,\r\n        animations: {\r\n            numbers: {\r\n                type: 'number',\r\n                properties: [\r\n                    'x',\r\n                    'y',\r\n                    'base',\r\n                    'width',\r\n                    'height'\r\n                ]\r\n            }\r\n        }\r\n    };\r\n static overrides = {\r\n        scales: {\r\n            _index_: {\r\n                type: 'category',\r\n                offset: true,\r\n                grid: {\r\n                    offset: true\r\n                }\r\n            },\r\n            _value_: {\r\n                type: 'linear',\r\n                beginAtZero: true\r\n            }\r\n        }\r\n    };\r\n parsePrimitiveData(meta, data, start, count) {\r\n        return parseArrayOrPrimitive(meta, data, start, count);\r\n    }\r\n parseArrayData(meta, data, start, count) {\r\n        return parseArrayOrPrimitive(meta, data, start, count);\r\n    }\r\n parseObjectData(meta, data, start, count) {\r\n        const { iScale , vScale  } = meta;\r\n        const { xAxisKey ='x' , yAxisKey ='y'  } = this._parsing;\r\n        const iAxisKey = iScale.axis === 'x' ? xAxisKey : yAxisKey;\r\n        const vAxisKey = vScale.axis === 'x' ? xAxisKey : yAxisKey;\r\n        const parsed = [];\r\n        let i, ilen, item, obj;\r\n        for(i = start, ilen = start + count; i < ilen; ++i){\r\n            obj = data[i];\r\n            item = {};\r\n            item[iScale.axis] = iScale.parse(resolveObjectKey(obj, iAxisKey), i);\r\n            parsed.push(parseValue(resolveObjectKey(obj, vAxisKey), item, vScale, i));\r\n        }\r\n        return parsed;\r\n    }\r\n updateRangeFromParsed(range, scale, parsed, stack) {\r\n        super.updateRangeFromParsed(range, scale, parsed, stack);\r\n        const custom = parsed._custom;\r\n        if (custom && scale === this._cachedMeta.vScale) {\r\n            range.min = Math.min(range.min, custom.min);\r\n            range.max = Math.max(range.max, custom.max);\r\n        }\r\n    }\r\n getMaxOverflow() {\r\n        return 0;\r\n    }\r\n getLabelAndValue(index) {\r\n        const meta = this._cachedMeta;\r\n        const { iScale , vScale  } = meta;\r\n        const parsed = this.getParsed(index);\r\n        const custom = parsed._custom;\r\n        const value = isFloatBar(custom) ? '[' + custom.start + ', ' + custom.end + ']' : '' + vScale.getLabelForValue(parsed[vScale.axis]);\r\n        return {\r\n            label: '' + iScale.getLabelForValue(parsed[iScale.axis]),\r\n            value\r\n        };\r\n    }\r\n    initialize() {\r\n        this.enableOptionSharing = true;\r\n        super.initialize();\r\n        const meta = this._cachedMeta;\r\n        meta.stack = this.getDataset().stack;\r\n    }\r\n    update(mode) {\r\n        const meta = this._cachedMeta;\r\n        this.updateElements(meta.data, 0, meta.data.length, mode);\r\n    }\r\n    updateElements(bars, start, count, mode) {\r\n        const reset = mode === 'reset';\r\n        const { index , _cachedMeta: { vScale  }  } = this;\r\n        const base = vScale.getBasePixel();\r\n        const horizontal = vScale.isHorizontal();\r\n        const ruler = this._getRuler();\r\n        const { sharedOptions , includeOptions  } = this._getSharedOptions(start, mode);\r\n        for(let i = start; i < start + count; i++){\r\n            const parsed = this.getParsed(i);\r\n            const vpixels = reset || isNullOrUndef(parsed[vScale.axis]) ? {\r\n                base,\r\n                head: base\r\n            } : this._calculateBarValuePixels(i);\r\n            const ipixels = this._calculateBarIndexPixels(i, ruler);\r\n            const stack = (parsed._stacks || {})[vScale.axis];\r\n            const properties = {\r\n                horizontal,\r\n                base: vpixels.base,\r\n                enableBorderRadius: !stack || isFloatBar(parsed._custom) || index === stack._top || index === stack._bottom,\r\n                x: horizontal ? vpixels.head : ipixels.center,\r\n                y: horizontal ? ipixels.center : vpixels.head,\r\n                height: horizontal ? ipixels.size : Math.abs(vpixels.size),\r\n                width: horizontal ? Math.abs(vpixels.size) : ipixels.size\r\n            };\r\n            if (includeOptions) {\r\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, bars[i].active ? 'active' : mode);\r\n            }\r\n            const options = properties.options || bars[i].options;\r\n            setBorderSkipped(properties, options, stack, index);\r\n            setInflateAmount(properties, options, ruler.ratio);\r\n            this.updateElement(bars[i], i, properties, mode);\r\n        }\r\n    }\r\n _getStacks(last, dataIndex) {\r\n        const { iScale  } = this._cachedMeta;\r\n        const metasets = iScale.getMatchingVisibleMetas(this._type).filter((meta)=>meta.controller.options.grouped);\r\n        const stacked = iScale.options.stacked;\r\n        const stacks = [];\r\n        const currentParsed = this._cachedMeta.controller.getParsed(dataIndex);\r\n        const iScaleValue = currentParsed && currentParsed[iScale.axis];\r\n        const skipNull = (meta)=>{\r\n            const parsed = meta._parsed.find((item)=>item[iScale.axis] === iScaleValue);\r\n            const val = parsed && parsed[meta.vScale.axis];\r\n            if (isNullOrUndef(val) || isNaN(val)) {\r\n                return true;\r\n            }\r\n        };\r\n        for (const meta of metasets){\r\n            if (dataIndex !== undefined && skipNull(meta)) {\r\n                continue;\r\n            }\r\n            if (stacked === false || stacks.indexOf(meta.stack) === -1 || stacked === undefined && meta.stack === undefined) {\r\n                stacks.push(meta.stack);\r\n            }\r\n            if (meta.index === last) {\r\n                break;\r\n            }\r\n        }\r\n        if (!stacks.length) {\r\n            stacks.push(undefined);\r\n        }\r\n        return stacks;\r\n    }\r\n _getStackCount(index) {\r\n        return this._getStacks(undefined, index).length;\r\n    }\r\n    _getAxisCount() {\r\n        return this._getAxis().length;\r\n    }\r\n    getFirstScaleIdForIndexAxis() {\r\n        const scales = this.chart.scales;\r\n        const indexScaleId = this.chart.options.indexAxis;\r\n        return Object.keys(scales).filter((key)=>scales[key].axis === indexScaleId).shift();\r\n    }\r\n    _getAxis() {\r\n        const axis = {};\r\n        const firstScaleAxisId = this.getFirstScaleIdForIndexAxis();\r\n        for (const dataset of this.chart.data.datasets){\r\n            axis[valueOrDefault(this.chart.options.indexAxis === 'x' ? dataset.xAxisID : dataset.yAxisID, firstScaleAxisId)] = true;\r\n        }\r\n        return Object.keys(axis);\r\n    }\r\n _getStackIndex(datasetIndex, name, dataIndex) {\r\n        const stacks = this._getStacks(datasetIndex, dataIndex);\r\n        const index = name !== undefined ? stacks.indexOf(name) : -1;\r\n        return index === -1 ? stacks.length - 1 : index;\r\n    }\r\n _getRuler() {\r\n        const opts = this.options;\r\n        const meta = this._cachedMeta;\r\n        const iScale = meta.iScale;\r\n        const pixels = [];\r\n        let i, ilen;\r\n        for(i = 0, ilen = meta.data.length; i < ilen; ++i){\r\n            pixels.push(iScale.getPixelForValue(this.getParsed(i)[iScale.axis], i));\r\n        }\r\n        const barThickness = opts.barThickness;\r\n        const min = barThickness || computeMinSampleSize(meta);\r\n        return {\r\n            min,\r\n            pixels,\r\n            start: iScale._startPixel,\r\n            end: iScale._endPixel,\r\n            stackCount: this._getStackCount(),\r\n            scale: iScale,\r\n            grouped: opts.grouped,\r\n            ratio: barThickness ? 1 : opts.categoryPercentage * opts.barPercentage\r\n        };\r\n    }\r\n _calculateBarValuePixels(index) {\r\n        const { _cachedMeta: { vScale , _stacked , index: datasetIndex  } , options: { base: baseValue , minBarLength  }  } = this;\r\n        const actualBase = baseValue || 0;\r\n        const parsed = this.getParsed(index);\r\n        const custom = parsed._custom;\r\n        const floating = isFloatBar(custom);\r\n        let value = parsed[vScale.axis];\r\n        let start = 0;\r\n        let length = _stacked ? this.applyStack(vScale, parsed, _stacked) : value;\r\n        let head, size;\r\n        if (length !== value) {\r\n            start = length - value;\r\n            length = value;\r\n        }\r\n        if (floating) {\r\n            value = custom.barStart;\r\n            length = custom.barEnd - custom.barStart;\r\n            if (value !== 0 && sign(value) !== sign(custom.barEnd)) {\r\n                start = 0;\r\n            }\r\n            start += value;\r\n        }\r\n        const startValue = !isNullOrUndef(baseValue) && !floating ? baseValue : start;\r\n        let base = vScale.getPixelForValue(startValue);\r\n        if (this.chart.getDataVisibility(index)) {\r\n            head = vScale.getPixelForValue(start + length);\r\n        } else {\r\n            head = base;\r\n        }\r\n        size = head - base;\r\n        if (Math.abs(size) < minBarLength) {\r\n            size = barSign(size, vScale, actualBase) * minBarLength;\r\n            if (value === actualBase) {\r\n                base -= size / 2;\r\n            }\r\n            const startPixel = vScale.getPixelForDecimal(0);\r\n            const endPixel = vScale.getPixelForDecimal(1);\r\n            const min = Math.min(startPixel, endPixel);\r\n            const max = Math.max(startPixel, endPixel);\r\n            base = Math.max(Math.min(base, max), min);\r\n            head = base + size;\r\n            if (_stacked && !floating) {\r\n                parsed._stacks[vScale.axis]._visualValues[datasetIndex] = vScale.getValueForPixel(head) - vScale.getValueForPixel(base);\r\n            }\r\n        }\r\n        if (base === vScale.getPixelForValue(actualBase)) {\r\n            const halfGrid = sign(size) * vScale.getLineWidthForValue(actualBase) / 2;\r\n            base += halfGrid;\r\n            size -= halfGrid;\r\n        }\r\n        return {\r\n            size,\r\n            base,\r\n            head,\r\n            center: head + size / 2\r\n        };\r\n    }\r\n _calculateBarIndexPixels(index, ruler) {\r\n        const scale = ruler.scale;\r\n        const options = this.options;\r\n        const skipNull = options.skipNull;\r\n        const maxBarThickness = valueOrDefault(options.maxBarThickness, Infinity);\r\n        let center, size;\r\n        const axisCount = this._getAxisCount();\r\n        if (ruler.grouped) {\r\n            const stackCount = skipNull ? this._getStackCount(index) : ruler.stackCount;\r\n            const range = options.barThickness === 'flex' ? computeFlexCategoryTraits(index, ruler, options, stackCount * axisCount) : computeFitCategoryTraits(index, ruler, options, stackCount * axisCount);\r\n            const axisID = this.chart.options.indexAxis === 'x' ? this.getDataset().xAxisID : this.getDataset().yAxisID;\r\n            const axisNumber = this._getAxis().indexOf(valueOrDefault(axisID, this.getFirstScaleIdForIndexAxis()));\r\n            const stackIndex = this._getStackIndex(this.index, this._cachedMeta.stack, skipNull ? index : undefined) + axisNumber;\r\n            center = range.start + range.chunk * stackIndex + range.chunk / 2;\r\n            size = Math.min(maxBarThickness, range.chunk * range.ratio);\r\n        } else {\r\n            center = scale.getPixelForValue(this.getParsed(index)[scale.axis], index);\r\n            size = Math.min(maxBarThickness, ruler.min * ruler.ratio);\r\n        }\r\n        return {\r\n            base: center - size / 2,\r\n            head: center + size / 2,\r\n            center,\r\n            size\r\n        };\r\n    }\r\n    draw() {\r\n        const meta = this._cachedMeta;\r\n        const vScale = meta.vScale;\r\n        const rects = meta.data;\r\n        const ilen = rects.length;\r\n        let i = 0;\r\n        for(; i < ilen; ++i){\r\n            if (this.getParsed(i)[vScale.axis] !== null && !rects[i].hidden) {\r\n                rects[i].draw(this._ctx);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nclass BubbleController extends DatasetController {\r\n    static id = 'bubble';\r\n static defaults = {\r\n        datasetElementType: false,\r\n        dataElementType: 'point',\r\n        animations: {\r\n            numbers: {\r\n                type: 'number',\r\n                properties: [\r\n                    'x',\r\n                    'y',\r\n                    'borderWidth',\r\n                    'radius'\r\n                ]\r\n            }\r\n        }\r\n    };\r\n static overrides = {\r\n        scales: {\r\n            x: {\r\n                type: 'linear'\r\n            },\r\n            y: {\r\n                type: 'linear'\r\n            }\r\n        }\r\n    };\r\n    initialize() {\r\n        this.enableOptionSharing = true;\r\n        super.initialize();\r\n    }\r\n parsePrimitiveData(meta, data, start, count) {\r\n        const parsed = super.parsePrimitiveData(meta, data, start, count);\r\n        for(let i = 0; i < parsed.length; i++){\r\n            parsed[i]._custom = this.resolveDataElementOptions(i + start).radius;\r\n        }\r\n        return parsed;\r\n    }\r\n parseArrayData(meta, data, start, count) {\r\n        const parsed = super.parseArrayData(meta, data, start, count);\r\n        for(let i = 0; i < parsed.length; i++){\r\n            const item = data[start + i];\r\n            parsed[i]._custom = valueOrDefault(item[2], this.resolveDataElementOptions(i + start).radius);\r\n        }\r\n        return parsed;\r\n    }\r\n parseObjectData(meta, data, start, count) {\r\n        const parsed = super.parseObjectData(meta, data, start, count);\r\n        for(let i = 0; i < parsed.length; i++){\r\n            const item = data[start + i];\r\n            parsed[i]._custom = valueOrDefault(item && item.r && +item.r, this.resolveDataElementOptions(i + start).radius);\r\n        }\r\n        return parsed;\r\n    }\r\n getMaxOverflow() {\r\n        const data = this._cachedMeta.data;\r\n        let max = 0;\r\n        for(let i = data.length - 1; i >= 0; --i){\r\n            max = Math.max(max, data[i].size(this.resolveDataElementOptions(i)) / 2);\r\n        }\r\n        return max > 0 && max;\r\n    }\r\n getLabelAndValue(index) {\r\n        const meta = this._cachedMeta;\r\n        const labels = this.chart.data.labels || [];\r\n        const { xScale , yScale  } = meta;\r\n        const parsed = this.getParsed(index);\r\n        const x = xScale.getLabelForValue(parsed.x);\r\n        const y = yScale.getLabelForValue(parsed.y);\r\n        const r = parsed._custom;\r\n        return {\r\n            label: labels[index] || '',\r\n            value: '(' + x + ', ' + y + (r ? ', ' + r : '') + ')'\r\n        };\r\n    }\r\n    update(mode) {\r\n        const points = this._cachedMeta.data;\r\n        this.updateElements(points, 0, points.length, mode);\r\n    }\r\n    updateElements(points, start, count, mode) {\r\n        const reset = mode === 'reset';\r\n        const { iScale , vScale  } = this._cachedMeta;\r\n        const { sharedOptions , includeOptions  } = this._getSharedOptions(start, mode);\r\n        const iAxis = iScale.axis;\r\n        const vAxis = vScale.axis;\r\n        for(let i = start; i < start + count; i++){\r\n            const point = points[i];\r\n            const parsed = !reset && this.getParsed(i);\r\n            const properties = {};\r\n            const iPixel = properties[iAxis] = reset ? iScale.getPixelForDecimal(0.5) : iScale.getPixelForValue(parsed[iAxis]);\r\n            const vPixel = properties[vAxis] = reset ? vScale.getBasePixel() : vScale.getPixelForValue(parsed[vAxis]);\r\n            properties.skip = isNaN(iPixel) || isNaN(vPixel);\r\n            if (includeOptions) {\r\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, point.active ? 'active' : mode);\r\n                if (reset) {\r\n                    properties.options.radius = 0;\r\n                }\r\n            }\r\n            this.updateElement(point, i, properties, mode);\r\n        }\r\n    }\r\n resolveDataElementOptions(index, mode) {\r\n        const parsed = this.getParsed(index);\r\n        let values = super.resolveDataElementOptions(index, mode);\r\n        if (values.$shared) {\r\n            values = Object.assign({}, values, {\r\n                $shared: false\r\n            });\r\n        }\r\n        const radius = values.radius;\r\n        if (mode !== 'active') {\r\n            values.radius = 0;\r\n        }\r\n        values.radius += valueOrDefault(parsed && parsed._custom, radius);\r\n        return values;\r\n    }\r\n}\r\n\r\nfunction getRatioAndOffset(rotation, circumference, cutout) {\r\n    let ratioX = 1;\r\n    let ratioY = 1;\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n    if (circumference < TAU) {\r\n        const startAngle = rotation;\r\n        const endAngle = startAngle + circumference;\r\n        const startX = Math.cos(startAngle);\r\n        const startY = Math.sin(startAngle);\r\n        const endX = Math.cos(endAngle);\r\n        const endY = Math.sin(endAngle);\r\n        const calcMax = (angle, a, b)=>_angleBetween(angle, startAngle, endAngle, true) ? 1 : Math.max(a, a * cutout, b, b * cutout);\r\n        const calcMin = (angle, a, b)=>_angleBetween(angle, startAngle, endAngle, true) ? -1 : Math.min(a, a * cutout, b, b * cutout);\r\n        const maxX = calcMax(0, startX, endX);\r\n        const maxY = calcMax(HALF_PI, startY, endY);\r\n        const minX = calcMin(PI, startX, endX);\r\n        const minY = calcMin(PI + HALF_PI, startY, endY);\r\n        ratioX = (maxX - minX) / 2;\r\n        ratioY = (maxY - minY) / 2;\r\n        offsetX = -(maxX + minX) / 2;\r\n        offsetY = -(maxY + minY) / 2;\r\n    }\r\n    return {\r\n        ratioX,\r\n        ratioY,\r\n        offsetX,\r\n        offsetY\r\n    };\r\n}\r\nclass DoughnutController extends DatasetController {\r\n    static id = 'doughnut';\r\n static defaults = {\r\n        datasetElementType: false,\r\n        dataElementType: 'arc',\r\n        animation: {\r\n            animateRotate: true,\r\n            animateScale: false\r\n        },\r\n        animations: {\r\n            numbers: {\r\n                type: 'number',\r\n                properties: [\r\n                    'circumference',\r\n                    'endAngle',\r\n                    'innerRadius',\r\n                    'outerRadius',\r\n                    'startAngle',\r\n                    'x',\r\n                    'y',\r\n                    'offset',\r\n                    'borderWidth',\r\n                    'spacing'\r\n                ]\r\n            }\r\n        },\r\n        cutout: '50%',\r\n        rotation: 0,\r\n        circumference: 360,\r\n        radius: '100%',\r\n        spacing: 0,\r\n        indexAxis: 'r'\r\n    };\r\n    static descriptors = {\r\n        _scriptable: (name)=>name !== 'spacing',\r\n        _indexable: (name)=>name !== 'spacing' && !name.startsWith('borderDash') && !name.startsWith('hoverBorderDash')\r\n    };\r\n static overrides = {\r\n        aspectRatio: 1,\r\n        plugins: {\r\n            legend: {\r\n                labels: {\r\n                    generateLabels (chart) {\r\n                        const data = chart.data;\r\n                        if (data.labels.length && data.datasets.length) {\r\n                            const { labels: { pointStyle , color  }  } = chart.legend.options;\r\n                            return data.labels.map((label, i)=>{\r\n                                const meta = chart.getDatasetMeta(0);\r\n                                const style = meta.controller.getStyle(i);\r\n                                return {\r\n                                    text: label,\r\n                                    fillStyle: style.backgroundColor,\r\n                                    strokeStyle: style.borderColor,\r\n                                    fontColor: color,\r\n                                    lineWidth: style.borderWidth,\r\n                                    pointStyle: pointStyle,\r\n                                    hidden: !chart.getDataVisibility(i),\r\n                                    index: i\r\n                                };\r\n                            });\r\n                        }\r\n                        return [];\r\n                    }\r\n                },\r\n                onClick (e, legendItem, legend) {\r\n                    legend.chart.toggleDataVisibility(legendItem.index);\r\n                    legend.chart.update();\r\n                }\r\n            }\r\n        }\r\n    };\r\n    constructor(chart, datasetIndex){\r\n        super(chart, datasetIndex);\r\n        this.enableOptionSharing = true;\r\n        this.innerRadius = undefined;\r\n        this.outerRadius = undefined;\r\n        this.offsetX = undefined;\r\n        this.offsetY = undefined;\r\n    }\r\n    linkScales() {}\r\n parse(start, count) {\r\n        const data = this.getDataset().data;\r\n        const meta = this._cachedMeta;\r\n        if (this._parsing === false) {\r\n            meta._parsed = data;\r\n        } else {\r\n            let getter = (i)=>+data[i];\r\n            if (isObject(data[start])) {\r\n                const { key ='value'  } = this._parsing;\r\n                getter = (i)=>+resolveObjectKey(data[i], key);\r\n            }\r\n            let i, ilen;\r\n            for(i = start, ilen = start + count; i < ilen; ++i){\r\n                meta._parsed[i] = getter(i);\r\n            }\r\n        }\r\n    }\r\n _getRotation() {\r\n        return toRadians(this.options.rotation - 90);\r\n    }\r\n _getCircumference() {\r\n        return toRadians(this.options.circumference);\r\n    }\r\n _getRotationExtents() {\r\n        let min = TAU;\r\n        let max = -TAU;\r\n        for(let i = 0; i < this.chart.data.datasets.length; ++i){\r\n            if (this.chart.isDatasetVisible(i) && this.chart.getDatasetMeta(i).type === this._type) {\r\n                const controller = this.chart.getDatasetMeta(i).controller;\r\n                const rotation = controller._getRotation();\r\n                const circumference = controller._getCircumference();\r\n                min = Math.min(min, rotation);\r\n                max = Math.max(max, rotation + circumference);\r\n            }\r\n        }\r\n        return {\r\n            rotation: min,\r\n            circumference: max - min\r\n        };\r\n    }\r\n update(mode) {\r\n        const chart = this.chart;\r\n        const { chartArea  } = chart;\r\n        const meta = this._cachedMeta;\r\n        const arcs = meta.data;\r\n        const spacing = this.getMaxBorderWidth() + this.getMaxOffset(arcs) + this.options.spacing;\r\n        const maxSize = Math.max((Math.min(chartArea.width, chartArea.height) - spacing) / 2, 0);\r\n        const cutout = Math.min(toPercentage(this.options.cutout, maxSize), 1);\r\n        const chartWeight = this._getRingWeight(this.index);\r\n        const { circumference , rotation  } = this._getRotationExtents();\r\n        const { ratioX , ratioY , offsetX , offsetY  } = getRatioAndOffset(rotation, circumference, cutout);\r\n        const maxWidth = (chartArea.width - spacing) / ratioX;\r\n        const maxHeight = (chartArea.height - spacing) / ratioY;\r\n        const maxRadius = Math.max(Math.min(maxWidth, maxHeight) / 2, 0);\r\n        const outerRadius = toDimension(this.options.radius, maxRadius);\r\n        const innerRadius = Math.max(outerRadius * cutout, 0);\r\n        const radiusLength = (outerRadius - innerRadius) / this._getVisibleDatasetWeightTotal();\r\n        this.offsetX = offsetX * outerRadius;\r\n        this.offsetY = offsetY * outerRadius;\r\n        meta.total = this.calculateTotal();\r\n        this.outerRadius = outerRadius - radiusLength * this._getRingWeightOffset(this.index);\r\n        this.innerRadius = Math.max(this.outerRadius - radiusLength * chartWeight, 0);\r\n        this.updateElements(arcs, 0, arcs.length, mode);\r\n    }\r\n _circumference(i, reset) {\r\n        const opts = this.options;\r\n        const meta = this._cachedMeta;\r\n        const circumference = this._getCircumference();\r\n        if (reset && opts.animation.animateRotate || !this.chart.getDataVisibility(i) || meta._parsed[i] === null || meta.data[i].hidden) {\r\n            return 0;\r\n        }\r\n        return this.calculateCircumference(meta._parsed[i] * circumference / TAU);\r\n    }\r\n    updateElements(arcs, start, count, mode) {\r\n        const reset = mode === 'reset';\r\n        const chart = this.chart;\r\n        const chartArea = chart.chartArea;\r\n        const opts = chart.options;\r\n        const animationOpts = opts.animation;\r\n        const centerX = (chartArea.left + chartArea.right) / 2;\r\n        const centerY = (chartArea.top + chartArea.bottom) / 2;\r\n        const animateScale = reset && animationOpts.animateScale;\r\n        const innerRadius = animateScale ? 0 : this.innerRadius;\r\n        const outerRadius = animateScale ? 0 : this.outerRadius;\r\n        const { sharedOptions , includeOptions  } = this._getSharedOptions(start, mode);\r\n        let startAngle = this._getRotation();\r\n        let i;\r\n        for(i = 0; i < start; ++i){\r\n            startAngle += this._circumference(i, reset);\r\n        }\r\n        for(i = start; i < start + count; ++i){\r\n            const circumference = this._circumference(i, reset);\r\n            const arc = arcs[i];\r\n            const properties = {\r\n                x: centerX + this.offsetX,\r\n                y: centerY + this.offsetY,\r\n                startAngle,\r\n                endAngle: startAngle + circumference,\r\n                circumference,\r\n                outerRadius,\r\n                innerRadius\r\n            };\r\n            if (includeOptions) {\r\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, arc.active ? 'active' : mode);\r\n            }\r\n            startAngle += circumference;\r\n            this.updateElement(arc, i, properties, mode);\r\n        }\r\n    }\r\n    calculateTotal() {\r\n        const meta = this._cachedMeta;\r\n        const metaData = meta.data;\r\n        let total = 0;\r\n        let i;\r\n        for(i = 0; i < metaData.length; i++){\r\n            const value = meta._parsed[i];\r\n            if (value !== null && !isNaN(value) && this.chart.getDataVisibility(i) && !metaData[i].hidden) {\r\n                total += Math.abs(value);\r\n            }\r\n        }\r\n        return total;\r\n    }\r\n    calculateCircumference(value) {\r\n        const total = this._cachedMeta.total;\r\n        if (total > 0 && !isNaN(value)) {\r\n            return TAU * (Math.abs(value) / total);\r\n        }\r\n        return 0;\r\n    }\r\n    getLabelAndValue(index) {\r\n        const meta = this._cachedMeta;\r\n        const chart = this.chart;\r\n        const labels = chart.data.labels || [];\r\n        const value = formatNumber(meta._parsed[index], chart.options.locale);\r\n        return {\r\n            label: labels[index] || '',\r\n            value\r\n        };\r\n    }\r\n    getMaxBorderWidth(arcs) {\r\n        let max = 0;\r\n        const chart = this.chart;\r\n        let i, ilen, meta, controller, options;\r\n        if (!arcs) {\r\n            for(i = 0, ilen = chart.data.datasets.length; i < ilen; ++i){\r\n                if (chart.isDatasetVisible(i)) {\r\n                    meta = chart.getDatasetMeta(i);\r\n                    arcs = meta.data;\r\n                    controller = meta.controller;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (!arcs) {\r\n            return 0;\r\n        }\r\n        for(i = 0, ilen = arcs.length; i < ilen; ++i){\r\n            options = controller.resolveDataElementOptions(i);\r\n            if (options.borderAlign !== 'inner') {\r\n                max = Math.max(max, options.borderWidth || 0, options.hoverBorderWidth || 0);\r\n            }\r\n        }\r\n        return max;\r\n    }\r\n    getMaxOffset(arcs) {\r\n        let max = 0;\r\n        for(let i = 0, ilen = arcs.length; i < ilen; ++i){\r\n            const options = this.resolveDataElementOptions(i);\r\n            max = Math.max(max, options.offset || 0, options.hoverOffset || 0);\r\n        }\r\n        return max;\r\n    }\r\n _getRingWeightOffset(datasetIndex) {\r\n        let ringWeightOffset = 0;\r\n        for(let i = 0; i < datasetIndex; ++i){\r\n            if (this.chart.isDatasetVisible(i)) {\r\n                ringWeightOffset += this._getRingWeight(i);\r\n            }\r\n        }\r\n        return ringWeightOffset;\r\n    }\r\n _getRingWeight(datasetIndex) {\r\n        return Math.max(valueOrDefault(this.chart.data.datasets[datasetIndex].weight, 1), 0);\r\n    }\r\n _getVisibleDatasetWeightTotal() {\r\n        return this._getRingWeightOffset(this.chart.data.datasets.length) || 1;\r\n    }\r\n}\r\n\r\nclass LineController extends DatasetController {\r\n    static id = 'line';\r\n static defaults = {\r\n        datasetElementType: 'line',\r\n        dataElementType: 'point',\r\n        showLine: true,\r\n        spanGaps: false\r\n    };\r\n static overrides = {\r\n        scales: {\r\n            _index_: {\r\n                type: 'category'\r\n            },\r\n            _value_: {\r\n                type: 'linear'\r\n            }\r\n        }\r\n    };\r\n    initialize() {\r\n        this.enableOptionSharing = true;\r\n        this.supportsDecimation = true;\r\n        super.initialize();\r\n    }\r\n    update(mode) {\r\n        const meta = this._cachedMeta;\r\n        const { dataset: line , data: points = [] , _dataset  } = meta;\r\n        const animationsDisabled = this.chart._animationsDisabled;\r\n        let { start , count  } = _getStartAndCountOfVisiblePoints(meta, points, animationsDisabled);\r\n        this._drawStart = start;\r\n        this._drawCount = count;\r\n        if (_scaleRangesChanged(meta)) {\r\n            start = 0;\r\n            count = points.length;\r\n        }\r\n        line._chart = this.chart;\r\n        line._datasetIndex = this.index;\r\n        line._decimated = !!_dataset._decimated;\r\n        line.points = points;\r\n        const options = this.resolveDatasetElementOptions(mode);\r\n        if (!this.options.showLine) {\r\n            options.borderWidth = 0;\r\n        }\r\n        options.segment = this.options.segment;\r\n        this.updateElement(line, undefined, {\r\n            animated: !animationsDisabled,\r\n            options\r\n        }, mode);\r\n        this.updateElements(points, start, count, mode);\r\n    }\r\n    updateElements(points, start, count, mode) {\r\n        const reset = mode === 'reset';\r\n        const { iScale , vScale , _stacked , _dataset  } = this._cachedMeta;\r\n        const { sharedOptions , includeOptions  } = this._getSharedOptions(start, mode);\r\n        const iAxis = iScale.axis;\r\n        const vAxis = vScale.axis;\r\n        const { spanGaps , segment  } = this.options;\r\n        const maxGapLength = isNumber(spanGaps) ? spanGaps : Number.POSITIVE_INFINITY;\r\n        const directUpdate = this.chart._animationsDisabled || reset || mode === 'none';\r\n        const end = start + count;\r\n        const pointsCount = points.length;\r\n        let prevParsed = start > 0 && this.getParsed(start - 1);\r\n        for(let i = 0; i < pointsCount; ++i){\r\n            const point = points[i];\r\n            const properties = directUpdate ? point : {};\r\n            if (i < start || i >= end) {\r\n                properties.skip = true;\r\n                continue;\r\n            }\r\n            const parsed = this.getParsed(i);\r\n            const nullData = isNullOrUndef(parsed[vAxis]);\r\n            const iPixel = properties[iAxis] = iScale.getPixelForValue(parsed[iAxis], i);\r\n            const vPixel = properties[vAxis] = reset || nullData ? vScale.getBasePixel() : vScale.getPixelForValue(_stacked ? this.applyStack(vScale, parsed, _stacked) : parsed[vAxis], i);\r\n            properties.skip = isNaN(iPixel) || isNaN(vPixel) || nullData;\r\n            properties.stop = i > 0 && Math.abs(parsed[iAxis] - prevParsed[iAxis]) > maxGapLength;\r\n            if (segment) {\r\n                properties.parsed = parsed;\r\n                properties.raw = _dataset.data[i];\r\n            }\r\n            if (includeOptions) {\r\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, point.active ? 'active' : mode);\r\n            }\r\n            if (!directUpdate) {\r\n                this.updateElement(point, i, properties, mode);\r\n            }\r\n            prevParsed = parsed;\r\n        }\r\n    }\r\n getMaxOverflow() {\r\n        const meta = this._cachedMeta;\r\n        const dataset = meta.dataset;\r\n        const border = dataset.options && dataset.options.borderWidth || 0;\r\n        const data = meta.data || [];\r\n        if (!data.length) {\r\n            return border;\r\n        }\r\n        const firstPoint = data[0].size(this.resolveDataElementOptions(0));\r\n        const lastPoint = data[data.length - 1].size(this.resolveDataElementOptions(data.length - 1));\r\n        return Math.max(border, firstPoint, lastPoint) / 2;\r\n    }\r\n    draw() {\r\n        const meta = this._cachedMeta;\r\n        meta.dataset.updateControlPoints(this.chart.chartArea, meta.iScale.axis);\r\n        super.draw();\r\n    }\r\n}\r\n\r\nclass PolarAreaController extends DatasetController {\r\n    static id = 'polarArea';\r\n static defaults = {\r\n        dataElementType: 'arc',\r\n        animation: {\r\n            animateRotate: true,\r\n            animateScale: true\r\n        },\r\n        animations: {\r\n            numbers: {\r\n                type: 'number',\r\n                properties: [\r\n                    'x',\r\n                    'y',\r\n                    'startAngle',\r\n                    'endAngle',\r\n                    'innerRadius',\r\n                    'outerRadius'\r\n                ]\r\n            }\r\n        },\r\n        indexAxis: 'r',\r\n        startAngle: 0\r\n    };\r\n static overrides = {\r\n        aspectRatio: 1,\r\n        plugins: {\r\n            legend: {\r\n                labels: {\r\n                    generateLabels (chart) {\r\n                        const data = chart.data;\r\n                        if (data.labels.length && data.datasets.length) {\r\n                            const { labels: { pointStyle , color  }  } = chart.legend.options;\r\n                            return data.labels.map((label, i)=>{\r\n                                const meta = chart.getDatasetMeta(0);\r\n                                const style = meta.controller.getStyle(i);\r\n                                return {\r\n                                    text: label,\r\n                                    fillStyle: style.backgroundColor,\r\n                                    strokeStyle: style.borderColor,\r\n                                    fontColor: color,\r\n                                    lineWidth: style.borderWidth,\r\n                                    pointStyle: pointStyle,\r\n                                    hidden: !chart.getDataVisibility(i),\r\n                                    index: i\r\n                                };\r\n                            });\r\n                        }\r\n                        return [];\r\n                    }\r\n                },\r\n                onClick (e, legendItem, legend) {\r\n                    legend.chart.toggleDataVisibility(legendItem.index);\r\n                    legend.chart.update();\r\n                }\r\n            }\r\n        },\r\n        scales: {\r\n            r: {\r\n                type: 'radialLinear',\r\n                angleLines: {\r\n                    display: false\r\n                },\r\n                beginAtZero: true,\r\n                grid: {\r\n                    circular: true\r\n                },\r\n                pointLabels: {\r\n                    display: false\r\n                },\r\n                startAngle: 0\r\n            }\r\n        }\r\n    };\r\n    constructor(chart, datasetIndex){\r\n        super(chart, datasetIndex);\r\n        this.innerRadius = undefined;\r\n        this.outerRadius = undefined;\r\n    }\r\n    getLabelAndValue(index) {\r\n        const meta = this._cachedMeta;\r\n        const chart = this.chart;\r\n        const labels = chart.data.labels || [];\r\n        const value = formatNumber(meta._parsed[index].r, chart.options.locale);\r\n        return {\r\n            label: labels[index] || '',\r\n            value\r\n        };\r\n    }\r\n    parseObjectData(meta, data, start, count) {\r\n        return _parseObjectDataRadialScale.bind(this)(meta, data, start, count);\r\n    }\r\n    update(mode) {\r\n        const arcs = this._cachedMeta.data;\r\n        this._updateRadius();\r\n        this.updateElements(arcs, 0, arcs.length, mode);\r\n    }\r\n getMinMax() {\r\n        const meta = this._cachedMeta;\r\n        const range = {\r\n            min: Number.POSITIVE_INFINITY,\r\n            max: Number.NEGATIVE_INFINITY\r\n        };\r\n        meta.data.forEach((element, index)=>{\r\n            const parsed = this.getParsed(index).r;\r\n            if (!isNaN(parsed) && this.chart.getDataVisibility(index)) {\r\n                if (parsed < range.min) {\r\n                    range.min = parsed;\r\n                }\r\n                if (parsed > range.max) {\r\n                    range.max = parsed;\r\n                }\r\n            }\r\n        });\r\n        return range;\r\n    }\r\n _updateRadius() {\r\n        const chart = this.chart;\r\n        const chartArea = chart.chartArea;\r\n        const opts = chart.options;\r\n        const minSize = Math.min(chartArea.right - chartArea.left, chartArea.bottom - chartArea.top);\r\n        const outerRadius = Math.max(minSize / 2, 0);\r\n        const innerRadius = Math.max(opts.cutoutPercentage ? outerRadius / 100 * opts.cutoutPercentage : 1, 0);\r\n        const radiusLength = (outerRadius - innerRadius) / chart.getVisibleDatasetCount();\r\n        this.outerRadius = outerRadius - radiusLength * this.index;\r\n        this.innerRadius = this.outerRadius - radiusLength;\r\n    }\r\n    updateElements(arcs, start, count, mode) {\r\n        const reset = mode === 'reset';\r\n        const chart = this.chart;\r\n        const opts = chart.options;\r\n        const animationOpts = opts.animation;\r\n        const scale = this._cachedMeta.rScale;\r\n        const centerX = scale.xCenter;\r\n        const centerY = scale.yCenter;\r\n        const datasetStartAngle = scale.getIndexAngle(0) - 0.5 * PI;\r\n        let angle = datasetStartAngle;\r\n        let i;\r\n        const defaultAngle = 360 / this.countVisibleElements();\r\n        for(i = 0; i < start; ++i){\r\n            angle += this._computeAngle(i, mode, defaultAngle);\r\n        }\r\n        for(i = start; i < start + count; i++){\r\n            const arc = arcs[i];\r\n            let startAngle = angle;\r\n            let endAngle = angle + this._computeAngle(i, mode, defaultAngle);\r\n            let outerRadius = chart.getDataVisibility(i) ? scale.getDistanceFromCenterForValue(this.getParsed(i).r) : 0;\r\n            angle = endAngle;\r\n            if (reset) {\r\n                if (animationOpts.animateScale) {\r\n                    outerRadius = 0;\r\n                }\r\n                if (animationOpts.animateRotate) {\r\n                    startAngle = endAngle = datasetStartAngle;\r\n                }\r\n            }\r\n            const properties = {\r\n                x: centerX,\r\n                y: centerY,\r\n                innerRadius: 0,\r\n                outerRadius,\r\n                startAngle,\r\n                endAngle,\r\n                options: this.resolveDataElementOptions(i, arc.active ? 'active' : mode)\r\n            };\r\n            this.updateElement(arc, i, properties, mode);\r\n        }\r\n    }\r\n    countVisibleElements() {\r\n        const meta = this._cachedMeta;\r\n        let count = 0;\r\n        meta.data.forEach((element, index)=>{\r\n            if (!isNaN(this.getParsed(index).r) && this.chart.getDataVisibility(index)) {\r\n                count++;\r\n            }\r\n        });\r\n        return count;\r\n    }\r\n _computeAngle(index, mode, defaultAngle) {\r\n        return this.chart.getDataVisibility(index) ? toRadians(this.resolveDataElementOptions(index, mode).angle || defaultAngle) : 0;\r\n    }\r\n}\r\n\r\nclass PieController extends DoughnutController {\r\n    static id = 'pie';\r\n static defaults = {\r\n        cutout: 0,\r\n        rotation: 0,\r\n        circumference: 360,\r\n        radius: '100%'\r\n    };\r\n}\r\n\r\nclass RadarController extends DatasetController {\r\n    static id = 'radar';\r\n static defaults = {\r\n        datasetElementType: 'line',\r\n        dataElementType: 'point',\r\n        indexAxis: 'r',\r\n        showLine: true,\r\n        elements: {\r\n            line: {\r\n                fill: 'start'\r\n            }\r\n        }\r\n    };\r\n static overrides = {\r\n        aspectRatio: 1,\r\n        scales: {\r\n            r: {\r\n                type: 'radialLinear'\r\n            }\r\n        }\r\n    };\r\n getLabelAndValue(index) {\r\n        const vScale = this._cachedMeta.vScale;\r\n        const parsed = this.getParsed(index);\r\n        return {\r\n            label: vScale.getLabels()[index],\r\n            value: '' + vScale.getLabelForValue(parsed[vScale.axis])\r\n        };\r\n    }\r\n    parseObjectData(meta, data, start, count) {\r\n        return _parseObjectDataRadialScale.bind(this)(meta, data, start, count);\r\n    }\r\n    update(mode) {\r\n        const meta = this._cachedMeta;\r\n        const line = meta.dataset;\r\n        const points = meta.data || [];\r\n        const labels = meta.iScale.getLabels();\r\n        line.points = points;\r\n        if (mode !== 'resize') {\r\n            const options = this.resolveDatasetElementOptions(mode);\r\n            if (!this.options.showLine) {\r\n                options.borderWidth = 0;\r\n            }\r\n            const properties = {\r\n                _loop: true,\r\n                _fullLoop: labels.length === points.length,\r\n                options\r\n            };\r\n            this.updateElement(line, undefined, properties, mode);\r\n        }\r\n        this.updateElements(points, 0, points.length, mode);\r\n    }\r\n    updateElements(points, start, count, mode) {\r\n        const scale = this._cachedMeta.rScale;\r\n        const reset = mode === 'reset';\r\n        for(let i = start; i < start + count; i++){\r\n            const point = points[i];\r\n            const options = this.resolveDataElementOptions(i, point.active ? 'active' : mode);\r\n            const pointPosition = scale.getPointPositionForValue(i, this.getParsed(i).r);\r\n            const x = reset ? scale.xCenter : pointPosition.x;\r\n            const y = reset ? scale.yCenter : pointPosition.y;\r\n            const properties = {\r\n                x,\r\n                y,\r\n                angle: pointPosition.angle,\r\n                skip: isNaN(x) || isNaN(y),\r\n                options\r\n            };\r\n            this.updateElement(point, i, properties, mode);\r\n        }\r\n    }\r\n}\r\n\r\nclass ScatterController extends DatasetController {\r\n    static id = 'scatter';\r\n static defaults = {\r\n        datasetElementType: false,\r\n        dataElementType: 'point',\r\n        showLine: false,\r\n        fill: false\r\n    };\r\n static overrides = {\r\n        interaction: {\r\n            mode: 'point'\r\n        },\r\n        scales: {\r\n            x: {\r\n                type: 'linear'\r\n            },\r\n            y: {\r\n                type: 'linear'\r\n            }\r\n        }\r\n    };\r\n getLabelAndValue(index) {\r\n        const meta = this._cachedMeta;\r\n        const labels = this.chart.data.labels || [];\r\n        const { xScale , yScale  } = meta;\r\n        const parsed = this.getParsed(index);\r\n        const x = xScale.getLabelForValue(parsed.x);\r\n        const y = yScale.getLabelForValue(parsed.y);\r\n        return {\r\n            label: labels[index] || '',\r\n            value: '(' + x + ', ' + y + ')'\r\n        };\r\n    }\r\n    update(mode) {\r\n        const meta = this._cachedMeta;\r\n        const { data: points = []  } = meta;\r\n        const animationsDisabled = this.chart._animationsDisabled;\r\n        let { start , count  } = _getStartAndCountOfVisiblePoints(meta, points, animationsDisabled);\r\n        this._drawStart = start;\r\n        this._drawCount = count;\r\n        if (_scaleRangesChanged(meta)) {\r\n            start = 0;\r\n            count = points.length;\r\n        }\r\n        if (this.options.showLine) {\r\n            if (!this.datasetElementType) {\r\n                this.addElements();\r\n            }\r\n            const { dataset: line , _dataset  } = meta;\r\n            line._chart = this.chart;\r\n            line._datasetIndex = this.index;\r\n            line._decimated = !!_dataset._decimated;\r\n            line.points = points;\r\n            const options = this.resolveDatasetElementOptions(mode);\r\n            options.segment = this.options.segment;\r\n            this.updateElement(line, undefined, {\r\n                animated: !animationsDisabled,\r\n                options\r\n            }, mode);\r\n        } else if (this.datasetElementType) {\r\n            delete meta.dataset;\r\n            this.datasetElementType = false;\r\n        }\r\n        this.updateElements(points, start, count, mode);\r\n    }\r\n    addElements() {\r\n        const { showLine  } = this.options;\r\n        if (!this.datasetElementType && showLine) {\r\n            this.datasetElementType = this.chart.registry.getElement('line');\r\n        }\r\n        super.addElements();\r\n    }\r\n    updateElements(points, start, count, mode) {\r\n        const reset = mode === 'reset';\r\n        const { iScale , vScale , _stacked , _dataset  } = this._cachedMeta;\r\n        const firstOpts = this.resolveDataElementOptions(start, mode);\r\n        const sharedOptions = this.getSharedOptions(firstOpts);\r\n        const includeOptions = this.includeOptions(mode, sharedOptions);\r\n        const iAxis = iScale.axis;\r\n        const vAxis = vScale.axis;\r\n        const { spanGaps , segment  } = this.options;\r\n        const maxGapLength = isNumber(spanGaps) ? spanGaps : Number.POSITIVE_INFINITY;\r\n        const directUpdate = this.chart._animationsDisabled || reset || mode === 'none';\r\n        let prevParsed = start > 0 && this.getParsed(start - 1);\r\n        for(let i = start; i < start + count; ++i){\r\n            const point = points[i];\r\n            const parsed = this.getParsed(i);\r\n            const properties = directUpdate ? point : {};\r\n            const nullData = isNullOrUndef(parsed[vAxis]);\r\n            const iPixel = properties[iAxis] = iScale.getPixelForValue(parsed[iAxis], i);\r\n            const vPixel = properties[vAxis] = reset || nullData ? vScale.getBasePixel() : vScale.getPixelForValue(_stacked ? this.applyStack(vScale, parsed, _stacked) : parsed[vAxis], i);\r\n            properties.skip = isNaN(iPixel) || isNaN(vPixel) || nullData;\r\n            properties.stop = i > 0 && Math.abs(parsed[iAxis] - prevParsed[iAxis]) > maxGapLength;\r\n            if (segment) {\r\n                properties.parsed = parsed;\r\n                properties.raw = _dataset.data[i];\r\n            }\r\n            if (includeOptions) {\r\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, point.active ? 'active' : mode);\r\n            }\r\n            if (!directUpdate) {\r\n                this.updateElement(point, i, properties, mode);\r\n            }\r\n            prevParsed = parsed;\r\n        }\r\n        this.updateSharedOptions(sharedOptions, mode, firstOpts);\r\n    }\r\n getMaxOverflow() {\r\n        const meta = this._cachedMeta;\r\n        const data = meta.data || [];\r\n        if (!this.options.showLine) {\r\n            let max = 0;\r\n            for(let i = data.length - 1; i >= 0; --i){\r\n                max = Math.max(max, data[i].size(this.resolveDataElementOptions(i)) / 2);\r\n            }\r\n            return max > 0 && max;\r\n        }\r\n        const dataset = meta.dataset;\r\n        const border = dataset.options && dataset.options.borderWidth || 0;\r\n        if (!data.length) {\r\n            return border;\r\n        }\r\n        const firstPoint = data[0].size(this.resolveDataElementOptions(0));\r\n        const lastPoint = data[data.length - 1].size(this.resolveDataElementOptions(data.length - 1));\r\n        return Math.max(border, firstPoint, lastPoint) / 2;\r\n    }\r\n}\r\n\r\nvar controllers = /*#__PURE__*/Object.freeze({\r\n__proto__: null,\r\nBarController: BarController,\r\nBubbleController: BubbleController,\r\nDoughnutController: DoughnutController,\r\nLineController: LineController,\r\nPieController: PieController,\r\nPolarAreaController: PolarAreaController,\r\nRadarController: RadarController,\r\nScatterController: ScatterController\r\n});\r\n\r\n/**\r\n * @namespace Chart._adapters\r\n * @since 2.8.0\r\n * @private\r\n */ function abstract() {\r\n    throw new Error('This method is not implemented: Check that a complete date adapter is provided.');\r\n}\r\n/**\r\n * Date adapter (current used by the time scale)\r\n * @namespace Chart._adapters._date\r\n * @memberof Chart._adapters\r\n * @private\r\n */ class DateAdapterBase {\r\n    /**\r\n   * Override default date adapter methods.\r\n   * Accepts type parameter to define options type.\r\n   * @example\r\n   * Chart._adapters._date.override<{myAdapterOption: string}>({\r\n   *   init() {\r\n   *     console.log(this.options.myAdapterOption);\r\n   *   }\r\n   * })\r\n   */ static override(members) {\r\n        Object.assign(DateAdapterBase.prototype, members);\r\n    }\r\n    options;\r\n    constructor(options){\r\n        this.options = options || {};\r\n    }\r\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n    init() {}\r\n    formats() {\r\n        return abstract();\r\n    }\r\n    parse() {\r\n        return abstract();\r\n    }\r\n    format() {\r\n        return abstract();\r\n    }\r\n    add() {\r\n        return abstract();\r\n    }\r\n    diff() {\r\n        return abstract();\r\n    }\r\n    startOf() {\r\n        return abstract();\r\n    }\r\n    endOf() {\r\n        return abstract();\r\n    }\r\n}\r\nvar adapters = {\r\n    _date: DateAdapterBase\r\n};\r\n\r\nfunction binarySearch(metaset, axis, value, intersect) {\r\n    const { controller , data , _sorted  } = metaset;\r\n    const iScale = controller._cachedMeta.iScale;\r\n    const spanGaps = metaset.dataset ? metaset.dataset.options ? metaset.dataset.options.spanGaps : null : null;\r\n    if (iScale && axis === iScale.axis && axis !== 'r' && _sorted && data.length) {\r\n        const lookupMethod = iScale._reversePixels ? _rlookupByKey : _lookupByKey;\r\n        if (!intersect) {\r\n            const result = lookupMethod(data, axis, value);\r\n            if (spanGaps) {\r\n                const { vScale  } = controller._cachedMeta;\r\n                const { _parsed  } = metaset;\r\n                const distanceToDefinedLo = _parsed.slice(0, result.lo + 1).reverse().findIndex((point)=>!isNullOrUndef(point[vScale.axis]));\r\n                result.lo -= Math.max(0, distanceToDefinedLo);\r\n                const distanceToDefinedHi = _parsed.slice(result.hi).findIndex((point)=>!isNullOrUndef(point[vScale.axis]));\r\n                result.hi += Math.max(0, distanceToDefinedHi);\r\n            }\r\n            return result;\r\n        } else if (controller._sharedOptions) {\r\n            const el = data[0];\r\n            const range = typeof el.getRange === 'function' && el.getRange(axis);\r\n            if (range) {\r\n                const start = lookupMethod(data, axis, value - range);\r\n                const end = lookupMethod(data, axis, value + range);\r\n                return {\r\n                    lo: start.lo,\r\n                    hi: end.hi\r\n                };\r\n            }\r\n        }\r\n    }\r\n    return {\r\n        lo: 0,\r\n        hi: data.length - 1\r\n    };\r\n}\r\n function evaluateInteractionItems(chart, axis, position, handler, intersect) {\r\n    const metasets = chart.getSortedVisibleDatasetMetas();\r\n    const value = position[axis];\r\n    for(let i = 0, ilen = metasets.length; i < ilen; ++i){\r\n        const { index , data  } = metasets[i];\r\n        const { lo , hi  } = binarySearch(metasets[i], axis, value, intersect);\r\n        for(let j = lo; j <= hi; ++j){\r\n            const element = data[j];\r\n            if (!element.skip) {\r\n                handler(element, index, j);\r\n            }\r\n        }\r\n    }\r\n}\r\n function getDistanceMetricForAxis(axis) {\r\n    const useX = axis.indexOf('x') !== -1;\r\n    const useY = axis.indexOf('y') !== -1;\r\n    return function(pt1, pt2) {\r\n        const deltaX = useX ? Math.abs(pt1.x - pt2.x) : 0;\r\n        const deltaY = useY ? Math.abs(pt1.y - pt2.y) : 0;\r\n        return Math.sqrt(Math.pow(deltaX, 2) + Math.pow(deltaY, 2));\r\n    };\r\n}\r\n function getIntersectItems(chart, position, axis, useFinalPosition, includeInvisible) {\r\n    const items = [];\r\n    if (!includeInvisible && !chart.isPointInArea(position)) {\r\n        return items;\r\n    }\r\n    const evaluationFunc = function(element, datasetIndex, index) {\r\n        if (!includeInvisible && !_isPointInArea(element, chart.chartArea, 0)) {\r\n            return;\r\n        }\r\n        if (element.inRange(position.x, position.y, useFinalPosition)) {\r\n            items.push({\r\n                element,\r\n                datasetIndex,\r\n                index\r\n            });\r\n        }\r\n    };\r\n    evaluateInteractionItems(chart, axis, position, evaluationFunc, true);\r\n    return items;\r\n}\r\n function getNearestRadialItems(chart, position, axis, useFinalPosition) {\r\n    let items = [];\r\n    function evaluationFunc(element, datasetIndex, index) {\r\n        const { startAngle , endAngle  } = element.getProps([\r\n            'startAngle',\r\n            'endAngle'\r\n        ], useFinalPosition);\r\n        const { angle  } = getAngleFromPoint(element, {\r\n            x: position.x,\r\n            y: position.y\r\n        });\r\n        if (_angleBetween(angle, startAngle, endAngle)) {\r\n            items.push({\r\n                element,\r\n                datasetIndex,\r\n                index\r\n            });\r\n        }\r\n    }\r\n    evaluateInteractionItems(chart, axis, position, evaluationFunc);\r\n    return items;\r\n}\r\n function getNearestCartesianItems(chart, position, axis, intersect, useFinalPosition, includeInvisible) {\r\n    let items = [];\r\n    const distanceMetric = getDistanceMetricForAxis(axis);\r\n    let minDistance = Number.POSITIVE_INFINITY;\r\n    function evaluationFunc(element, datasetIndex, index) {\r\n        const inRange = element.inRange(position.x, position.y, useFinalPosition);\r\n        if (intersect && !inRange) {\r\n            return;\r\n        }\r\n        const center = element.getCenterPoint(useFinalPosition);\r\n        const pointInArea = !!includeInvisible || chart.isPointInArea(center);\r\n        if (!pointInArea && !inRange) {\r\n            return;\r\n        }\r\n        const distance = distanceMetric(position, center);\r\n        if (distance < minDistance) {\r\n            items = [\r\n                {\r\n                    element,\r\n                    datasetIndex,\r\n                    index\r\n                }\r\n            ];\r\n            minDistance = distance;\r\n        } else if (distance === minDistance) {\r\n            items.push({\r\n                element,\r\n                datasetIndex,\r\n                index\r\n            });\r\n        }\r\n    }\r\n    evaluateInteractionItems(chart, axis, position, evaluationFunc);\r\n    return items;\r\n}\r\n function getNearestItems(chart, position, axis, intersect, useFinalPosition, includeInvisible) {\r\n    if (!includeInvisible && !chart.isPointInArea(position)) {\r\n        return [];\r\n    }\r\n    return axis === 'r' && !intersect ? getNearestRadialItems(chart, position, axis, useFinalPosition) : getNearestCartesianItems(chart, position, axis, intersect, useFinalPosition, includeInvisible);\r\n}\r\n function getAxisItems(chart, position, axis, intersect, useFinalPosition) {\r\n    const items = [];\r\n    const rangeMethod = axis === 'x' ? 'inXRange' : 'inYRange';\r\n    let intersectsItem = false;\r\n    evaluateInteractionItems(chart, axis, position, (element, datasetIndex, index)=>{\r\n        if (element[rangeMethod] && element[rangeMethod](position[axis], useFinalPosition)) {\r\n            items.push({\r\n                element,\r\n                datasetIndex,\r\n                index\r\n            });\r\n            intersectsItem = intersectsItem || element.inRange(position.x, position.y, useFinalPosition);\r\n        }\r\n    });\r\n    if (intersect && !intersectsItem) {\r\n        return [];\r\n    }\r\n    return items;\r\n}\r\n var Interaction = {\r\n    evaluateInteractionItems,\r\n    modes: {\r\n index (chart, e, options, useFinalPosition) {\r\n            const position = getRelativePosition(e, chart);\r\n            const axis = options.axis || 'x';\r\n            const includeInvisible = options.includeInvisible || false;\r\n            const items = options.intersect ? getIntersectItems(chart, position, axis, useFinalPosition, includeInvisible) : getNearestItems(chart, position, axis, false, useFinalPosition, includeInvisible);\r\n            const elements = [];\r\n            if (!items.length) {\r\n                return [];\r\n            }\r\n            chart.getSortedVisibleDatasetMetas().forEach((meta)=>{\r\n                const index = items[0].index;\r\n                const element = meta.data[index];\r\n                if (element && !element.skip) {\r\n                    elements.push({\r\n                        element,\r\n                        datasetIndex: meta.index,\r\n                        index\r\n                    });\r\n                }\r\n            });\r\n            return elements;\r\n        },\r\n dataset (chart, e, options, useFinalPosition) {\r\n            const position = getRelativePosition(e, chart);\r\n            const axis = options.axis || 'xy';\r\n            const includeInvisible = options.includeInvisible || false;\r\n            let items = options.intersect ? getIntersectItems(chart, position, axis, useFinalPosition, includeInvisible) : getNearestItems(chart, position, axis, false, useFinalPosition, includeInvisible);\r\n            if (items.length > 0) {\r\n                const datasetIndex = items[0].datasetIndex;\r\n                const data = chart.getDatasetMeta(datasetIndex).data;\r\n                items = [];\r\n                for(let i = 0; i < data.length; ++i){\r\n                    items.push({\r\n                        element: data[i],\r\n                        datasetIndex,\r\n                        index: i\r\n                    });\r\n                }\r\n            }\r\n            return items;\r\n        },\r\n point (chart, e, options, useFinalPosition) {\r\n            const position = getRelativePosition(e, chart);\r\n            const axis = options.axis || 'xy';\r\n            const includeInvisible = options.includeInvisible || false;\r\n            return getIntersectItems(chart, position, axis, useFinalPosition, includeInvisible);\r\n        },\r\n nearest (chart, e, options, useFinalPosition) {\r\n            const position = getRelativePosition(e, chart);\r\n            const axis = options.axis || 'xy';\r\n            const includeInvisible = options.includeInvisible || false;\r\n            return getNearestItems(chart, position, axis, options.intersect, useFinalPosition, includeInvisible);\r\n        },\r\n x (chart, e, options, useFinalPosition) {\r\n            const position = getRelativePosition(e, chart);\r\n            return getAxisItems(chart, position, 'x', options.intersect, useFinalPosition);\r\n        },\r\n y (chart, e, options, useFinalPosition) {\r\n            const position = getRelativePosition(e, chart);\r\n            return getAxisItems(chart, position, 'y', options.intersect, useFinalPosition);\r\n        }\r\n    }\r\n};\r\n\r\nconst STATIC_POSITIONS = [\r\n    'left',\r\n    'top',\r\n    'right',\r\n    'bottom'\r\n];\r\nfunction filterByPosition(array, position) {\r\n    return array.filter((v)=>v.pos === position);\r\n}\r\nfunction filterDynamicPositionByAxis(array, axis) {\r\n    return array.filter((v)=>STATIC_POSITIONS.indexOf(v.pos) === -1 && v.box.axis === axis);\r\n}\r\nfunction sortByWeight(array, reverse) {\r\n    return array.sort((a, b)=>{\r\n        const v0 = reverse ? b : a;\r\n        const v1 = reverse ? a : b;\r\n        return v0.weight === v1.weight ? v0.index - v1.index : v0.weight - v1.weight;\r\n    });\r\n}\r\nfunction wrapBoxes(boxes) {\r\n    const layoutBoxes = [];\r\n    let i, ilen, box, pos, stack, stackWeight;\r\n    for(i = 0, ilen = (boxes || []).length; i < ilen; ++i){\r\n        box = boxes[i];\r\n        ({ position: pos , options: { stack , stackWeight =1  }  } = box);\r\n        layoutBoxes.push({\r\n            index: i,\r\n            box,\r\n            pos,\r\n            horizontal: box.isHorizontal(),\r\n            weight: box.weight,\r\n            stack: stack && pos + stack,\r\n            stackWeight\r\n        });\r\n    }\r\n    return layoutBoxes;\r\n}\r\nfunction buildStacks(layouts) {\r\n    const stacks = {};\r\n    for (const wrap of layouts){\r\n        const { stack , pos , stackWeight  } = wrap;\r\n        if (!stack || !STATIC_POSITIONS.includes(pos)) {\r\n            continue;\r\n        }\r\n        const _stack = stacks[stack] || (stacks[stack] = {\r\n            count: 0,\r\n            placed: 0,\r\n            weight: 0,\r\n            size: 0\r\n        });\r\n        _stack.count++;\r\n        _stack.weight += stackWeight;\r\n    }\r\n    return stacks;\r\n}\r\n function setLayoutDims(layouts, params) {\r\n    const stacks = buildStacks(layouts);\r\n    const { vBoxMaxWidth , hBoxMaxHeight  } = params;\r\n    let i, ilen, layout;\r\n    for(i = 0, ilen = layouts.length; i < ilen; ++i){\r\n        layout = layouts[i];\r\n        const { fullSize  } = layout.box;\r\n        const stack = stacks[layout.stack];\r\n        const factor = stack && layout.stackWeight / stack.weight;\r\n        if (layout.horizontal) {\r\n            layout.width = factor ? factor * vBoxMaxWidth : fullSize && params.availableWidth;\r\n            layout.height = hBoxMaxHeight;\r\n        } else {\r\n            layout.width = vBoxMaxWidth;\r\n            layout.height = factor ? factor * hBoxMaxHeight : fullSize && params.availableHeight;\r\n        }\r\n    }\r\n    return stacks;\r\n}\r\nfunction buildLayoutBoxes(boxes) {\r\n    const layoutBoxes = wrapBoxes(boxes);\r\n    const fullSize = sortByWeight(layoutBoxes.filter((wrap)=>wrap.box.fullSize), true);\r\n    const left = sortByWeight(filterByPosition(layoutBoxes, 'left'), true);\r\n    const right = sortByWeight(filterByPosition(layoutBoxes, 'right'));\r\n    const top = sortByWeight(filterByPosition(layoutBoxes, 'top'), true);\r\n    const bottom = sortByWeight(filterByPosition(layoutBoxes, 'bottom'));\r\n    const centerHorizontal = filterDynamicPositionByAxis(layoutBoxes, 'x');\r\n    const centerVertical = filterDynamicPositionByAxis(layoutBoxes, 'y');\r\n    return {\r\n        fullSize,\r\n        leftAndTop: left.concat(top),\r\n        rightAndBottom: right.concat(centerVertical).concat(bottom).concat(centerHorizontal),\r\n        chartArea: filterByPosition(layoutBoxes, 'chartArea'),\r\n        vertical: left.concat(right).concat(centerVertical),\r\n        horizontal: top.concat(bottom).concat(centerHorizontal)\r\n    };\r\n}\r\nfunction getCombinedMax(maxPadding, chartArea, a, b) {\r\n    return Math.max(maxPadding[a], chartArea[a]) + Math.max(maxPadding[b], chartArea[b]);\r\n}\r\nfunction updateMaxPadding(maxPadding, boxPadding) {\r\n    maxPadding.top = Math.max(maxPadding.top, boxPadding.top);\r\n    maxPadding.left = Math.max(maxPadding.left, boxPadding.left);\r\n    maxPadding.bottom = Math.max(maxPadding.bottom, boxPadding.bottom);\r\n    maxPadding.right = Math.max(maxPadding.right, boxPadding.right);\r\n}\r\nfunction updateDims(chartArea, params, layout, stacks) {\r\n    const { pos , box  } = layout;\r\n    const maxPadding = chartArea.maxPadding;\r\n    if (!isObject(pos)) {\r\n        if (layout.size) {\r\n            chartArea[pos] -= layout.size;\r\n        }\r\n        const stack = stacks[layout.stack] || {\r\n            size: 0,\r\n            count: 1\r\n        };\r\n        stack.size = Math.max(stack.size, layout.horizontal ? box.height : box.width);\r\n        layout.size = stack.size / stack.count;\r\n        chartArea[pos] += layout.size;\r\n    }\r\n    if (box.getPadding) {\r\n        updateMaxPadding(maxPadding, box.getPadding());\r\n    }\r\n    const newWidth = Math.max(0, params.outerWidth - getCombinedMax(maxPadding, chartArea, 'left', 'right'));\r\n    const newHeight = Math.max(0, params.outerHeight - getCombinedMax(maxPadding, chartArea, 'top', 'bottom'));\r\n    const widthChanged = newWidth !== chartArea.w;\r\n    const heightChanged = newHeight !== chartArea.h;\r\n    chartArea.w = newWidth;\r\n    chartArea.h = newHeight;\r\n    return layout.horizontal ? {\r\n        same: widthChanged,\r\n        other: heightChanged\r\n    } : {\r\n        same: heightChanged,\r\n        other: widthChanged\r\n    };\r\n}\r\nfunction handleMaxPadding(chartArea) {\r\n    const maxPadding = chartArea.maxPadding;\r\n    function updatePos(pos) {\r\n        const change = Math.max(maxPadding[pos] - chartArea[pos], 0);\r\n        chartArea[pos] += change;\r\n        return change;\r\n    }\r\n    chartArea.y += updatePos('top');\r\n    chartArea.x += updatePos('left');\r\n    updatePos('right');\r\n    updatePos('bottom');\r\n}\r\nfunction getMargins(horizontal, chartArea) {\r\n    const maxPadding = chartArea.maxPadding;\r\n    function marginForPositions(positions) {\r\n        const margin = {\r\n            left: 0,\r\n            top: 0,\r\n            right: 0,\r\n            bottom: 0\r\n        };\r\n        positions.forEach((pos)=>{\r\n            margin[pos] = Math.max(chartArea[pos], maxPadding[pos]);\r\n        });\r\n        return margin;\r\n    }\r\n    return horizontal ? marginForPositions([\r\n        'left',\r\n        'right'\r\n    ]) : marginForPositions([\r\n        'top',\r\n        'bottom'\r\n    ]);\r\n}\r\nfunction fitBoxes(boxes, chartArea, params, stacks) {\r\n    const refitBoxes = [];\r\n    let i, ilen, layout, box, refit, changed;\r\n    for(i = 0, ilen = boxes.length, refit = 0; i < ilen; ++i){\r\n        layout = boxes[i];\r\n        box = layout.box;\r\n        box.update(layout.width || chartArea.w, layout.height || chartArea.h, getMargins(layout.horizontal, chartArea));\r\n        const { same , other  } = updateDims(chartArea, params, layout, stacks);\r\n        refit |= same && refitBoxes.length;\r\n        changed = changed || other;\r\n        if (!box.fullSize) {\r\n            refitBoxes.push(layout);\r\n        }\r\n    }\r\n    return refit && fitBoxes(refitBoxes, chartArea, params, stacks) || changed;\r\n}\r\nfunction setBoxDims(box, left, top, width, height) {\r\n    box.top = top;\r\n    box.left = left;\r\n    box.right = left + width;\r\n    box.bottom = top + height;\r\n    box.width = width;\r\n    box.height = height;\r\n}\r\nfunction placeBoxes(boxes, chartArea, params, stacks) {\r\n    const userPadding = params.padding;\r\n    let { x , y  } = chartArea;\r\n    for (const layout of boxes){\r\n        const box = layout.box;\r\n        const stack = stacks[layout.stack] || {\r\n            count: 1,\r\n            placed: 0,\r\n            weight: 1\r\n        };\r\n        const weight = layout.stackWeight / stack.weight || 1;\r\n        if (layout.horizontal) {\r\n            const width = chartArea.w * weight;\r\n            const height = stack.size || box.height;\r\n            if (defined(stack.start)) {\r\n                y = stack.start;\r\n            }\r\n            if (box.fullSize) {\r\n                setBoxDims(box, userPadding.left, y, params.outerWidth - userPadding.right - userPadding.left, height);\r\n            } else {\r\n                setBoxDims(box, chartArea.left + stack.placed, y, width, height);\r\n            }\r\n            stack.start = y;\r\n            stack.placed += width;\r\n            y = box.bottom;\r\n        } else {\r\n            const height = chartArea.h * weight;\r\n            const width = stack.size || box.width;\r\n            if (defined(stack.start)) {\r\n                x = stack.start;\r\n            }\r\n            if (box.fullSize) {\r\n                setBoxDims(box, x, userPadding.top, width, params.outerHeight - userPadding.bottom - userPadding.top);\r\n            } else {\r\n                setBoxDims(box, x, chartArea.top + stack.placed, width, height);\r\n            }\r\n            stack.start = x;\r\n            stack.placed += height;\r\n            x = box.right;\r\n        }\r\n    }\r\n    chartArea.x = x;\r\n    chartArea.y = y;\r\n}\r\nvar layouts = {\r\n addBox (chart, item) {\r\n        if (!chart.boxes) {\r\n            chart.boxes = [];\r\n        }\r\n        item.fullSize = item.fullSize || false;\r\n        item.position = item.position || 'top';\r\n        item.weight = item.weight || 0;\r\n        item._layers = item._layers || function() {\r\n            return [\r\n                {\r\n                    z: 0,\r\n                    draw (chartArea) {\r\n                        item.draw(chartArea);\r\n                    }\r\n                }\r\n            ];\r\n        };\r\n        chart.boxes.push(item);\r\n    },\r\n removeBox (chart, layoutItem) {\r\n        const index = chart.boxes ? chart.boxes.indexOf(layoutItem) : -1;\r\n        if (index !== -1) {\r\n            chart.boxes.splice(index, 1);\r\n        }\r\n    },\r\n configure (chart, item, options) {\r\n        item.fullSize = options.fullSize;\r\n        item.position = options.position;\r\n        item.weight = options.weight;\r\n    },\r\n update (chart, width, height, minPadding) {\r\n        if (!chart) {\r\n            return;\r\n        }\r\n        const padding = toPadding(chart.options.layout.padding);\r\n        const availableWidth = Math.max(width - padding.width, 0);\r\n        const availableHeight = Math.max(height - padding.height, 0);\r\n        const boxes = buildLayoutBoxes(chart.boxes);\r\n        const verticalBoxes = boxes.vertical;\r\n        const horizontalBoxes = boxes.horizontal;\r\n        each(chart.boxes, (box)=>{\r\n            if (typeof box.beforeLayout === 'function') {\r\n                box.beforeLayout();\r\n            }\r\n        });\r\n        const visibleVerticalBoxCount = verticalBoxes.reduce((total, wrap)=>wrap.box.options && wrap.box.options.display === false ? total : total + 1, 0) || 1;\r\n        const params = Object.freeze({\r\n            outerWidth: width,\r\n            outerHeight: height,\r\n            padding,\r\n            availableWidth,\r\n            availableHeight,\r\n            vBoxMaxWidth: availableWidth / 2 / visibleVerticalBoxCount,\r\n            hBoxMaxHeight: availableHeight / 2\r\n        });\r\n        const maxPadding = Object.assign({}, padding);\r\n        updateMaxPadding(maxPadding, toPadding(minPadding));\r\n        const chartArea = Object.assign({\r\n            maxPadding,\r\n            w: availableWidth,\r\n            h: availableHeight,\r\n            x: padding.left,\r\n            y: padding.top\r\n        }, padding);\r\n        const stacks = setLayoutDims(verticalBoxes.concat(horizontalBoxes), params);\r\n        fitBoxes(boxes.fullSize, chartArea, params, stacks);\r\n        fitBoxes(verticalBoxes, chartArea, params, stacks);\r\n        if (fitBoxes(horizontalBoxes, chartArea, params, stacks)) {\r\n            fitBoxes(verticalBoxes, chartArea, params, stacks);\r\n        }\r\n        handleMaxPadding(chartArea);\r\n        placeBoxes(boxes.leftAndTop, chartArea, params, stacks);\r\n        chartArea.x += chartArea.w;\r\n        chartArea.y += chartArea.h;\r\n        placeBoxes(boxes.rightAndBottom, chartArea, params, stacks);\r\n        chart.chartArea = {\r\n            left: chartArea.left,\r\n            top: chartArea.top,\r\n            right: chartArea.left + chartArea.w,\r\n            bottom: chartArea.top + chartArea.h,\r\n            height: chartArea.h,\r\n            width: chartArea.w\r\n        };\r\n        each(boxes.chartArea, (layout)=>{\r\n            const box = layout.box;\r\n            Object.assign(box, chart.chartArea);\r\n            box.update(chartArea.w, chartArea.h, {\r\n                left: 0,\r\n                top: 0,\r\n                right: 0,\r\n                bottom: 0\r\n            });\r\n        });\r\n    }\r\n};\r\n\r\nclass BasePlatform {\r\n acquireContext(canvas, aspectRatio) {}\r\n releaseContext(context) {\r\n        return false;\r\n    }\r\n addEventListener(chart, type, listener) {}\r\n removeEventListener(chart, type, listener) {}\r\n getDevicePixelRatio() {\r\n        return 1;\r\n    }\r\n getMaximumSize(element, width, height, aspectRatio) {\r\n        width = Math.max(0, width || element.width);\r\n        height = height || element.height;\r\n        return {\r\n            width,\r\n            height: Math.max(0, aspectRatio ? Math.floor(width / aspectRatio) : height)\r\n        };\r\n    }\r\n isAttached(canvas) {\r\n        return true;\r\n    }\r\n updateConfig(config) {\r\n    }\r\n}\r\n\r\nclass BasicPlatform extends BasePlatform {\r\n    acquireContext(item) {\r\n        return item && item.getContext && item.getContext('2d') || null;\r\n    }\r\n    updateConfig(config) {\r\n        config.options.animation = false;\r\n    }\r\n}\r\n\r\nconst EXPANDO_KEY = '$chartjs';\r\n const EVENT_TYPES = {\r\n    touchstart: 'mousedown',\r\n    touchmove: 'mousemove',\r\n    touchend: 'mouseup',\r\n    pointerenter: 'mouseenter',\r\n    pointerdown: 'mousedown',\r\n    pointermove: 'mousemove',\r\n    pointerup: 'mouseup',\r\n    pointerleave: 'mouseout',\r\n    pointerout: 'mouseout'\r\n};\r\nconst isNullOrEmpty = (value)=>value === null || value === '';\r\n function initCanvas(canvas, aspectRatio) {\r\n    const style = canvas.style;\r\n    const renderHeight = canvas.getAttribute('height');\r\n    const renderWidth = canvas.getAttribute('width');\r\n    canvas[EXPANDO_KEY] = {\r\n        initial: {\r\n            height: renderHeight,\r\n            width: renderWidth,\r\n            style: {\r\n                display: style.display,\r\n                height: style.height,\r\n                width: style.width\r\n            }\r\n        }\r\n    };\r\n    style.display = style.display || 'block';\r\n    style.boxSizing = style.boxSizing || 'border-box';\r\n    if (isNullOrEmpty(renderWidth)) {\r\n        const displayWidth = readUsedSize(canvas, 'width');\r\n        if (displayWidth !== undefined) {\r\n            canvas.width = displayWidth;\r\n        }\r\n    }\r\n    if (isNullOrEmpty(renderHeight)) {\r\n        if (canvas.style.height === '') {\r\n            canvas.height = canvas.width / (aspectRatio || 2);\r\n        } else {\r\n            const displayHeight = readUsedSize(canvas, 'height');\r\n            if (displayHeight !== undefined) {\r\n                canvas.height = displayHeight;\r\n            }\r\n        }\r\n    }\r\n    return canvas;\r\n}\r\nconst eventListenerOptions = supportsEventListenerOptions ? {\r\n    passive: true\r\n} : false;\r\nfunction addListener(node, type, listener) {\r\n    if (node) {\r\n        node.addEventListener(type, listener, eventListenerOptions);\r\n    }\r\n}\r\nfunction removeListener(chart, type, listener) {\r\n    if (chart && chart.canvas) {\r\n        chart.canvas.removeEventListener(type, listener, eventListenerOptions);\r\n    }\r\n}\r\nfunction fromNativeEvent(event, chart) {\r\n    const type = EVENT_TYPES[event.type] || event.type;\r\n    const { x , y  } = getRelativePosition(event, chart);\r\n    return {\r\n        type,\r\n        chart,\r\n        native: event,\r\n        x: x !== undefined ? x : null,\r\n        y: y !== undefined ? y : null\r\n    };\r\n}\r\nfunction nodeListContains(nodeList, canvas) {\r\n    for (const node of nodeList){\r\n        if (node === canvas || node.contains(canvas)) {\r\n            return true;\r\n        }\r\n    }\r\n}\r\nfunction createAttachObserver(chart, type, listener) {\r\n    const canvas = chart.canvas;\r\n    const observer = new MutationObserver((entries)=>{\r\n        let trigger = false;\r\n        for (const entry of entries){\r\n            trigger = trigger || nodeListContains(entry.addedNodes, canvas);\r\n            trigger = trigger && !nodeListContains(entry.removedNodes, canvas);\r\n        }\r\n        if (trigger) {\r\n            listener();\r\n        }\r\n    });\r\n    observer.observe(document, {\r\n        childList: true,\r\n        subtree: true\r\n    });\r\n    return observer;\r\n}\r\nfunction createDetachObserver(chart, type, listener) {\r\n    const canvas = chart.canvas;\r\n    const observer = new MutationObserver((entries)=>{\r\n        let trigger = false;\r\n        for (const entry of entries){\r\n            trigger = trigger || nodeListContains(entry.removedNodes, canvas);\r\n            trigger = trigger && !nodeListContains(entry.addedNodes, canvas);\r\n        }\r\n        if (trigger) {\r\n            listener();\r\n        }\r\n    });\r\n    observer.observe(document, {\r\n        childList: true,\r\n        subtree: true\r\n    });\r\n    return observer;\r\n}\r\nconst drpListeningCharts = new Map();\r\nlet oldDevicePixelRatio = 0;\r\nfunction onWindowResize() {\r\n    const dpr = window.devicePixelRatio;\r\n    if (dpr === oldDevicePixelRatio) {\r\n        return;\r\n    }\r\n    oldDevicePixelRatio = dpr;\r\n    drpListeningCharts.forEach((resize, chart)=>{\r\n        if (chart.currentDevicePixelRatio !== dpr) {\r\n            resize();\r\n        }\r\n    });\r\n}\r\nfunction listenDevicePixelRatioChanges(chart, resize) {\r\n    if (!drpListeningCharts.size) {\r\n        window.addEventListener('resize', onWindowResize);\r\n    }\r\n    drpListeningCharts.set(chart, resize);\r\n}\r\nfunction unlistenDevicePixelRatioChanges(chart) {\r\n    drpListeningCharts.delete(chart);\r\n    if (!drpListeningCharts.size) {\r\n        window.removeEventListener('resize', onWindowResize);\r\n    }\r\n}\r\nfunction createResizeObserver(chart, type, listener) {\r\n    const canvas = chart.canvas;\r\n    const container = canvas && _getParentNode(canvas);\r\n    if (!container) {\r\n        return;\r\n    }\r\n    const resize = throttled((width, height)=>{\r\n        const w = container.clientWidth;\r\n        listener(width, height);\r\n        if (w < container.clientWidth) {\r\n            listener();\r\n        }\r\n    }, window);\r\n    const observer = new ResizeObserver((entries)=>{\r\n        const entry = entries[0];\r\n        const width = entry.contentRect.width;\r\n        const height = entry.contentRect.height;\r\n        if (width === 0 && height === 0) {\r\n            return;\r\n        }\r\n        resize(width, height);\r\n    });\r\n    observer.observe(container);\r\n    listenDevicePixelRatioChanges(chart, resize);\r\n    return observer;\r\n}\r\nfunction releaseObserver(chart, type, observer) {\r\n    if (observer) {\r\n        observer.disconnect();\r\n    }\r\n    if (type === 'resize') {\r\n        unlistenDevicePixelRatioChanges(chart);\r\n    }\r\n}\r\nfunction createProxyAndListen(chart, type, listener) {\r\n    const canvas = chart.canvas;\r\n    const proxy = throttled((event)=>{\r\n        if (chart.ctx !== null) {\r\n            listener(fromNativeEvent(event, chart));\r\n        }\r\n    }, chart);\r\n    addListener(canvas, type, proxy);\r\n    return proxy;\r\n}\r\n class DomPlatform extends BasePlatform {\r\n acquireContext(canvas, aspectRatio) {\r\n        const context = canvas && canvas.getContext && canvas.getContext('2d');\r\n        if (context && context.canvas === canvas) {\r\n            initCanvas(canvas, aspectRatio);\r\n            return context;\r\n        }\r\n        return null;\r\n    }\r\n releaseContext(context) {\r\n        const canvas = context.canvas;\r\n        if (!canvas[EXPANDO_KEY]) {\r\n            return false;\r\n        }\r\n        const initial = canvas[EXPANDO_KEY].initial;\r\n        [\r\n            'height',\r\n            'width'\r\n        ].forEach((prop)=>{\r\n            const value = initial[prop];\r\n            if (isNullOrUndef(value)) {\r\n                canvas.removeAttribute(prop);\r\n            } else {\r\n                canvas.setAttribute(prop, value);\r\n            }\r\n        });\r\n        const style = initial.style || {};\r\n        Object.keys(style).forEach((key)=>{\r\n            canvas.style[key] = style[key];\r\n        });\r\n        canvas.width = canvas.width;\r\n        delete canvas[EXPANDO_KEY];\r\n        return true;\r\n    }\r\n addEventListener(chart, type, listener) {\r\n        this.removeEventListener(chart, type);\r\n        const proxies = chart.$proxies || (chart.$proxies = {});\r\n        const handlers = {\r\n            attach: createAttachObserver,\r\n            detach: createDetachObserver,\r\n            resize: createResizeObserver\r\n        };\r\n        const handler = handlers[type] || createProxyAndListen;\r\n        proxies[type] = handler(chart, type, listener);\r\n    }\r\n removeEventListener(chart, type) {\r\n        const proxies = chart.$proxies || (chart.$proxies = {});\r\n        const proxy = proxies[type];\r\n        if (!proxy) {\r\n            return;\r\n        }\r\n        const handlers = {\r\n            attach: releaseObserver,\r\n            detach: releaseObserver,\r\n            resize: releaseObserver\r\n        };\r\n        const handler = handlers[type] || removeListener;\r\n        handler(chart, type, proxy);\r\n        proxies[type] = undefined;\r\n    }\r\n    getDevicePixelRatio() {\r\n        return window.devicePixelRatio;\r\n    }\r\n getMaximumSize(canvas, width, height, aspectRatio) {\r\n        return getMaximumSize(canvas, width, height, aspectRatio);\r\n    }\r\n isAttached(canvas) {\r\n        const container = canvas && _getParentNode(canvas);\r\n        return !!(container && container.isConnected);\r\n    }\r\n}\r\n\r\nfunction _detectPlatform(canvas) {\r\n    if (!_isDomSupported() || typeof OffscreenCanvas !== 'undefined' && canvas instanceof OffscreenCanvas) {\r\n        return BasicPlatform;\r\n    }\r\n    return DomPlatform;\r\n}\r\n\r\nclass Element {\r\n    static defaults = {};\r\n    static defaultRoutes = undefined;\r\n    x;\r\n    y;\r\n    active = false;\r\n    options;\r\n    $animations;\r\n    tooltipPosition(useFinalPosition) {\r\n        const { x , y  } = this.getProps([\r\n            'x',\r\n            'y'\r\n        ], useFinalPosition);\r\n        return {\r\n            x,\r\n            y\r\n        };\r\n    }\r\n    hasValue() {\r\n        return isNumber(this.x) && isNumber(this.y);\r\n    }\r\n    getProps(props, final) {\r\n        const anims = this.$animations;\r\n        if (!final || !anims) {\r\n            // let's not create an object, if not needed\r\n            return this;\r\n        }\r\n        const ret = {};\r\n        props.forEach((prop)=>{\r\n            ret[prop] = anims[prop] && anims[prop].active() ? anims[prop]._to : this[prop];\r\n        });\r\n        return ret;\r\n    }\r\n}\r\n\r\nfunction autoSkip(scale, ticks) {\r\n    const tickOpts = scale.options.ticks;\r\n    const determinedMaxTicks = determineMaxTicks(scale);\r\n    const ticksLimit = Math.min(tickOpts.maxTicksLimit || determinedMaxTicks, determinedMaxTicks);\r\n    const majorIndices = tickOpts.major.enabled ? getMajorIndices(ticks) : [];\r\n    const numMajorIndices = majorIndices.length;\r\n    const first = majorIndices[0];\r\n    const last = majorIndices[numMajorIndices - 1];\r\n    const newTicks = [];\r\n    if (numMajorIndices > ticksLimit) {\r\n        skipMajors(ticks, newTicks, majorIndices, numMajorIndices / ticksLimit);\r\n        return newTicks;\r\n    }\r\n    const spacing = calculateSpacing(majorIndices, ticks, ticksLimit);\r\n    if (numMajorIndices > 0) {\r\n        let i, ilen;\r\n        const avgMajorSpacing = numMajorIndices > 1 ? Math.round((last - first) / (numMajorIndices - 1)) : null;\r\n        skip(ticks, newTicks, spacing, isNullOrUndef(avgMajorSpacing) ? 0 : first - avgMajorSpacing, first);\r\n        for(i = 0, ilen = numMajorIndices - 1; i < ilen; i++){\r\n            skip(ticks, newTicks, spacing, majorIndices[i], majorIndices[i + 1]);\r\n        }\r\n        skip(ticks, newTicks, spacing, last, isNullOrUndef(avgMajorSpacing) ? ticks.length : last + avgMajorSpacing);\r\n        return newTicks;\r\n    }\r\n    skip(ticks, newTicks, spacing);\r\n    return newTicks;\r\n}\r\nfunction determineMaxTicks(scale) {\r\n    const offset = scale.options.offset;\r\n    const tickLength = scale._tickSize();\r\n    const maxScale = scale._length / tickLength + (offset ? 0 : 1);\r\n    const maxChart = scale._maxLength / tickLength;\r\n    return Math.floor(Math.min(maxScale, maxChart));\r\n}\r\n function calculateSpacing(majorIndices, ticks, ticksLimit) {\r\n    const evenMajorSpacing = getEvenSpacing(majorIndices);\r\n    const spacing = ticks.length / ticksLimit;\r\n    if (!evenMajorSpacing) {\r\n        return Math.max(spacing, 1);\r\n    }\r\n    const factors = _factorize(evenMajorSpacing);\r\n    for(let i = 0, ilen = factors.length - 1; i < ilen; i++){\r\n        const factor = factors[i];\r\n        if (factor > spacing) {\r\n            return factor;\r\n        }\r\n    }\r\n    return Math.max(spacing, 1);\r\n}\r\n function getMajorIndices(ticks) {\r\n    const result = [];\r\n    let i, ilen;\r\n    for(i = 0, ilen = ticks.length; i < ilen; i++){\r\n        if (ticks[i].major) {\r\n            result.push(i);\r\n        }\r\n    }\r\n    return result;\r\n}\r\n function skipMajors(ticks, newTicks, majorIndices, spacing) {\r\n    let count = 0;\r\n    let next = majorIndices[0];\r\n    let i;\r\n    spacing = Math.ceil(spacing);\r\n    for(i = 0; i < ticks.length; i++){\r\n        if (i === next) {\r\n            newTicks.push(ticks[i]);\r\n            count++;\r\n            next = majorIndices[count * spacing];\r\n        }\r\n    }\r\n}\r\n function skip(ticks, newTicks, spacing, majorStart, majorEnd) {\r\n    const start = valueOrDefault(majorStart, 0);\r\n    const end = Math.min(valueOrDefault(majorEnd, ticks.length), ticks.length);\r\n    let count = 0;\r\n    let length, i, next;\r\n    spacing = Math.ceil(spacing);\r\n    if (majorEnd) {\r\n        length = majorEnd - majorStart;\r\n        spacing = length / Math.floor(length / spacing);\r\n    }\r\n    next = start;\r\n    while(next < 0){\r\n        count++;\r\n        next = Math.round(start + count * spacing);\r\n    }\r\n    for(i = Math.max(start, 0); i < end; i++){\r\n        if (i === next) {\r\n            newTicks.push(ticks[i]);\r\n            count++;\r\n            next = Math.round(start + count * spacing);\r\n        }\r\n    }\r\n}\r\n function getEvenSpacing(arr) {\r\n    const len = arr.length;\r\n    let i, diff;\r\n    if (len < 2) {\r\n        return false;\r\n    }\r\n    for(diff = arr[0], i = 1; i < len; ++i){\r\n        if (arr[i] - arr[i - 1] !== diff) {\r\n            return false;\r\n        }\r\n    }\r\n    return diff;\r\n}\r\n\r\nconst reverseAlign = (align)=>align === 'left' ? 'right' : align === 'right' ? 'left' : align;\r\nconst offsetFromEdge = (scale, edge, offset)=>edge === 'top' || edge === 'left' ? scale[edge] + offset : scale[edge] - offset;\r\nconst getTicksLimit = (ticksLength, maxTicksLimit)=>Math.min(maxTicksLimit || ticksLength, ticksLength);\r\n function sample(arr, numItems) {\r\n    const result = [];\r\n    const increment = arr.length / numItems;\r\n    const len = arr.length;\r\n    let i = 0;\r\n    for(; i < len; i += increment){\r\n        result.push(arr[Math.floor(i)]);\r\n    }\r\n    return result;\r\n}\r\n function getPixelForGridLine(scale, index, offsetGridLines) {\r\n    const length = scale.ticks.length;\r\n    const validIndex = Math.min(index, length - 1);\r\n    const start = scale._startPixel;\r\n    const end = scale._endPixel;\r\n    const epsilon = 1e-6;\r\n    let lineValue = scale.getPixelForTick(validIndex);\r\n    let offset;\r\n    if (offsetGridLines) {\r\n        if (length === 1) {\r\n            offset = Math.max(lineValue - start, end - lineValue);\r\n        } else if (index === 0) {\r\n            offset = (scale.getPixelForTick(1) - lineValue) / 2;\r\n        } else {\r\n            offset = (lineValue - scale.getPixelForTick(validIndex - 1)) / 2;\r\n        }\r\n        lineValue += validIndex < index ? offset : -offset;\r\n        if (lineValue < start - epsilon || lineValue > end + epsilon) {\r\n            return;\r\n        }\r\n    }\r\n    return lineValue;\r\n}\r\n function garbageCollect(caches, length) {\r\n    each(caches, (cache)=>{\r\n        const gc = cache.gc;\r\n        const gcLen = gc.length / 2;\r\n        let i;\r\n        if (gcLen > length) {\r\n            for(i = 0; i < gcLen; ++i){\r\n                delete cache.data[gc[i]];\r\n            }\r\n            gc.splice(0, gcLen);\r\n        }\r\n    });\r\n}\r\n function getTickMarkLength(options) {\r\n    return options.drawTicks ? options.tickLength : 0;\r\n}\r\n function getTitleHeight(options, fallback) {\r\n    if (!options.display) {\r\n        return 0;\r\n    }\r\n    const font = toFont(options.font, fallback);\r\n    const padding = toPadding(options.padding);\r\n    const lines = isArray(options.text) ? options.text.length : 1;\r\n    return lines * font.lineHeight + padding.height;\r\n}\r\nfunction createScaleContext(parent, scale) {\r\n    return createContext(parent, {\r\n        scale,\r\n        type: 'scale'\r\n    });\r\n}\r\nfunction createTickContext(parent, index, tick) {\r\n    return createContext(parent, {\r\n        tick,\r\n        index,\r\n        type: 'tick'\r\n    });\r\n}\r\nfunction titleAlign(align, position, reverse) {\r\n     let ret = _toLeftRightCenter(align);\r\n    if (reverse && position !== 'right' || !reverse && position === 'right') {\r\n        ret = reverseAlign(ret);\r\n    }\r\n    return ret;\r\n}\r\nfunction titleArgs(scale, offset, position, align) {\r\n    const { top , left , bottom , right , chart  } = scale;\r\n    const { chartArea , scales  } = chart;\r\n    let rotation = 0;\r\n    let maxWidth, titleX, titleY;\r\n    const height = bottom - top;\r\n    const width = right - left;\r\n    if (scale.isHorizontal()) {\r\n        titleX = _alignStartEnd(align, left, right);\r\n        if (isObject(position)) {\r\n            const positionAxisID = Object.keys(position)[0];\r\n            const value = position[positionAxisID];\r\n            titleY = scales[positionAxisID].getPixelForValue(value) + height - offset;\r\n        } else if (position === 'center') {\r\n            titleY = (chartArea.bottom + chartArea.top) / 2 + height - offset;\r\n        } else {\r\n            titleY = offsetFromEdge(scale, position, offset);\r\n        }\r\n        maxWidth = right - left;\r\n    } else {\r\n        if (isObject(position)) {\r\n            const positionAxisID = Object.keys(position)[0];\r\n            const value = position[positionAxisID];\r\n            titleX = scales[positionAxisID].getPixelForValue(value) - width + offset;\r\n        } else if (position === 'center') {\r\n            titleX = (chartArea.left + chartArea.right) / 2 - width + offset;\r\n        } else {\r\n            titleX = offsetFromEdge(scale, position, offset);\r\n        }\r\n        titleY = _alignStartEnd(align, bottom, top);\r\n        rotation = position === 'left' ? -HALF_PI : HALF_PI;\r\n    }\r\n    return {\r\n        titleX,\r\n        titleY,\r\n        maxWidth,\r\n        rotation\r\n    };\r\n}\r\nclass Scale extends Element {\r\n    constructor(cfg){\r\n        super();\r\n         this.id = cfg.id;\r\n         this.type = cfg.type;\r\n         this.options = undefined;\r\n         this.ctx = cfg.ctx;\r\n         this.chart = cfg.chart;\r\n         this.top = undefined;\r\n         this.bottom = undefined;\r\n         this.left = undefined;\r\n         this.right = undefined;\r\n         this.width = undefined;\r\n         this.height = undefined;\r\n        this._margins = {\r\n            left: 0,\r\n            right: 0,\r\n            top: 0,\r\n            bottom: 0\r\n        };\r\n         this.maxWidth = undefined;\r\n         this.maxHeight = undefined;\r\n         this.paddingTop = undefined;\r\n         this.paddingBottom = undefined;\r\n         this.paddingLeft = undefined;\r\n         this.paddingRight = undefined;\r\n         this.axis = undefined;\r\n         this.labelRotation = undefined;\r\n        this.min = undefined;\r\n        this.max = undefined;\r\n        this._range = undefined;\r\n         this.ticks = [];\r\n         this._gridLineItems = null;\r\n         this._labelItems = null;\r\n         this._labelSizes = null;\r\n        this._length = 0;\r\n        this._maxLength = 0;\r\n        this._longestTextCache = {};\r\n         this._startPixel = undefined;\r\n         this._endPixel = undefined;\r\n        this._reversePixels = false;\r\n        this._userMax = undefined;\r\n        this._userMin = undefined;\r\n        this._suggestedMax = undefined;\r\n        this._suggestedMin = undefined;\r\n        this._ticksLength = 0;\r\n        this._borderValue = 0;\r\n        this._cache = {};\r\n        this._dataLimitsCached = false;\r\n        this.$context = undefined;\r\n    }\r\n init(options) {\r\n        this.options = options.setContext(this.getContext());\r\n        this.axis = options.axis;\r\n        this._userMin = this.parse(options.min);\r\n        this._userMax = this.parse(options.max);\r\n        this._suggestedMin = this.parse(options.suggestedMin);\r\n        this._suggestedMax = this.parse(options.suggestedMax);\r\n    }\r\n parse(raw, index) {\r\n        return raw;\r\n    }\r\n getUserBounds() {\r\n        let { _userMin , _userMax , _suggestedMin , _suggestedMax  } = this;\r\n        _userMin = finiteOrDefault(_userMin, Number.POSITIVE_INFINITY);\r\n        _userMax = finiteOrDefault(_userMax, Number.NEGATIVE_INFINITY);\r\n        _suggestedMin = finiteOrDefault(_suggestedMin, Number.POSITIVE_INFINITY);\r\n        _suggestedMax = finiteOrDefault(_suggestedMax, Number.NEGATIVE_INFINITY);\r\n        return {\r\n            min: finiteOrDefault(_userMin, _suggestedMin),\r\n            max: finiteOrDefault(_userMax, _suggestedMax),\r\n            minDefined: isNumberFinite(_userMin),\r\n            maxDefined: isNumberFinite(_userMax)\r\n        };\r\n    }\r\n getMinMax(canStack) {\r\n        let { min , max , minDefined , maxDefined  } = this.getUserBounds();\r\n        let range;\r\n        if (minDefined && maxDefined) {\r\n            return {\r\n                min,\r\n                max\r\n            };\r\n        }\r\n        const metas = this.getMatchingVisibleMetas();\r\n        for(let i = 0, ilen = metas.length; i < ilen; ++i){\r\n            range = metas[i].controller.getMinMax(this, canStack);\r\n            if (!minDefined) {\r\n                min = Math.min(min, range.min);\r\n            }\r\n            if (!maxDefined) {\r\n                max = Math.max(max, range.max);\r\n            }\r\n        }\r\n        min = maxDefined && min > max ? max : min;\r\n        max = minDefined && min > max ? min : max;\r\n        return {\r\n            min: finiteOrDefault(min, finiteOrDefault(max, min)),\r\n            max: finiteOrDefault(max, finiteOrDefault(min, max))\r\n        };\r\n    }\r\n getPadding() {\r\n        return {\r\n            left: this.paddingLeft || 0,\r\n            top: this.paddingTop || 0,\r\n            right: this.paddingRight || 0,\r\n            bottom: this.paddingBottom || 0\r\n        };\r\n    }\r\n getTicks() {\r\n        return this.ticks;\r\n    }\r\n getLabels() {\r\n        const data = this.chart.data;\r\n        return this.options.labels || (this.isHorizontal() ? data.xLabels : data.yLabels) || data.labels || [];\r\n    }\r\n getLabelItems(chartArea = this.chart.chartArea) {\r\n        const items = this._labelItems || (this._labelItems = this._computeLabelItems(chartArea));\r\n        return items;\r\n    }\r\n    beforeLayout() {\r\n        this._cache = {};\r\n        this._dataLimitsCached = false;\r\n    }\r\n    beforeUpdate() {\r\n        callback(this.options.beforeUpdate, [\r\n            this\r\n        ]);\r\n    }\r\n update(maxWidth, maxHeight, margins) {\r\n        const { beginAtZero , grace , ticks: tickOpts  } = this.options;\r\n        const sampleSize = tickOpts.sampleSize;\r\n        this.beforeUpdate();\r\n        this.maxWidth = maxWidth;\r\n        this.maxHeight = maxHeight;\r\n        this._margins = margins = Object.assign({\r\n            left: 0,\r\n            right: 0,\r\n            top: 0,\r\n            bottom: 0\r\n        }, margins);\r\n        this.ticks = null;\r\n        this._labelSizes = null;\r\n        this._gridLineItems = null;\r\n        this._labelItems = null;\r\n        this.beforeSetDimensions();\r\n        this.setDimensions();\r\n        this.afterSetDimensions();\r\n        this._maxLength = this.isHorizontal() ? this.width + margins.left + margins.right : this.height + margins.top + margins.bottom;\r\n        if (!this._dataLimitsCached) {\r\n            this.beforeDataLimits();\r\n            this.determineDataLimits();\r\n            this.afterDataLimits();\r\n            this._range = _addGrace(this, grace, beginAtZero);\r\n            this._dataLimitsCached = true;\r\n        }\r\n        this.beforeBuildTicks();\r\n        this.ticks = this.buildTicks() || [];\r\n        this.afterBuildTicks();\r\n        const samplingEnabled = sampleSize < this.ticks.length;\r\n        this._convertTicksToLabels(samplingEnabled ? sample(this.ticks, sampleSize) : this.ticks);\r\n        this.configure();\r\n        this.beforeCalculateLabelRotation();\r\n        this.calculateLabelRotation();\r\n        this.afterCalculateLabelRotation();\r\n        if (tickOpts.display && (tickOpts.autoSkip || tickOpts.source === 'auto')) {\r\n            this.ticks = autoSkip(this, this.ticks);\r\n            this._labelSizes = null;\r\n            this.afterAutoSkip();\r\n        }\r\n        if (samplingEnabled) {\r\n            this._convertTicksToLabels(this.ticks);\r\n        }\r\n        this.beforeFit();\r\n        this.fit();\r\n        this.afterFit();\r\n        this.afterUpdate();\r\n    }\r\n configure() {\r\n        let reversePixels = this.options.reverse;\r\n        let startPixel, endPixel;\r\n        if (this.isHorizontal()) {\r\n            startPixel = this.left;\r\n            endPixel = this.right;\r\n        } else {\r\n            startPixel = this.top;\r\n            endPixel = this.bottom;\r\n            reversePixels = !reversePixels;\r\n        }\r\n        this._startPixel = startPixel;\r\n        this._endPixel = endPixel;\r\n        this._reversePixels = reversePixels;\r\n        this._length = endPixel - startPixel;\r\n        this._alignToPixels = this.options.alignToPixels;\r\n    }\r\n    afterUpdate() {\r\n        callback(this.options.afterUpdate, [\r\n            this\r\n        ]);\r\n    }\r\n    beforeSetDimensions() {\r\n        callback(this.options.beforeSetDimensions, [\r\n            this\r\n        ]);\r\n    }\r\n    setDimensions() {\r\n        if (this.isHorizontal()) {\r\n            this.width = this.maxWidth;\r\n            this.left = 0;\r\n            this.right = this.width;\r\n        } else {\r\n            this.height = this.maxHeight;\r\n            this.top = 0;\r\n            this.bottom = this.height;\r\n        }\r\n        this.paddingLeft = 0;\r\n        this.paddingTop = 0;\r\n        this.paddingRight = 0;\r\n        this.paddingBottom = 0;\r\n    }\r\n    afterSetDimensions() {\r\n        callback(this.options.afterSetDimensions, [\r\n            this\r\n        ]);\r\n    }\r\n    _callHooks(name) {\r\n        this.chart.notifyPlugins(name, this.getContext());\r\n        callback(this.options[name], [\r\n            this\r\n        ]);\r\n    }\r\n    beforeDataLimits() {\r\n        this._callHooks('beforeDataLimits');\r\n    }\r\n    determineDataLimits() {}\r\n    afterDataLimits() {\r\n        this._callHooks('afterDataLimits');\r\n    }\r\n    beforeBuildTicks() {\r\n        this._callHooks('beforeBuildTicks');\r\n    }\r\n buildTicks() {\r\n        return [];\r\n    }\r\n    afterBuildTicks() {\r\n        this._callHooks('afterBuildTicks');\r\n    }\r\n    beforeTickToLabelConversion() {\r\n        callback(this.options.beforeTickToLabelConversion, [\r\n            this\r\n        ]);\r\n    }\r\n generateTickLabels(ticks) {\r\n        const tickOpts = this.options.ticks;\r\n        let i, ilen, tick;\r\n        for(i = 0, ilen = ticks.length; i < ilen; i++){\r\n            tick = ticks[i];\r\n            tick.label = callback(tickOpts.callback, [\r\n                tick.value,\r\n                i,\r\n                ticks\r\n            ], this);\r\n        }\r\n    }\r\n    afterTickToLabelConversion() {\r\n        callback(this.options.afterTickToLabelConversion, [\r\n            this\r\n        ]);\r\n    }\r\n    beforeCalculateLabelRotation() {\r\n        callback(this.options.beforeCalculateLabelRotation, [\r\n            this\r\n        ]);\r\n    }\r\n    calculateLabelRotation() {\r\n        const options = this.options;\r\n        const tickOpts = options.ticks;\r\n        const numTicks = getTicksLimit(this.ticks.length, options.ticks.maxTicksLimit);\r\n        const minRotation = tickOpts.minRotation || 0;\r\n        const maxRotation = tickOpts.maxRotation;\r\n        let labelRotation = minRotation;\r\n        let tickWidth, maxHeight, maxLabelDiagonal;\r\n        if (!this._isVisible() || !tickOpts.display || minRotation >= maxRotation || numTicks <= 1 || !this.isHorizontal()) {\r\n            this.labelRotation = minRotation;\r\n            return;\r\n        }\r\n        const labelSizes = this._getLabelSizes();\r\n        const maxLabelWidth = labelSizes.widest.width;\r\n        const maxLabelHeight = labelSizes.highest.height;\r\n        const maxWidth = _limitValue(this.chart.width - maxLabelWidth, 0, this.maxWidth);\r\n        tickWidth = options.offset ? this.maxWidth / numTicks : maxWidth / (numTicks - 1);\r\n        if (maxLabelWidth + 6 > tickWidth) {\r\n            tickWidth = maxWidth / (numTicks - (options.offset ? 0.5 : 1));\r\n            maxHeight = this.maxHeight - getTickMarkLength(options.grid) - tickOpts.padding - getTitleHeight(options.title, this.chart.options.font);\r\n            maxLabelDiagonal = Math.sqrt(maxLabelWidth * maxLabelWidth + maxLabelHeight * maxLabelHeight);\r\n            labelRotation = toDegrees(Math.min(Math.asin(_limitValue((labelSizes.highest.height + 6) / tickWidth, -1, 1)), Math.asin(_limitValue(maxHeight / maxLabelDiagonal, -1, 1)) - Math.asin(_limitValue(maxLabelHeight / maxLabelDiagonal, -1, 1))));\r\n            labelRotation = Math.max(minRotation, Math.min(maxRotation, labelRotation));\r\n        }\r\n        this.labelRotation = labelRotation;\r\n    }\r\n    afterCalculateLabelRotation() {\r\n        callback(this.options.afterCalculateLabelRotation, [\r\n            this\r\n        ]);\r\n    }\r\n    afterAutoSkip() {}\r\n    beforeFit() {\r\n        callback(this.options.beforeFit, [\r\n            this\r\n        ]);\r\n    }\r\n    fit() {\r\n        const minSize = {\r\n            width: 0,\r\n            height: 0\r\n        };\r\n        const { chart , options: { ticks: tickOpts , title: titleOpts , grid: gridOpts  }  } = this;\r\n        const display = this._isVisible();\r\n        const isHorizontal = this.isHorizontal();\r\n        if (display) {\r\n            const titleHeight = getTitleHeight(titleOpts, chart.options.font);\r\n            if (isHorizontal) {\r\n                minSize.width = this.maxWidth;\r\n                minSize.height = getTickMarkLength(gridOpts) + titleHeight;\r\n            } else {\r\n                minSize.height = this.maxHeight;\r\n                minSize.width = getTickMarkLength(gridOpts) + titleHeight;\r\n            }\r\n            if (tickOpts.display && this.ticks.length) {\r\n                const { first , last , widest , highest  } = this._getLabelSizes();\r\n                const tickPadding = tickOpts.padding * 2;\r\n                const angleRadians = toRadians(this.labelRotation);\r\n                const cos = Math.cos(angleRadians);\r\n                const sin = Math.sin(angleRadians);\r\n                if (isHorizontal) {\r\n                    const labelHeight = tickOpts.mirror ? 0 : sin * widest.width + cos * highest.height;\r\n                    minSize.height = Math.min(this.maxHeight, minSize.height + labelHeight + tickPadding);\r\n                } else {\r\n                    const labelWidth = tickOpts.mirror ? 0 : cos * widest.width + sin * highest.height;\r\n                    minSize.width = Math.min(this.maxWidth, minSize.width + labelWidth + tickPadding);\r\n                }\r\n                this._calculatePadding(first, last, sin, cos);\r\n            }\r\n        }\r\n        this._handleMargins();\r\n        if (isHorizontal) {\r\n            this.width = this._length = chart.width - this._margins.left - this._margins.right;\r\n            this.height = minSize.height;\r\n        } else {\r\n            this.width = minSize.width;\r\n            this.height = this._length = chart.height - this._margins.top - this._margins.bottom;\r\n        }\r\n    }\r\n    _calculatePadding(first, last, sin, cos) {\r\n        const { ticks: { align , padding  } , position  } = this.options;\r\n        const isRotated = this.labelRotation !== 0;\r\n        const labelsBelowTicks = position !== 'top' && this.axis === 'x';\r\n        if (this.isHorizontal()) {\r\n            const offsetLeft = this.getPixelForTick(0) - this.left;\r\n            const offsetRight = this.right - this.getPixelForTick(this.ticks.length - 1);\r\n            let paddingLeft = 0;\r\n            let paddingRight = 0;\r\n            if (isRotated) {\r\n                if (labelsBelowTicks) {\r\n                    paddingLeft = cos * first.width;\r\n                    paddingRight = sin * last.height;\r\n                } else {\r\n                    paddingLeft = sin * first.height;\r\n                    paddingRight = cos * last.width;\r\n                }\r\n            } else if (align === 'start') {\r\n                paddingRight = last.width;\r\n            } else if (align === 'end') {\r\n                paddingLeft = first.width;\r\n            } else if (align !== 'inner') {\r\n                paddingLeft = first.width / 2;\r\n                paddingRight = last.width / 2;\r\n            }\r\n            this.paddingLeft = Math.max((paddingLeft - offsetLeft + padding) * this.width / (this.width - offsetLeft), 0);\r\n            this.paddingRight = Math.max((paddingRight - offsetRight + padding) * this.width / (this.width - offsetRight), 0);\r\n        } else {\r\n            let paddingTop = last.height / 2;\r\n            let paddingBottom = first.height / 2;\r\n            if (align === 'start') {\r\n                paddingTop = 0;\r\n                paddingBottom = first.height;\r\n            } else if (align === 'end') {\r\n                paddingTop = last.height;\r\n                paddingBottom = 0;\r\n            }\r\n            this.paddingTop = paddingTop + padding;\r\n            this.paddingBottom = paddingBottom + padding;\r\n        }\r\n    }\r\n _handleMargins() {\r\n        if (this._margins) {\r\n            this._margins.left = Math.max(this.paddingLeft, this._margins.left);\r\n            this._margins.top = Math.max(this.paddingTop, this._margins.top);\r\n            this._margins.right = Math.max(this.paddingRight, this._margins.right);\r\n            this._margins.bottom = Math.max(this.paddingBottom, this._margins.bottom);\r\n        }\r\n    }\r\n    afterFit() {\r\n        callback(this.options.afterFit, [\r\n            this\r\n        ]);\r\n    }\r\n isHorizontal() {\r\n        const { axis , position  } = this.options;\r\n        return position === 'top' || position === 'bottom' || axis === 'x';\r\n    }\r\n isFullSize() {\r\n        return this.options.fullSize;\r\n    }\r\n _convertTicksToLabels(ticks) {\r\n        this.beforeTickToLabelConversion();\r\n        this.generateTickLabels(ticks);\r\n        let i, ilen;\r\n        for(i = 0, ilen = ticks.length; i < ilen; i++){\r\n            if (isNullOrUndef(ticks[i].label)) {\r\n                ticks.splice(i, 1);\r\n                ilen--;\r\n                i--;\r\n            }\r\n        }\r\n        this.afterTickToLabelConversion();\r\n    }\r\n _getLabelSizes() {\r\n        let labelSizes = this._labelSizes;\r\n        if (!labelSizes) {\r\n            const sampleSize = this.options.ticks.sampleSize;\r\n            let ticks = this.ticks;\r\n            if (sampleSize < ticks.length) {\r\n                ticks = sample(ticks, sampleSize);\r\n            }\r\n            this._labelSizes = labelSizes = this._computeLabelSizes(ticks, ticks.length, this.options.ticks.maxTicksLimit);\r\n        }\r\n        return labelSizes;\r\n    }\r\n _computeLabelSizes(ticks, length, maxTicksLimit) {\r\n        const { ctx , _longestTextCache: caches  } = this;\r\n        const widths = [];\r\n        const heights = [];\r\n        const increment = Math.floor(length / getTicksLimit(length, maxTicksLimit));\r\n        let widestLabelSize = 0;\r\n        let highestLabelSize = 0;\r\n        let i, j, jlen, label, tickFont, fontString, cache, lineHeight, width, height, nestedLabel;\r\n        for(i = 0; i < length; i += increment){\r\n            label = ticks[i].label;\r\n            tickFont = this._resolveTickFontOptions(i);\r\n            ctx.font = fontString = tickFont.string;\r\n            cache = caches[fontString] = caches[fontString] || {\r\n                data: {},\r\n                gc: []\r\n            };\r\n            lineHeight = tickFont.lineHeight;\r\n            width = height = 0;\r\n            if (!isNullOrUndef(label) && !isArray(label)) {\r\n                width = _measureText(ctx, cache.data, cache.gc, width, label);\r\n                height = lineHeight;\r\n            } else if (isArray(label)) {\r\n                for(j = 0, jlen = label.length; j < jlen; ++j){\r\n                    nestedLabel =  label[j];\r\n                    if (!isNullOrUndef(nestedLabel) && !isArray(nestedLabel)) {\r\n                        width = _measureText(ctx, cache.data, cache.gc, width, nestedLabel);\r\n                        height += lineHeight;\r\n                    }\r\n                }\r\n            }\r\n            widths.push(width);\r\n            heights.push(height);\r\n            widestLabelSize = Math.max(width, widestLabelSize);\r\n            highestLabelSize = Math.max(height, highestLabelSize);\r\n        }\r\n        garbageCollect(caches, length);\r\n        const widest = widths.indexOf(widestLabelSize);\r\n        const highest = heights.indexOf(highestLabelSize);\r\n        const valueAt = (idx)=>({\r\n                width: widths[idx] || 0,\r\n                height: heights[idx] || 0\r\n            });\r\n        return {\r\n            first: valueAt(0),\r\n            last: valueAt(length - 1),\r\n            widest: valueAt(widest),\r\n            highest: valueAt(highest),\r\n            widths,\r\n            heights\r\n        };\r\n    }\r\n getLabelForValue(value) {\r\n        return value;\r\n    }\r\n getPixelForValue(value, index) {\r\n        return NaN;\r\n    }\r\n getValueForPixel(pixel) {}\r\n getPixelForTick(index) {\r\n        const ticks = this.ticks;\r\n        if (index < 0 || index > ticks.length - 1) {\r\n            return null;\r\n        }\r\n        return this.getPixelForValue(ticks[index].value);\r\n    }\r\n getPixelForDecimal(decimal) {\r\n        if (this._reversePixels) {\r\n            decimal = 1 - decimal;\r\n        }\r\n        const pixel = this._startPixel + decimal * this._length;\r\n        return _int16Range(this._alignToPixels ? _alignPixel(this.chart, pixel, 0) : pixel);\r\n    }\r\n getDecimalForPixel(pixel) {\r\n        const decimal = (pixel - this._startPixel) / this._length;\r\n        return this._reversePixels ? 1 - decimal : decimal;\r\n    }\r\n getBasePixel() {\r\n        return this.getPixelForValue(this.getBaseValue());\r\n    }\r\n getBaseValue() {\r\n        const { min , max  } = this;\r\n        return min < 0 && max < 0 ? max : min > 0 && max > 0 ? min : 0;\r\n    }\r\n getContext(index) {\r\n        const ticks = this.ticks || [];\r\n        if (index >= 0 && index < ticks.length) {\r\n            const tick = ticks[index];\r\n            return tick.$context || (tick.$context = createTickContext(this.getContext(), index, tick));\r\n        }\r\n        return this.$context || (this.$context = createScaleContext(this.chart.getContext(), this));\r\n    }\r\n _tickSize() {\r\n        const optionTicks = this.options.ticks;\r\n        const rot = toRadians(this.labelRotation);\r\n        const cos = Math.abs(Math.cos(rot));\r\n        const sin = Math.abs(Math.sin(rot));\r\n        const labelSizes = this._getLabelSizes();\r\n        const padding = optionTicks.autoSkipPadding || 0;\r\n        const w = labelSizes ? labelSizes.widest.width + padding : 0;\r\n        const h = labelSizes ? labelSizes.highest.height + padding : 0;\r\n        return this.isHorizontal() ? h * cos > w * sin ? w / cos : h / sin : h * sin < w * cos ? h / cos : w / sin;\r\n    }\r\n _isVisible() {\r\n        const display = this.options.display;\r\n        if (display !== 'auto') {\r\n            return !!display;\r\n        }\r\n        return this.getMatchingVisibleMetas().length > 0;\r\n    }\r\n _computeGridLineItems(chartArea) {\r\n        const axis = this.axis;\r\n        const chart = this.chart;\r\n        const options = this.options;\r\n        const { grid , position , border  } = options;\r\n        const offset = grid.offset;\r\n        const isHorizontal = this.isHorizontal();\r\n        const ticks = this.ticks;\r\n        const ticksLength = ticks.length + (offset ? 1 : 0);\r\n        const tl = getTickMarkLength(grid);\r\n        const items = [];\r\n        const borderOpts = border.setContext(this.getContext());\r\n        const axisWidth = borderOpts.display ? borderOpts.width : 0;\r\n        const axisHalfWidth = axisWidth / 2;\r\n        const alignBorderValue = function(pixel) {\r\n            return _alignPixel(chart, pixel, axisWidth);\r\n        };\r\n        let borderValue, i, lineValue, alignedLineValue;\r\n        let tx1, ty1, tx2, ty2, x1, y1, x2, y2;\r\n        if (position === 'top') {\r\n            borderValue = alignBorderValue(this.bottom);\r\n            ty1 = this.bottom - tl;\r\n            ty2 = borderValue - axisHalfWidth;\r\n            y1 = alignBorderValue(chartArea.top) + axisHalfWidth;\r\n            y2 = chartArea.bottom;\r\n        } else if (position === 'bottom') {\r\n            borderValue = alignBorderValue(this.top);\r\n            y1 = chartArea.top;\r\n            y2 = alignBorderValue(chartArea.bottom) - axisHalfWidth;\r\n            ty1 = borderValue + axisHalfWidth;\r\n            ty2 = this.top + tl;\r\n        } else if (position === 'left') {\r\n            borderValue = alignBorderValue(this.right);\r\n            tx1 = this.right - tl;\r\n            tx2 = borderValue - axisHalfWidth;\r\n            x1 = alignBorderValue(chartArea.left) + axisHalfWidth;\r\n            x2 = chartArea.right;\r\n        } else if (position === 'right') {\r\n            borderValue = alignBorderValue(this.left);\r\n            x1 = chartArea.left;\r\n            x2 = alignBorderValue(chartArea.right) - axisHalfWidth;\r\n            tx1 = borderValue + axisHalfWidth;\r\n            tx2 = this.left + tl;\r\n        } else if (axis === 'x') {\r\n            if (position === 'center') {\r\n                borderValue = alignBorderValue((chartArea.top + chartArea.bottom) / 2 + 0.5);\r\n            } else if (isObject(position)) {\r\n                const positionAxisID = Object.keys(position)[0];\r\n                const value = position[positionAxisID];\r\n                borderValue = alignBorderValue(this.chart.scales[positionAxisID].getPixelForValue(value));\r\n            }\r\n            y1 = chartArea.top;\r\n            y2 = chartArea.bottom;\r\n            ty1 = borderValue + axisHalfWidth;\r\n            ty2 = ty1 + tl;\r\n        } else if (axis === 'y') {\r\n            if (position === 'center') {\r\n                borderValue = alignBorderValue((chartArea.left + chartArea.right) / 2);\r\n            } else if (isObject(position)) {\r\n                const positionAxisID = Object.keys(position)[0];\r\n                const value = position[positionAxisID];\r\n                borderValue = alignBorderValue(this.chart.scales[positionAxisID].getPixelForValue(value));\r\n            }\r\n            tx1 = borderValue - axisHalfWidth;\r\n            tx2 = tx1 - tl;\r\n            x1 = chartArea.left;\r\n            x2 = chartArea.right;\r\n        }\r\n        const limit = valueOrDefault(options.ticks.maxTicksLimit, ticksLength);\r\n        const step = Math.max(1, Math.ceil(ticksLength / limit));\r\n        for(i = 0; i < ticksLength; i += step){\r\n            const context = this.getContext(i);\r\n            const optsAtIndex = grid.setContext(context);\r\n            const optsAtIndexBorder = border.setContext(context);\r\n            const lineWidth = optsAtIndex.lineWidth;\r\n            const lineColor = optsAtIndex.color;\r\n            const borderDash = optsAtIndexBorder.dash || [];\r\n            const borderDashOffset = optsAtIndexBorder.dashOffset;\r\n            const tickWidth = optsAtIndex.tickWidth;\r\n            const tickColor = optsAtIndex.tickColor;\r\n            const tickBorderDash = optsAtIndex.tickBorderDash || [];\r\n            const tickBorderDashOffset = optsAtIndex.tickBorderDashOffset;\r\n            lineValue = getPixelForGridLine(this, i, offset);\r\n            if (lineValue === undefined) {\r\n                continue;\r\n            }\r\n            alignedLineValue = _alignPixel(chart, lineValue, lineWidth);\r\n            if (isHorizontal) {\r\n                tx1 = tx2 = x1 = x2 = alignedLineValue;\r\n            } else {\r\n                ty1 = ty2 = y1 = y2 = alignedLineValue;\r\n            }\r\n            items.push({\r\n                tx1,\r\n                ty1,\r\n                tx2,\r\n                ty2,\r\n                x1,\r\n                y1,\r\n                x2,\r\n                y2,\r\n                width: lineWidth,\r\n                color: lineColor,\r\n                borderDash,\r\n                borderDashOffset,\r\n                tickWidth,\r\n                tickColor,\r\n                tickBorderDash,\r\n                tickBorderDashOffset\r\n            });\r\n        }\r\n        this._ticksLength = ticksLength;\r\n        this._borderValue = borderValue;\r\n        return items;\r\n    }\r\n _computeLabelItems(chartArea) {\r\n        const axis = this.axis;\r\n        const options = this.options;\r\n        const { position , ticks: optionTicks  } = options;\r\n        const isHorizontal = this.isHorizontal();\r\n        const ticks = this.ticks;\r\n        const { align , crossAlign , padding , mirror  } = optionTicks;\r\n        const tl = getTickMarkLength(options.grid);\r\n        const tickAndPadding = tl + padding;\r\n        const hTickAndPadding = mirror ? -padding : tickAndPadding;\r\n        const rotation = -toRadians(this.labelRotation);\r\n        const items = [];\r\n        let i, ilen, tick, label, x, y, textAlign, pixel, font, lineHeight, lineCount, textOffset;\r\n        let textBaseline = 'middle';\r\n        if (position === 'top') {\r\n            y = this.bottom - hTickAndPadding;\r\n            textAlign = this._getXAxisLabelAlignment();\r\n        } else if (position === 'bottom') {\r\n            y = this.top + hTickAndPadding;\r\n            textAlign = this._getXAxisLabelAlignment();\r\n        } else if (position === 'left') {\r\n            const ret = this._getYAxisLabelAlignment(tl);\r\n            textAlign = ret.textAlign;\r\n            x = ret.x;\r\n        } else if (position === 'right') {\r\n            const ret = this._getYAxisLabelAlignment(tl);\r\n            textAlign = ret.textAlign;\r\n            x = ret.x;\r\n        } else if (axis === 'x') {\r\n            if (position === 'center') {\r\n                y = (chartArea.top + chartArea.bottom) / 2 + tickAndPadding;\r\n            } else if (isObject(position)) {\r\n                const positionAxisID = Object.keys(position)[0];\r\n                const value = position[positionAxisID];\r\n                y = this.chart.scales[positionAxisID].getPixelForValue(value) + tickAndPadding;\r\n            }\r\n            textAlign = this._getXAxisLabelAlignment();\r\n        } else if (axis === 'y') {\r\n            if (position === 'center') {\r\n                x = (chartArea.left + chartArea.right) / 2 - tickAndPadding;\r\n            } else if (isObject(position)) {\r\n                const positionAxisID = Object.keys(position)[0];\r\n                const value = position[positionAxisID];\r\n                x = this.chart.scales[positionAxisID].getPixelForValue(value);\r\n            }\r\n            textAlign = this._getYAxisLabelAlignment(tl).textAlign;\r\n        }\r\n        if (axis === 'y') {\r\n            if (align === 'start') {\r\n                textBaseline = 'top';\r\n            } else if (align === 'end') {\r\n                textBaseline = 'bottom';\r\n            }\r\n        }\r\n        const labelSizes = this._getLabelSizes();\r\n        for(i = 0, ilen = ticks.length; i < ilen; ++i){\r\n            tick = ticks[i];\r\n            label = tick.label;\r\n            const optsAtIndex = optionTicks.setContext(this.getContext(i));\r\n            pixel = this.getPixelForTick(i) + optionTicks.labelOffset;\r\n            font = this._resolveTickFontOptions(i);\r\n            lineHeight = font.lineHeight;\r\n            lineCount = isArray(label) ? label.length : 1;\r\n            const halfCount = lineCount / 2;\r\n            const color = optsAtIndex.color;\r\n            const strokeColor = optsAtIndex.textStrokeColor;\r\n            const strokeWidth = optsAtIndex.textStrokeWidth;\r\n            let tickTextAlign = textAlign;\r\n            if (isHorizontal) {\r\n                x = pixel;\r\n                if (textAlign === 'inner') {\r\n                    if (i === ilen - 1) {\r\n                        tickTextAlign = !this.options.reverse ? 'right' : 'left';\r\n                    } else if (i === 0) {\r\n                        tickTextAlign = !this.options.reverse ? 'left' : 'right';\r\n                    } else {\r\n                        tickTextAlign = 'center';\r\n                    }\r\n                }\r\n                if (position === 'top') {\r\n                    if (crossAlign === 'near' || rotation !== 0) {\r\n                        textOffset = -lineCount * lineHeight + lineHeight / 2;\r\n                    } else if (crossAlign === 'center') {\r\n                        textOffset = -labelSizes.highest.height / 2 - halfCount * lineHeight + lineHeight;\r\n                    } else {\r\n                        textOffset = -labelSizes.highest.height + lineHeight / 2;\r\n                    }\r\n                } else {\r\n                    if (crossAlign === 'near' || rotation !== 0) {\r\n                        textOffset = lineHeight / 2;\r\n                    } else if (crossAlign === 'center') {\r\n                        textOffset = labelSizes.highest.height / 2 - halfCount * lineHeight;\r\n                    } else {\r\n                        textOffset = labelSizes.highest.height - lineCount * lineHeight;\r\n                    }\r\n                }\r\n                if (mirror) {\r\n                    textOffset *= -1;\r\n                }\r\n                if (rotation !== 0 && !optsAtIndex.showLabelBackdrop) {\r\n                    x += lineHeight / 2 * Math.sin(rotation);\r\n                }\r\n            } else {\r\n                y = pixel;\r\n                textOffset = (1 - lineCount) * lineHeight / 2;\r\n            }\r\n            let backdrop;\r\n            if (optsAtIndex.showLabelBackdrop) {\r\n                const labelPadding = toPadding(optsAtIndex.backdropPadding);\r\n                const height = labelSizes.heights[i];\r\n                const width = labelSizes.widths[i];\r\n                let top = textOffset - labelPadding.top;\r\n                let left = 0 - labelPadding.left;\r\n                switch(textBaseline){\r\n                    case 'middle':\r\n                        top -= height / 2;\r\n                        break;\r\n                    case 'bottom':\r\n                        top -= height;\r\n                        break;\r\n                }\r\n                switch(textAlign){\r\n                    case 'center':\r\n                        left -= width / 2;\r\n                        break;\r\n                    case 'right':\r\n                        left -= width;\r\n                        break;\r\n                    case 'inner':\r\n                        if (i === ilen - 1) {\r\n                            left -= width;\r\n                        } else if (i > 0) {\r\n                            left -= width / 2;\r\n                        }\r\n                        break;\r\n                }\r\n                backdrop = {\r\n                    left,\r\n                    top,\r\n                    width: width + labelPadding.width,\r\n                    height: height + labelPadding.height,\r\n                    color: optsAtIndex.backdropColor\r\n                };\r\n            }\r\n            items.push({\r\n                label,\r\n                font,\r\n                textOffset,\r\n                options: {\r\n                    rotation,\r\n                    color,\r\n                    strokeColor,\r\n                    strokeWidth,\r\n                    textAlign: tickTextAlign,\r\n                    textBaseline,\r\n                    translation: [\r\n                        x,\r\n                        y\r\n                    ],\r\n                    backdrop\r\n                }\r\n            });\r\n        }\r\n        return items;\r\n    }\r\n    _getXAxisLabelAlignment() {\r\n        const { position , ticks  } = this.options;\r\n        const rotation = -toRadians(this.labelRotation);\r\n        if (rotation) {\r\n            return position === 'top' ? 'left' : 'right';\r\n        }\r\n        let align = 'center';\r\n        if (ticks.align === 'start') {\r\n            align = 'left';\r\n        } else if (ticks.align === 'end') {\r\n            align = 'right';\r\n        } else if (ticks.align === 'inner') {\r\n            align = 'inner';\r\n        }\r\n        return align;\r\n    }\r\n    _getYAxisLabelAlignment(tl) {\r\n        const { position , ticks: { crossAlign , mirror , padding  }  } = this.options;\r\n        const labelSizes = this._getLabelSizes();\r\n        const tickAndPadding = tl + padding;\r\n        const widest = labelSizes.widest.width;\r\n        let textAlign;\r\n        let x;\r\n        if (position === 'left') {\r\n            if (mirror) {\r\n                x = this.right + padding;\r\n                if (crossAlign === 'near') {\r\n                    textAlign = 'left';\r\n                } else if (crossAlign === 'center') {\r\n                    textAlign = 'center';\r\n                    x += widest / 2;\r\n                } else {\r\n                    textAlign = 'right';\r\n                    x += widest;\r\n                }\r\n            } else {\r\n                x = this.right - tickAndPadding;\r\n                if (crossAlign === 'near') {\r\n                    textAlign = 'right';\r\n                } else if (crossAlign === 'center') {\r\n                    textAlign = 'center';\r\n                    x -= widest / 2;\r\n                } else {\r\n                    textAlign = 'left';\r\n                    x = this.left;\r\n                }\r\n            }\r\n        } else if (position === 'right') {\r\n            if (mirror) {\r\n                x = this.left + padding;\r\n                if (crossAlign === 'near') {\r\n                    textAlign = 'right';\r\n                } else if (crossAlign === 'center') {\r\n                    textAlign = 'center';\r\n                    x -= widest / 2;\r\n                } else {\r\n                    textAlign = 'left';\r\n                    x -= widest;\r\n                }\r\n            } else {\r\n                x = this.left + tickAndPadding;\r\n                if (crossAlign === 'near') {\r\n                    textAlign = 'left';\r\n                } else if (crossAlign === 'center') {\r\n                    textAlign = 'center';\r\n                    x += widest / 2;\r\n                } else {\r\n                    textAlign = 'right';\r\n                    x = this.right;\r\n                }\r\n            }\r\n        } else {\r\n            textAlign = 'right';\r\n        }\r\n        return {\r\n            textAlign,\r\n            x\r\n        };\r\n    }\r\n _computeLabelArea() {\r\n        if (this.options.ticks.mirror) {\r\n            return;\r\n        }\r\n        const chart = this.chart;\r\n        const position = this.options.position;\r\n        if (position === 'left' || position === 'right') {\r\n            return {\r\n                top: 0,\r\n                left: this.left,\r\n                bottom: chart.height,\r\n                right: this.right\r\n            };\r\n        }\r\n        if (position === 'top' || position === 'bottom') {\r\n            return {\r\n                top: this.top,\r\n                left: 0,\r\n                bottom: this.bottom,\r\n                right: chart.width\r\n            };\r\n        }\r\n    }\r\n drawBackground() {\r\n        const { ctx , options: { backgroundColor  } , left , top , width , height  } = this;\r\n        if (backgroundColor) {\r\n            ctx.save();\r\n            ctx.fillStyle = backgroundColor;\r\n            ctx.fillRect(left, top, width, height);\r\n            ctx.restore();\r\n        }\r\n    }\r\n    getLineWidthForValue(value) {\r\n        const grid = this.options.grid;\r\n        if (!this._isVisible() || !grid.display) {\r\n            return 0;\r\n        }\r\n        const ticks = this.ticks;\r\n        const index = ticks.findIndex((t)=>t.value === value);\r\n        if (index >= 0) {\r\n            const opts = grid.setContext(this.getContext(index));\r\n            return opts.lineWidth;\r\n        }\r\n        return 0;\r\n    }\r\n drawGrid(chartArea) {\r\n        const grid = this.options.grid;\r\n        const ctx = this.ctx;\r\n        const items = this._gridLineItems || (this._gridLineItems = this._computeGridLineItems(chartArea));\r\n        let i, ilen;\r\n        const drawLine = (p1, p2, style)=>{\r\n            if (!style.width || !style.color) {\r\n                return;\r\n            }\r\n            ctx.save();\r\n            ctx.lineWidth = style.width;\r\n            ctx.strokeStyle = style.color;\r\n            ctx.setLineDash(style.borderDash || []);\r\n            ctx.lineDashOffset = style.borderDashOffset;\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n            ctx.restore();\r\n        };\r\n        if (grid.display) {\r\n            for(i = 0, ilen = items.length; i < ilen; ++i){\r\n                const item = items[i];\r\n                if (grid.drawOnChartArea) {\r\n                    drawLine({\r\n                        x: item.x1,\r\n                        y: item.y1\r\n                    }, {\r\n                        x: item.x2,\r\n                        y: item.y2\r\n                    }, item);\r\n                }\r\n                if (grid.drawTicks) {\r\n                    drawLine({\r\n                        x: item.tx1,\r\n                        y: item.ty1\r\n                    }, {\r\n                        x: item.tx2,\r\n                        y: item.ty2\r\n                    }, {\r\n                        color: item.tickColor,\r\n                        width: item.tickWidth,\r\n                        borderDash: item.tickBorderDash,\r\n                        borderDashOffset: item.tickBorderDashOffset\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n drawBorder() {\r\n        const { chart , ctx , options: { border , grid  }  } = this;\r\n        const borderOpts = border.setContext(this.getContext());\r\n        const axisWidth = border.display ? borderOpts.width : 0;\r\n        if (!axisWidth) {\r\n            return;\r\n        }\r\n        const lastLineWidth = grid.setContext(this.getContext(0)).lineWidth;\r\n        const borderValue = this._borderValue;\r\n        let x1, x2, y1, y2;\r\n        if (this.isHorizontal()) {\r\n            x1 = _alignPixel(chart, this.left, axisWidth) - axisWidth / 2;\r\n            x2 = _alignPixel(chart, this.right, lastLineWidth) + lastLineWidth / 2;\r\n            y1 = y2 = borderValue;\r\n        } else {\r\n            y1 = _alignPixel(chart, this.top, axisWidth) - axisWidth / 2;\r\n            y2 = _alignPixel(chart, this.bottom, lastLineWidth) + lastLineWidth / 2;\r\n            x1 = x2 = borderValue;\r\n        }\r\n        ctx.save();\r\n        ctx.lineWidth = borderOpts.width;\r\n        ctx.strokeStyle = borderOpts.color;\r\n        ctx.beginPath();\r\n        ctx.moveTo(x1, y1);\r\n        ctx.lineTo(x2, y2);\r\n        ctx.stroke();\r\n        ctx.restore();\r\n    }\r\n drawLabels(chartArea) {\r\n        const optionTicks = this.options.ticks;\r\n        if (!optionTicks.display) {\r\n            return;\r\n        }\r\n        const ctx = this.ctx;\r\n        const area = this._computeLabelArea();\r\n        if (area) {\r\n            clipArea(ctx, area);\r\n        }\r\n        const items = this.getLabelItems(chartArea);\r\n        for (const item of items){\r\n            const renderTextOptions = item.options;\r\n            const tickFont = item.font;\r\n            const label = item.label;\r\n            const y = item.textOffset;\r\n            renderText(ctx, label, 0, y, tickFont, renderTextOptions);\r\n        }\r\n        if (area) {\r\n            unclipArea(ctx);\r\n        }\r\n    }\r\n drawTitle() {\r\n        const { ctx , options: { position , title , reverse  }  } = this;\r\n        if (!title.display) {\r\n            return;\r\n        }\r\n        const font = toFont(title.font);\r\n        const padding = toPadding(title.padding);\r\n        const align = title.align;\r\n        let offset = font.lineHeight / 2;\r\n        if (position === 'bottom' || position === 'center' || isObject(position)) {\r\n            offset += padding.bottom;\r\n            if (isArray(title.text)) {\r\n                offset += font.lineHeight * (title.text.length - 1);\r\n            }\r\n        } else {\r\n            offset += padding.top;\r\n        }\r\n        const { titleX , titleY , maxWidth , rotation  } = titleArgs(this, offset, position, align);\r\n        renderText(ctx, title.text, 0, 0, font, {\r\n            color: title.color,\r\n            maxWidth,\r\n            rotation,\r\n            textAlign: titleAlign(align, position, reverse),\r\n            textBaseline: 'middle',\r\n            translation: [\r\n                titleX,\r\n                titleY\r\n            ]\r\n        });\r\n    }\r\n    draw(chartArea) {\r\n        if (!this._isVisible()) {\r\n            return;\r\n        }\r\n        this.drawBackground();\r\n        this.drawGrid(chartArea);\r\n        this.drawBorder();\r\n        this.drawTitle();\r\n        this.drawLabels(chartArea);\r\n    }\r\n _layers() {\r\n        const opts = this.options;\r\n        const tz = opts.ticks && opts.ticks.z || 0;\r\n        const gz = valueOrDefault(opts.grid && opts.grid.z, -1);\r\n        const bz = valueOrDefault(opts.border && opts.border.z, 0);\r\n        if (!this._isVisible() || this.draw !== Scale.prototype.draw) {\r\n            return [\r\n                {\r\n                    z: tz,\r\n                    draw: (chartArea)=>{\r\n                        this.draw(chartArea);\r\n                    }\r\n                }\r\n            ];\r\n        }\r\n        return [\r\n            {\r\n                z: gz,\r\n                draw: (chartArea)=>{\r\n                    this.drawBackground();\r\n                    this.drawGrid(chartArea);\r\n                    this.drawTitle();\r\n                }\r\n            },\r\n            {\r\n                z: bz,\r\n                draw: ()=>{\r\n                    this.drawBorder();\r\n                }\r\n            },\r\n            {\r\n                z: tz,\r\n                draw: (chartArea)=>{\r\n                    this.drawLabels(chartArea);\r\n                }\r\n            }\r\n        ];\r\n    }\r\n getMatchingVisibleMetas(type) {\r\n        const metas = this.chart.getSortedVisibleDatasetMetas();\r\n        const axisID = this.axis + 'AxisID';\r\n        const result = [];\r\n        let i, ilen;\r\n        for(i = 0, ilen = metas.length; i < ilen; ++i){\r\n            const meta = metas[i];\r\n            if (meta[axisID] === this.id && (!type || meta.type === type)) {\r\n                result.push(meta);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n _resolveTickFontOptions(index) {\r\n        const opts = this.options.ticks.setContext(this.getContext(index));\r\n        return toFont(opts.font);\r\n    }\r\n _maxDigits() {\r\n        const fontSize = this._resolveTickFontOptions(0).lineHeight;\r\n        return (this.isHorizontal() ? this.width : this.height) / fontSize;\r\n    }\r\n}\r\n\r\nclass TypedRegistry {\r\n    constructor(type, scope, override){\r\n        this.type = type;\r\n        this.scope = scope;\r\n        this.override = override;\r\n        this.items = Object.create(null);\r\n    }\r\n    isForType(type) {\r\n        return Object.prototype.isPrototypeOf.call(this.type.prototype, type.prototype);\r\n    }\r\n register(item) {\r\n        const proto = Object.getPrototypeOf(item);\r\n        let parentScope;\r\n        if (isIChartComponent(proto)) {\r\n            parentScope = this.register(proto);\r\n        }\r\n        const items = this.items;\r\n        const id = item.id;\r\n        const scope = this.scope + '.' + id;\r\n        if (!id) {\r\n            throw new Error('class does not have id: ' + item);\r\n        }\r\n        if (id in items) {\r\n            return scope;\r\n        }\r\n        items[id] = item;\r\n        registerDefaults(item, scope, parentScope);\r\n        if (this.override) {\r\n            defaults.override(item.id, item.overrides);\r\n        }\r\n        return scope;\r\n    }\r\n get(id) {\r\n        return this.items[id];\r\n    }\r\n unregister(item) {\r\n        const items = this.items;\r\n        const id = item.id;\r\n        const scope = this.scope;\r\n        if (id in items) {\r\n            delete items[id];\r\n        }\r\n        if (scope && id in defaults[scope]) {\r\n            delete defaults[scope][id];\r\n            if (this.override) {\r\n                delete overrides[id];\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction registerDefaults(item, scope, parentScope) {\r\n    const itemDefaults = merge(Object.create(null), [\r\n        parentScope ? defaults.get(parentScope) : {},\r\n        defaults.get(scope),\r\n        item.defaults\r\n    ]);\r\n    defaults.set(scope, itemDefaults);\r\n    if (item.defaultRoutes) {\r\n        routeDefaults(scope, item.defaultRoutes);\r\n    }\r\n    if (item.descriptors) {\r\n        defaults.describe(scope, item.descriptors);\r\n    }\r\n}\r\nfunction routeDefaults(scope, routes) {\r\n    Object.keys(routes).forEach((property)=>{\r\n        const propertyParts = property.split('.');\r\n        const sourceName = propertyParts.pop();\r\n        const sourceScope = [\r\n            scope\r\n        ].concat(propertyParts).join('.');\r\n        const parts = routes[property].split('.');\r\n        const targetName = parts.pop();\r\n        const targetScope = parts.join('.');\r\n        defaults.route(sourceScope, sourceName, targetScope, targetName);\r\n    });\r\n}\r\nfunction isIChartComponent(proto) {\r\n    return 'id' in proto && 'defaults' in proto;\r\n}\r\n\r\nclass Registry {\r\n    constructor(){\r\n        this.controllers = new TypedRegistry(DatasetController, 'datasets', true);\r\n        this.elements = new TypedRegistry(Element, 'elements');\r\n        this.plugins = new TypedRegistry(Object, 'plugins');\r\n        this.scales = new TypedRegistry(Scale, 'scales');\r\n        this._typedRegistries = [\r\n            this.controllers,\r\n            this.scales,\r\n            this.elements\r\n        ];\r\n    }\r\n add(...args) {\r\n        this._each('register', args);\r\n    }\r\n    remove(...args) {\r\n        this._each('unregister', args);\r\n    }\r\n addControllers(...args) {\r\n        this._each('register', args, this.controllers);\r\n    }\r\n addElements(...args) {\r\n        this._each('register', args, this.elements);\r\n    }\r\n addPlugins(...args) {\r\n        this._each('register', args, this.plugins);\r\n    }\r\n addScales(...args) {\r\n        this._each('register', args, this.scales);\r\n    }\r\n getController(id) {\r\n        return this._get(id, this.controllers, 'controller');\r\n    }\r\n getElement(id) {\r\n        return this._get(id, this.elements, 'element');\r\n    }\r\n getPlugin(id) {\r\n        return this._get(id, this.plugins, 'plugin');\r\n    }\r\n getScale(id) {\r\n        return this._get(id, this.scales, 'scale');\r\n    }\r\n removeControllers(...args) {\r\n        this._each('unregister', args, this.controllers);\r\n    }\r\n removeElements(...args) {\r\n        this._each('unregister', args, this.elements);\r\n    }\r\n removePlugins(...args) {\r\n        this._each('unregister', args, this.plugins);\r\n    }\r\n removeScales(...args) {\r\n        this._each('unregister', args, this.scales);\r\n    }\r\n _each(method, args, typedRegistry) {\r\n        [\r\n            ...args\r\n        ].forEach((arg)=>{\r\n            const reg = typedRegistry || this._getRegistryForType(arg);\r\n            if (typedRegistry || reg.isForType(arg) || reg === this.plugins && arg.id) {\r\n                this._exec(method, reg, arg);\r\n            } else {\r\n                each(arg, (item)=>{\r\n                    const itemReg = typedRegistry || this._getRegistryForType(item);\r\n                    this._exec(method, itemReg, item);\r\n                });\r\n            }\r\n        });\r\n    }\r\n _exec(method, registry, component) {\r\n        const camelMethod = _capitalize(method);\r\n        callback(component['before' + camelMethod], [], component);\r\n        registry[method](component);\r\n        callback(component['after' + camelMethod], [], component);\r\n    }\r\n _getRegistryForType(type) {\r\n        for(let i = 0; i < this._typedRegistries.length; i++){\r\n            const reg = this._typedRegistries[i];\r\n            if (reg.isForType(type)) {\r\n                return reg;\r\n            }\r\n        }\r\n        return this.plugins;\r\n    }\r\n _get(id, typedRegistry, type) {\r\n        const item = typedRegistry.get(id);\r\n        if (item === undefined) {\r\n            throw new Error('\"' + id + '\" is not a registered ' + type + '.');\r\n        }\r\n        return item;\r\n    }\r\n}\r\nvar registry = /* #__PURE__ */ new Registry();\r\n\r\nclass PluginService {\r\n    constructor(){\r\n        this._init = [];\r\n    }\r\n notify(chart, hook, args, filter) {\r\n        if (hook === 'beforeInit') {\r\n            this._init = this._createDescriptors(chart, true);\r\n            this._notify(this._init, chart, 'install');\r\n        }\r\n        const descriptors = filter ? this._descriptors(chart).filter(filter) : this._descriptors(chart);\r\n        const result = this._notify(descriptors, chart, hook, args);\r\n        if (hook === 'afterDestroy') {\r\n            this._notify(descriptors, chart, 'stop');\r\n            this._notify(this._init, chart, 'uninstall');\r\n        }\r\n        return result;\r\n    }\r\n _notify(descriptors, chart, hook, args) {\r\n        args = args || {};\r\n        for (const descriptor of descriptors){\r\n            const plugin = descriptor.plugin;\r\n            const method = plugin[hook];\r\n            const params = [\r\n                chart,\r\n                args,\r\n                descriptor.options\r\n            ];\r\n            if (callback(method, params, plugin) === false && args.cancelable) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    invalidate() {\r\n        if (!isNullOrUndef(this._cache)) {\r\n            this._oldCache = this._cache;\r\n            this._cache = undefined;\r\n        }\r\n    }\r\n _descriptors(chart) {\r\n        if (this._cache) {\r\n            return this._cache;\r\n        }\r\n        const descriptors = this._cache = this._createDescriptors(chart);\r\n        this._notifyStateChanges(chart);\r\n        return descriptors;\r\n    }\r\n    _createDescriptors(chart, all) {\r\n        const config = chart && chart.config;\r\n        const options = valueOrDefault(config.options && config.options.plugins, {});\r\n        const plugins = allPlugins(config);\r\n        return options === false && !all ? [] : createDescriptors(chart, plugins, options, all);\r\n    }\r\n _notifyStateChanges(chart) {\r\n        const previousDescriptors = this._oldCache || [];\r\n        const descriptors = this._cache;\r\n        const diff = (a, b)=>a.filter((x)=>!b.some((y)=>x.plugin.id === y.plugin.id));\r\n        this._notify(diff(previousDescriptors, descriptors), chart, 'stop');\r\n        this._notify(diff(descriptors, previousDescriptors), chart, 'start');\r\n    }\r\n}\r\n function allPlugins(config) {\r\n    const localIds = {};\r\n    const plugins = [];\r\n    const keys = Object.keys(registry.plugins.items);\r\n    for(let i = 0; i < keys.length; i++){\r\n        plugins.push(registry.getPlugin(keys[i]));\r\n    }\r\n    const local = config.plugins || [];\r\n    for(let i = 0; i < local.length; i++){\r\n        const plugin = local[i];\r\n        if (plugins.indexOf(plugin) === -1) {\r\n            plugins.push(plugin);\r\n            localIds[plugin.id] = true;\r\n        }\r\n    }\r\n    return {\r\n        plugins,\r\n        localIds\r\n    };\r\n}\r\nfunction getOpts(options, all) {\r\n    if (!all && options === false) {\r\n        return null;\r\n    }\r\n    if (options === true) {\r\n        return {};\r\n    }\r\n    return options;\r\n}\r\nfunction createDescriptors(chart, { plugins , localIds  }, options, all) {\r\n    const result = [];\r\n    const context = chart.getContext();\r\n    for (const plugin of plugins){\r\n        const id = plugin.id;\r\n        const opts = getOpts(options[id], all);\r\n        if (opts === null) {\r\n            continue;\r\n        }\r\n        result.push({\r\n            plugin,\r\n            options: pluginOpts(chart.config, {\r\n                plugin,\r\n                local: localIds[id]\r\n            }, opts, context)\r\n        });\r\n    }\r\n    return result;\r\n}\r\nfunction pluginOpts(config, { plugin , local  }, opts, context) {\r\n    const keys = config.pluginScopeKeys(plugin);\r\n    const scopes = config.getOptionScopes(opts, keys);\r\n    if (local && plugin.defaults) {\r\n        scopes.push(plugin.defaults);\r\n    }\r\n    return config.createResolver(scopes, context, [\r\n        ''\r\n    ], {\r\n        scriptable: false,\r\n        indexable: false,\r\n        allKeys: true\r\n    });\r\n}\r\n\r\nfunction getIndexAxis(type, options) {\r\n    const datasetDefaults = defaults.datasets[type] || {};\r\n    const datasetOptions = (options.datasets || {})[type] || {};\r\n    return datasetOptions.indexAxis || options.indexAxis || datasetDefaults.indexAxis || 'x';\r\n}\r\nfunction getAxisFromDefaultScaleID(id, indexAxis) {\r\n    let axis = id;\r\n    if (id === '_index_') {\r\n        axis = indexAxis;\r\n    } else if (id === '_value_') {\r\n        axis = indexAxis === 'x' ? 'y' : 'x';\r\n    }\r\n    return axis;\r\n}\r\nfunction getDefaultScaleIDFromAxis(axis, indexAxis) {\r\n    return axis === indexAxis ? '_index_' : '_value_';\r\n}\r\nfunction idMatchesAxis(id) {\r\n    if (id === 'x' || id === 'y' || id === 'r') {\r\n        return id;\r\n    }\r\n}\r\nfunction axisFromPosition(position) {\r\n    if (position === 'top' || position === 'bottom') {\r\n        return 'x';\r\n    }\r\n    if (position === 'left' || position === 'right') {\r\n        return 'y';\r\n    }\r\n}\r\nfunction determineAxis(id, ...scaleOptions) {\r\n    if (idMatchesAxis(id)) {\r\n        return id;\r\n    }\r\n    for (const opts of scaleOptions){\r\n        const axis = opts.axis || axisFromPosition(opts.position) || id.length > 1 && idMatchesAxis(id[0].toLowerCase());\r\n        if (axis) {\r\n            return axis;\r\n        }\r\n    }\r\n    throw new Error(`Cannot determine type of '${id}' axis. Please provide 'axis' or 'position' option.`);\r\n}\r\nfunction getAxisFromDataset(id, axis, dataset) {\r\n    if (dataset[axis + 'AxisID'] === id) {\r\n        return {\r\n            axis\r\n        };\r\n    }\r\n}\r\nfunction retrieveAxisFromDatasets(id, config) {\r\n    if (config.data && config.data.datasets) {\r\n        const boundDs = config.data.datasets.filter((d)=>d.xAxisID === id || d.yAxisID === id);\r\n        if (boundDs.length) {\r\n            return getAxisFromDataset(id, 'x', boundDs[0]) || getAxisFromDataset(id, 'y', boundDs[0]);\r\n        }\r\n    }\r\n    return {};\r\n}\r\nfunction mergeScaleConfig(config, options) {\r\n    const chartDefaults = overrides[config.type] || {\r\n        scales: {}\r\n    };\r\n    const configScales = options.scales || {};\r\n    const chartIndexAxis = getIndexAxis(config.type, options);\r\n    const scales = Object.create(null);\r\n    Object.keys(configScales).forEach((id)=>{\r\n        const scaleConf = configScales[id];\r\n        if (!isObject(scaleConf)) {\r\n            return console.error(`Invalid scale configuration for scale: ${id}`);\r\n        }\r\n        if (scaleConf._proxy) {\r\n            return console.warn(`Ignoring resolver passed as options for scale: ${id}`);\r\n        }\r\n        const axis = determineAxis(id, scaleConf, retrieveAxisFromDatasets(id, config), defaults.scales[scaleConf.type]);\r\n        const defaultId = getDefaultScaleIDFromAxis(axis, chartIndexAxis);\r\n        const defaultScaleOptions = chartDefaults.scales || {};\r\n        scales[id] = mergeIf(Object.create(null), [\r\n            {\r\n                axis\r\n            },\r\n            scaleConf,\r\n            defaultScaleOptions[axis],\r\n            defaultScaleOptions[defaultId]\r\n        ]);\r\n    });\r\n    config.data.datasets.forEach((dataset)=>{\r\n        const type = dataset.type || config.type;\r\n        const indexAxis = dataset.indexAxis || getIndexAxis(type, options);\r\n        const datasetDefaults = overrides[type] || {};\r\n        const defaultScaleOptions = datasetDefaults.scales || {};\r\n        Object.keys(defaultScaleOptions).forEach((defaultID)=>{\r\n            const axis = getAxisFromDefaultScaleID(defaultID, indexAxis);\r\n            const id = dataset[axis + 'AxisID'] || axis;\r\n            scales[id] = scales[id] || Object.create(null);\r\n            mergeIf(scales[id], [\r\n                {\r\n                    axis\r\n                },\r\n                configScales[id],\r\n                defaultScaleOptions[defaultID]\r\n            ]);\r\n        });\r\n    });\r\n    Object.keys(scales).forEach((key)=>{\r\n        const scale = scales[key];\r\n        mergeIf(scale, [\r\n            defaults.scales[scale.type],\r\n            defaults.scale\r\n        ]);\r\n    });\r\n    return scales;\r\n}\r\nfunction initOptions(config) {\r\n    const options = config.options || (config.options = {});\r\n    options.plugins = valueOrDefault(options.plugins, {});\r\n    options.scales = mergeScaleConfig(config, options);\r\n}\r\nfunction initData(data) {\r\n    data = data || {};\r\n    data.datasets = data.datasets || [];\r\n    data.labels = data.labels || [];\r\n    return data;\r\n}\r\nfunction initConfig(config) {\r\n    config = config || {};\r\n    config.data = initData(config.data);\r\n    initOptions(config);\r\n    return config;\r\n}\r\nconst keyCache = new Map();\r\nconst keysCached = new Set();\r\nfunction cachedKeys(cacheKey, generate) {\r\n    let keys = keyCache.get(cacheKey);\r\n    if (!keys) {\r\n        keys = generate();\r\n        keyCache.set(cacheKey, keys);\r\n        keysCached.add(keys);\r\n    }\r\n    return keys;\r\n}\r\nconst addIfFound = (set, obj, key)=>{\r\n    const opts = resolveObjectKey(obj, key);\r\n    if (opts !== undefined) {\r\n        set.add(opts);\r\n    }\r\n};\r\nclass Config {\r\n    constructor(config){\r\n        this._config = initConfig(config);\r\n        this._scopeCache = new Map();\r\n        this._resolverCache = new Map();\r\n    }\r\n    get platform() {\r\n        return this._config.platform;\r\n    }\r\n    get type() {\r\n        return this._config.type;\r\n    }\r\n    set type(type) {\r\n        this._config.type = type;\r\n    }\r\n    get data() {\r\n        return this._config.data;\r\n    }\r\n    set data(data) {\r\n        this._config.data = initData(data);\r\n    }\r\n    get options() {\r\n        return this._config.options;\r\n    }\r\n    set options(options) {\r\n        this._config.options = options;\r\n    }\r\n    get plugins() {\r\n        return this._config.plugins;\r\n    }\r\n    update() {\r\n        const config = this._config;\r\n        this.clearCache();\r\n        initOptions(config);\r\n    }\r\n    clearCache() {\r\n        this._scopeCache.clear();\r\n        this._resolverCache.clear();\r\n    }\r\n datasetScopeKeys(datasetType) {\r\n        return cachedKeys(datasetType, ()=>[\r\n                [\r\n                    `datasets.${datasetType}`,\r\n                    ''\r\n                ]\r\n            ]);\r\n    }\r\n datasetAnimationScopeKeys(datasetType, transition) {\r\n        return cachedKeys(`${datasetType}.transition.${transition}`, ()=>[\r\n                [\r\n                    `datasets.${datasetType}.transitions.${transition}`,\r\n                    `transitions.${transition}`\r\n                ],\r\n                [\r\n                    `datasets.${datasetType}`,\r\n                    ''\r\n                ]\r\n            ]);\r\n    }\r\n datasetElementScopeKeys(datasetType, elementType) {\r\n        return cachedKeys(`${datasetType}-${elementType}`, ()=>[\r\n                [\r\n                    `datasets.${datasetType}.elements.${elementType}`,\r\n                    `datasets.${datasetType}`,\r\n                    `elements.${elementType}`,\r\n                    ''\r\n                ]\r\n            ]);\r\n    }\r\n pluginScopeKeys(plugin) {\r\n        const id = plugin.id;\r\n        const type = this.type;\r\n        return cachedKeys(`${type}-plugin-${id}`, ()=>[\r\n                [\r\n                    `plugins.${id}`,\r\n                    ...plugin.additionalOptionScopes || []\r\n                ]\r\n            ]);\r\n    }\r\n _cachedScopes(mainScope, resetCache) {\r\n        const _scopeCache = this._scopeCache;\r\n        let cache = _scopeCache.get(mainScope);\r\n        if (!cache || resetCache) {\r\n            cache = new Map();\r\n            _scopeCache.set(mainScope, cache);\r\n        }\r\n        return cache;\r\n    }\r\n getOptionScopes(mainScope, keyLists, resetCache) {\r\n        const { options , type  } = this;\r\n        const cache = this._cachedScopes(mainScope, resetCache);\r\n        const cached = cache.get(keyLists);\r\n        if (cached) {\r\n            return cached;\r\n        }\r\n        const scopes = new Set();\r\n        keyLists.forEach((keys)=>{\r\n            if (mainScope) {\r\n                scopes.add(mainScope);\r\n                keys.forEach((key)=>addIfFound(scopes, mainScope, key));\r\n            }\r\n            keys.forEach((key)=>addIfFound(scopes, options, key));\r\n            keys.forEach((key)=>addIfFound(scopes, overrides[type] || {}, key));\r\n            keys.forEach((key)=>addIfFound(scopes, defaults, key));\r\n            keys.forEach((key)=>addIfFound(scopes, descriptors, key));\r\n        });\r\n        const array = Array.from(scopes);\r\n        if (array.length === 0) {\r\n            array.push(Object.create(null));\r\n        }\r\n        if (keysCached.has(keyLists)) {\r\n            cache.set(keyLists, array);\r\n        }\r\n        return array;\r\n    }\r\n chartOptionScopes() {\r\n        const { options , type  } = this;\r\n        return [\r\n            options,\r\n            overrides[type] || {},\r\n            defaults.datasets[type] || {},\r\n            {\r\n                type\r\n            },\r\n            defaults,\r\n            descriptors\r\n        ];\r\n    }\r\n resolveNamedOptions(scopes, names, context, prefixes = [\r\n        ''\r\n    ]) {\r\n        const result = {\r\n            $shared: true\r\n        };\r\n        const { resolver , subPrefixes  } = getResolver(this._resolverCache, scopes, prefixes);\r\n        let options = resolver;\r\n        if (needContext(resolver, names)) {\r\n            result.$shared = false;\r\n            context = isFunction(context) ? context() : context;\r\n            const subResolver = this.createResolver(scopes, context, subPrefixes);\r\n            options = _attachContext(resolver, context, subResolver);\r\n        }\r\n        for (const prop of names){\r\n            result[prop] = options[prop];\r\n        }\r\n        return result;\r\n    }\r\n createResolver(scopes, context, prefixes = [\r\n        ''\r\n    ], descriptorDefaults) {\r\n        const { resolver  } = getResolver(this._resolverCache, scopes, prefixes);\r\n        return isObject(context) ? _attachContext(resolver, context, undefined, descriptorDefaults) : resolver;\r\n    }\r\n}\r\nfunction getResolver(resolverCache, scopes, prefixes) {\r\n    let cache = resolverCache.get(scopes);\r\n    if (!cache) {\r\n        cache = new Map();\r\n        resolverCache.set(scopes, cache);\r\n    }\r\n    const cacheKey = prefixes.join();\r\n    let cached = cache.get(cacheKey);\r\n    if (!cached) {\r\n        const resolver = _createResolver(scopes, prefixes);\r\n        cached = {\r\n            resolver,\r\n            subPrefixes: prefixes.filter((p)=>!p.toLowerCase().includes('hover'))\r\n        };\r\n        cache.set(cacheKey, cached);\r\n    }\r\n    return cached;\r\n}\r\nconst hasFunction = (value)=>isObject(value) && Object.getOwnPropertyNames(value).some((key)=>isFunction(value[key]));\r\nfunction needContext(proxy, names) {\r\n    const { isScriptable , isIndexable  } = _descriptors(proxy);\r\n    for (const prop of names){\r\n        const scriptable = isScriptable(prop);\r\n        const indexable = isIndexable(prop);\r\n        const value = (indexable || scriptable) && proxy[prop];\r\n        if (scriptable && (isFunction(value) || hasFunction(value)) || indexable && isArray(value)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nvar version = \"4.5.0\";\r\n\r\nconst KNOWN_POSITIONS = [\r\n    'top',\r\n    'bottom',\r\n    'left',\r\n    'right',\r\n    'chartArea'\r\n];\r\nfunction positionIsHorizontal(position, axis) {\r\n    return position === 'top' || position === 'bottom' || KNOWN_POSITIONS.indexOf(position) === -1 && axis === 'x';\r\n}\r\nfunction compare2Level(l1, l2) {\r\n    return function(a, b) {\r\n        return a[l1] === b[l1] ? a[l2] - b[l2] : a[l1] - b[l1];\r\n    };\r\n}\r\nfunction onAnimationsComplete(context) {\r\n    const chart = context.chart;\r\n    const animationOptions = chart.options.animation;\r\n    chart.notifyPlugins('afterRender');\r\n    callback(animationOptions && animationOptions.onComplete, [\r\n        context\r\n    ], chart);\r\n}\r\nfunction onAnimationProgress(context) {\r\n    const chart = context.chart;\r\n    const animationOptions = chart.options.animation;\r\n    callback(animationOptions && animationOptions.onProgress, [\r\n        context\r\n    ], chart);\r\n}\r\n function getCanvas(item) {\r\n    if (_isDomSupported() && typeof item === 'string') {\r\n        item = document.getElementById(item);\r\n    } else if (item && item.length) {\r\n        item = item[0];\r\n    }\r\n    if (item && item.canvas) {\r\n        item = item.canvas;\r\n    }\r\n    return item;\r\n}\r\nconst instances = {};\r\nconst getChart = (key)=>{\r\n    const canvas = getCanvas(key);\r\n    return Object.values(instances).filter((c)=>c.canvas === canvas).pop();\r\n};\r\nfunction moveNumericKeys(obj, start, move) {\r\n    const keys = Object.keys(obj);\r\n    for (const key of keys){\r\n        const intKey = +key;\r\n        if (intKey >= start) {\r\n            const value = obj[key];\r\n            delete obj[key];\r\n            if (move > 0 || intKey > start) {\r\n                obj[intKey + move] = value;\r\n            }\r\n        }\r\n    }\r\n}\r\n function determineLastEvent(e, lastEvent, inChartArea, isClick) {\r\n    if (!inChartArea || e.type === 'mouseout') {\r\n        return null;\r\n    }\r\n    if (isClick) {\r\n        return lastEvent;\r\n    }\r\n    return e;\r\n}\r\nclass Chart {\r\n    static defaults = defaults;\r\n    static instances = instances;\r\n    static overrides = overrides;\r\n    static registry = registry;\r\n    static version = version;\r\n    static getChart = getChart;\r\n    static register(...items) {\r\n        registry.add(...items);\r\n        invalidatePlugins();\r\n    }\r\n    static unregister(...items) {\r\n        registry.remove(...items);\r\n        invalidatePlugins();\r\n    }\r\n    constructor(item, userConfig){\r\n        const config = this.config = new Config(userConfig);\r\n        const initialCanvas = getCanvas(item);\r\n        const existingChart = getChart(initialCanvas);\r\n        if (existingChart) {\r\n            throw new Error('Canvas is already in use. Chart with ID \\'' + existingChart.id + '\\'' + ' must be destroyed before the canvas with ID \\'' + existingChart.canvas.id + '\\' can be reused.');\r\n        }\r\n        const options = config.createResolver(config.chartOptionScopes(), this.getContext());\r\n        this.platform = new (config.platform || _detectPlatform(initialCanvas))();\r\n        this.platform.updateConfig(config);\r\n        const context = this.platform.acquireContext(initialCanvas, options.aspectRatio);\r\n        const canvas = context && context.canvas;\r\n        const height = canvas && canvas.height;\r\n        const width = canvas && canvas.width;\r\n        this.id = uid();\r\n        this.ctx = context;\r\n        this.canvas = canvas;\r\n        this.width = width;\r\n        this.height = height;\r\n        this._options = options;\r\n        this._aspectRatio = this.aspectRatio;\r\n        this._layers = [];\r\n        this._metasets = [];\r\n        this._stacks = undefined;\r\n        this.boxes = [];\r\n        this.currentDevicePixelRatio = undefined;\r\n        this.chartArea = undefined;\r\n        this._active = [];\r\n        this._lastEvent = undefined;\r\n        this._listeners = {};\r\n         this._responsiveListeners = undefined;\r\n        this._sortedMetasets = [];\r\n        this.scales = {};\r\n        this._plugins = new PluginService();\r\n        this.$proxies = {};\r\n        this._hiddenIndices = {};\r\n        this.attached = false;\r\n        this._animationsDisabled = undefined;\r\n        this.$context = undefined;\r\n        this._doResize = debounce((mode)=>this.update(mode), options.resizeDelay || 0);\r\n        this._dataChanges = [];\r\n        instances[this.id] = this;\r\n        if (!context || !canvas) {\r\n            console.error(\"Failed to create chart: can't acquire context from the given item\");\r\n            return;\r\n        }\r\n        animator.listen(this, 'complete', onAnimationsComplete);\r\n        animator.listen(this, 'progress', onAnimationProgress);\r\n        this._initialize();\r\n        if (this.attached) {\r\n            this.update();\r\n        }\r\n    }\r\n    get aspectRatio() {\r\n        const { options: { aspectRatio , maintainAspectRatio  } , width , height , _aspectRatio  } = this;\r\n        if (!isNullOrUndef(aspectRatio)) {\r\n            return aspectRatio;\r\n        }\r\n        if (maintainAspectRatio && _aspectRatio) {\r\n            return _aspectRatio;\r\n        }\r\n        return height ? width / height : null;\r\n    }\r\n    get data() {\r\n        return this.config.data;\r\n    }\r\n    set data(data) {\r\n        this.config.data = data;\r\n    }\r\n    get options() {\r\n        return this._options;\r\n    }\r\n    set options(options) {\r\n        this.config.options = options;\r\n    }\r\n    get registry() {\r\n        return registry;\r\n    }\r\n _initialize() {\r\n        this.notifyPlugins('beforeInit');\r\n        if (this.options.responsive) {\r\n            this.resize();\r\n        } else {\r\n            retinaScale(this, this.options.devicePixelRatio);\r\n        }\r\n        this.bindEvents();\r\n        this.notifyPlugins('afterInit');\r\n        return this;\r\n    }\r\n    clear() {\r\n        clearCanvas(this.canvas, this.ctx);\r\n        return this;\r\n    }\r\n    stop() {\r\n        animator.stop(this);\r\n        return this;\r\n    }\r\n resize(width, height) {\r\n        if (!animator.running(this)) {\r\n            this._resize(width, height);\r\n        } else {\r\n            this._resizeBeforeDraw = {\r\n                width,\r\n                height\r\n            };\r\n        }\r\n    }\r\n    _resize(width, height) {\r\n        const options = this.options;\r\n        const canvas = this.canvas;\r\n        const aspectRatio = options.maintainAspectRatio && this.aspectRatio;\r\n        const newSize = this.platform.getMaximumSize(canvas, width, height, aspectRatio);\r\n        const newRatio = options.devicePixelRatio || this.platform.getDevicePixelRatio();\r\n        const mode = this.width ? 'resize' : 'attach';\r\n        this.width = newSize.width;\r\n        this.height = newSize.height;\r\n        this._aspectRatio = this.aspectRatio;\r\n        if (!retinaScale(this, newRatio, true)) {\r\n            return;\r\n        }\r\n        this.notifyPlugins('resize', {\r\n            size: newSize\r\n        });\r\n        callback(options.onResize, [\r\n            this,\r\n            newSize\r\n        ], this);\r\n        if (this.attached) {\r\n            if (this._doResize(mode)) {\r\n                this.render();\r\n            }\r\n        }\r\n    }\r\n    ensureScalesHaveIDs() {\r\n        const options = this.options;\r\n        const scalesOptions = options.scales || {};\r\n        each(scalesOptions, (axisOptions, axisID)=>{\r\n            axisOptions.id = axisID;\r\n        });\r\n    }\r\n buildOrUpdateScales() {\r\n        const options = this.options;\r\n        const scaleOpts = options.scales;\r\n        const scales = this.scales;\r\n        const updated = Object.keys(scales).reduce((obj, id)=>{\r\n            obj[id] = false;\r\n            return obj;\r\n        }, {});\r\n        let items = [];\r\n        if (scaleOpts) {\r\n            items = items.concat(Object.keys(scaleOpts).map((id)=>{\r\n                const scaleOptions = scaleOpts[id];\r\n                const axis = determineAxis(id, scaleOptions);\r\n                const isRadial = axis === 'r';\r\n                const isHorizontal = axis === 'x';\r\n                return {\r\n                    options: scaleOptions,\r\n                    dposition: isRadial ? 'chartArea' : isHorizontal ? 'bottom' : 'left',\r\n                    dtype: isRadial ? 'radialLinear' : isHorizontal ? 'category' : 'linear'\r\n                };\r\n            }));\r\n        }\r\n        each(items, (item)=>{\r\n            const scaleOptions = item.options;\r\n            const id = scaleOptions.id;\r\n            const axis = determineAxis(id, scaleOptions);\r\n            const scaleType = valueOrDefault(scaleOptions.type, item.dtype);\r\n            if (scaleOptions.position === undefined || positionIsHorizontal(scaleOptions.position, axis) !== positionIsHorizontal(item.dposition)) {\r\n                scaleOptions.position = item.dposition;\r\n            }\r\n            updated[id] = true;\r\n            let scale = null;\r\n            if (id in scales && scales[id].type === scaleType) {\r\n                scale = scales[id];\r\n            } else {\r\n                const scaleClass = registry.getScale(scaleType);\r\n                scale = new scaleClass({\r\n                    id,\r\n                    type: scaleType,\r\n                    ctx: this.ctx,\r\n                    chart: this\r\n                });\r\n                scales[scale.id] = scale;\r\n            }\r\n            scale.init(scaleOptions, options);\r\n        });\r\n        each(updated, (hasUpdated, id)=>{\r\n            if (!hasUpdated) {\r\n                delete scales[id];\r\n            }\r\n        });\r\n        each(scales, (scale)=>{\r\n            layouts.configure(this, scale, scale.options);\r\n            layouts.addBox(this, scale);\r\n        });\r\n    }\r\n _updateMetasets() {\r\n        const metasets = this._metasets;\r\n        const numData = this.data.datasets.length;\r\n        const numMeta = metasets.length;\r\n        metasets.sort((a, b)=>a.index - b.index);\r\n        if (numMeta > numData) {\r\n            for(let i = numData; i < numMeta; ++i){\r\n                this._destroyDatasetMeta(i);\r\n            }\r\n            metasets.splice(numData, numMeta - numData);\r\n        }\r\n        this._sortedMetasets = metasets.slice(0).sort(compare2Level('order', 'index'));\r\n    }\r\n _removeUnreferencedMetasets() {\r\n        const { _metasets: metasets , data: { datasets  }  } = this;\r\n        if (metasets.length > datasets.length) {\r\n            delete this._stacks;\r\n        }\r\n        metasets.forEach((meta, index)=>{\r\n            if (datasets.filter((x)=>x === meta._dataset).length === 0) {\r\n                this._destroyDatasetMeta(index);\r\n            }\r\n        });\r\n    }\r\n    buildOrUpdateControllers() {\r\n        const newControllers = [];\r\n        const datasets = this.data.datasets;\r\n        let i, ilen;\r\n        this._removeUnreferencedMetasets();\r\n        for(i = 0, ilen = datasets.length; i < ilen; i++){\r\n            const dataset = datasets[i];\r\n            let meta = this.getDatasetMeta(i);\r\n            const type = dataset.type || this.config.type;\r\n            if (meta.type && meta.type !== type) {\r\n                this._destroyDatasetMeta(i);\r\n                meta = this.getDatasetMeta(i);\r\n            }\r\n            meta.type = type;\r\n            meta.indexAxis = dataset.indexAxis || getIndexAxis(type, this.options);\r\n            meta.order = dataset.order || 0;\r\n            meta.index = i;\r\n            meta.label = '' + dataset.label;\r\n            meta.visible = this.isDatasetVisible(i);\r\n            if (meta.controller) {\r\n                meta.controller.updateIndex(i);\r\n                meta.controller.linkScales();\r\n            } else {\r\n                const ControllerClass = registry.getController(type);\r\n                const { datasetElementType , dataElementType  } = defaults.datasets[type];\r\n                Object.assign(ControllerClass, {\r\n                    dataElementType: registry.getElement(dataElementType),\r\n                    datasetElementType: datasetElementType && registry.getElement(datasetElementType)\r\n                });\r\n                meta.controller = new ControllerClass(this, i);\r\n                newControllers.push(meta.controller);\r\n            }\r\n        }\r\n        this._updateMetasets();\r\n        return newControllers;\r\n    }\r\n _resetElements() {\r\n        each(this.data.datasets, (dataset, datasetIndex)=>{\r\n            this.getDatasetMeta(datasetIndex).controller.reset();\r\n        }, this);\r\n    }\r\n reset() {\r\n        this._resetElements();\r\n        this.notifyPlugins('reset');\r\n    }\r\n    update(mode) {\r\n        const config = this.config;\r\n        config.update();\r\n        const options = this._options = config.createResolver(config.chartOptionScopes(), this.getContext());\r\n        const animsDisabled = this._animationsDisabled = !options.animation;\r\n        this._updateScales();\r\n        this._checkEventBindings();\r\n        this._updateHiddenIndices();\r\n        this._plugins.invalidate();\r\n        if (this.notifyPlugins('beforeUpdate', {\r\n            mode,\r\n            cancelable: true\r\n        }) === false) {\r\n            return;\r\n        }\r\n        const newControllers = this.buildOrUpdateControllers();\r\n        this.notifyPlugins('beforeElementsUpdate');\r\n        let minPadding = 0;\r\n        for(let i = 0, ilen = this.data.datasets.length; i < ilen; i++){\r\n            const { controller  } = this.getDatasetMeta(i);\r\n            const reset = !animsDisabled && newControllers.indexOf(controller) === -1;\r\n            controller.buildOrUpdateElements(reset);\r\n            minPadding = Math.max(+controller.getMaxOverflow(), minPadding);\r\n        }\r\n        minPadding = this._minPadding = options.layout.autoPadding ? minPadding : 0;\r\n        this._updateLayout(minPadding);\r\n        if (!animsDisabled) {\r\n            each(newControllers, (controller)=>{\r\n                controller.reset();\r\n            });\r\n        }\r\n        this._updateDatasets(mode);\r\n        this.notifyPlugins('afterUpdate', {\r\n            mode\r\n        });\r\n        this._layers.sort(compare2Level('z', '_idx'));\r\n        const { _active , _lastEvent  } = this;\r\n        if (_lastEvent) {\r\n            this._eventHandler(_lastEvent, true);\r\n        } else if (_active.length) {\r\n            this._updateHoverStyles(_active, _active, true);\r\n        }\r\n        this.render();\r\n    }\r\n _updateScales() {\r\n        each(this.scales, (scale)=>{\r\n            layouts.removeBox(this, scale);\r\n        });\r\n        this.ensureScalesHaveIDs();\r\n        this.buildOrUpdateScales();\r\n    }\r\n _checkEventBindings() {\r\n        const options = this.options;\r\n        const existingEvents = new Set(Object.keys(this._listeners));\r\n        const newEvents = new Set(options.events);\r\n        if (!setsEqual(existingEvents, newEvents) || !!this._responsiveListeners !== options.responsive) {\r\n            this.unbindEvents();\r\n            this.bindEvents();\r\n        }\r\n    }\r\n _updateHiddenIndices() {\r\n        const { _hiddenIndices  } = this;\r\n        const changes = this._getUniformDataChanges() || [];\r\n        for (const { method , start , count  } of changes){\r\n            const move = method === '_removeElements' ? -count : count;\r\n            moveNumericKeys(_hiddenIndices, start, move);\r\n        }\r\n    }\r\n _getUniformDataChanges() {\r\n        const _dataChanges = this._dataChanges;\r\n        if (!_dataChanges || !_dataChanges.length) {\r\n            return;\r\n        }\r\n        this._dataChanges = [];\r\n        const datasetCount = this.data.datasets.length;\r\n        const makeSet = (idx)=>new Set(_dataChanges.filter((c)=>c[0] === idx).map((c, i)=>i + ',' + c.splice(1).join(',')));\r\n        const changeSet = makeSet(0);\r\n        for(let i = 1; i < datasetCount; i++){\r\n            if (!setsEqual(changeSet, makeSet(i))) {\r\n                return;\r\n            }\r\n        }\r\n        return Array.from(changeSet).map((c)=>c.split(',')).map((a)=>({\r\n                method: a[1],\r\n                start: +a[2],\r\n                count: +a[3]\r\n            }));\r\n    }\r\n _updateLayout(minPadding) {\r\n        if (this.notifyPlugins('beforeLayout', {\r\n            cancelable: true\r\n        }) === false) {\r\n            return;\r\n        }\r\n        layouts.update(this, this.width, this.height, minPadding);\r\n        const area = this.chartArea;\r\n        const noArea = area.width <= 0 || area.height <= 0;\r\n        this._layers = [];\r\n        each(this.boxes, (box)=>{\r\n            if (noArea && box.position === 'chartArea') {\r\n                return;\r\n            }\r\n            if (box.configure) {\r\n                box.configure();\r\n            }\r\n            this._layers.push(...box._layers());\r\n        }, this);\r\n        this._layers.forEach((item, index)=>{\r\n            item._idx = index;\r\n        });\r\n        this.notifyPlugins('afterLayout');\r\n    }\r\n _updateDatasets(mode) {\r\n        if (this.notifyPlugins('beforeDatasetsUpdate', {\r\n            mode,\r\n            cancelable: true\r\n        }) === false) {\r\n            return;\r\n        }\r\n        for(let i = 0, ilen = this.data.datasets.length; i < ilen; ++i){\r\n            this.getDatasetMeta(i).controller.configure();\r\n        }\r\n        for(let i = 0, ilen = this.data.datasets.length; i < ilen; ++i){\r\n            this._updateDataset(i, isFunction(mode) ? mode({\r\n                datasetIndex: i\r\n            }) : mode);\r\n        }\r\n        this.notifyPlugins('afterDatasetsUpdate', {\r\n            mode\r\n        });\r\n    }\r\n _updateDataset(index, mode) {\r\n        const meta = this.getDatasetMeta(index);\r\n        const args = {\r\n            meta,\r\n            index,\r\n            mode,\r\n            cancelable: true\r\n        };\r\n        if (this.notifyPlugins('beforeDatasetUpdate', args) === false) {\r\n            return;\r\n        }\r\n        meta.controller._update(mode);\r\n        args.cancelable = false;\r\n        this.notifyPlugins('afterDatasetUpdate', args);\r\n    }\r\n    render() {\r\n        if (this.notifyPlugins('beforeRender', {\r\n            cancelable: true\r\n        }) === false) {\r\n            return;\r\n        }\r\n        if (animator.has(this)) {\r\n            if (this.attached && !animator.running(this)) {\r\n                animator.start(this);\r\n            }\r\n        } else {\r\n            this.draw();\r\n            onAnimationsComplete({\r\n                chart: this\r\n            });\r\n        }\r\n    }\r\n    draw() {\r\n        let i;\r\n        if (this._resizeBeforeDraw) {\r\n            const { width , height  } = this._resizeBeforeDraw;\r\n            this._resizeBeforeDraw = null;\r\n            this._resize(width, height);\r\n        }\r\n        this.clear();\r\n        if (this.width <= 0 || this.height <= 0) {\r\n            return;\r\n        }\r\n        if (this.notifyPlugins('beforeDraw', {\r\n            cancelable: true\r\n        }) === false) {\r\n            return;\r\n        }\r\n        const layers = this._layers;\r\n        for(i = 0; i < layers.length && layers[i].z <= 0; ++i){\r\n            layers[i].draw(this.chartArea);\r\n        }\r\n        this._drawDatasets();\r\n        for(; i < layers.length; ++i){\r\n            layers[i].draw(this.chartArea);\r\n        }\r\n        this.notifyPlugins('afterDraw');\r\n    }\r\n _getSortedDatasetMetas(filterVisible) {\r\n        const metasets = this._sortedMetasets;\r\n        const result = [];\r\n        let i, ilen;\r\n        for(i = 0, ilen = metasets.length; i < ilen; ++i){\r\n            const meta = metasets[i];\r\n            if (!filterVisible || meta.visible) {\r\n                result.push(meta);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n getSortedVisibleDatasetMetas() {\r\n        return this._getSortedDatasetMetas(true);\r\n    }\r\n _drawDatasets() {\r\n        if (this.notifyPlugins('beforeDatasetsDraw', {\r\n            cancelable: true\r\n        }) === false) {\r\n            return;\r\n        }\r\n        const metasets = this.getSortedVisibleDatasetMetas();\r\n        for(let i = metasets.length - 1; i >= 0; --i){\r\n            this._drawDataset(metasets[i]);\r\n        }\r\n        this.notifyPlugins('afterDatasetsDraw');\r\n    }\r\n _drawDataset(meta) {\r\n        const ctx = this.ctx;\r\n        const args = {\r\n            meta,\r\n            index: meta.index,\r\n            cancelable: true\r\n        };\r\n        const clip = getDatasetClipArea(this, meta);\r\n        if (this.notifyPlugins('beforeDatasetDraw', args) === false) {\r\n            return;\r\n        }\r\n        if (clip) {\r\n            clipArea(ctx, clip);\r\n        }\r\n        meta.controller.draw();\r\n        if (clip) {\r\n            unclipArea(ctx);\r\n        }\r\n        args.cancelable = false;\r\n        this.notifyPlugins('afterDatasetDraw', args);\r\n    }\r\n isPointInArea(point) {\r\n        return _isPointInArea(point, this.chartArea, this._minPadding);\r\n    }\r\n    getElementsAtEventForMode(e, mode, options, useFinalPosition) {\r\n        const method = Interaction.modes[mode];\r\n        if (typeof method === 'function') {\r\n            return method(this, e, options, useFinalPosition);\r\n        }\r\n        return [];\r\n    }\r\n    getDatasetMeta(datasetIndex) {\r\n        const dataset = this.data.datasets[datasetIndex];\r\n        const metasets = this._metasets;\r\n        let meta = metasets.filter((x)=>x && x._dataset === dataset).pop();\r\n        if (!meta) {\r\n            meta = {\r\n                type: null,\r\n                data: [],\r\n                dataset: null,\r\n                controller: null,\r\n                hidden: null,\r\n                xAxisID: null,\r\n                yAxisID: null,\r\n                order: dataset && dataset.order || 0,\r\n                index: datasetIndex,\r\n                _dataset: dataset,\r\n                _parsed: [],\r\n                _sorted: false\r\n            };\r\n            metasets.push(meta);\r\n        }\r\n        return meta;\r\n    }\r\n    getContext() {\r\n        return this.$context || (this.$context = createContext(null, {\r\n            chart: this,\r\n            type: 'chart'\r\n        }));\r\n    }\r\n    getVisibleDatasetCount() {\r\n        return this.getSortedVisibleDatasetMetas().length;\r\n    }\r\n    isDatasetVisible(datasetIndex) {\r\n        const dataset = this.data.datasets[datasetIndex];\r\n        if (!dataset) {\r\n            return false;\r\n        }\r\n        const meta = this.getDatasetMeta(datasetIndex);\r\n        return typeof meta.hidden === 'boolean' ? !meta.hidden : !dataset.hidden;\r\n    }\r\n    setDatasetVisibility(datasetIndex, visible) {\r\n        const meta = this.getDatasetMeta(datasetIndex);\r\n        meta.hidden = !visible;\r\n    }\r\n    toggleDataVisibility(index) {\r\n        this._hiddenIndices[index] = !this._hiddenIndices[index];\r\n    }\r\n    getDataVisibility(index) {\r\n        return !this._hiddenIndices[index];\r\n    }\r\n _updateVisibility(datasetIndex, dataIndex, visible) {\r\n        const mode = visible ? 'show' : 'hide';\r\n        const meta = this.getDatasetMeta(datasetIndex);\r\n        const anims = meta.controller._resolveAnimations(undefined, mode);\r\n        if (defined(dataIndex)) {\r\n            meta.data[dataIndex].hidden = !visible;\r\n            this.update();\r\n        } else {\r\n            this.setDatasetVisibility(datasetIndex, visible);\r\n            anims.update(meta, {\r\n                visible\r\n            });\r\n            this.update((ctx)=>ctx.datasetIndex === datasetIndex ? mode : undefined);\r\n        }\r\n    }\r\n    hide(datasetIndex, dataIndex) {\r\n        this._updateVisibility(datasetIndex, dataIndex, false);\r\n    }\r\n    show(datasetIndex, dataIndex) {\r\n        this._updateVisibility(datasetIndex, dataIndex, true);\r\n    }\r\n _destroyDatasetMeta(datasetIndex) {\r\n        const meta = this._metasets[datasetIndex];\r\n        if (meta && meta.controller) {\r\n            meta.controller._destroy();\r\n        }\r\n        delete this._metasets[datasetIndex];\r\n    }\r\n    _stop() {\r\n        let i, ilen;\r\n        this.stop();\r\n        animator.remove(this);\r\n        for(i = 0, ilen = this.data.datasets.length; i < ilen; ++i){\r\n            this._destroyDatasetMeta(i);\r\n        }\r\n    }\r\n    destroy() {\r\n        this.notifyPlugins('beforeDestroy');\r\n        const { canvas , ctx  } = this;\r\n        this._stop();\r\n        this.config.clearCache();\r\n        if (canvas) {\r\n            this.unbindEvents();\r\n            clearCanvas(canvas, ctx);\r\n            this.platform.releaseContext(ctx);\r\n            this.canvas = null;\r\n            this.ctx = null;\r\n        }\r\n        delete instances[this.id];\r\n        this.notifyPlugins('afterDestroy');\r\n    }\r\n    toBase64Image(...args) {\r\n        return this.canvas.toDataURL(...args);\r\n    }\r\n bindEvents() {\r\n        this.bindUserEvents();\r\n        if (this.options.responsive) {\r\n            this.bindResponsiveEvents();\r\n        } else {\r\n            this.attached = true;\r\n        }\r\n    }\r\n bindUserEvents() {\r\n        const listeners = this._listeners;\r\n        const platform = this.platform;\r\n        const _add = (type, listener)=>{\r\n            platform.addEventListener(this, type, listener);\r\n            listeners[type] = listener;\r\n        };\r\n        const listener = (e, x, y)=>{\r\n            e.offsetX = x;\r\n            e.offsetY = y;\r\n            this._eventHandler(e);\r\n        };\r\n        each(this.options.events, (type)=>_add(type, listener));\r\n    }\r\n bindResponsiveEvents() {\r\n        if (!this._responsiveListeners) {\r\n            this._responsiveListeners = {};\r\n        }\r\n        const listeners = this._responsiveListeners;\r\n        const platform = this.platform;\r\n        const _add = (type, listener)=>{\r\n            platform.addEventListener(this, type, listener);\r\n            listeners[type] = listener;\r\n        };\r\n        const _remove = (type, listener)=>{\r\n            if (listeners[type]) {\r\n                platform.removeEventListener(this, type, listener);\r\n                delete listeners[type];\r\n            }\r\n        };\r\n        const listener = (width, height)=>{\r\n            if (this.canvas) {\r\n                this.resize(width, height);\r\n            }\r\n        };\r\n        let detached;\r\n        const attached = ()=>{\r\n            _remove('attach', attached);\r\n            this.attached = true;\r\n            this.resize();\r\n            _add('resize', listener);\r\n            _add('detach', detached);\r\n        };\r\n        detached = ()=>{\r\n            this.attached = false;\r\n            _remove('resize', listener);\r\n            this._stop();\r\n            this._resize(0, 0);\r\n            _add('attach', attached);\r\n        };\r\n        if (platform.isAttached(this.canvas)) {\r\n            attached();\r\n        } else {\r\n            detached();\r\n        }\r\n    }\r\n unbindEvents() {\r\n        each(this._listeners, (listener, type)=>{\r\n            this.platform.removeEventListener(this, type, listener);\r\n        });\r\n        this._listeners = {};\r\n        each(this._responsiveListeners, (listener, type)=>{\r\n            this.platform.removeEventListener(this, type, listener);\r\n        });\r\n        this._responsiveListeners = undefined;\r\n    }\r\n    updateHoverStyle(items, mode, enabled) {\r\n        const prefix = enabled ? 'set' : 'remove';\r\n        let meta, item, i, ilen;\r\n        if (mode === 'dataset') {\r\n            meta = this.getDatasetMeta(items[0].datasetIndex);\r\n            meta.controller['_' + prefix + 'DatasetHoverStyle']();\r\n        }\r\n        for(i = 0, ilen = items.length; i < ilen; ++i){\r\n            item = items[i];\r\n            const controller = item && this.getDatasetMeta(item.datasetIndex).controller;\r\n            if (controller) {\r\n                controller[prefix + 'HoverStyle'](item.element, item.datasetIndex, item.index);\r\n            }\r\n        }\r\n    }\r\n getActiveElements() {\r\n        return this._active || [];\r\n    }\r\n setActiveElements(activeElements) {\r\n        const lastActive = this._active || [];\r\n        const active = activeElements.map(({ datasetIndex , index  })=>{\r\n            const meta = this.getDatasetMeta(datasetIndex);\r\n            if (!meta) {\r\n                throw new Error('No dataset found at index ' + datasetIndex);\r\n            }\r\n            return {\r\n                datasetIndex,\r\n                element: meta.data[index],\r\n                index\r\n            };\r\n        });\r\n        const changed = !_elementsEqual(active, lastActive);\r\n        if (changed) {\r\n            this._active = active;\r\n            this._lastEvent = null;\r\n            this._updateHoverStyles(active, lastActive);\r\n        }\r\n    }\r\n notifyPlugins(hook, args, filter) {\r\n        return this._plugins.notify(this, hook, args, filter);\r\n    }\r\n isPluginEnabled(pluginId) {\r\n        return this._plugins._cache.filter((p)=>p.plugin.id === pluginId).length === 1;\r\n    }\r\n _updateHoverStyles(active, lastActive, replay) {\r\n        const hoverOptions = this.options.hover;\r\n        const diff = (a, b)=>a.filter((x)=>!b.some((y)=>x.datasetIndex === y.datasetIndex && x.index === y.index));\r\n        const deactivated = diff(lastActive, active);\r\n        const activated = replay ? active : diff(active, lastActive);\r\n        if (deactivated.length) {\r\n            this.updateHoverStyle(deactivated, hoverOptions.mode, false);\r\n        }\r\n        if (activated.length && hoverOptions.mode) {\r\n            this.updateHoverStyle(activated, hoverOptions.mode, true);\r\n        }\r\n    }\r\n _eventHandler(e, replay) {\r\n        const args = {\r\n            event: e,\r\n            replay,\r\n            cancelable: true,\r\n            inChartArea: this.isPointInArea(e)\r\n        };\r\n        const eventFilter = (plugin)=>(plugin.options.events || this.options.events).includes(e.native.type);\r\n        if (this.notifyPlugins('beforeEvent', args, eventFilter) === false) {\r\n            return;\r\n        }\r\n        const changed = this._handleEvent(e, replay, args.inChartArea);\r\n        args.cancelable = false;\r\n        this.notifyPlugins('afterEvent', args, eventFilter);\r\n        if (changed || args.changed) {\r\n            this.render();\r\n        }\r\n        return this;\r\n    }\r\n _handleEvent(e, replay, inChartArea) {\r\n        const { _active: lastActive = [] , options  } = this;\r\n        const useFinalPosition = replay;\r\n        const active = this._getActiveElements(e, lastActive, inChartArea, useFinalPosition);\r\n        const isClick = _isClickEvent(e);\r\n        const lastEvent = determineLastEvent(e, this._lastEvent, inChartArea, isClick);\r\n        if (inChartArea) {\r\n            this._lastEvent = null;\r\n            callback(options.onHover, [\r\n                e,\r\n                active,\r\n                this\r\n            ], this);\r\n            if (isClick) {\r\n                callback(options.onClick, [\r\n                    e,\r\n                    active,\r\n                    this\r\n                ], this);\r\n            }\r\n        }\r\n        const changed = !_elementsEqual(active, lastActive);\r\n        if (changed || replay) {\r\n            this._active = active;\r\n            this._updateHoverStyles(active, lastActive, replay);\r\n        }\r\n        this._lastEvent = lastEvent;\r\n        return changed;\r\n    }\r\n _getActiveElements(e, lastActive, inChartArea, useFinalPosition) {\r\n        if (e.type === 'mouseout') {\r\n            return [];\r\n        }\r\n        if (!inChartArea) {\r\n            return lastActive;\r\n        }\r\n        const hoverOptions = this.options.hover;\r\n        return this.getElementsAtEventForMode(e, hoverOptions.mode, hoverOptions, useFinalPosition);\r\n    }\r\n}\r\nfunction invalidatePlugins() {\r\n    return each(Chart.instances, (chart)=>chart._plugins.invalidate());\r\n}\r\n\r\nfunction clipSelf(ctx, element, endAngle) {\r\n    const { startAngle , x , y , outerRadius , innerRadius , options  } = element;\r\n    const { borderWidth , borderJoinStyle  } = options;\r\n    const outerAngleClip = Math.min(borderWidth / outerRadius, _normalizeAngle(startAngle - endAngle));\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, outerRadius - borderWidth / 2, startAngle + outerAngleClip / 2, endAngle - outerAngleClip / 2);\r\n    if (innerRadius > 0) {\r\n        const innerAngleClip = Math.min(borderWidth / innerRadius, _normalizeAngle(startAngle - endAngle));\r\n        ctx.arc(x, y, innerRadius + borderWidth / 2, endAngle - innerAngleClip / 2, startAngle + innerAngleClip / 2, true);\r\n    } else {\r\n        const clipWidth = Math.min(borderWidth / 2, outerRadius * _normalizeAngle(startAngle - endAngle));\r\n        if (borderJoinStyle === 'round') {\r\n            ctx.arc(x, y, clipWidth, endAngle - PI / 2, startAngle + PI / 2, true);\r\n        } else if (borderJoinStyle === 'bevel') {\r\n            const r = 2 * clipWidth * clipWidth;\r\n            const endX = -r * Math.cos(endAngle + PI / 2) + x;\r\n            const endY = -r * Math.sin(endAngle + PI / 2) + y;\r\n            const startX = r * Math.cos(startAngle + PI / 2) + x;\r\n            const startY = r * Math.sin(startAngle + PI / 2) + y;\r\n            ctx.lineTo(endX, endY);\r\n            ctx.lineTo(startX, startY);\r\n        }\r\n    }\r\n    ctx.closePath();\r\n    ctx.moveTo(0, 0);\r\n    ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n    ctx.clip('evenodd');\r\n}\r\nfunction clipArc(ctx, element, endAngle) {\r\n    const { startAngle , pixelMargin , x , y , outerRadius , innerRadius  } = element;\r\n    let angleMargin = pixelMargin / outerRadius;\r\n    // Draw an inner border by clipping the arc and drawing a double-width border\r\n    // Enlarge the clipping arc by 0.33 pixels to eliminate glitches between borders\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, outerRadius, startAngle - angleMargin, endAngle + angleMargin);\r\n    if (innerRadius > pixelMargin) {\r\n        angleMargin = pixelMargin / innerRadius;\r\n        ctx.arc(x, y, innerRadius, endAngle + angleMargin, startAngle - angleMargin, true);\r\n    } else {\r\n        ctx.arc(x, y, pixelMargin, endAngle + HALF_PI, startAngle - HALF_PI);\r\n    }\r\n    ctx.closePath();\r\n    ctx.clip();\r\n}\r\nfunction toRadiusCorners(value) {\r\n    return _readValueToProps(value, [\r\n        'outerStart',\r\n        'outerEnd',\r\n        'innerStart',\r\n        'innerEnd'\r\n    ]);\r\n}\r\n/**\r\n * Parse border radius from the provided options\r\n */ function parseBorderRadius$1(arc, innerRadius, outerRadius, angleDelta) {\r\n    const o = toRadiusCorners(arc.options.borderRadius);\r\n    const halfThickness = (outerRadius - innerRadius) / 2;\r\n    const innerLimit = Math.min(halfThickness, angleDelta * innerRadius / 2);\r\n    // Outer limits are complicated. We want to compute the available angular distance at\r\n    // a radius of outerRadius - borderRadius because for small angular distances, this term limits.\r\n    // We compute at r = outerRadius - borderRadius because this circle defines the center of the border corners.\r\n    //\r\n    // If the borderRadius is large, that value can become negative.\r\n    // This causes the outer borders to lose their radius entirely, which is rather unexpected. To solve that, if borderRadius > outerRadius\r\n    // we know that the thickness term will dominate and compute the limits at that point\r\n    const computeOuterLimit = (val)=>{\r\n        const outerArcLimit = (outerRadius - Math.min(halfThickness, val)) * angleDelta / 2;\r\n        return _limitValue(val, 0, Math.min(halfThickness, outerArcLimit));\r\n    };\r\n    return {\r\n        outerStart: computeOuterLimit(o.outerStart),\r\n        outerEnd: computeOuterLimit(o.outerEnd),\r\n        innerStart: _limitValue(o.innerStart, 0, innerLimit),\r\n        innerEnd: _limitValue(o.innerEnd, 0, innerLimit)\r\n    };\r\n}\r\n/**\r\n * Convert (r, 𝜃) to (x, y)\r\n */ function rThetaToXY(r, theta, x, y) {\r\n    return {\r\n        x: x + r * Math.cos(theta),\r\n        y: y + r * Math.sin(theta)\r\n    };\r\n}\r\n/**\r\n * Path the arc, respecting border radius by separating into left and right halves.\r\n *\r\n *   Start      End\r\n *\r\n *    1--->a--->2    Outer\r\n *   /           \\\r\n *   8           3\r\n *   |           |\r\n *   |           |\r\n *   7           4\r\n *   \\           /\r\n *    6<---b<---5    Inner\r\n */ function pathArc(ctx, element, offset, spacing, end, circular) {\r\n    const { x , y , startAngle: start , pixelMargin , innerRadius: innerR  } = element;\r\n    const outerRadius = Math.max(element.outerRadius + spacing + offset - pixelMargin, 0);\r\n    const innerRadius = innerR > 0 ? innerR + spacing + offset + pixelMargin : 0;\r\n    let spacingOffset = 0;\r\n    const alpha = end - start;\r\n    if (spacing) {\r\n        // When spacing is present, it is the same for all items\r\n        // So we adjust the start and end angle of the arc such that\r\n        // the distance is the same as it would be without the spacing\r\n        const noSpacingInnerRadius = innerR > 0 ? innerR - spacing : 0;\r\n        const noSpacingOuterRadius = outerRadius > 0 ? outerRadius - spacing : 0;\r\n        const avNogSpacingRadius = (noSpacingInnerRadius + noSpacingOuterRadius) / 2;\r\n        const adjustedAngle = avNogSpacingRadius !== 0 ? alpha * avNogSpacingRadius / (avNogSpacingRadius + spacing) : alpha;\r\n        spacingOffset = (alpha - adjustedAngle) / 2;\r\n    }\r\n    const beta = Math.max(0.001, alpha * outerRadius - offset / PI) / outerRadius;\r\n    const angleOffset = (alpha - beta) / 2;\r\n    const startAngle = start + angleOffset + spacingOffset;\r\n    const endAngle = end - angleOffset - spacingOffset;\r\n    const { outerStart , outerEnd , innerStart , innerEnd  } = parseBorderRadius$1(element, innerRadius, outerRadius, endAngle - startAngle);\r\n    const outerStartAdjustedRadius = outerRadius - outerStart;\r\n    const outerEndAdjustedRadius = outerRadius - outerEnd;\r\n    const outerStartAdjustedAngle = startAngle + outerStart / outerStartAdjustedRadius;\r\n    const outerEndAdjustedAngle = endAngle - outerEnd / outerEndAdjustedRadius;\r\n    const innerStartAdjustedRadius = innerRadius + innerStart;\r\n    const innerEndAdjustedRadius = innerRadius + innerEnd;\r\n    const innerStartAdjustedAngle = startAngle + innerStart / innerStartAdjustedRadius;\r\n    const innerEndAdjustedAngle = endAngle - innerEnd / innerEndAdjustedRadius;\r\n    ctx.beginPath();\r\n    if (circular) {\r\n        // The first arc segments from point 1 to point a to point 2\r\n        const outerMidAdjustedAngle = (outerStartAdjustedAngle + outerEndAdjustedAngle) / 2;\r\n        ctx.arc(x, y, outerRadius, outerStartAdjustedAngle, outerMidAdjustedAngle);\r\n        ctx.arc(x, y, outerRadius, outerMidAdjustedAngle, outerEndAdjustedAngle);\r\n        // The corner segment from point 2 to point 3\r\n        if (outerEnd > 0) {\r\n            const pCenter = rThetaToXY(outerEndAdjustedRadius, outerEndAdjustedAngle, x, y);\r\n            ctx.arc(pCenter.x, pCenter.y, outerEnd, outerEndAdjustedAngle, endAngle + HALF_PI);\r\n        }\r\n        // The line from point 3 to point 4\r\n        const p4 = rThetaToXY(innerEndAdjustedRadius, endAngle, x, y);\r\n        ctx.lineTo(p4.x, p4.y);\r\n        // The corner segment from point 4 to point 5\r\n        if (innerEnd > 0) {\r\n            const pCenter = rThetaToXY(innerEndAdjustedRadius, innerEndAdjustedAngle, x, y);\r\n            ctx.arc(pCenter.x, pCenter.y, innerEnd, endAngle + HALF_PI, innerEndAdjustedAngle + Math.PI);\r\n        }\r\n        // The inner arc from point 5 to point b to point 6\r\n        const innerMidAdjustedAngle = (endAngle - innerEnd / innerRadius + (startAngle + innerStart / innerRadius)) / 2;\r\n        ctx.arc(x, y, innerRadius, endAngle - innerEnd / innerRadius, innerMidAdjustedAngle, true);\r\n        ctx.arc(x, y, innerRadius, innerMidAdjustedAngle, startAngle + innerStart / innerRadius, true);\r\n        // The corner segment from point 6 to point 7\r\n        if (innerStart > 0) {\r\n            const pCenter = rThetaToXY(innerStartAdjustedRadius, innerStartAdjustedAngle, x, y);\r\n            ctx.arc(pCenter.x, pCenter.y, innerStart, innerStartAdjustedAngle + Math.PI, startAngle - HALF_PI);\r\n        }\r\n        // The line from point 7 to point 8\r\n        const p8 = rThetaToXY(outerStartAdjustedRadius, startAngle, x, y);\r\n        ctx.lineTo(p8.x, p8.y);\r\n        // The corner segment from point 8 to point 1\r\n        if (outerStart > 0) {\r\n            const pCenter = rThetaToXY(outerStartAdjustedRadius, outerStartAdjustedAngle, x, y);\r\n            ctx.arc(pCenter.x, pCenter.y, outerStart, startAngle - HALF_PI, outerStartAdjustedAngle);\r\n        }\r\n    } else {\r\n        ctx.moveTo(x, y);\r\n        const outerStartX = Math.cos(outerStartAdjustedAngle) * outerRadius + x;\r\n        const outerStartY = Math.sin(outerStartAdjustedAngle) * outerRadius + y;\r\n        ctx.lineTo(outerStartX, outerStartY);\r\n        const outerEndX = Math.cos(outerEndAdjustedAngle) * outerRadius + x;\r\n        const outerEndY = Math.sin(outerEndAdjustedAngle) * outerRadius + y;\r\n        ctx.lineTo(outerEndX, outerEndY);\r\n    }\r\n    ctx.closePath();\r\n}\r\nfunction drawArc(ctx, element, offset, spacing, circular) {\r\n    const { fullCircles , startAngle , circumference  } = element;\r\n    let endAngle = element.endAngle;\r\n    if (fullCircles) {\r\n        pathArc(ctx, element, offset, spacing, endAngle, circular);\r\n        for(let i = 0; i < fullCircles; ++i){\r\n            ctx.fill();\r\n        }\r\n        if (!isNaN(circumference)) {\r\n            endAngle = startAngle + (circumference % TAU || TAU);\r\n        }\r\n    }\r\n    pathArc(ctx, element, offset, spacing, endAngle, circular);\r\n    ctx.fill();\r\n    return endAngle;\r\n}\r\nfunction drawBorder(ctx, element, offset, spacing, circular) {\r\n    const { fullCircles , startAngle , circumference , options  } = element;\r\n    const { borderWidth , borderJoinStyle , borderDash , borderDashOffset , borderRadius  } = options;\r\n    const inner = options.borderAlign === 'inner';\r\n    if (!borderWidth) {\r\n        return;\r\n    }\r\n    ctx.setLineDash(borderDash || []);\r\n    ctx.lineDashOffset = borderDashOffset;\r\n    if (inner) {\r\n        ctx.lineWidth = borderWidth * 2;\r\n        ctx.lineJoin = borderJoinStyle || 'round';\r\n    } else {\r\n        ctx.lineWidth = borderWidth;\r\n        ctx.lineJoin = borderJoinStyle || 'bevel';\r\n    }\r\n    let endAngle = element.endAngle;\r\n    if (fullCircles) {\r\n        pathArc(ctx, element, offset, spacing, endAngle, circular);\r\n        for(let i = 0; i < fullCircles; ++i){\r\n            ctx.stroke();\r\n        }\r\n        if (!isNaN(circumference)) {\r\n            endAngle = startAngle + (circumference % TAU || TAU);\r\n        }\r\n    }\r\n    if (inner) {\r\n        clipArc(ctx, element, endAngle);\r\n    }\r\n    if (options.selfJoin && endAngle - startAngle >= PI && borderRadius === 0 && borderJoinStyle !== 'miter') {\r\n        clipSelf(ctx, element, endAngle);\r\n    }\r\n    if (!fullCircles) {\r\n        pathArc(ctx, element, offset, spacing, endAngle, circular);\r\n        ctx.stroke();\r\n    }\r\n}\r\nclass ArcElement extends Element {\r\n    static id = 'arc';\r\n    static defaults = {\r\n        borderAlign: 'center',\r\n        borderColor: '#fff',\r\n        borderDash: [],\r\n        borderDashOffset: 0,\r\n        borderJoinStyle: undefined,\r\n        borderRadius: 0,\r\n        borderWidth: 2,\r\n        offset: 0,\r\n        spacing: 0,\r\n        angle: undefined,\r\n        circular: true,\r\n        selfJoin: false\r\n    };\r\n    static defaultRoutes = {\r\n        backgroundColor: 'backgroundColor'\r\n    };\r\n    static descriptors = {\r\n        _scriptable: true,\r\n        _indexable: (name)=>name !== 'borderDash'\r\n    };\r\n    circumference;\r\n    endAngle;\r\n    fullCircles;\r\n    innerRadius;\r\n    outerRadius;\r\n    pixelMargin;\r\n    startAngle;\r\n    constructor(cfg){\r\n        super();\r\n        this.options = undefined;\r\n        this.circumference = undefined;\r\n        this.startAngle = undefined;\r\n        this.endAngle = undefined;\r\n        this.innerRadius = undefined;\r\n        this.outerRadius = undefined;\r\n        this.pixelMargin = 0;\r\n        this.fullCircles = 0;\r\n        if (cfg) {\r\n            Object.assign(this, cfg);\r\n        }\r\n    }\r\n    inRange(chartX, chartY, useFinalPosition) {\r\n        const point = this.getProps([\r\n            'x',\r\n            'y'\r\n        ], useFinalPosition);\r\n        const { angle , distance  } = getAngleFromPoint(point, {\r\n            x: chartX,\r\n            y: chartY\r\n        });\r\n        const { startAngle , endAngle , innerRadius , outerRadius , circumference  } = this.getProps([\r\n            'startAngle',\r\n            'endAngle',\r\n            'innerRadius',\r\n            'outerRadius',\r\n            'circumference'\r\n        ], useFinalPosition);\r\n        const rAdjust = (this.options.spacing + this.options.borderWidth) / 2;\r\n        const _circumference = valueOrDefault(circumference, endAngle - startAngle);\r\n        const nonZeroBetween = _angleBetween(angle, startAngle, endAngle) && startAngle !== endAngle;\r\n        const betweenAngles = _circumference >= TAU || nonZeroBetween;\r\n        const withinRadius = _isBetween(distance, innerRadius + rAdjust, outerRadius + rAdjust);\r\n        return betweenAngles && withinRadius;\r\n    }\r\n    getCenterPoint(useFinalPosition) {\r\n        const { x , y , startAngle , endAngle , innerRadius , outerRadius  } = this.getProps([\r\n            'x',\r\n            'y',\r\n            'startAngle',\r\n            'endAngle',\r\n            'innerRadius',\r\n            'outerRadius'\r\n        ], useFinalPosition);\r\n        const { offset , spacing  } = this.options;\r\n        const halfAngle = (startAngle + endAngle) / 2;\r\n        const halfRadius = (innerRadius + outerRadius + spacing + offset) / 2;\r\n        return {\r\n            x: x + Math.cos(halfAngle) * halfRadius,\r\n            y: y + Math.sin(halfAngle) * halfRadius\r\n        };\r\n    }\r\n    tooltipPosition(useFinalPosition) {\r\n        return this.getCenterPoint(useFinalPosition);\r\n    }\r\n    draw(ctx) {\r\n        const { options , circumference  } = this;\r\n        const offset = (options.offset || 0) / 4;\r\n        const spacing = (options.spacing || 0) / 2;\r\n        const circular = options.circular;\r\n        this.pixelMargin = options.borderAlign === 'inner' ? 0.33 : 0;\r\n        this.fullCircles = circumference > TAU ? Math.floor(circumference / TAU) : 0;\r\n        if (circumference === 0 || this.innerRadius < 0 || this.outerRadius < 0) {\r\n            return;\r\n        }\r\n        ctx.save();\r\n        const halfAngle = (this.startAngle + this.endAngle) / 2;\r\n        ctx.translate(Math.cos(halfAngle) * offset, Math.sin(halfAngle) * offset);\r\n        const fix = 1 - Math.sin(Math.min(PI, circumference || 0));\r\n        const radiusOffset = offset * fix;\r\n        ctx.fillStyle = options.backgroundColor;\r\n        ctx.strokeStyle = options.borderColor;\r\n        drawArc(ctx, this, radiusOffset, spacing, circular);\r\n        drawBorder(ctx, this, radiusOffset, spacing, circular);\r\n        ctx.restore();\r\n    }\r\n}\r\n\r\nfunction setStyle(ctx, options, style = options) {\r\n    ctx.lineCap = valueOrDefault(style.borderCapStyle, options.borderCapStyle);\r\n    ctx.setLineDash(valueOrDefault(style.borderDash, options.borderDash));\r\n    ctx.lineDashOffset = valueOrDefault(style.borderDashOffset, options.borderDashOffset);\r\n    ctx.lineJoin = valueOrDefault(style.borderJoinStyle, options.borderJoinStyle);\r\n    ctx.lineWidth = valueOrDefault(style.borderWidth, options.borderWidth);\r\n    ctx.strokeStyle = valueOrDefault(style.borderColor, options.borderColor);\r\n}\r\nfunction lineTo(ctx, previous, target) {\r\n    ctx.lineTo(target.x, target.y);\r\n}\r\n function getLineMethod(options) {\r\n    if (options.stepped) {\r\n        return _steppedLineTo;\r\n    }\r\n    if (options.tension || options.cubicInterpolationMode === 'monotone') {\r\n        return _bezierCurveTo;\r\n    }\r\n    return lineTo;\r\n}\r\nfunction pathVars(points, segment, params = {}) {\r\n    const count = points.length;\r\n    const { start: paramsStart = 0 , end: paramsEnd = count - 1  } = params;\r\n    const { start: segmentStart , end: segmentEnd  } = segment;\r\n    const start = Math.max(paramsStart, segmentStart);\r\n    const end = Math.min(paramsEnd, segmentEnd);\r\n    const outside = paramsStart < segmentStart && paramsEnd < segmentStart || paramsStart > segmentEnd && paramsEnd > segmentEnd;\r\n    return {\r\n        count,\r\n        start,\r\n        loop: segment.loop,\r\n        ilen: end < start && !outside ? count + end - start : end - start\r\n    };\r\n}\r\n function pathSegment(ctx, line, segment, params) {\r\n    const { points , options  } = line;\r\n    const { count , start , loop , ilen  } = pathVars(points, segment, params);\r\n    const lineMethod = getLineMethod(options);\r\n    let { move =true , reverse  } = params || {};\r\n    let i, point, prev;\r\n    for(i = 0; i <= ilen; ++i){\r\n        point = points[(start + (reverse ? ilen - i : i)) % count];\r\n        if (point.skip) {\r\n            continue;\r\n        } else if (move) {\r\n            ctx.moveTo(point.x, point.y);\r\n            move = false;\r\n        } else {\r\n            lineMethod(ctx, prev, point, reverse, options.stepped);\r\n        }\r\n        prev = point;\r\n    }\r\n    if (loop) {\r\n        point = points[(start + (reverse ? ilen : 0)) % count];\r\n        lineMethod(ctx, prev, point, reverse, options.stepped);\r\n    }\r\n    return !!loop;\r\n}\r\n function fastPathSegment(ctx, line, segment, params) {\r\n    const points = line.points;\r\n    const { count , start , ilen  } = pathVars(points, segment, params);\r\n    const { move =true , reverse  } = params || {};\r\n    let avgX = 0;\r\n    let countX = 0;\r\n    let i, point, prevX, minY, maxY, lastY;\r\n    const pointIndex = (index)=>(start + (reverse ? ilen - index : index)) % count;\r\n    const drawX = ()=>{\r\n        if (minY !== maxY) {\r\n            ctx.lineTo(avgX, maxY);\r\n            ctx.lineTo(avgX, minY);\r\n            ctx.lineTo(avgX, lastY);\r\n        }\r\n    };\r\n    if (move) {\r\n        point = points[pointIndex(0)];\r\n        ctx.moveTo(point.x, point.y);\r\n    }\r\n    for(i = 0; i <= ilen; ++i){\r\n        point = points[pointIndex(i)];\r\n        if (point.skip) {\r\n            continue;\r\n        }\r\n        const x = point.x;\r\n        const y = point.y;\r\n        const truncX = x | 0;\r\n        if (truncX === prevX) {\r\n            if (y < minY) {\r\n                minY = y;\r\n            } else if (y > maxY) {\r\n                maxY = y;\r\n            }\r\n            avgX = (countX * avgX + x) / ++countX;\r\n        } else {\r\n            drawX();\r\n            ctx.lineTo(x, y);\r\n            prevX = truncX;\r\n            countX = 0;\r\n            minY = maxY = y;\r\n        }\r\n        lastY = y;\r\n    }\r\n    drawX();\r\n}\r\n function _getSegmentMethod(line) {\r\n    const opts = line.options;\r\n    const borderDash = opts.borderDash && opts.borderDash.length;\r\n    const useFastPath = !line._decimated && !line._loop && !opts.tension && opts.cubicInterpolationMode !== 'monotone' && !opts.stepped && !borderDash;\r\n    return useFastPath ? fastPathSegment : pathSegment;\r\n}\r\n function _getInterpolationMethod(options) {\r\n    if (options.stepped) {\r\n        return _steppedInterpolation;\r\n    }\r\n    if (options.tension || options.cubicInterpolationMode === 'monotone') {\r\n        return _bezierInterpolation;\r\n    }\r\n    return _pointInLine;\r\n}\r\nfunction strokePathWithCache(ctx, line, start, count) {\r\n    let path = line._path;\r\n    if (!path) {\r\n        path = line._path = new Path2D();\r\n        if (line.path(path, start, count)) {\r\n            path.closePath();\r\n        }\r\n    }\r\n    setStyle(ctx, line.options);\r\n    ctx.stroke(path);\r\n}\r\nfunction strokePathDirect(ctx, line, start, count) {\r\n    const { segments , options  } = line;\r\n    const segmentMethod = _getSegmentMethod(line);\r\n    for (const segment of segments){\r\n        setStyle(ctx, options, segment.style);\r\n        ctx.beginPath();\r\n        if (segmentMethod(ctx, line, segment, {\r\n            start,\r\n            end: start + count - 1\r\n        })) {\r\n            ctx.closePath();\r\n        }\r\n        ctx.stroke();\r\n    }\r\n}\r\nconst usePath2D = typeof Path2D === 'function';\r\nfunction draw(ctx, line, start, count) {\r\n    if (usePath2D && !line.options.segment) {\r\n        strokePathWithCache(ctx, line, start, count);\r\n    } else {\r\n        strokePathDirect(ctx, line, start, count);\r\n    }\r\n}\r\nclass LineElement extends Element {\r\n    static id = 'line';\r\n static defaults = {\r\n        borderCapStyle: 'butt',\r\n        borderDash: [],\r\n        borderDashOffset: 0,\r\n        borderJoinStyle: 'miter',\r\n        borderWidth: 3,\r\n        capBezierPoints: true,\r\n        cubicInterpolationMode: 'default',\r\n        fill: false,\r\n        spanGaps: false,\r\n        stepped: false,\r\n        tension: 0\r\n    };\r\n static defaultRoutes = {\r\n        backgroundColor: 'backgroundColor',\r\n        borderColor: 'borderColor'\r\n    };\r\n    static descriptors = {\r\n        _scriptable: true,\r\n        _indexable: (name)=>name !== 'borderDash' && name !== 'fill'\r\n    };\r\n    constructor(cfg){\r\n        super();\r\n        this.animated = true;\r\n        this.options = undefined;\r\n        this._chart = undefined;\r\n        this._loop = undefined;\r\n        this._fullLoop = undefined;\r\n        this._path = undefined;\r\n        this._points = undefined;\r\n        this._segments = undefined;\r\n        this._decimated = false;\r\n        this._pointsUpdated = false;\r\n        this._datasetIndex = undefined;\r\n        if (cfg) {\r\n            Object.assign(this, cfg);\r\n        }\r\n    }\r\n    updateControlPoints(chartArea, indexAxis) {\r\n        const options = this.options;\r\n        if ((options.tension || options.cubicInterpolationMode === 'monotone') && !options.stepped && !this._pointsUpdated) {\r\n            const loop = options.spanGaps ? this._loop : this._fullLoop;\r\n            _updateBezierControlPoints(this._points, options, chartArea, loop, indexAxis);\r\n            this._pointsUpdated = true;\r\n        }\r\n    }\r\n    set points(points) {\r\n        this._points = points;\r\n        delete this._segments;\r\n        delete this._path;\r\n        this._pointsUpdated = false;\r\n    }\r\n    get points() {\r\n        return this._points;\r\n    }\r\n    get segments() {\r\n        return this._segments || (this._segments = _computeSegments(this, this.options.segment));\r\n    }\r\n first() {\r\n        const segments = this.segments;\r\n        const points = this.points;\r\n        return segments.length && points[segments[0].start];\r\n    }\r\n last() {\r\n        const segments = this.segments;\r\n        const points = this.points;\r\n        const count = segments.length;\r\n        return count && points[segments[count - 1].end];\r\n    }\r\n interpolate(point, property) {\r\n        const options = this.options;\r\n        const value = point[property];\r\n        const points = this.points;\r\n        const segments = _boundSegments(this, {\r\n            property,\r\n            start: value,\r\n            end: value\r\n        });\r\n        if (!segments.length) {\r\n            return;\r\n        }\r\n        const result = [];\r\n        const _interpolate = _getInterpolationMethod(options);\r\n        let i, ilen;\r\n        for(i = 0, ilen = segments.length; i < ilen; ++i){\r\n            const { start , end  } = segments[i];\r\n            const p1 = points[start];\r\n            const p2 = points[end];\r\n            if (p1 === p2) {\r\n                result.push(p1);\r\n                continue;\r\n            }\r\n            const t = Math.abs((value - p1[property]) / (p2[property] - p1[property]));\r\n            const interpolated = _interpolate(p1, p2, t, options.stepped);\r\n            interpolated[property] = point[property];\r\n            result.push(interpolated);\r\n        }\r\n        return result.length === 1 ? result[0] : result;\r\n    }\r\n pathSegment(ctx, segment, params) {\r\n        const segmentMethod = _getSegmentMethod(this);\r\n        return segmentMethod(ctx, this, segment, params);\r\n    }\r\n path(ctx, start, count) {\r\n        const segments = this.segments;\r\n        const segmentMethod = _getSegmentMethod(this);\r\n        let loop = this._loop;\r\n        start = start || 0;\r\n        count = count || this.points.length - start;\r\n        for (const segment of segments){\r\n            loop &= segmentMethod(ctx, this, segment, {\r\n                start,\r\n                end: start + count - 1\r\n            });\r\n        }\r\n        return !!loop;\r\n    }\r\n draw(ctx, chartArea, start, count) {\r\n        const options = this.options || {};\r\n        const points = this.points || [];\r\n        if (points.length && options.borderWidth) {\r\n            ctx.save();\r\n            draw(ctx, this, start, count);\r\n            ctx.restore();\r\n        }\r\n        if (this.animated) {\r\n            this._pointsUpdated = false;\r\n            this._path = undefined;\r\n        }\r\n    }\r\n}\r\n\r\nfunction inRange$1(el, pos, axis, useFinalPosition) {\r\n    const options = el.options;\r\n    const { [axis]: value  } = el.getProps([\r\n        axis\r\n    ], useFinalPosition);\r\n    return Math.abs(pos - value) < options.radius + options.hitRadius;\r\n}\r\nclass PointElement extends Element {\r\n    static id = 'point';\r\n    parsed;\r\n    skip;\r\n    stop;\r\n    /**\r\n   * @type {any}\r\n   */ static defaults = {\r\n        borderWidth: 1,\r\n        hitRadius: 1,\r\n        hoverBorderWidth: 1,\r\n        hoverRadius: 4,\r\n        pointStyle: 'circle',\r\n        radius: 3,\r\n        rotation: 0\r\n    };\r\n    /**\r\n   * @type {any}\r\n   */ static defaultRoutes = {\r\n        backgroundColor: 'backgroundColor',\r\n        borderColor: 'borderColor'\r\n    };\r\n    constructor(cfg){\r\n        super();\r\n        this.options = undefined;\r\n        this.parsed = undefined;\r\n        this.skip = undefined;\r\n        this.stop = undefined;\r\n        if (cfg) {\r\n            Object.assign(this, cfg);\r\n        }\r\n    }\r\n    inRange(mouseX, mouseY, useFinalPosition) {\r\n        const options = this.options;\r\n        const { x , y  } = this.getProps([\r\n            'x',\r\n            'y'\r\n        ], useFinalPosition);\r\n        return Math.pow(mouseX - x, 2) + Math.pow(mouseY - y, 2) < Math.pow(options.hitRadius + options.radius, 2);\r\n    }\r\n    inXRange(mouseX, useFinalPosition) {\r\n        return inRange$1(this, mouseX, 'x', useFinalPosition);\r\n    }\r\n    inYRange(mouseY, useFinalPosition) {\r\n        return inRange$1(this, mouseY, 'y', useFinalPosition);\r\n    }\r\n    getCenterPoint(useFinalPosition) {\r\n        const { x , y  } = this.getProps([\r\n            'x',\r\n            'y'\r\n        ], useFinalPosition);\r\n        return {\r\n            x,\r\n            y\r\n        };\r\n    }\r\n    size(options) {\r\n        options = options || this.options || {};\r\n        let radius = options.radius || 0;\r\n        radius = Math.max(radius, radius && options.hoverRadius || 0);\r\n        const borderWidth = radius && options.borderWidth || 0;\r\n        return (radius + borderWidth) * 2;\r\n    }\r\n    draw(ctx, area) {\r\n        const options = this.options;\r\n        if (this.skip || options.radius < 0.1 || !_isPointInArea(this, area, this.size(options) / 2)) {\r\n            return;\r\n        }\r\n        ctx.strokeStyle = options.borderColor;\r\n        ctx.lineWidth = options.borderWidth;\r\n        ctx.fillStyle = options.backgroundColor;\r\n        drawPoint(ctx, options, this.x, this.y);\r\n    }\r\n    getRange() {\r\n        const options = this.options || {};\r\n        // @ts-expect-error Fallbacks should never be hit in practice\r\n        return options.radius + options.hitRadius;\r\n    }\r\n}\r\n\r\nfunction getBarBounds(bar, useFinalPosition) {\r\n    const { x , y , base , width , height  } =  bar.getProps([\r\n        'x',\r\n        'y',\r\n        'base',\r\n        'width',\r\n        'height'\r\n    ], useFinalPosition);\r\n    let left, right, top, bottom, half;\r\n    if (bar.horizontal) {\r\n        half = height / 2;\r\n        left = Math.min(x, base);\r\n        right = Math.max(x, base);\r\n        top = y - half;\r\n        bottom = y + half;\r\n    } else {\r\n        half = width / 2;\r\n        left = x - half;\r\n        right = x + half;\r\n        top = Math.min(y, base);\r\n        bottom = Math.max(y, base);\r\n    }\r\n    return {\r\n        left,\r\n        top,\r\n        right,\r\n        bottom\r\n    };\r\n}\r\nfunction skipOrLimit(skip, value, min, max) {\r\n    return skip ? 0 : _limitValue(value, min, max);\r\n}\r\nfunction parseBorderWidth(bar, maxW, maxH) {\r\n    const value = bar.options.borderWidth;\r\n    const skip = bar.borderSkipped;\r\n    const o = toTRBL(value);\r\n    return {\r\n        t: skipOrLimit(skip.top, o.top, 0, maxH),\r\n        r: skipOrLimit(skip.right, o.right, 0, maxW),\r\n        b: skipOrLimit(skip.bottom, o.bottom, 0, maxH),\r\n        l: skipOrLimit(skip.left, o.left, 0, maxW)\r\n    };\r\n}\r\nfunction parseBorderRadius(bar, maxW, maxH) {\r\n    const { enableBorderRadius  } = bar.getProps([\r\n        'enableBorderRadius'\r\n    ]);\r\n    const value = bar.options.borderRadius;\r\n    const o = toTRBLCorners(value);\r\n    const maxR = Math.min(maxW, maxH);\r\n    const skip = bar.borderSkipped;\r\n    const enableBorder = enableBorderRadius || isObject(value);\r\n    return {\r\n        topLeft: skipOrLimit(!enableBorder || skip.top || skip.left, o.topLeft, 0, maxR),\r\n        topRight: skipOrLimit(!enableBorder || skip.top || skip.right, o.topRight, 0, maxR),\r\n        bottomLeft: skipOrLimit(!enableBorder || skip.bottom || skip.left, o.bottomLeft, 0, maxR),\r\n        bottomRight: skipOrLimit(!enableBorder || skip.bottom || skip.right, o.bottomRight, 0, maxR)\r\n    };\r\n}\r\nfunction boundingRects(bar) {\r\n    const bounds = getBarBounds(bar);\r\n    const width = bounds.right - bounds.left;\r\n    const height = bounds.bottom - bounds.top;\r\n    const border = parseBorderWidth(bar, width / 2, height / 2);\r\n    const radius = parseBorderRadius(bar, width / 2, height / 2);\r\n    return {\r\n        outer: {\r\n            x: bounds.left,\r\n            y: bounds.top,\r\n            w: width,\r\n            h: height,\r\n            radius\r\n        },\r\n        inner: {\r\n            x: bounds.left + border.l,\r\n            y: bounds.top + border.t,\r\n            w: width - border.l - border.r,\r\n            h: height - border.t - border.b,\r\n            radius: {\r\n                topLeft: Math.max(0, radius.topLeft - Math.max(border.t, border.l)),\r\n                topRight: Math.max(0, radius.topRight - Math.max(border.t, border.r)),\r\n                bottomLeft: Math.max(0, radius.bottomLeft - Math.max(border.b, border.l)),\r\n                bottomRight: Math.max(0, radius.bottomRight - Math.max(border.b, border.r))\r\n            }\r\n        }\r\n    };\r\n}\r\nfunction inRange(bar, x, y, useFinalPosition) {\r\n    const skipX = x === null;\r\n    const skipY = y === null;\r\n    const skipBoth = skipX && skipY;\r\n    const bounds = bar && !skipBoth && getBarBounds(bar, useFinalPosition);\r\n    return bounds && (skipX || _isBetween(x, bounds.left, bounds.right)) && (skipY || _isBetween(y, bounds.top, bounds.bottom));\r\n}\r\nfunction hasRadius(radius) {\r\n    return radius.topLeft || radius.topRight || radius.bottomLeft || radius.bottomRight;\r\n}\r\n function addNormalRectPath(ctx, rect) {\r\n    ctx.rect(rect.x, rect.y, rect.w, rect.h);\r\n}\r\nfunction inflateRect(rect, amount, refRect = {}) {\r\n    const x = rect.x !== refRect.x ? -amount : 0;\r\n    const y = rect.y !== refRect.y ? -amount : 0;\r\n    const w = (rect.x + rect.w !== refRect.x + refRect.w ? amount : 0) - x;\r\n    const h = (rect.y + rect.h !== refRect.y + refRect.h ? amount : 0) - y;\r\n    return {\r\n        x: rect.x + x,\r\n        y: rect.y + y,\r\n        w: rect.w + w,\r\n        h: rect.h + h,\r\n        radius: rect.radius\r\n    };\r\n}\r\nclass BarElement extends Element {\r\n    static id = 'bar';\r\n static defaults = {\r\n        borderSkipped: 'start',\r\n        borderWidth: 0,\r\n        borderRadius: 0,\r\n        inflateAmount: 'auto',\r\n        pointStyle: undefined\r\n    };\r\n static defaultRoutes = {\r\n        backgroundColor: 'backgroundColor',\r\n        borderColor: 'borderColor'\r\n    };\r\n    constructor(cfg){\r\n        super();\r\n        this.options = undefined;\r\n        this.horizontal = undefined;\r\n        this.base = undefined;\r\n        this.width = undefined;\r\n        this.height = undefined;\r\n        this.inflateAmount = undefined;\r\n        if (cfg) {\r\n            Object.assign(this, cfg);\r\n        }\r\n    }\r\n    draw(ctx) {\r\n        const { inflateAmount , options: { borderColor , backgroundColor  }  } = this;\r\n        const { inner , outer  } = boundingRects(this);\r\n        const addRectPath = hasRadius(outer.radius) ? addRoundedRectPath : addNormalRectPath;\r\n        ctx.save();\r\n        if (outer.w !== inner.w || outer.h !== inner.h) {\r\n            ctx.beginPath();\r\n            addRectPath(ctx, inflateRect(outer, inflateAmount, inner));\r\n            ctx.clip();\r\n            addRectPath(ctx, inflateRect(inner, -inflateAmount, outer));\r\n            ctx.fillStyle = borderColor;\r\n            ctx.fill('evenodd');\r\n        }\r\n        ctx.beginPath();\r\n        addRectPath(ctx, inflateRect(inner, inflateAmount));\r\n        ctx.fillStyle = backgroundColor;\r\n        ctx.fill();\r\n        ctx.restore();\r\n    }\r\n    inRange(mouseX, mouseY, useFinalPosition) {\r\n        return inRange(this, mouseX, mouseY, useFinalPosition);\r\n    }\r\n    inXRange(mouseX, useFinalPosition) {\r\n        return inRange(this, mouseX, null, useFinalPosition);\r\n    }\r\n    inYRange(mouseY, useFinalPosition) {\r\n        return inRange(this, null, mouseY, useFinalPosition);\r\n    }\r\n    getCenterPoint(useFinalPosition) {\r\n        const { x , y , base , horizontal  } =  this.getProps([\r\n            'x',\r\n            'y',\r\n            'base',\r\n            'horizontal'\r\n        ], useFinalPosition);\r\n        return {\r\n            x: horizontal ? (x + base) / 2 : x,\r\n            y: horizontal ? y : (y + base) / 2\r\n        };\r\n    }\r\n    getRange(axis) {\r\n        return axis === 'x' ? this.width / 2 : this.height / 2;\r\n    }\r\n}\r\n\r\nvar elements = /*#__PURE__*/Object.freeze({\r\n__proto__: null,\r\nArcElement: ArcElement,\r\nBarElement: BarElement,\r\nLineElement: LineElement,\r\nPointElement: PointElement\r\n});\r\n\r\nconst BORDER_COLORS = [\r\n    'rgb(54, 162, 235)',\r\n    'rgb(255, 99, 132)',\r\n    'rgb(255, 159, 64)',\r\n    'rgb(255, 205, 86)',\r\n    'rgb(75, 192, 192)',\r\n    'rgb(153, 102, 255)',\r\n    'rgb(201, 203, 207)' // grey\r\n];\r\n// Border colors with 50% transparency\r\nconst BACKGROUND_COLORS = /* #__PURE__ */ BORDER_COLORS.map((color)=>color.replace('rgb(', 'rgba(').replace(')', ', 0.5)'));\r\nfunction getBorderColor(i) {\r\n    return BORDER_COLORS[i % BORDER_COLORS.length];\r\n}\r\nfunction getBackgroundColor(i) {\r\n    return BACKGROUND_COLORS[i % BACKGROUND_COLORS.length];\r\n}\r\nfunction colorizeDefaultDataset(dataset, i) {\r\n    dataset.borderColor = getBorderColor(i);\r\n    dataset.backgroundColor = getBackgroundColor(i);\r\n    return ++i;\r\n}\r\nfunction colorizeDoughnutDataset(dataset, i) {\r\n    dataset.backgroundColor = dataset.data.map(()=>getBorderColor(i++));\r\n    return i;\r\n}\r\nfunction colorizePolarAreaDataset(dataset, i) {\r\n    dataset.backgroundColor = dataset.data.map(()=>getBackgroundColor(i++));\r\n    return i;\r\n}\r\nfunction getColorizer(chart) {\r\n    let i = 0;\r\n    return (dataset, datasetIndex)=>{\r\n        const controller = chart.getDatasetMeta(datasetIndex).controller;\r\n        if (controller instanceof DoughnutController) {\r\n            i = colorizeDoughnutDataset(dataset, i);\r\n        } else if (controller instanceof PolarAreaController) {\r\n            i = colorizePolarAreaDataset(dataset, i);\r\n        } else if (controller) {\r\n            i = colorizeDefaultDataset(dataset, i);\r\n        }\r\n    };\r\n}\r\nfunction containsColorsDefinitions(descriptors) {\r\n    let k;\r\n    for(k in descriptors){\r\n        if (descriptors[k].borderColor || descriptors[k].backgroundColor) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction containsColorsDefinition(descriptor) {\r\n    return descriptor && (descriptor.borderColor || descriptor.backgroundColor);\r\n}\r\nfunction containsDefaultColorsDefenitions() {\r\n    return defaults.borderColor !== 'rgba(0,0,0,0.1)' || defaults.backgroundColor !== 'rgba(0,0,0,0.1)';\r\n}\r\nvar plugin_colors = {\r\n    id: 'colors',\r\n    defaults: {\r\n        enabled: true,\r\n        forceOverride: false\r\n    },\r\n    beforeLayout (chart, _args, options) {\r\n        if (!options.enabled) {\r\n            return;\r\n        }\r\n        const { data: { datasets  } , options: chartOptions  } = chart.config;\r\n        const { elements  } = chartOptions;\r\n        const containsColorDefenition = containsColorsDefinitions(datasets) || containsColorsDefinition(chartOptions) || elements && containsColorsDefinitions(elements) || containsDefaultColorsDefenitions();\r\n        if (!options.forceOverride && containsColorDefenition) {\r\n            return;\r\n        }\r\n        const colorizer = getColorizer(chart);\r\n        datasets.forEach(colorizer);\r\n    }\r\n};\r\n\r\nfunction lttbDecimation(data, start, count, availableWidth, options) {\r\n const samples = options.samples || availableWidth;\r\n    if (samples >= count) {\r\n        return data.slice(start, start + count);\r\n    }\r\n    const decimated = [];\r\n    const bucketWidth = (count - 2) / (samples - 2);\r\n    let sampledIndex = 0;\r\n    const endIndex = start + count - 1;\r\n    let a = start;\r\n    let i, maxAreaPoint, maxArea, area, nextA;\r\n    decimated[sampledIndex++] = data[a];\r\n    for(i = 0; i < samples - 2; i++){\r\n        let avgX = 0;\r\n        let avgY = 0;\r\n        let j;\r\n        const avgRangeStart = Math.floor((i + 1) * bucketWidth) + 1 + start;\r\n        const avgRangeEnd = Math.min(Math.floor((i + 2) * bucketWidth) + 1, count) + start;\r\n        const avgRangeLength = avgRangeEnd - avgRangeStart;\r\n        for(j = avgRangeStart; j < avgRangeEnd; j++){\r\n            avgX += data[j].x;\r\n            avgY += data[j].y;\r\n        }\r\n        avgX /= avgRangeLength;\r\n        avgY /= avgRangeLength;\r\n        const rangeOffs = Math.floor(i * bucketWidth) + 1 + start;\r\n        const rangeTo = Math.min(Math.floor((i + 1) * bucketWidth) + 1, count) + start;\r\n        const { x: pointAx , y: pointAy  } = data[a];\r\n        maxArea = area = -1;\r\n        for(j = rangeOffs; j < rangeTo; j++){\r\n            area = 0.5 * Math.abs((pointAx - avgX) * (data[j].y - pointAy) - (pointAx - data[j].x) * (avgY - pointAy));\r\n            if (area > maxArea) {\r\n                maxArea = area;\r\n                maxAreaPoint = data[j];\r\n                nextA = j;\r\n            }\r\n        }\r\n        decimated[sampledIndex++] = maxAreaPoint;\r\n        a = nextA;\r\n    }\r\n    decimated[sampledIndex++] = data[endIndex];\r\n    return decimated;\r\n}\r\nfunction minMaxDecimation(data, start, count, availableWidth) {\r\n    let avgX = 0;\r\n    let countX = 0;\r\n    let i, point, x, y, prevX, minIndex, maxIndex, startIndex, minY, maxY;\r\n    const decimated = [];\r\n    const endIndex = start + count - 1;\r\n    const xMin = data[start].x;\r\n    const xMax = data[endIndex].x;\r\n    const dx = xMax - xMin;\r\n    for(i = start; i < start + count; ++i){\r\n        point = data[i];\r\n        x = (point.x - xMin) / dx * availableWidth;\r\n        y = point.y;\r\n        const truncX = x | 0;\r\n        if (truncX === prevX) {\r\n            if (y < minY) {\r\n                minY = y;\r\n                minIndex = i;\r\n            } else if (y > maxY) {\r\n                maxY = y;\r\n                maxIndex = i;\r\n            }\r\n            avgX = (countX * avgX + point.x) / ++countX;\r\n        } else {\r\n            const lastIndex = i - 1;\r\n            if (!isNullOrUndef(minIndex) && !isNullOrUndef(maxIndex)) {\r\n                const intermediateIndex1 = Math.min(minIndex, maxIndex);\r\n                const intermediateIndex2 = Math.max(minIndex, maxIndex);\r\n                if (intermediateIndex1 !== startIndex && intermediateIndex1 !== lastIndex) {\r\n                    decimated.push({\r\n                        ...data[intermediateIndex1],\r\n                        x: avgX\r\n                    });\r\n                }\r\n                if (intermediateIndex2 !== startIndex && intermediateIndex2 !== lastIndex) {\r\n                    decimated.push({\r\n                        ...data[intermediateIndex2],\r\n                        x: avgX\r\n                    });\r\n                }\r\n            }\r\n            if (i > 0 && lastIndex !== startIndex) {\r\n                decimated.push(data[lastIndex]);\r\n            }\r\n            decimated.push(point);\r\n            prevX = truncX;\r\n            countX = 0;\r\n            minY = maxY = y;\r\n            minIndex = maxIndex = startIndex = i;\r\n        }\r\n    }\r\n    return decimated;\r\n}\r\nfunction cleanDecimatedDataset(dataset) {\r\n    if (dataset._decimated) {\r\n        const data = dataset._data;\r\n        delete dataset._decimated;\r\n        delete dataset._data;\r\n        Object.defineProperty(dataset, 'data', {\r\n            configurable: true,\r\n            enumerable: true,\r\n            writable: true,\r\n            value: data\r\n        });\r\n    }\r\n}\r\nfunction cleanDecimatedData(chart) {\r\n    chart.data.datasets.forEach((dataset)=>{\r\n        cleanDecimatedDataset(dataset);\r\n    });\r\n}\r\nfunction getStartAndCountOfVisiblePointsSimplified(meta, points) {\r\n    const pointCount = points.length;\r\n    let start = 0;\r\n    let count;\r\n    const { iScale  } = meta;\r\n    const { min , max , minDefined , maxDefined  } = iScale.getUserBounds();\r\n    if (minDefined) {\r\n        start = _limitValue(_lookupByKey(points, iScale.axis, min).lo, 0, pointCount - 1);\r\n    }\r\n    if (maxDefined) {\r\n        count = _limitValue(_lookupByKey(points, iScale.axis, max).hi + 1, start, pointCount) - start;\r\n    } else {\r\n        count = pointCount - start;\r\n    }\r\n    return {\r\n        start,\r\n        count\r\n    };\r\n}\r\nvar plugin_decimation = {\r\n    id: 'decimation',\r\n    defaults: {\r\n        algorithm: 'min-max',\r\n        enabled: false\r\n    },\r\n    beforeElementsUpdate: (chart, args, options)=>{\r\n        if (!options.enabled) {\r\n            cleanDecimatedData(chart);\r\n            return;\r\n        }\r\n        const availableWidth = chart.width;\r\n        chart.data.datasets.forEach((dataset, datasetIndex)=>{\r\n            const { _data , indexAxis  } = dataset;\r\n            const meta = chart.getDatasetMeta(datasetIndex);\r\n            const data = _data || dataset.data;\r\n            if (resolve([\r\n                indexAxis,\r\n                chart.options.indexAxis\r\n            ]) === 'y') {\r\n                return;\r\n            }\r\n            if (!meta.controller.supportsDecimation) {\r\n                return;\r\n            }\r\n            const xAxis = chart.scales[meta.xAxisID];\r\n            if (xAxis.type !== 'linear' && xAxis.type !== 'time') {\r\n                return;\r\n            }\r\n            if (chart.options.parsing) {\r\n                return;\r\n            }\r\n            let { start , count  } = getStartAndCountOfVisiblePointsSimplified(meta, data);\r\n            const threshold = options.threshold || 4 * availableWidth;\r\n            if (count <= threshold) {\r\n                cleanDecimatedDataset(dataset);\r\n                return;\r\n            }\r\n            if (isNullOrUndef(_data)) {\r\n                dataset._data = data;\r\n                delete dataset.data;\r\n                Object.defineProperty(dataset, 'data', {\r\n                    configurable: true,\r\n                    enumerable: true,\r\n                    get: function() {\r\n                        return this._decimated;\r\n                    },\r\n                    set: function(d) {\r\n                        this._data = d;\r\n                    }\r\n                });\r\n            }\r\n            let decimated;\r\n            switch(options.algorithm){\r\n                case 'lttb':\r\n                    decimated = lttbDecimation(data, start, count, availableWidth, options);\r\n                    break;\r\n                case 'min-max':\r\n                    decimated = minMaxDecimation(data, start, count, availableWidth);\r\n                    break;\r\n                default:\r\n                    throw new Error(`Unsupported decimation algorithm '${options.algorithm}'`);\r\n            }\r\n            dataset._decimated = decimated;\r\n        });\r\n    },\r\n    destroy (chart) {\r\n        cleanDecimatedData(chart);\r\n    }\r\n};\r\n\r\nfunction _segments(line, target, property) {\r\n    const segments = line.segments;\r\n    const points = line.points;\r\n    const tpoints = target.points;\r\n    const parts = [];\r\n    for (const segment of segments){\r\n        let { start , end  } = segment;\r\n        end = _findSegmentEnd(start, end, points);\r\n        const bounds = _getBounds(property, points[start], points[end], segment.loop);\r\n        if (!target.segments) {\r\n            parts.push({\r\n                source: segment,\r\n                target: bounds,\r\n                start: points[start],\r\n                end: points[end]\r\n            });\r\n            continue;\r\n        }\r\n        const targetSegments = _boundSegments(target, bounds);\r\n        for (const tgt of targetSegments){\r\n            const subBounds = _getBounds(property, tpoints[tgt.start], tpoints[tgt.end], tgt.loop);\r\n            const fillSources = _boundSegment(segment, points, subBounds);\r\n            for (const fillSource of fillSources){\r\n                parts.push({\r\n                    source: fillSource,\r\n                    target: tgt,\r\n                    start: {\r\n                        [property]: _getEdge(bounds, subBounds, 'start', Math.max)\r\n                    },\r\n                    end: {\r\n                        [property]: _getEdge(bounds, subBounds, 'end', Math.min)\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n    return parts;\r\n}\r\nfunction _getBounds(property, first, last, loop) {\r\n    if (loop) {\r\n        return;\r\n    }\r\n    let start = first[property];\r\n    let end = last[property];\r\n    if (property === 'angle') {\r\n        start = _normalizeAngle(start);\r\n        end = _normalizeAngle(end);\r\n    }\r\n    return {\r\n        property,\r\n        start,\r\n        end\r\n    };\r\n}\r\nfunction _pointsFromSegments(boundary, line) {\r\n    const { x =null , y =null  } = boundary || {};\r\n    const linePoints = line.points;\r\n    const points = [];\r\n    line.segments.forEach(({ start , end  })=>{\r\n        end = _findSegmentEnd(start, end, linePoints);\r\n        const first = linePoints[start];\r\n        const last = linePoints[end];\r\n        if (y !== null) {\r\n            points.push({\r\n                x: first.x,\r\n                y\r\n            });\r\n            points.push({\r\n                x: last.x,\r\n                y\r\n            });\r\n        } else if (x !== null) {\r\n            points.push({\r\n                x,\r\n                y: first.y\r\n            });\r\n            points.push({\r\n                x,\r\n                y: last.y\r\n            });\r\n        }\r\n    });\r\n    return points;\r\n}\r\nfunction _findSegmentEnd(start, end, points) {\r\n    for(; end > start; end--){\r\n        const point = points[end];\r\n        if (!isNaN(point.x) && !isNaN(point.y)) {\r\n            break;\r\n        }\r\n    }\r\n    return end;\r\n}\r\nfunction _getEdge(a, b, prop, fn) {\r\n    if (a && b) {\r\n        return fn(a[prop], b[prop]);\r\n    }\r\n    return a ? a[prop] : b ? b[prop] : 0;\r\n}\r\n\r\nfunction _createBoundaryLine(boundary, line) {\r\n    let points = [];\r\n    let _loop = false;\r\n    if (isArray(boundary)) {\r\n        _loop = true;\r\n        points = boundary;\r\n    } else {\r\n        points = _pointsFromSegments(boundary, line);\r\n    }\r\n    return points.length ? new LineElement({\r\n        points,\r\n        options: {\r\n            tension: 0\r\n        },\r\n        _loop,\r\n        _fullLoop: _loop\r\n    }) : null;\r\n}\r\nfunction _shouldApplyFill(source) {\r\n    return source && source.fill !== false;\r\n}\r\n\r\nfunction _resolveTarget(sources, index, propagate) {\r\n    const source = sources[index];\r\n    let fill = source.fill;\r\n    const visited = [\r\n        index\r\n    ];\r\n    let target;\r\n    if (!propagate) {\r\n        return fill;\r\n    }\r\n    while(fill !== false && visited.indexOf(fill) === -1){\r\n        if (!isNumberFinite(fill)) {\r\n            return fill;\r\n        }\r\n        target = sources[fill];\r\n        if (!target) {\r\n            return false;\r\n        }\r\n        if (target.visible) {\r\n            return fill;\r\n        }\r\n        visited.push(fill);\r\n        fill = target.fill;\r\n    }\r\n    return false;\r\n}\r\n function _decodeFill(line, index, count) {\r\n     const fill = parseFillOption(line);\r\n    if (isObject(fill)) {\r\n        return isNaN(fill.value) ? false : fill;\r\n    }\r\n    let target = parseFloat(fill);\r\n    if (isNumberFinite(target) && Math.floor(target) === target) {\r\n        return decodeTargetIndex(fill[0], index, target, count);\r\n    }\r\n    return [\r\n        'origin',\r\n        'start',\r\n        'end',\r\n        'stack',\r\n        'shape'\r\n    ].indexOf(fill) >= 0 && fill;\r\n}\r\nfunction decodeTargetIndex(firstCh, index, target, count) {\r\n    if (firstCh === '-' || firstCh === '+') {\r\n        target = index + target;\r\n    }\r\n    if (target === index || target < 0 || target >= count) {\r\n        return false;\r\n    }\r\n    return target;\r\n}\r\n function _getTargetPixel(fill, scale) {\r\n    let pixel = null;\r\n    if (fill === 'start') {\r\n        pixel = scale.bottom;\r\n    } else if (fill === 'end') {\r\n        pixel = scale.top;\r\n    } else if (isObject(fill)) {\r\n        pixel = scale.getPixelForValue(fill.value);\r\n    } else if (scale.getBasePixel) {\r\n        pixel = scale.getBasePixel();\r\n    }\r\n    return pixel;\r\n}\r\n function _getTargetValue(fill, scale, startValue) {\r\n    let value;\r\n    if (fill === 'start') {\r\n        value = startValue;\r\n    } else if (fill === 'end') {\r\n        value = scale.options.reverse ? scale.min : scale.max;\r\n    } else if (isObject(fill)) {\r\n        value = fill.value;\r\n    } else {\r\n        value = scale.getBaseValue();\r\n    }\r\n    return value;\r\n}\r\n function parseFillOption(line) {\r\n    const options = line.options;\r\n    const fillOption = options.fill;\r\n    let fill = valueOrDefault(fillOption && fillOption.target, fillOption);\r\n    if (fill === undefined) {\r\n        fill = !!options.backgroundColor;\r\n    }\r\n    if (fill === false || fill === null) {\r\n        return false;\r\n    }\r\n    if (fill === true) {\r\n        return 'origin';\r\n    }\r\n    return fill;\r\n}\r\n\r\nfunction _buildStackLine(source) {\r\n    const { scale , index , line  } = source;\r\n    const points = [];\r\n    const segments = line.segments;\r\n    const sourcePoints = line.points;\r\n    const linesBelow = getLinesBelow(scale, index);\r\n    linesBelow.push(_createBoundaryLine({\r\n        x: null,\r\n        y: scale.bottom\r\n    }, line));\r\n    for(let i = 0; i < segments.length; i++){\r\n        const segment = segments[i];\r\n        for(let j = segment.start; j <= segment.end; j++){\r\n            addPointsBelow(points, sourcePoints[j], linesBelow);\r\n        }\r\n    }\r\n    return new LineElement({\r\n        points,\r\n        options: {}\r\n    });\r\n}\r\n function getLinesBelow(scale, index) {\r\n    const below = [];\r\n    const metas = scale.getMatchingVisibleMetas('line');\r\n    for(let i = 0; i < metas.length; i++){\r\n        const meta = metas[i];\r\n        if (meta.index === index) {\r\n            break;\r\n        }\r\n        if (!meta.hidden) {\r\n            below.unshift(meta.dataset);\r\n        }\r\n    }\r\n    return below;\r\n}\r\n function addPointsBelow(points, sourcePoint, linesBelow) {\r\n    const postponed = [];\r\n    for(let j = 0; j < linesBelow.length; j++){\r\n        const line = linesBelow[j];\r\n        const { first , last , point  } = findPoint(line, sourcePoint, 'x');\r\n        if (!point || first && last) {\r\n            continue;\r\n        }\r\n        if (first) {\r\n            postponed.unshift(point);\r\n        } else {\r\n            points.push(point);\r\n            if (!last) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    points.push(...postponed);\r\n}\r\n function findPoint(line, sourcePoint, property) {\r\n    const point = line.interpolate(sourcePoint, property);\r\n    if (!point) {\r\n        return {};\r\n    }\r\n    const pointValue = point[property];\r\n    const segments = line.segments;\r\n    const linePoints = line.points;\r\n    let first = false;\r\n    let last = false;\r\n    for(let i = 0; i < segments.length; i++){\r\n        const segment = segments[i];\r\n        const firstValue = linePoints[segment.start][property];\r\n        const lastValue = linePoints[segment.end][property];\r\n        if (_isBetween(pointValue, firstValue, lastValue)) {\r\n            first = pointValue === firstValue;\r\n            last = pointValue === lastValue;\r\n            break;\r\n        }\r\n    }\r\n    return {\r\n        first,\r\n        last,\r\n        point\r\n    };\r\n}\r\n\r\nclass simpleArc {\r\n    constructor(opts){\r\n        this.x = opts.x;\r\n        this.y = opts.y;\r\n        this.radius = opts.radius;\r\n    }\r\n    pathSegment(ctx, bounds, opts) {\r\n        const { x , y , radius  } = this;\r\n        bounds = bounds || {\r\n            start: 0,\r\n            end: TAU\r\n        };\r\n        ctx.arc(x, y, radius, bounds.end, bounds.start, true);\r\n        return !opts.bounds;\r\n    }\r\n    interpolate(point) {\r\n        const { x , y , radius  } = this;\r\n        const angle = point.angle;\r\n        return {\r\n            x: x + Math.cos(angle) * radius,\r\n            y: y + Math.sin(angle) * radius,\r\n            angle\r\n        };\r\n    }\r\n}\r\n\r\nfunction _getTarget(source) {\r\n    const { chart , fill , line  } = source;\r\n    if (isNumberFinite(fill)) {\r\n        return getLineByIndex(chart, fill);\r\n    }\r\n    if (fill === 'stack') {\r\n        return _buildStackLine(source);\r\n    }\r\n    if (fill === 'shape') {\r\n        return true;\r\n    }\r\n    const boundary = computeBoundary(source);\r\n    if (boundary instanceof simpleArc) {\r\n        return boundary;\r\n    }\r\n    return _createBoundaryLine(boundary, line);\r\n}\r\n function getLineByIndex(chart, index) {\r\n    const meta = chart.getDatasetMeta(index);\r\n    const visible = meta && chart.isDatasetVisible(index);\r\n    return visible ? meta.dataset : null;\r\n}\r\nfunction computeBoundary(source) {\r\n    const scale = source.scale || {};\r\n    if (scale.getPointPositionForValue) {\r\n        return computeCircularBoundary(source);\r\n    }\r\n    return computeLinearBoundary(source);\r\n}\r\nfunction computeLinearBoundary(source) {\r\n    const { scale ={} , fill  } = source;\r\n    const pixel = _getTargetPixel(fill, scale);\r\n    if (isNumberFinite(pixel)) {\r\n        const horizontal = scale.isHorizontal();\r\n        return {\r\n            x: horizontal ? pixel : null,\r\n            y: horizontal ? null : pixel\r\n        };\r\n    }\r\n    return null;\r\n}\r\nfunction computeCircularBoundary(source) {\r\n    const { scale , fill  } = source;\r\n    const options = scale.options;\r\n    const length = scale.getLabels().length;\r\n    const start = options.reverse ? scale.max : scale.min;\r\n    const value = _getTargetValue(fill, scale, start);\r\n    const target = [];\r\n    if (options.grid.circular) {\r\n        const center = scale.getPointPositionForValue(0, start);\r\n        return new simpleArc({\r\n            x: center.x,\r\n            y: center.y,\r\n            radius: scale.getDistanceFromCenterForValue(value)\r\n        });\r\n    }\r\n    for(let i = 0; i < length; ++i){\r\n        target.push(scale.getPointPositionForValue(i, value));\r\n    }\r\n    return target;\r\n}\r\n\r\nfunction _drawfill(ctx, source, area) {\r\n    const target = _getTarget(source);\r\n    const { chart , index , line , scale , axis  } = source;\r\n    const lineOpts = line.options;\r\n    const fillOption = lineOpts.fill;\r\n    const color = lineOpts.backgroundColor;\r\n    const { above =color , below =color  } = fillOption || {};\r\n    const meta = chart.getDatasetMeta(index);\r\n    const clip = getDatasetClipArea(chart, meta);\r\n    if (target && line.points.length) {\r\n        clipArea(ctx, area);\r\n        doFill(ctx, {\r\n            line,\r\n            target,\r\n            above,\r\n            below,\r\n            area,\r\n            scale,\r\n            axis,\r\n            clip\r\n        });\r\n        unclipArea(ctx);\r\n    }\r\n}\r\nfunction doFill(ctx, cfg) {\r\n    const { line , target , above , below , area , scale , clip  } = cfg;\r\n    const property = line._loop ? 'angle' : cfg.axis;\r\n    ctx.save();\r\n    let fillColor = below;\r\n    if (below !== above) {\r\n        if (property === 'x') {\r\n            clipVertical(ctx, target, area.top);\r\n            fill(ctx, {\r\n                line,\r\n                target,\r\n                color: above,\r\n                scale,\r\n                property,\r\n                clip\r\n            });\r\n            ctx.restore();\r\n            ctx.save();\r\n            clipVertical(ctx, target, area.bottom);\r\n        } else if (property === 'y') {\r\n            clipHorizontal(ctx, target, area.left);\r\n            fill(ctx, {\r\n                line,\r\n                target,\r\n                color: below,\r\n                scale,\r\n                property,\r\n                clip\r\n            });\r\n            ctx.restore();\r\n            ctx.save();\r\n            clipHorizontal(ctx, target, area.right);\r\n            fillColor = above;\r\n        }\r\n    }\r\n    fill(ctx, {\r\n        line,\r\n        target,\r\n        color: fillColor,\r\n        scale,\r\n        property,\r\n        clip\r\n    });\r\n    ctx.restore();\r\n}\r\nfunction clipVertical(ctx, target, clipY) {\r\n    const { segments , points  } = target;\r\n    let first = true;\r\n    let lineLoop = false;\r\n    ctx.beginPath();\r\n    for (const segment of segments){\r\n        const { start , end  } = segment;\r\n        const firstPoint = points[start];\r\n        const lastPoint = points[_findSegmentEnd(start, end, points)];\r\n        if (first) {\r\n            ctx.moveTo(firstPoint.x, firstPoint.y);\r\n            first = false;\r\n        } else {\r\n            ctx.lineTo(firstPoint.x, clipY);\r\n            ctx.lineTo(firstPoint.x, firstPoint.y);\r\n        }\r\n        lineLoop = !!target.pathSegment(ctx, segment, {\r\n            move: lineLoop\r\n        });\r\n        if (lineLoop) {\r\n            ctx.closePath();\r\n        } else {\r\n            ctx.lineTo(lastPoint.x, clipY);\r\n        }\r\n    }\r\n    ctx.lineTo(target.first().x, clipY);\r\n    ctx.closePath();\r\n    ctx.clip();\r\n}\r\nfunction clipHorizontal(ctx, target, clipX) {\r\n    const { segments , points  } = target;\r\n    let first = true;\r\n    let lineLoop = false;\r\n    ctx.beginPath();\r\n    for (const segment of segments){\r\n        const { start , end  } = segment;\r\n        const firstPoint = points[start];\r\n        const lastPoint = points[_findSegmentEnd(start, end, points)];\r\n        if (first) {\r\n            ctx.moveTo(firstPoint.x, firstPoint.y);\r\n            first = false;\r\n        } else {\r\n            ctx.lineTo(clipX, firstPoint.y);\r\n            ctx.lineTo(firstPoint.x, firstPoint.y);\r\n        }\r\n        lineLoop = !!target.pathSegment(ctx, segment, {\r\n            move: lineLoop\r\n        });\r\n        if (lineLoop) {\r\n            ctx.closePath();\r\n        } else {\r\n            ctx.lineTo(clipX, lastPoint.y);\r\n        }\r\n    }\r\n    ctx.lineTo(clipX, target.first().y);\r\n    ctx.closePath();\r\n    ctx.clip();\r\n}\r\nfunction fill(ctx, cfg) {\r\n    const { line , target , property , color , scale , clip  } = cfg;\r\n    const segments = _segments(line, target, property);\r\n    for (const { source: src , target: tgt , start , end  } of segments){\r\n        const { style: { backgroundColor =color  } = {}  } = src;\r\n        const notShape = target !== true;\r\n        ctx.save();\r\n        ctx.fillStyle = backgroundColor;\r\n        clipBounds(ctx, scale, clip, notShape && _getBounds(property, start, end));\r\n        ctx.beginPath();\r\n        const lineLoop = !!line.pathSegment(ctx, src);\r\n        let loop;\r\n        if (notShape) {\r\n            if (lineLoop) {\r\n                ctx.closePath();\r\n            } else {\r\n                interpolatedLineTo(ctx, target, end, property);\r\n            }\r\n            const targetLoop = !!target.pathSegment(ctx, tgt, {\r\n                move: lineLoop,\r\n                reverse: true\r\n            });\r\n            loop = lineLoop && targetLoop;\r\n            if (!loop) {\r\n                interpolatedLineTo(ctx, target, start, property);\r\n            }\r\n        }\r\n        ctx.closePath();\r\n        ctx.fill(loop ? 'evenodd' : 'nonzero');\r\n        ctx.restore();\r\n    }\r\n}\r\nfunction clipBounds(ctx, scale, clip, bounds) {\r\n    const chartArea = scale.chart.chartArea;\r\n    const { property , start , end  } = bounds || {};\r\n    if (property === 'x' || property === 'y') {\r\n        let left, top, right, bottom;\r\n        if (property === 'x') {\r\n            left = start;\r\n            top = chartArea.top;\r\n            right = end;\r\n            bottom = chartArea.bottom;\r\n        } else {\r\n            left = chartArea.left;\r\n            top = start;\r\n            right = chartArea.right;\r\n            bottom = end;\r\n        }\r\n        ctx.beginPath();\r\n        if (clip) {\r\n            left = Math.max(left, clip.left);\r\n            right = Math.min(right, clip.right);\r\n            top = Math.max(top, clip.top);\r\n            bottom = Math.min(bottom, clip.bottom);\r\n        }\r\n        ctx.rect(left, top, right - left, bottom - top);\r\n        ctx.clip();\r\n    }\r\n}\r\nfunction interpolatedLineTo(ctx, target, point, property) {\r\n    const interpolatedPoint = target.interpolate(point, property);\r\n    if (interpolatedPoint) {\r\n        ctx.lineTo(interpolatedPoint.x, interpolatedPoint.y);\r\n    }\r\n}\r\n\r\nvar index = {\r\n    id: 'filler',\r\n    afterDatasetsUpdate (chart, _args, options) {\r\n        const count = (chart.data.datasets || []).length;\r\n        const sources = [];\r\n        let meta, i, line, source;\r\n        for(i = 0; i < count; ++i){\r\n            meta = chart.getDatasetMeta(i);\r\n            line = meta.dataset;\r\n            source = null;\r\n            if (line && line.options && line instanceof LineElement) {\r\n                source = {\r\n                    visible: chart.isDatasetVisible(i),\r\n                    index: i,\r\n                    fill: _decodeFill(line, i, count),\r\n                    chart,\r\n                    axis: meta.controller.options.indexAxis,\r\n                    scale: meta.vScale,\r\n                    line\r\n                };\r\n            }\r\n            meta.$filler = source;\r\n            sources.push(source);\r\n        }\r\n        for(i = 0; i < count; ++i){\r\n            source = sources[i];\r\n            if (!source || source.fill === false) {\r\n                continue;\r\n            }\r\n            source.fill = _resolveTarget(sources, i, options.propagate);\r\n        }\r\n    },\r\n    beforeDraw (chart, _args, options) {\r\n        const draw = options.drawTime === 'beforeDraw';\r\n        const metasets = chart.getSortedVisibleDatasetMetas();\r\n        const area = chart.chartArea;\r\n        for(let i = metasets.length - 1; i >= 0; --i){\r\n            const source = metasets[i].$filler;\r\n            if (!source) {\r\n                continue;\r\n            }\r\n            source.line.updateControlPoints(area, source.axis);\r\n            if (draw && source.fill) {\r\n                _drawfill(chart.ctx, source, area);\r\n            }\r\n        }\r\n    },\r\n    beforeDatasetsDraw (chart, _args, options) {\r\n        if (options.drawTime !== 'beforeDatasetsDraw') {\r\n            return;\r\n        }\r\n        const metasets = chart.getSortedVisibleDatasetMetas();\r\n        for(let i = metasets.length - 1; i >= 0; --i){\r\n            const source = metasets[i].$filler;\r\n            if (_shouldApplyFill(source)) {\r\n                _drawfill(chart.ctx, source, chart.chartArea);\r\n            }\r\n        }\r\n    },\r\n    beforeDatasetDraw (chart, args, options) {\r\n        const source = args.meta.$filler;\r\n        if (!_shouldApplyFill(source) || options.drawTime !== 'beforeDatasetDraw') {\r\n            return;\r\n        }\r\n        _drawfill(chart.ctx, source, chart.chartArea);\r\n    },\r\n    defaults: {\r\n        propagate: true,\r\n        drawTime: 'beforeDatasetDraw'\r\n    }\r\n};\r\n\r\nconst getBoxSize = (labelOpts, fontSize)=>{\r\n    let { boxHeight =fontSize , boxWidth =fontSize  } = labelOpts;\r\n    if (labelOpts.usePointStyle) {\r\n        boxHeight = Math.min(boxHeight, fontSize);\r\n        boxWidth = labelOpts.pointStyleWidth || Math.min(boxWidth, fontSize);\r\n    }\r\n    return {\r\n        boxWidth,\r\n        boxHeight,\r\n        itemHeight: Math.max(fontSize, boxHeight)\r\n    };\r\n};\r\nconst itemsEqual = (a, b)=>a !== null && b !== null && a.datasetIndex === b.datasetIndex && a.index === b.index;\r\nclass Legend extends Element {\r\n constructor(config){\r\n        super();\r\n        this._added = false;\r\n        this.legendHitBoxes = [];\r\n this._hoveredItem = null;\r\n        this.doughnutMode = false;\r\n        this.chart = config.chart;\r\n        this.options = config.options;\r\n        this.ctx = config.ctx;\r\n        this.legendItems = undefined;\r\n        this.columnSizes = undefined;\r\n        this.lineWidths = undefined;\r\n        this.maxHeight = undefined;\r\n        this.maxWidth = undefined;\r\n        this.top = undefined;\r\n        this.bottom = undefined;\r\n        this.left = undefined;\r\n        this.right = undefined;\r\n        this.height = undefined;\r\n        this.width = undefined;\r\n        this._margins = undefined;\r\n        this.position = undefined;\r\n        this.weight = undefined;\r\n        this.fullSize = undefined;\r\n    }\r\n    update(maxWidth, maxHeight, margins) {\r\n        this.maxWidth = maxWidth;\r\n        this.maxHeight = maxHeight;\r\n        this._margins = margins;\r\n        this.setDimensions();\r\n        this.buildLabels();\r\n        this.fit();\r\n    }\r\n    setDimensions() {\r\n        if (this.isHorizontal()) {\r\n            this.width = this.maxWidth;\r\n            this.left = this._margins.left;\r\n            this.right = this.width;\r\n        } else {\r\n            this.height = this.maxHeight;\r\n            this.top = this._margins.top;\r\n            this.bottom = this.height;\r\n        }\r\n    }\r\n    buildLabels() {\r\n        const labelOpts = this.options.labels || {};\r\n        let legendItems = callback(labelOpts.generateLabels, [\r\n            this.chart\r\n        ], this) || [];\r\n        if (labelOpts.filter) {\r\n            legendItems = legendItems.filter((item)=>labelOpts.filter(item, this.chart.data));\r\n        }\r\n        if (labelOpts.sort) {\r\n            legendItems = legendItems.sort((a, b)=>labelOpts.sort(a, b, this.chart.data));\r\n        }\r\n        if (this.options.reverse) {\r\n            legendItems.reverse();\r\n        }\r\n        this.legendItems = legendItems;\r\n    }\r\n    fit() {\r\n        const { options , ctx  } = this;\r\n        if (!options.display) {\r\n            this.width = this.height = 0;\r\n            return;\r\n        }\r\n        const labelOpts = options.labels;\r\n        const labelFont = toFont(labelOpts.font);\r\n        const fontSize = labelFont.size;\r\n        const titleHeight = this._computeTitleHeight();\r\n        const { boxWidth , itemHeight  } = getBoxSize(labelOpts, fontSize);\r\n        let width, height;\r\n        ctx.font = labelFont.string;\r\n        if (this.isHorizontal()) {\r\n            width = this.maxWidth;\r\n            height = this._fitRows(titleHeight, fontSize, boxWidth, itemHeight) + 10;\r\n        } else {\r\n            height = this.maxHeight;\r\n            width = this._fitCols(titleHeight, labelFont, boxWidth, itemHeight) + 10;\r\n        }\r\n        this.width = Math.min(width, options.maxWidth || this.maxWidth);\r\n        this.height = Math.min(height, options.maxHeight || this.maxHeight);\r\n    }\r\n _fitRows(titleHeight, fontSize, boxWidth, itemHeight) {\r\n        const { ctx , maxWidth , options: { labels: { padding  }  }  } = this;\r\n        const hitboxes = this.legendHitBoxes = [];\r\n        const lineWidths = this.lineWidths = [\r\n            0\r\n        ];\r\n        const lineHeight = itemHeight + padding;\r\n        let totalHeight = titleHeight;\r\n        ctx.textAlign = 'left';\r\n        ctx.textBaseline = 'middle';\r\n        let row = -1;\r\n        let top = -lineHeight;\r\n        this.legendItems.forEach((legendItem, i)=>{\r\n            const itemWidth = boxWidth + fontSize / 2 + ctx.measureText(legendItem.text).width;\r\n            if (i === 0 || lineWidths[lineWidths.length - 1] + itemWidth + 2 * padding > maxWidth) {\r\n                totalHeight += lineHeight;\r\n                lineWidths[lineWidths.length - (i > 0 ? 0 : 1)] = 0;\r\n                top += lineHeight;\r\n                row++;\r\n            }\r\n            hitboxes[i] = {\r\n                left: 0,\r\n                top,\r\n                row,\r\n                width: itemWidth,\r\n                height: itemHeight\r\n            };\r\n            lineWidths[lineWidths.length - 1] += itemWidth + padding;\r\n        });\r\n        return totalHeight;\r\n    }\r\n    _fitCols(titleHeight, labelFont, boxWidth, _itemHeight) {\r\n        const { ctx , maxHeight , options: { labels: { padding  }  }  } = this;\r\n        const hitboxes = this.legendHitBoxes = [];\r\n        const columnSizes = this.columnSizes = [];\r\n        const heightLimit = maxHeight - titleHeight;\r\n        let totalWidth = padding;\r\n        let currentColWidth = 0;\r\n        let currentColHeight = 0;\r\n        let left = 0;\r\n        let col = 0;\r\n        this.legendItems.forEach((legendItem, i)=>{\r\n            const { itemWidth , itemHeight  } = calculateItemSize(boxWidth, labelFont, ctx, legendItem, _itemHeight);\r\n            if (i > 0 && currentColHeight + itemHeight + 2 * padding > heightLimit) {\r\n                totalWidth += currentColWidth + padding;\r\n                columnSizes.push({\r\n                    width: currentColWidth,\r\n                    height: currentColHeight\r\n                });\r\n                left += currentColWidth + padding;\r\n                col++;\r\n                currentColWidth = currentColHeight = 0;\r\n            }\r\n            hitboxes[i] = {\r\n                left,\r\n                top: currentColHeight,\r\n                col,\r\n                width: itemWidth,\r\n                height: itemHeight\r\n            };\r\n            currentColWidth = Math.max(currentColWidth, itemWidth);\r\n            currentColHeight += itemHeight + padding;\r\n        });\r\n        totalWidth += currentColWidth;\r\n        columnSizes.push({\r\n            width: currentColWidth,\r\n            height: currentColHeight\r\n        });\r\n        return totalWidth;\r\n    }\r\n    adjustHitBoxes() {\r\n        if (!this.options.display) {\r\n            return;\r\n        }\r\n        const titleHeight = this._computeTitleHeight();\r\n        const { legendHitBoxes: hitboxes , options: { align , labels: { padding  } , rtl  }  } = this;\r\n        const rtlHelper = getRtlAdapter(rtl, this.left, this.width);\r\n        if (this.isHorizontal()) {\r\n            let row = 0;\r\n            let left = _alignStartEnd(align, this.left + padding, this.right - this.lineWidths[row]);\r\n            for (const hitbox of hitboxes){\r\n                if (row !== hitbox.row) {\r\n                    row = hitbox.row;\r\n                    left = _alignStartEnd(align, this.left + padding, this.right - this.lineWidths[row]);\r\n                }\r\n                hitbox.top += this.top + titleHeight + padding;\r\n                hitbox.left = rtlHelper.leftForLtr(rtlHelper.x(left), hitbox.width);\r\n                left += hitbox.width + padding;\r\n            }\r\n        } else {\r\n            let col = 0;\r\n            let top = _alignStartEnd(align, this.top + titleHeight + padding, this.bottom - this.columnSizes[col].height);\r\n            for (const hitbox of hitboxes){\r\n                if (hitbox.col !== col) {\r\n                    col = hitbox.col;\r\n                    top = _alignStartEnd(align, this.top + titleHeight + padding, this.bottom - this.columnSizes[col].height);\r\n                }\r\n                hitbox.top = top;\r\n                hitbox.left += this.left + padding;\r\n                hitbox.left = rtlHelper.leftForLtr(rtlHelper.x(hitbox.left), hitbox.width);\r\n                top += hitbox.height + padding;\r\n            }\r\n        }\r\n    }\r\n    isHorizontal() {\r\n        return this.options.position === 'top' || this.options.position === 'bottom';\r\n    }\r\n    draw() {\r\n        if (this.options.display) {\r\n            const ctx = this.ctx;\r\n            clipArea(ctx, this);\r\n            this._draw();\r\n            unclipArea(ctx);\r\n        }\r\n    }\r\n _draw() {\r\n        const { options: opts , columnSizes , lineWidths , ctx  } = this;\r\n        const { align , labels: labelOpts  } = opts;\r\n        const defaultColor = defaults.color;\r\n        const rtlHelper = getRtlAdapter(opts.rtl, this.left, this.width);\r\n        const labelFont = toFont(labelOpts.font);\r\n        const { padding  } = labelOpts;\r\n        const fontSize = labelFont.size;\r\n        const halfFontSize = fontSize / 2;\r\n        let cursor;\r\n        this.drawTitle();\r\n        ctx.textAlign = rtlHelper.textAlign('left');\r\n        ctx.textBaseline = 'middle';\r\n        ctx.lineWidth = 0.5;\r\n        ctx.font = labelFont.string;\r\n        const { boxWidth , boxHeight , itemHeight  } = getBoxSize(labelOpts, fontSize);\r\n        const drawLegendBox = function(x, y, legendItem) {\r\n            if (isNaN(boxWidth) || boxWidth <= 0 || isNaN(boxHeight) || boxHeight < 0) {\r\n                return;\r\n            }\r\n            ctx.save();\r\n            const lineWidth = valueOrDefault(legendItem.lineWidth, 1);\r\n            ctx.fillStyle = valueOrDefault(legendItem.fillStyle, defaultColor);\r\n            ctx.lineCap = valueOrDefault(legendItem.lineCap, 'butt');\r\n            ctx.lineDashOffset = valueOrDefault(legendItem.lineDashOffset, 0);\r\n            ctx.lineJoin = valueOrDefault(legendItem.lineJoin, 'miter');\r\n            ctx.lineWidth = lineWidth;\r\n            ctx.strokeStyle = valueOrDefault(legendItem.strokeStyle, defaultColor);\r\n            ctx.setLineDash(valueOrDefault(legendItem.lineDash, []));\r\n            if (labelOpts.usePointStyle) {\r\n                const drawOptions = {\r\n                    radius: boxHeight * Math.SQRT2 / 2,\r\n                    pointStyle: legendItem.pointStyle,\r\n                    rotation: legendItem.rotation,\r\n                    borderWidth: lineWidth\r\n                };\r\n                const centerX = rtlHelper.xPlus(x, boxWidth / 2);\r\n                const centerY = y + halfFontSize;\r\n                drawPointLegend(ctx, drawOptions, centerX, centerY, labelOpts.pointStyleWidth && boxWidth);\r\n            } else {\r\n                const yBoxTop = y + Math.max((fontSize - boxHeight) / 2, 0);\r\n                const xBoxLeft = rtlHelper.leftForLtr(x, boxWidth);\r\n                const borderRadius = toTRBLCorners(legendItem.borderRadius);\r\n                ctx.beginPath();\r\n                if (Object.values(borderRadius).some((v)=>v !== 0)) {\r\n                    addRoundedRectPath(ctx, {\r\n                        x: xBoxLeft,\r\n                        y: yBoxTop,\r\n                        w: boxWidth,\r\n                        h: boxHeight,\r\n                        radius: borderRadius\r\n                    });\r\n                } else {\r\n                    ctx.rect(xBoxLeft, yBoxTop, boxWidth, boxHeight);\r\n                }\r\n                ctx.fill();\r\n                if (lineWidth !== 0) {\r\n                    ctx.stroke();\r\n                }\r\n            }\r\n            ctx.restore();\r\n        };\r\n        const fillText = function(x, y, legendItem) {\r\n            renderText(ctx, legendItem.text, x, y + itemHeight / 2, labelFont, {\r\n                strikethrough: legendItem.hidden,\r\n                textAlign: rtlHelper.textAlign(legendItem.textAlign)\r\n            });\r\n        };\r\n        const isHorizontal = this.isHorizontal();\r\n        const titleHeight = this._computeTitleHeight();\r\n        if (isHorizontal) {\r\n            cursor = {\r\n                x: _alignStartEnd(align, this.left + padding, this.right - lineWidths[0]),\r\n                y: this.top + padding + titleHeight,\r\n                line: 0\r\n            };\r\n        } else {\r\n            cursor = {\r\n                x: this.left + padding,\r\n                y: _alignStartEnd(align, this.top + titleHeight + padding, this.bottom - columnSizes[0].height),\r\n                line: 0\r\n            };\r\n        }\r\n        overrideTextDirection(this.ctx, opts.textDirection);\r\n        const lineHeight = itemHeight + padding;\r\n        this.legendItems.forEach((legendItem, i)=>{\r\n            ctx.strokeStyle = legendItem.fontColor;\r\n            ctx.fillStyle = legendItem.fontColor;\r\n            const textWidth = ctx.measureText(legendItem.text).width;\r\n            const textAlign = rtlHelper.textAlign(legendItem.textAlign || (legendItem.textAlign = labelOpts.textAlign));\r\n            const width = boxWidth + halfFontSize + textWidth;\r\n            let x = cursor.x;\r\n            let y = cursor.y;\r\n            rtlHelper.setWidth(this.width);\r\n            if (isHorizontal) {\r\n                if (i > 0 && x + width + padding > this.right) {\r\n                    y = cursor.y += lineHeight;\r\n                    cursor.line++;\r\n                    x = cursor.x = _alignStartEnd(align, this.left + padding, this.right - lineWidths[cursor.line]);\r\n                }\r\n            } else if (i > 0 && y + lineHeight > this.bottom) {\r\n                x = cursor.x = x + columnSizes[cursor.line].width + padding;\r\n                cursor.line++;\r\n                y = cursor.y = _alignStartEnd(align, this.top + titleHeight + padding, this.bottom - columnSizes[cursor.line].height);\r\n            }\r\n            const realX = rtlHelper.x(x);\r\n            drawLegendBox(realX, y, legendItem);\r\n            x = _textX(textAlign, x + boxWidth + halfFontSize, isHorizontal ? x + width : this.right, opts.rtl);\r\n            fillText(rtlHelper.x(x), y, legendItem);\r\n            if (isHorizontal) {\r\n                cursor.x += width + padding;\r\n            } else if (typeof legendItem.text !== 'string') {\r\n                const fontLineHeight = labelFont.lineHeight;\r\n                cursor.y += calculateLegendItemHeight(legendItem, fontLineHeight) + padding;\r\n            } else {\r\n                cursor.y += lineHeight;\r\n            }\r\n        });\r\n        restoreTextDirection(this.ctx, opts.textDirection);\r\n    }\r\n drawTitle() {\r\n        const opts = this.options;\r\n        const titleOpts = opts.title;\r\n        const titleFont = toFont(titleOpts.font);\r\n        const titlePadding = toPadding(titleOpts.padding);\r\n        if (!titleOpts.display) {\r\n            return;\r\n        }\r\n        const rtlHelper = getRtlAdapter(opts.rtl, this.left, this.width);\r\n        const ctx = this.ctx;\r\n        const position = titleOpts.position;\r\n        const halfFontSize = titleFont.size / 2;\r\n        const topPaddingPlusHalfFontSize = titlePadding.top + halfFontSize;\r\n        let y;\r\n        let left = this.left;\r\n        let maxWidth = this.width;\r\n        if (this.isHorizontal()) {\r\n            maxWidth = Math.max(...this.lineWidths);\r\n            y = this.top + topPaddingPlusHalfFontSize;\r\n            left = _alignStartEnd(opts.align, left, this.right - maxWidth);\r\n        } else {\r\n            const maxHeight = this.columnSizes.reduce((acc, size)=>Math.max(acc, size.height), 0);\r\n            y = topPaddingPlusHalfFontSize + _alignStartEnd(opts.align, this.top, this.bottom - maxHeight - opts.labels.padding - this._computeTitleHeight());\r\n        }\r\n        const x = _alignStartEnd(position, left, left + maxWidth);\r\n        ctx.textAlign = rtlHelper.textAlign(_toLeftRightCenter(position));\r\n        ctx.textBaseline = 'middle';\r\n        ctx.strokeStyle = titleOpts.color;\r\n        ctx.fillStyle = titleOpts.color;\r\n        ctx.font = titleFont.string;\r\n        renderText(ctx, titleOpts.text, x, y, titleFont);\r\n    }\r\n _computeTitleHeight() {\r\n        const titleOpts = this.options.title;\r\n        const titleFont = toFont(titleOpts.font);\r\n        const titlePadding = toPadding(titleOpts.padding);\r\n        return titleOpts.display ? titleFont.lineHeight + titlePadding.height : 0;\r\n    }\r\n _getLegendItemAt(x, y) {\r\n        let i, hitBox, lh;\r\n        if (_isBetween(x, this.left, this.right) && _isBetween(y, this.top, this.bottom)) {\r\n            lh = this.legendHitBoxes;\r\n            for(i = 0; i < lh.length; ++i){\r\n                hitBox = lh[i];\r\n                if (_isBetween(x, hitBox.left, hitBox.left + hitBox.width) && _isBetween(y, hitBox.top, hitBox.top + hitBox.height)) {\r\n                    return this.legendItems[i];\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n handleEvent(e) {\r\n        const opts = this.options;\r\n        if (!isListened(e.type, opts)) {\r\n            return;\r\n        }\r\n        const hoveredItem = this._getLegendItemAt(e.x, e.y);\r\n        if (e.type === 'mousemove' || e.type === 'mouseout') {\r\n            const previous = this._hoveredItem;\r\n            const sameItem = itemsEqual(previous, hoveredItem);\r\n            if (previous && !sameItem) {\r\n                callback(opts.onLeave, [\r\n                    e,\r\n                    previous,\r\n                    this\r\n                ], this);\r\n            }\r\n            this._hoveredItem = hoveredItem;\r\n            if (hoveredItem && !sameItem) {\r\n                callback(opts.onHover, [\r\n                    e,\r\n                    hoveredItem,\r\n                    this\r\n                ], this);\r\n            }\r\n        } else if (hoveredItem) {\r\n            callback(opts.onClick, [\r\n                e,\r\n                hoveredItem,\r\n                this\r\n            ], this);\r\n        }\r\n    }\r\n}\r\nfunction calculateItemSize(boxWidth, labelFont, ctx, legendItem, _itemHeight) {\r\n    const itemWidth = calculateItemWidth(legendItem, boxWidth, labelFont, ctx);\r\n    const itemHeight = calculateItemHeight(_itemHeight, legendItem, labelFont.lineHeight);\r\n    return {\r\n        itemWidth,\r\n        itemHeight\r\n    };\r\n}\r\nfunction calculateItemWidth(legendItem, boxWidth, labelFont, ctx) {\r\n    let legendItemText = legendItem.text;\r\n    if (legendItemText && typeof legendItemText !== 'string') {\r\n        legendItemText = legendItemText.reduce((a, b)=>a.length > b.length ? a : b);\r\n    }\r\n    return boxWidth + labelFont.size / 2 + ctx.measureText(legendItemText).width;\r\n}\r\nfunction calculateItemHeight(_itemHeight, legendItem, fontLineHeight) {\r\n    let itemHeight = _itemHeight;\r\n    if (typeof legendItem.text !== 'string') {\r\n        itemHeight = calculateLegendItemHeight(legendItem, fontLineHeight);\r\n    }\r\n    return itemHeight;\r\n}\r\nfunction calculateLegendItemHeight(legendItem, fontLineHeight) {\r\n    const labelHeight = legendItem.text ? legendItem.text.length : 0;\r\n    return fontLineHeight * labelHeight;\r\n}\r\nfunction isListened(type, opts) {\r\n    if ((type === 'mousemove' || type === 'mouseout') && (opts.onHover || opts.onLeave)) {\r\n        return true;\r\n    }\r\n    if (opts.onClick && (type === 'click' || type === 'mouseup')) {\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\nvar plugin_legend = {\r\n    id: 'legend',\r\n _element: Legend,\r\n    start (chart, _args, options) {\r\n        const legend = chart.legend = new Legend({\r\n            ctx: chart.ctx,\r\n            options,\r\n            chart\r\n        });\r\n        layouts.configure(chart, legend, options);\r\n        layouts.addBox(chart, legend);\r\n    },\r\n    stop (chart) {\r\n        layouts.removeBox(chart, chart.legend);\r\n        delete chart.legend;\r\n    },\r\n    beforeUpdate (chart, _args, options) {\r\n        const legend = chart.legend;\r\n        layouts.configure(chart, legend, options);\r\n        legend.options = options;\r\n    },\r\n    afterUpdate (chart) {\r\n        const legend = chart.legend;\r\n        legend.buildLabels();\r\n        legend.adjustHitBoxes();\r\n    },\r\n    afterEvent (chart, args) {\r\n        if (!args.replay) {\r\n            chart.legend.handleEvent(args.event);\r\n        }\r\n    },\r\n    defaults: {\r\n        display: true,\r\n        position: 'top',\r\n        align: 'center',\r\n        fullSize: true,\r\n        reverse: false,\r\n        weight: 1000,\r\n        onClick (e, legendItem, legend) {\r\n            const index = legendItem.datasetIndex;\r\n            const ci = legend.chart;\r\n            if (ci.isDatasetVisible(index)) {\r\n                ci.hide(index);\r\n                legendItem.hidden = true;\r\n            } else {\r\n                ci.show(index);\r\n                legendItem.hidden = false;\r\n            }\r\n        },\r\n        onHover: null,\r\n        onLeave: null,\r\n        labels: {\r\n            color: (ctx)=>ctx.chart.options.color,\r\n            boxWidth: 40,\r\n            padding: 10,\r\n            generateLabels (chart) {\r\n                const datasets = chart.data.datasets;\r\n                const { labels: { usePointStyle , pointStyle , textAlign , color , useBorderRadius , borderRadius  }  } = chart.legend.options;\r\n                return chart._getSortedDatasetMetas().map((meta)=>{\r\n                    const style = meta.controller.getStyle(usePointStyle ? 0 : undefined);\r\n                    const borderWidth = toPadding(style.borderWidth);\r\n                    return {\r\n                        text: datasets[meta.index].label,\r\n                        fillStyle: style.backgroundColor,\r\n                        fontColor: color,\r\n                        hidden: !meta.visible,\r\n                        lineCap: style.borderCapStyle,\r\n                        lineDash: style.borderDash,\r\n                        lineDashOffset: style.borderDashOffset,\r\n                        lineJoin: style.borderJoinStyle,\r\n                        lineWidth: (borderWidth.width + borderWidth.height) / 4,\r\n                        strokeStyle: style.borderColor,\r\n                        pointStyle: pointStyle || style.pointStyle,\r\n                        rotation: style.rotation,\r\n                        textAlign: textAlign || style.textAlign,\r\n                        borderRadius: useBorderRadius && (borderRadius || style.borderRadius),\r\n                        datasetIndex: meta.index\r\n                    };\r\n                }, this);\r\n            }\r\n        },\r\n        title: {\r\n            color: (ctx)=>ctx.chart.options.color,\r\n            display: false,\r\n            position: 'center',\r\n            text: ''\r\n        }\r\n    },\r\n    descriptors: {\r\n        _scriptable: (name)=>!name.startsWith('on'),\r\n        labels: {\r\n            _scriptable: (name)=>![\r\n                    'generateLabels',\r\n                    'filter',\r\n                    'sort'\r\n                ].includes(name)\r\n        }\r\n    }\r\n};\r\n\r\nclass Title extends Element {\r\n constructor(config){\r\n        super();\r\n        this.chart = config.chart;\r\n        this.options = config.options;\r\n        this.ctx = config.ctx;\r\n        this._padding = undefined;\r\n        this.top = undefined;\r\n        this.bottom = undefined;\r\n        this.left = undefined;\r\n        this.right = undefined;\r\n        this.width = undefined;\r\n        this.height = undefined;\r\n        this.position = undefined;\r\n        this.weight = undefined;\r\n        this.fullSize = undefined;\r\n    }\r\n    update(maxWidth, maxHeight) {\r\n        const opts = this.options;\r\n        this.left = 0;\r\n        this.top = 0;\r\n        if (!opts.display) {\r\n            this.width = this.height = this.right = this.bottom = 0;\r\n            return;\r\n        }\r\n        this.width = this.right = maxWidth;\r\n        this.height = this.bottom = maxHeight;\r\n        const lineCount = isArray(opts.text) ? opts.text.length : 1;\r\n        this._padding = toPadding(opts.padding);\r\n        const textSize = lineCount * toFont(opts.font).lineHeight + this._padding.height;\r\n        if (this.isHorizontal()) {\r\n            this.height = textSize;\r\n        } else {\r\n            this.width = textSize;\r\n        }\r\n    }\r\n    isHorizontal() {\r\n        const pos = this.options.position;\r\n        return pos === 'top' || pos === 'bottom';\r\n    }\r\n    _drawArgs(offset) {\r\n        const { top , left , bottom , right , options  } = this;\r\n        const align = options.align;\r\n        let rotation = 0;\r\n        let maxWidth, titleX, titleY;\r\n        if (this.isHorizontal()) {\r\n            titleX = _alignStartEnd(align, left, right);\r\n            titleY = top + offset;\r\n            maxWidth = right - left;\r\n        } else {\r\n            if (options.position === 'left') {\r\n                titleX = left + offset;\r\n                titleY = _alignStartEnd(align, bottom, top);\r\n                rotation = PI * -0.5;\r\n            } else {\r\n                titleX = right - offset;\r\n                titleY = _alignStartEnd(align, top, bottom);\r\n                rotation = PI * 0.5;\r\n            }\r\n            maxWidth = bottom - top;\r\n        }\r\n        return {\r\n            titleX,\r\n            titleY,\r\n            maxWidth,\r\n            rotation\r\n        };\r\n    }\r\n    draw() {\r\n        const ctx = this.ctx;\r\n        const opts = this.options;\r\n        if (!opts.display) {\r\n            return;\r\n        }\r\n        const fontOpts = toFont(opts.font);\r\n        const lineHeight = fontOpts.lineHeight;\r\n        const offset = lineHeight / 2 + this._padding.top;\r\n        const { titleX , titleY , maxWidth , rotation  } = this._drawArgs(offset);\r\n        renderText(ctx, opts.text, 0, 0, fontOpts, {\r\n            color: opts.color,\r\n            maxWidth,\r\n            rotation,\r\n            textAlign: _toLeftRightCenter(opts.align),\r\n            textBaseline: 'middle',\r\n            translation: [\r\n                titleX,\r\n                titleY\r\n            ]\r\n        });\r\n    }\r\n}\r\nfunction createTitle(chart, titleOpts) {\r\n    const title = new Title({\r\n        ctx: chart.ctx,\r\n        options: titleOpts,\r\n        chart\r\n    });\r\n    layouts.configure(chart, title, titleOpts);\r\n    layouts.addBox(chart, title);\r\n    chart.titleBlock = title;\r\n}\r\nvar plugin_title = {\r\n    id: 'title',\r\n _element: Title,\r\n    start (chart, _args, options) {\r\n        createTitle(chart, options);\r\n    },\r\n    stop (chart) {\r\n        const titleBlock = chart.titleBlock;\r\n        layouts.removeBox(chart, titleBlock);\r\n        delete chart.titleBlock;\r\n    },\r\n    beforeUpdate (chart, _args, options) {\r\n        const title = chart.titleBlock;\r\n        layouts.configure(chart, title, options);\r\n        title.options = options;\r\n    },\r\n    defaults: {\r\n        align: 'center',\r\n        display: false,\r\n        font: {\r\n            weight: 'bold'\r\n        },\r\n        fullSize: true,\r\n        padding: 10,\r\n        position: 'top',\r\n        text: '',\r\n        weight: 2000\r\n    },\r\n    defaultRoutes: {\r\n        color: 'color'\r\n    },\r\n    descriptors: {\r\n        _scriptable: true,\r\n        _indexable: false\r\n    }\r\n};\r\n\r\nconst map = new WeakMap();\r\nvar plugin_subtitle = {\r\n    id: 'subtitle',\r\n    start (chart, _args, options) {\r\n        const title = new Title({\r\n            ctx: chart.ctx,\r\n            options,\r\n            chart\r\n        });\r\n        layouts.configure(chart, title, options);\r\n        layouts.addBox(chart, title);\r\n        map.set(chart, title);\r\n    },\r\n    stop (chart) {\r\n        layouts.removeBox(chart, map.get(chart));\r\n        map.delete(chart);\r\n    },\r\n    beforeUpdate (chart, _args, options) {\r\n        const title = map.get(chart);\r\n        layouts.configure(chart, title, options);\r\n        title.options = options;\r\n    },\r\n    defaults: {\r\n        align: 'center',\r\n        display: false,\r\n        font: {\r\n            weight: 'normal'\r\n        },\r\n        fullSize: true,\r\n        padding: 0,\r\n        position: 'top',\r\n        text: '',\r\n        weight: 1500\r\n    },\r\n    defaultRoutes: {\r\n        color: 'color'\r\n    },\r\n    descriptors: {\r\n        _scriptable: true,\r\n        _indexable: false\r\n    }\r\n};\r\n\r\nconst positioners = {\r\n average (items) {\r\n        if (!items.length) {\r\n            return false;\r\n        }\r\n        let i, len;\r\n        let xSet = new Set();\r\n        let y = 0;\r\n        let count = 0;\r\n        for(i = 0, len = items.length; i < len; ++i){\r\n            const el = items[i].element;\r\n            if (el && el.hasValue()) {\r\n                const pos = el.tooltipPosition();\r\n                xSet.add(pos.x);\r\n                y += pos.y;\r\n                ++count;\r\n            }\r\n        }\r\n        if (count === 0 || xSet.size === 0) {\r\n            return false;\r\n        }\r\n        const xAverage = [\r\n            ...xSet\r\n        ].reduce((a, b)=>a + b) / xSet.size;\r\n        return {\r\n            x: xAverage,\r\n            y: y / count\r\n        };\r\n    },\r\n nearest (items, eventPosition) {\r\n        if (!items.length) {\r\n            return false;\r\n        }\r\n        let x = eventPosition.x;\r\n        let y = eventPosition.y;\r\n        let minDistance = Number.POSITIVE_INFINITY;\r\n        let i, len, nearestElement;\r\n        for(i = 0, len = items.length; i < len; ++i){\r\n            const el = items[i].element;\r\n            if (el && el.hasValue()) {\r\n                const center = el.getCenterPoint();\r\n                const d = distanceBetweenPoints(eventPosition, center);\r\n                if (d < minDistance) {\r\n                    minDistance = d;\r\n                    nearestElement = el;\r\n                }\r\n            }\r\n        }\r\n        if (nearestElement) {\r\n            const tp = nearestElement.tooltipPosition();\r\n            x = tp.x;\r\n            y = tp.y;\r\n        }\r\n        return {\r\n            x,\r\n            y\r\n        };\r\n    }\r\n};\r\nfunction pushOrConcat(base, toPush) {\r\n    if (toPush) {\r\n        if (isArray(toPush)) {\r\n            Array.prototype.push.apply(base, toPush);\r\n        } else {\r\n            base.push(toPush);\r\n        }\r\n    }\r\n    return base;\r\n}\r\n function splitNewlines(str) {\r\n    if ((typeof str === 'string' || str instanceof String) && str.indexOf('\\n') > -1) {\r\n        return str.split('\\n');\r\n    }\r\n    return str;\r\n}\r\n function createTooltipItem(chart, item) {\r\n    const { element , datasetIndex , index  } = item;\r\n    const controller = chart.getDatasetMeta(datasetIndex).controller;\r\n    const { label , value  } = controller.getLabelAndValue(index);\r\n    return {\r\n        chart,\r\n        label,\r\n        parsed: controller.getParsed(index),\r\n        raw: chart.data.datasets[datasetIndex].data[index],\r\n        formattedValue: value,\r\n        dataset: controller.getDataset(),\r\n        dataIndex: index,\r\n        datasetIndex,\r\n        element\r\n    };\r\n}\r\n function getTooltipSize(tooltip, options) {\r\n    const ctx = tooltip.chart.ctx;\r\n    const { body , footer , title  } = tooltip;\r\n    const { boxWidth , boxHeight  } = options;\r\n    const bodyFont = toFont(options.bodyFont);\r\n    const titleFont = toFont(options.titleFont);\r\n    const footerFont = toFont(options.footerFont);\r\n    const titleLineCount = title.length;\r\n    const footerLineCount = footer.length;\r\n    const bodyLineItemCount = body.length;\r\n    const padding = toPadding(options.padding);\r\n    let height = padding.height;\r\n    let width = 0;\r\n    let combinedBodyLength = body.reduce((count, bodyItem)=>count + bodyItem.before.length + bodyItem.lines.length + bodyItem.after.length, 0);\r\n    combinedBodyLength += tooltip.beforeBody.length + tooltip.afterBody.length;\r\n    if (titleLineCount) {\r\n        height += titleLineCount * titleFont.lineHeight + (titleLineCount - 1) * options.titleSpacing + options.titleMarginBottom;\r\n    }\r\n    if (combinedBodyLength) {\r\n        const bodyLineHeight = options.displayColors ? Math.max(boxHeight, bodyFont.lineHeight) : bodyFont.lineHeight;\r\n        height += bodyLineItemCount * bodyLineHeight + (combinedBodyLength - bodyLineItemCount) * bodyFont.lineHeight + (combinedBodyLength - 1) * options.bodySpacing;\r\n    }\r\n    if (footerLineCount) {\r\n        height += options.footerMarginTop + footerLineCount * footerFont.lineHeight + (footerLineCount - 1) * options.footerSpacing;\r\n    }\r\n    let widthPadding = 0;\r\n    const maxLineWidth = function(line) {\r\n        width = Math.max(width, ctx.measureText(line).width + widthPadding);\r\n    };\r\n    ctx.save();\r\n    ctx.font = titleFont.string;\r\n    each(tooltip.title, maxLineWidth);\r\n    ctx.font = bodyFont.string;\r\n    each(tooltip.beforeBody.concat(tooltip.afterBody), maxLineWidth);\r\n    widthPadding = options.displayColors ? boxWidth + 2 + options.boxPadding : 0;\r\n    each(body, (bodyItem)=>{\r\n        each(bodyItem.before, maxLineWidth);\r\n        each(bodyItem.lines, maxLineWidth);\r\n        each(bodyItem.after, maxLineWidth);\r\n    });\r\n    widthPadding = 0;\r\n    ctx.font = footerFont.string;\r\n    each(tooltip.footer, maxLineWidth);\r\n    ctx.restore();\r\n    width += padding.width;\r\n    return {\r\n        width,\r\n        height\r\n    };\r\n}\r\nfunction determineYAlign(chart, size) {\r\n    const { y , height  } = size;\r\n    if (y < height / 2) {\r\n        return 'top';\r\n    } else if (y > chart.height - height / 2) {\r\n        return 'bottom';\r\n    }\r\n    return 'center';\r\n}\r\nfunction doesNotFitWithAlign(xAlign, chart, options, size) {\r\n    const { x , width  } = size;\r\n    const caret = options.caretSize + options.caretPadding;\r\n    if (xAlign === 'left' && x + width + caret > chart.width) {\r\n        return true;\r\n    }\r\n    if (xAlign === 'right' && x - width - caret < 0) {\r\n        return true;\r\n    }\r\n}\r\nfunction determineXAlign(chart, options, size, yAlign) {\r\n    const { x , width  } = size;\r\n    const { width: chartWidth , chartArea: { left , right  }  } = chart;\r\n    let xAlign = 'center';\r\n    if (yAlign === 'center') {\r\n        xAlign = x <= (left + right) / 2 ? 'left' : 'right';\r\n    } else if (x <= width / 2) {\r\n        xAlign = 'left';\r\n    } else if (x >= chartWidth - width / 2) {\r\n        xAlign = 'right';\r\n    }\r\n    if (doesNotFitWithAlign(xAlign, chart, options, size)) {\r\n        xAlign = 'center';\r\n    }\r\n    return xAlign;\r\n}\r\n function determineAlignment(chart, options, size) {\r\n    const yAlign = size.yAlign || options.yAlign || determineYAlign(chart, size);\r\n    return {\r\n        xAlign: size.xAlign || options.xAlign || determineXAlign(chart, options, size, yAlign),\r\n        yAlign\r\n    };\r\n}\r\nfunction alignX(size, xAlign) {\r\n    let { x , width  } = size;\r\n    if (xAlign === 'right') {\r\n        x -= width;\r\n    } else if (xAlign === 'center') {\r\n        x -= width / 2;\r\n    }\r\n    return x;\r\n}\r\nfunction alignY(size, yAlign, paddingAndSize) {\r\n    let { y , height  } = size;\r\n    if (yAlign === 'top') {\r\n        y += paddingAndSize;\r\n    } else if (yAlign === 'bottom') {\r\n        y -= height + paddingAndSize;\r\n    } else {\r\n        y -= height / 2;\r\n    }\r\n    return y;\r\n}\r\n function getBackgroundPoint(options, size, alignment, chart) {\r\n    const { caretSize , caretPadding , cornerRadius  } = options;\r\n    const { xAlign , yAlign  } = alignment;\r\n    const paddingAndSize = caretSize + caretPadding;\r\n    const { topLeft , topRight , bottomLeft , bottomRight  } = toTRBLCorners(cornerRadius);\r\n    let x = alignX(size, xAlign);\r\n    const y = alignY(size, yAlign, paddingAndSize);\r\n    if (yAlign === 'center') {\r\n        if (xAlign === 'left') {\r\n            x += paddingAndSize;\r\n        } else if (xAlign === 'right') {\r\n            x -= paddingAndSize;\r\n        }\r\n    } else if (xAlign === 'left') {\r\n        x -= Math.max(topLeft, bottomLeft) + caretSize;\r\n    } else if (xAlign === 'right') {\r\n        x += Math.max(topRight, bottomRight) + caretSize;\r\n    }\r\n    return {\r\n        x: _limitValue(x, 0, chart.width - size.width),\r\n        y: _limitValue(y, 0, chart.height - size.height)\r\n    };\r\n}\r\nfunction getAlignedX(tooltip, align, options) {\r\n    const padding = toPadding(options.padding);\r\n    return align === 'center' ? tooltip.x + tooltip.width / 2 : align === 'right' ? tooltip.x + tooltip.width - padding.right : tooltip.x + padding.left;\r\n}\r\n function getBeforeAfterBodyLines(callback) {\r\n    return pushOrConcat([], splitNewlines(callback));\r\n}\r\nfunction createTooltipContext(parent, tooltip, tooltipItems) {\r\n    return createContext(parent, {\r\n        tooltip,\r\n        tooltipItems,\r\n        type: 'tooltip'\r\n    });\r\n}\r\nfunction overrideCallbacks(callbacks, context) {\r\n    const override = context && context.dataset && context.dataset.tooltip && context.dataset.tooltip.callbacks;\r\n    return override ? callbacks.override(override) : callbacks;\r\n}\r\nconst defaultCallbacks = {\r\n    beforeTitle: noop,\r\n    title (tooltipItems) {\r\n        if (tooltipItems.length > 0) {\r\n            const item = tooltipItems[0];\r\n            const labels = item.chart.data.labels;\r\n            const labelCount = labels ? labels.length : 0;\r\n            if (this && this.options && this.options.mode === 'dataset') {\r\n                return item.dataset.label || '';\r\n            } else if (item.label) {\r\n                return item.label;\r\n            } else if (labelCount > 0 && item.dataIndex < labelCount) {\r\n                return labels[item.dataIndex];\r\n            }\r\n        }\r\n        return '';\r\n    },\r\n    afterTitle: noop,\r\n    beforeBody: noop,\r\n    beforeLabel: noop,\r\n    label (tooltipItem) {\r\n        if (this && this.options && this.options.mode === 'dataset') {\r\n            return tooltipItem.label + ': ' + tooltipItem.formattedValue || tooltipItem.formattedValue;\r\n        }\r\n        let label = tooltipItem.dataset.label || '';\r\n        if (label) {\r\n            label += ': ';\r\n        }\r\n        const value = tooltipItem.formattedValue;\r\n        if (!isNullOrUndef(value)) {\r\n            label += value;\r\n        }\r\n        return label;\r\n    },\r\n    labelColor (tooltipItem) {\r\n        const meta = tooltipItem.chart.getDatasetMeta(tooltipItem.datasetIndex);\r\n        const options = meta.controller.getStyle(tooltipItem.dataIndex);\r\n        return {\r\n            borderColor: options.borderColor,\r\n            backgroundColor: options.backgroundColor,\r\n            borderWidth: options.borderWidth,\r\n            borderDash: options.borderDash,\r\n            borderDashOffset: options.borderDashOffset,\r\n            borderRadius: 0\r\n        };\r\n    },\r\n    labelTextColor () {\r\n        return this.options.bodyColor;\r\n    },\r\n    labelPointStyle (tooltipItem) {\r\n        const meta = tooltipItem.chart.getDatasetMeta(tooltipItem.datasetIndex);\r\n        const options = meta.controller.getStyle(tooltipItem.dataIndex);\r\n        return {\r\n            pointStyle: options.pointStyle,\r\n            rotation: options.rotation\r\n        };\r\n    },\r\n    afterLabel: noop,\r\n    afterBody: noop,\r\n    beforeFooter: noop,\r\n    footer: noop,\r\n    afterFooter: noop\r\n};\r\n function invokeCallbackWithFallback(callbacks, name, ctx, arg) {\r\n    const result = callbacks[name].call(ctx, arg);\r\n    if (typeof result === 'undefined') {\r\n        return defaultCallbacks[name].call(ctx, arg);\r\n    }\r\n    return result;\r\n}\r\nclass Tooltip extends Element {\r\n static positioners = positioners;\r\n    constructor(config){\r\n        super();\r\n        this.opacity = 0;\r\n        this._active = [];\r\n        this._eventPosition = undefined;\r\n        this._size = undefined;\r\n        this._cachedAnimations = undefined;\r\n        this._tooltipItems = [];\r\n        this.$animations = undefined;\r\n        this.$context = undefined;\r\n        this.chart = config.chart;\r\n        this.options = config.options;\r\n        this.dataPoints = undefined;\r\n        this.title = undefined;\r\n        this.beforeBody = undefined;\r\n        this.body = undefined;\r\n        this.afterBody = undefined;\r\n        this.footer = undefined;\r\n        this.xAlign = undefined;\r\n        this.yAlign = undefined;\r\n        this.x = undefined;\r\n        this.y = undefined;\r\n        this.height = undefined;\r\n        this.width = undefined;\r\n        this.caretX = undefined;\r\n        this.caretY = undefined;\r\n        this.labelColors = undefined;\r\n        this.labelPointStyles = undefined;\r\n        this.labelTextColors = undefined;\r\n    }\r\n    initialize(options) {\r\n        this.options = options;\r\n        this._cachedAnimations = undefined;\r\n        this.$context = undefined;\r\n    }\r\n _resolveAnimations() {\r\n        const cached = this._cachedAnimations;\r\n        if (cached) {\r\n            return cached;\r\n        }\r\n        const chart = this.chart;\r\n        const options = this.options.setContext(this.getContext());\r\n        const opts = options.enabled && chart.options.animation && options.animations;\r\n        const animations = new Animations(this.chart, opts);\r\n        if (opts._cacheable) {\r\n            this._cachedAnimations = Object.freeze(animations);\r\n        }\r\n        return animations;\r\n    }\r\n getContext() {\r\n        return this.$context || (this.$context = createTooltipContext(this.chart.getContext(), this, this._tooltipItems));\r\n    }\r\n    getTitle(context, options) {\r\n        const { callbacks  } = options;\r\n        const beforeTitle = invokeCallbackWithFallback(callbacks, 'beforeTitle', this, context);\r\n        const title = invokeCallbackWithFallback(callbacks, 'title', this, context);\r\n        const afterTitle = invokeCallbackWithFallback(callbacks, 'afterTitle', this, context);\r\n        let lines = [];\r\n        lines = pushOrConcat(lines, splitNewlines(beforeTitle));\r\n        lines = pushOrConcat(lines, splitNewlines(title));\r\n        lines = pushOrConcat(lines, splitNewlines(afterTitle));\r\n        return lines;\r\n    }\r\n    getBeforeBody(tooltipItems, options) {\r\n        return getBeforeAfterBodyLines(invokeCallbackWithFallback(options.callbacks, 'beforeBody', this, tooltipItems));\r\n    }\r\n    getBody(tooltipItems, options) {\r\n        const { callbacks  } = options;\r\n        const bodyItems = [];\r\n        each(tooltipItems, (context)=>{\r\n            const bodyItem = {\r\n                before: [],\r\n                lines: [],\r\n                after: []\r\n            };\r\n            const scoped = overrideCallbacks(callbacks, context);\r\n            pushOrConcat(bodyItem.before, splitNewlines(invokeCallbackWithFallback(scoped, 'beforeLabel', this, context)));\r\n            pushOrConcat(bodyItem.lines, invokeCallbackWithFallback(scoped, 'label', this, context));\r\n            pushOrConcat(bodyItem.after, splitNewlines(invokeCallbackWithFallback(scoped, 'afterLabel', this, context)));\r\n            bodyItems.push(bodyItem);\r\n        });\r\n        return bodyItems;\r\n    }\r\n    getAfterBody(tooltipItems, options) {\r\n        return getBeforeAfterBodyLines(invokeCallbackWithFallback(options.callbacks, 'afterBody', this, tooltipItems));\r\n    }\r\n    getFooter(tooltipItems, options) {\r\n        const { callbacks  } = options;\r\n        const beforeFooter = invokeCallbackWithFallback(callbacks, 'beforeFooter', this, tooltipItems);\r\n        const footer = invokeCallbackWithFallback(callbacks, 'footer', this, tooltipItems);\r\n        const afterFooter = invokeCallbackWithFallback(callbacks, 'afterFooter', this, tooltipItems);\r\n        let lines = [];\r\n        lines = pushOrConcat(lines, splitNewlines(beforeFooter));\r\n        lines = pushOrConcat(lines, splitNewlines(footer));\r\n        lines = pushOrConcat(lines, splitNewlines(afterFooter));\r\n        return lines;\r\n    }\r\n _createItems(options) {\r\n        const active = this._active;\r\n        const data = this.chart.data;\r\n        const labelColors = [];\r\n        const labelPointStyles = [];\r\n        const labelTextColors = [];\r\n        let tooltipItems = [];\r\n        let i, len;\r\n        for(i = 0, len = active.length; i < len; ++i){\r\n            tooltipItems.push(createTooltipItem(this.chart, active[i]));\r\n        }\r\n        if (options.filter) {\r\n            tooltipItems = tooltipItems.filter((element, index, array)=>options.filter(element, index, array, data));\r\n        }\r\n        if (options.itemSort) {\r\n            tooltipItems = tooltipItems.sort((a, b)=>options.itemSort(a, b, data));\r\n        }\r\n        each(tooltipItems, (context)=>{\r\n            const scoped = overrideCallbacks(options.callbacks, context);\r\n            labelColors.push(invokeCallbackWithFallback(scoped, 'labelColor', this, context));\r\n            labelPointStyles.push(invokeCallbackWithFallback(scoped, 'labelPointStyle', this, context));\r\n            labelTextColors.push(invokeCallbackWithFallback(scoped, 'labelTextColor', this, context));\r\n        });\r\n        this.labelColors = labelColors;\r\n        this.labelPointStyles = labelPointStyles;\r\n        this.labelTextColors = labelTextColors;\r\n        this.dataPoints = tooltipItems;\r\n        return tooltipItems;\r\n    }\r\n    update(changed, replay) {\r\n        const options = this.options.setContext(this.getContext());\r\n        const active = this._active;\r\n        let properties;\r\n        let tooltipItems = [];\r\n        if (!active.length) {\r\n            if (this.opacity !== 0) {\r\n                properties = {\r\n                    opacity: 0\r\n                };\r\n            }\r\n        } else {\r\n            const position = positioners[options.position].call(this, active, this._eventPosition);\r\n            tooltipItems = this._createItems(options);\r\n            this.title = this.getTitle(tooltipItems, options);\r\n            this.beforeBody = this.getBeforeBody(tooltipItems, options);\r\n            this.body = this.getBody(tooltipItems, options);\r\n            this.afterBody = this.getAfterBody(tooltipItems, options);\r\n            this.footer = this.getFooter(tooltipItems, options);\r\n            const size = this._size = getTooltipSize(this, options);\r\n            const positionAndSize = Object.assign({}, position, size);\r\n            const alignment = determineAlignment(this.chart, options, positionAndSize);\r\n            const backgroundPoint = getBackgroundPoint(options, positionAndSize, alignment, this.chart);\r\n            this.xAlign = alignment.xAlign;\r\n            this.yAlign = alignment.yAlign;\r\n            properties = {\r\n                opacity: 1,\r\n                x: backgroundPoint.x,\r\n                y: backgroundPoint.y,\r\n                width: size.width,\r\n                height: size.height,\r\n                caretX: position.x,\r\n                caretY: position.y\r\n            };\r\n        }\r\n        this._tooltipItems = tooltipItems;\r\n        this.$context = undefined;\r\n        if (properties) {\r\n            this._resolveAnimations().update(this, properties);\r\n        }\r\n        if (changed && options.external) {\r\n            options.external.call(this, {\r\n                chart: this.chart,\r\n                tooltip: this,\r\n                replay\r\n            });\r\n        }\r\n    }\r\n    drawCaret(tooltipPoint, ctx, size, options) {\r\n        const caretPosition = this.getCaretPosition(tooltipPoint, size, options);\r\n        ctx.lineTo(caretPosition.x1, caretPosition.y1);\r\n        ctx.lineTo(caretPosition.x2, caretPosition.y2);\r\n        ctx.lineTo(caretPosition.x3, caretPosition.y3);\r\n    }\r\n    getCaretPosition(tooltipPoint, size, options) {\r\n        const { xAlign , yAlign  } = this;\r\n        const { caretSize , cornerRadius  } = options;\r\n        const { topLeft , topRight , bottomLeft , bottomRight  } = toTRBLCorners(cornerRadius);\r\n        const { x: ptX , y: ptY  } = tooltipPoint;\r\n        const { width , height  } = size;\r\n        let x1, x2, x3, y1, y2, y3;\r\n        if (yAlign === 'center') {\r\n            y2 = ptY + height / 2;\r\n            if (xAlign === 'left') {\r\n                x1 = ptX;\r\n                x2 = x1 - caretSize;\r\n                y1 = y2 + caretSize;\r\n                y3 = y2 - caretSize;\r\n            } else {\r\n                x1 = ptX + width;\r\n                x2 = x1 + caretSize;\r\n                y1 = y2 - caretSize;\r\n                y3 = y2 + caretSize;\r\n            }\r\n            x3 = x1;\r\n        } else {\r\n            if (xAlign === 'left') {\r\n                x2 = ptX + Math.max(topLeft, bottomLeft) + caretSize;\r\n            } else if (xAlign === 'right') {\r\n                x2 = ptX + width - Math.max(topRight, bottomRight) - caretSize;\r\n            } else {\r\n                x2 = this.caretX;\r\n            }\r\n            if (yAlign === 'top') {\r\n                y1 = ptY;\r\n                y2 = y1 - caretSize;\r\n                x1 = x2 - caretSize;\r\n                x3 = x2 + caretSize;\r\n            } else {\r\n                y1 = ptY + height;\r\n                y2 = y1 + caretSize;\r\n                x1 = x2 + caretSize;\r\n                x3 = x2 - caretSize;\r\n            }\r\n            y3 = y1;\r\n        }\r\n        return {\r\n            x1,\r\n            x2,\r\n            x3,\r\n            y1,\r\n            y2,\r\n            y3\r\n        };\r\n    }\r\n    drawTitle(pt, ctx, options) {\r\n        const title = this.title;\r\n        const length = title.length;\r\n        let titleFont, titleSpacing, i;\r\n        if (length) {\r\n            const rtlHelper = getRtlAdapter(options.rtl, this.x, this.width);\r\n            pt.x = getAlignedX(this, options.titleAlign, options);\r\n            ctx.textAlign = rtlHelper.textAlign(options.titleAlign);\r\n            ctx.textBaseline = 'middle';\r\n            titleFont = toFont(options.titleFont);\r\n            titleSpacing = options.titleSpacing;\r\n            ctx.fillStyle = options.titleColor;\r\n            ctx.font = titleFont.string;\r\n            for(i = 0; i < length; ++i){\r\n                ctx.fillText(title[i], rtlHelper.x(pt.x), pt.y + titleFont.lineHeight / 2);\r\n                pt.y += titleFont.lineHeight + titleSpacing;\r\n                if (i + 1 === length) {\r\n                    pt.y += options.titleMarginBottom - titleSpacing;\r\n                }\r\n            }\r\n        }\r\n    }\r\n _drawColorBox(ctx, pt, i, rtlHelper, options) {\r\n        const labelColor = this.labelColors[i];\r\n        const labelPointStyle = this.labelPointStyles[i];\r\n        const { boxHeight , boxWidth  } = options;\r\n        const bodyFont = toFont(options.bodyFont);\r\n        const colorX = getAlignedX(this, 'left', options);\r\n        const rtlColorX = rtlHelper.x(colorX);\r\n        const yOffSet = boxHeight < bodyFont.lineHeight ? (bodyFont.lineHeight - boxHeight) / 2 : 0;\r\n        const colorY = pt.y + yOffSet;\r\n        if (options.usePointStyle) {\r\n            const drawOptions = {\r\n                radius: Math.min(boxWidth, boxHeight) / 2,\r\n                pointStyle: labelPointStyle.pointStyle,\r\n                rotation: labelPointStyle.rotation,\r\n                borderWidth: 1\r\n            };\r\n            const centerX = rtlHelper.leftForLtr(rtlColorX, boxWidth) + boxWidth / 2;\r\n            const centerY = colorY + boxHeight / 2;\r\n            ctx.strokeStyle = options.multiKeyBackground;\r\n            ctx.fillStyle = options.multiKeyBackground;\r\n            drawPoint(ctx, drawOptions, centerX, centerY);\r\n            ctx.strokeStyle = labelColor.borderColor;\r\n            ctx.fillStyle = labelColor.backgroundColor;\r\n            drawPoint(ctx, drawOptions, centerX, centerY);\r\n        } else {\r\n            ctx.lineWidth = isObject(labelColor.borderWidth) ? Math.max(...Object.values(labelColor.borderWidth)) : labelColor.borderWidth || 1;\r\n            ctx.strokeStyle = labelColor.borderColor;\r\n            ctx.setLineDash(labelColor.borderDash || []);\r\n            ctx.lineDashOffset = labelColor.borderDashOffset || 0;\r\n            const outerX = rtlHelper.leftForLtr(rtlColorX, boxWidth);\r\n            const innerX = rtlHelper.leftForLtr(rtlHelper.xPlus(rtlColorX, 1), boxWidth - 2);\r\n            const borderRadius = toTRBLCorners(labelColor.borderRadius);\r\n            if (Object.values(borderRadius).some((v)=>v !== 0)) {\r\n                ctx.beginPath();\r\n                ctx.fillStyle = options.multiKeyBackground;\r\n                addRoundedRectPath(ctx, {\r\n                    x: outerX,\r\n                    y: colorY,\r\n                    w: boxWidth,\r\n                    h: boxHeight,\r\n                    radius: borderRadius\r\n                });\r\n                ctx.fill();\r\n                ctx.stroke();\r\n                ctx.fillStyle = labelColor.backgroundColor;\r\n                ctx.beginPath();\r\n                addRoundedRectPath(ctx, {\r\n                    x: innerX,\r\n                    y: colorY + 1,\r\n                    w: boxWidth - 2,\r\n                    h: boxHeight - 2,\r\n                    radius: borderRadius\r\n                });\r\n                ctx.fill();\r\n            } else {\r\n                ctx.fillStyle = options.multiKeyBackground;\r\n                ctx.fillRect(outerX, colorY, boxWidth, boxHeight);\r\n                ctx.strokeRect(outerX, colorY, boxWidth, boxHeight);\r\n                ctx.fillStyle = labelColor.backgroundColor;\r\n                ctx.fillRect(innerX, colorY + 1, boxWidth - 2, boxHeight - 2);\r\n            }\r\n        }\r\n        ctx.fillStyle = this.labelTextColors[i];\r\n    }\r\n    drawBody(pt, ctx, options) {\r\n        const { body  } = this;\r\n        const { bodySpacing , bodyAlign , displayColors , boxHeight , boxWidth , boxPadding  } = options;\r\n        const bodyFont = toFont(options.bodyFont);\r\n        let bodyLineHeight = bodyFont.lineHeight;\r\n        let xLinePadding = 0;\r\n        const rtlHelper = getRtlAdapter(options.rtl, this.x, this.width);\r\n        const fillLineOfText = function(line) {\r\n            ctx.fillText(line, rtlHelper.x(pt.x + xLinePadding), pt.y + bodyLineHeight / 2);\r\n            pt.y += bodyLineHeight + bodySpacing;\r\n        };\r\n        const bodyAlignForCalculation = rtlHelper.textAlign(bodyAlign);\r\n        let bodyItem, textColor, lines, i, j, ilen, jlen;\r\n        ctx.textAlign = bodyAlign;\r\n        ctx.textBaseline = 'middle';\r\n        ctx.font = bodyFont.string;\r\n        pt.x = getAlignedX(this, bodyAlignForCalculation, options);\r\n        ctx.fillStyle = options.bodyColor;\r\n        each(this.beforeBody, fillLineOfText);\r\n        xLinePadding = displayColors && bodyAlignForCalculation !== 'right' ? bodyAlign === 'center' ? boxWidth / 2 + boxPadding : boxWidth + 2 + boxPadding : 0;\r\n        for(i = 0, ilen = body.length; i < ilen; ++i){\r\n            bodyItem = body[i];\r\n            textColor = this.labelTextColors[i];\r\n            ctx.fillStyle = textColor;\r\n            each(bodyItem.before, fillLineOfText);\r\n            lines = bodyItem.lines;\r\n            if (displayColors && lines.length) {\r\n                this._drawColorBox(ctx, pt, i, rtlHelper, options);\r\n                bodyLineHeight = Math.max(bodyFont.lineHeight, boxHeight);\r\n            }\r\n            for(j = 0, jlen = lines.length; j < jlen; ++j){\r\n                fillLineOfText(lines[j]);\r\n                bodyLineHeight = bodyFont.lineHeight;\r\n            }\r\n            each(bodyItem.after, fillLineOfText);\r\n        }\r\n        xLinePadding = 0;\r\n        bodyLineHeight = bodyFont.lineHeight;\r\n        each(this.afterBody, fillLineOfText);\r\n        pt.y -= bodySpacing;\r\n    }\r\n    drawFooter(pt, ctx, options) {\r\n        const footer = this.footer;\r\n        const length = footer.length;\r\n        let footerFont, i;\r\n        if (length) {\r\n            const rtlHelper = getRtlAdapter(options.rtl, this.x, this.width);\r\n            pt.x = getAlignedX(this, options.footerAlign, options);\r\n            pt.y += options.footerMarginTop;\r\n            ctx.textAlign = rtlHelper.textAlign(options.footerAlign);\r\n            ctx.textBaseline = 'middle';\r\n            footerFont = toFont(options.footerFont);\r\n            ctx.fillStyle = options.footerColor;\r\n            ctx.font = footerFont.string;\r\n            for(i = 0; i < length; ++i){\r\n                ctx.fillText(footer[i], rtlHelper.x(pt.x), pt.y + footerFont.lineHeight / 2);\r\n                pt.y += footerFont.lineHeight + options.footerSpacing;\r\n            }\r\n        }\r\n    }\r\n    drawBackground(pt, ctx, tooltipSize, options) {\r\n        const { xAlign , yAlign  } = this;\r\n        const { x , y  } = pt;\r\n        const { width , height  } = tooltipSize;\r\n        const { topLeft , topRight , bottomLeft , bottomRight  } = toTRBLCorners(options.cornerRadius);\r\n        ctx.fillStyle = options.backgroundColor;\r\n        ctx.strokeStyle = options.borderColor;\r\n        ctx.lineWidth = options.borderWidth;\r\n        ctx.beginPath();\r\n        ctx.moveTo(x + topLeft, y);\r\n        if (yAlign === 'top') {\r\n            this.drawCaret(pt, ctx, tooltipSize, options);\r\n        }\r\n        ctx.lineTo(x + width - topRight, y);\r\n        ctx.quadraticCurveTo(x + width, y, x + width, y + topRight);\r\n        if (yAlign === 'center' && xAlign === 'right') {\r\n            this.drawCaret(pt, ctx, tooltipSize, options);\r\n        }\r\n        ctx.lineTo(x + width, y + height - bottomRight);\r\n        ctx.quadraticCurveTo(x + width, y + height, x + width - bottomRight, y + height);\r\n        if (yAlign === 'bottom') {\r\n            this.drawCaret(pt, ctx, tooltipSize, options);\r\n        }\r\n        ctx.lineTo(x + bottomLeft, y + height);\r\n        ctx.quadraticCurveTo(x, y + height, x, y + height - bottomLeft);\r\n        if (yAlign === 'center' && xAlign === 'left') {\r\n            this.drawCaret(pt, ctx, tooltipSize, options);\r\n        }\r\n        ctx.lineTo(x, y + topLeft);\r\n        ctx.quadraticCurveTo(x, y, x + topLeft, y);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n        if (options.borderWidth > 0) {\r\n            ctx.stroke();\r\n        }\r\n    }\r\n _updateAnimationTarget(options) {\r\n        const chart = this.chart;\r\n        const anims = this.$animations;\r\n        const animX = anims && anims.x;\r\n        const animY = anims && anims.y;\r\n        if (animX || animY) {\r\n            const position = positioners[options.position].call(this, this._active, this._eventPosition);\r\n            if (!position) {\r\n                return;\r\n            }\r\n            const size = this._size = getTooltipSize(this, options);\r\n            const positionAndSize = Object.assign({}, position, this._size);\r\n            const alignment = determineAlignment(chart, options, positionAndSize);\r\n            const point = getBackgroundPoint(options, positionAndSize, alignment, chart);\r\n            if (animX._to !== point.x || animY._to !== point.y) {\r\n                this.xAlign = alignment.xAlign;\r\n                this.yAlign = alignment.yAlign;\r\n                this.width = size.width;\r\n                this.height = size.height;\r\n                this.caretX = position.x;\r\n                this.caretY = position.y;\r\n                this._resolveAnimations().update(this, point);\r\n            }\r\n        }\r\n    }\r\n _willRender() {\r\n        return !!this.opacity;\r\n    }\r\n    draw(ctx) {\r\n        const options = this.options.setContext(this.getContext());\r\n        let opacity = this.opacity;\r\n        if (!opacity) {\r\n            return;\r\n        }\r\n        this._updateAnimationTarget(options);\r\n        const tooltipSize = {\r\n            width: this.width,\r\n            height: this.height\r\n        };\r\n        const pt = {\r\n            x: this.x,\r\n            y: this.y\r\n        };\r\n        opacity = Math.abs(opacity) < 1e-3 ? 0 : opacity;\r\n        const padding = toPadding(options.padding);\r\n        const hasTooltipContent = this.title.length || this.beforeBody.length || this.body.length || this.afterBody.length || this.footer.length;\r\n        if (options.enabled && hasTooltipContent) {\r\n            ctx.save();\r\n            ctx.globalAlpha = opacity;\r\n            this.drawBackground(pt, ctx, tooltipSize, options);\r\n            overrideTextDirection(ctx, options.textDirection);\r\n            pt.y += padding.top;\r\n            this.drawTitle(pt, ctx, options);\r\n            this.drawBody(pt, ctx, options);\r\n            this.drawFooter(pt, ctx, options);\r\n            restoreTextDirection(ctx, options.textDirection);\r\n            ctx.restore();\r\n        }\r\n    }\r\n getActiveElements() {\r\n        return this._active || [];\r\n    }\r\n setActiveElements(activeElements, eventPosition) {\r\n        const lastActive = this._active;\r\n        const active = activeElements.map(({ datasetIndex , index  })=>{\r\n            const meta = this.chart.getDatasetMeta(datasetIndex);\r\n            if (!meta) {\r\n                throw new Error('Cannot find a dataset at index ' + datasetIndex);\r\n            }\r\n            return {\r\n                datasetIndex,\r\n                element: meta.data[index],\r\n                index\r\n            };\r\n        });\r\n        const changed = !_elementsEqual(lastActive, active);\r\n        const positionChanged = this._positionChanged(active, eventPosition);\r\n        if (changed || positionChanged) {\r\n            this._active = active;\r\n            this._eventPosition = eventPosition;\r\n            this._ignoreReplayEvents = true;\r\n            this.update(true);\r\n        }\r\n    }\r\n handleEvent(e, replay, inChartArea = true) {\r\n        if (replay && this._ignoreReplayEvents) {\r\n            return false;\r\n        }\r\n        this._ignoreReplayEvents = false;\r\n        const options = this.options;\r\n        const lastActive = this._active || [];\r\n        const active = this._getActiveElements(e, lastActive, replay, inChartArea);\r\n        const positionChanged = this._positionChanged(active, e);\r\n        const changed = replay || !_elementsEqual(active, lastActive) || positionChanged;\r\n        if (changed) {\r\n            this._active = active;\r\n            if (options.enabled || options.external) {\r\n                this._eventPosition = {\r\n                    x: e.x,\r\n                    y: e.y\r\n                };\r\n                this.update(true, replay);\r\n            }\r\n        }\r\n        return changed;\r\n    }\r\n _getActiveElements(e, lastActive, replay, inChartArea) {\r\n        const options = this.options;\r\n        if (e.type === 'mouseout') {\r\n            return [];\r\n        }\r\n        if (!inChartArea) {\r\n            return lastActive.filter((i)=>this.chart.data.datasets[i.datasetIndex] && this.chart.getDatasetMeta(i.datasetIndex).controller.getParsed(i.index) !== undefined);\r\n        }\r\n        const active = this.chart.getElementsAtEventForMode(e, options.mode, options, replay);\r\n        if (options.reverse) {\r\n            active.reverse();\r\n        }\r\n        return active;\r\n    }\r\n _positionChanged(active, e) {\r\n        const { caretX , caretY , options  } = this;\r\n        const position = positioners[options.position].call(this, active, e);\r\n        return position !== false && (caretX !== position.x || caretY !== position.y);\r\n    }\r\n}\r\nvar plugin_tooltip = {\r\n    id: 'tooltip',\r\n    _element: Tooltip,\r\n    positioners,\r\n    afterInit (chart, _args, options) {\r\n        if (options) {\r\n            chart.tooltip = new Tooltip({\r\n                chart,\r\n                options\r\n            });\r\n        }\r\n    },\r\n    beforeUpdate (chart, _args, options) {\r\n        if (chart.tooltip) {\r\n            chart.tooltip.initialize(options);\r\n        }\r\n    },\r\n    reset (chart, _args, options) {\r\n        if (chart.tooltip) {\r\n            chart.tooltip.initialize(options);\r\n        }\r\n    },\r\n    afterDraw (chart) {\r\n        const tooltip = chart.tooltip;\r\n        if (tooltip && tooltip._willRender()) {\r\n            const args = {\r\n                tooltip\r\n            };\r\n            if (chart.notifyPlugins('beforeTooltipDraw', {\r\n                ...args,\r\n                cancelable: true\r\n            }) === false) {\r\n                return;\r\n            }\r\n            tooltip.draw(chart.ctx);\r\n            chart.notifyPlugins('afterTooltipDraw', args);\r\n        }\r\n    },\r\n    afterEvent (chart, args) {\r\n        if (chart.tooltip) {\r\n            const useFinalPosition = args.replay;\r\n            if (chart.tooltip.handleEvent(args.event, useFinalPosition, args.inChartArea)) {\r\n                args.changed = true;\r\n            }\r\n        }\r\n    },\r\n    defaults: {\r\n        enabled: true,\r\n        external: null,\r\n        position: 'average',\r\n        backgroundColor: 'rgba(0,0,0,0.8)',\r\n        titleColor: '#fff',\r\n        titleFont: {\r\n            weight: 'bold'\r\n        },\r\n        titleSpacing: 2,\r\n        titleMarginBottom: 6,\r\n        titleAlign: 'left',\r\n        bodyColor: '#fff',\r\n        bodySpacing: 2,\r\n        bodyFont: {},\r\n        bodyAlign: 'left',\r\n        footerColor: '#fff',\r\n        footerSpacing: 2,\r\n        footerMarginTop: 6,\r\n        footerFont: {\r\n            weight: 'bold'\r\n        },\r\n        footerAlign: 'left',\r\n        padding: 6,\r\n        caretPadding: 2,\r\n        caretSize: 5,\r\n        cornerRadius: 6,\r\n        boxHeight: (ctx, opts)=>opts.bodyFont.size,\r\n        boxWidth: (ctx, opts)=>opts.bodyFont.size,\r\n        multiKeyBackground: '#fff',\r\n        displayColors: true,\r\n        boxPadding: 0,\r\n        borderColor: 'rgba(0,0,0,0)',\r\n        borderWidth: 0,\r\n        animation: {\r\n            duration: 400,\r\n            easing: 'easeOutQuart'\r\n        },\r\n        animations: {\r\n            numbers: {\r\n                type: 'number',\r\n                properties: [\r\n                    'x',\r\n                    'y',\r\n                    'width',\r\n                    'height',\r\n                    'caretX',\r\n                    'caretY'\r\n                ]\r\n            },\r\n            opacity: {\r\n                easing: 'linear',\r\n                duration: 200\r\n            }\r\n        },\r\n        callbacks: defaultCallbacks\r\n    },\r\n    defaultRoutes: {\r\n        bodyFont: 'font',\r\n        footerFont: 'font',\r\n        titleFont: 'font'\r\n    },\r\n    descriptors: {\r\n        _scriptable: (name)=>name !== 'filter' && name !== 'itemSort' && name !== 'external',\r\n        _indexable: false,\r\n        callbacks: {\r\n            _scriptable: false,\r\n            _indexable: false\r\n        },\r\n        animation: {\r\n            _fallback: false\r\n        },\r\n        animations: {\r\n            _fallback: 'animation'\r\n        }\r\n    },\r\n    additionalOptionScopes: [\r\n        'interaction'\r\n    ]\r\n};\r\n\r\nvar plugins = /*#__PURE__*/Object.freeze({\r\n__proto__: null,\r\nColors: plugin_colors,\r\nDecimation: plugin_decimation,\r\nFiller: index,\r\nLegend: plugin_legend,\r\nSubTitle: plugin_subtitle,\r\nTitle: plugin_title,\r\nTooltip: plugin_tooltip\r\n});\r\n\r\nconst addIfString = (labels, raw, index, addedLabels)=>{\r\n    if (typeof raw === 'string') {\r\n        index = labels.push(raw) - 1;\r\n        addedLabels.unshift({\r\n            index,\r\n            label: raw\r\n        });\r\n    } else if (isNaN(raw)) {\r\n        index = null;\r\n    }\r\n    return index;\r\n};\r\nfunction findOrAddLabel(labels, raw, index, addedLabels) {\r\n    const first = labels.indexOf(raw);\r\n    if (first === -1) {\r\n        return addIfString(labels, raw, index, addedLabels);\r\n    }\r\n    const last = labels.lastIndexOf(raw);\r\n    return first !== last ? index : first;\r\n}\r\nconst validIndex = (index, max)=>index === null ? null : _limitValue(Math.round(index), 0, max);\r\nfunction _getLabelForValue(value) {\r\n    const labels = this.getLabels();\r\n    if (value >= 0 && value < labels.length) {\r\n        return labels[value];\r\n    }\r\n    return value;\r\n}\r\nclass CategoryScale extends Scale {\r\n    static id = 'category';\r\n static defaults = {\r\n        ticks: {\r\n            callback: _getLabelForValue\r\n        }\r\n    };\r\n    constructor(cfg){\r\n        super(cfg);\r\n         this._startValue = undefined;\r\n        this._valueRange = 0;\r\n        this._addedLabels = [];\r\n    }\r\n    init(scaleOptions) {\r\n        const added = this._addedLabels;\r\n        if (added.length) {\r\n            const labels = this.getLabels();\r\n            for (const { index , label  } of added){\r\n                if (labels[index] === label) {\r\n                    labels.splice(index, 1);\r\n                }\r\n            }\r\n            this._addedLabels = [];\r\n        }\r\n        super.init(scaleOptions);\r\n    }\r\n    parse(raw, index) {\r\n        if (isNullOrUndef(raw)) {\r\n            return null;\r\n        }\r\n        const labels = this.getLabels();\r\n        index = isFinite(index) && labels[index] === raw ? index : findOrAddLabel(labels, raw, valueOrDefault(index, raw), this._addedLabels);\r\n        return validIndex(index, labels.length - 1);\r\n    }\r\n    determineDataLimits() {\r\n        const { minDefined , maxDefined  } = this.getUserBounds();\r\n        let { min , max  } = this.getMinMax(true);\r\n        if (this.options.bounds === 'ticks') {\r\n            if (!minDefined) {\r\n                min = 0;\r\n            }\r\n            if (!maxDefined) {\r\n                max = this.getLabels().length - 1;\r\n            }\r\n        }\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    buildTicks() {\r\n        const min = this.min;\r\n        const max = this.max;\r\n        const offset = this.options.offset;\r\n        const ticks = [];\r\n        let labels = this.getLabels();\r\n        labels = min === 0 && max === labels.length - 1 ? labels : labels.slice(min, max + 1);\r\n        this._valueRange = Math.max(labels.length - (offset ? 0 : 1), 1);\r\n        this._startValue = this.min - (offset ? 0.5 : 0);\r\n        for(let value = min; value <= max; value++){\r\n            ticks.push({\r\n                value\r\n            });\r\n        }\r\n        return ticks;\r\n    }\r\n    getLabelForValue(value) {\r\n        return _getLabelForValue.call(this, value);\r\n    }\r\n configure() {\r\n        super.configure();\r\n        if (!this.isHorizontal()) {\r\n            this._reversePixels = !this._reversePixels;\r\n        }\r\n    }\r\n    getPixelForValue(value) {\r\n        if (typeof value !== 'number') {\r\n            value = this.parse(value);\r\n        }\r\n        return value === null ? NaN : this.getPixelForDecimal((value - this._startValue) / this._valueRange);\r\n    }\r\n    getPixelForTick(index) {\r\n        const ticks = this.ticks;\r\n        if (index < 0 || index > ticks.length - 1) {\r\n            return null;\r\n        }\r\n        return this.getPixelForValue(ticks[index].value);\r\n    }\r\n    getValueForPixel(pixel) {\r\n        return Math.round(this._startValue + this.getDecimalForPixel(pixel) * this._valueRange);\r\n    }\r\n    getBasePixel() {\r\n        return this.bottom;\r\n    }\r\n}\r\n\r\nfunction generateTicks$1(generationOptions, dataRange) {\r\n    const ticks = [];\r\n    const MIN_SPACING = 1e-14;\r\n    const { bounds , step , min , max , precision , count , maxTicks , maxDigits , includeBounds  } = generationOptions;\r\n    const unit = step || 1;\r\n    const maxSpaces = maxTicks - 1;\r\n    const { min: rmin , max: rmax  } = dataRange;\r\n    const minDefined = !isNullOrUndef(min);\r\n    const maxDefined = !isNullOrUndef(max);\r\n    const countDefined = !isNullOrUndef(count);\r\n    const minSpacing = (rmax - rmin) / (maxDigits + 1);\r\n    let spacing = niceNum((rmax - rmin) / maxSpaces / unit) * unit;\r\n    let factor, niceMin, niceMax, numSpaces;\r\n    if (spacing < MIN_SPACING && !minDefined && !maxDefined) {\r\n        return [\r\n            {\r\n                value: rmin\r\n            },\r\n            {\r\n                value: rmax\r\n            }\r\n        ];\r\n    }\r\n    numSpaces = Math.ceil(rmax / spacing) - Math.floor(rmin / spacing);\r\n    if (numSpaces > maxSpaces) {\r\n        spacing = niceNum(numSpaces * spacing / maxSpaces / unit) * unit;\r\n    }\r\n    if (!isNullOrUndef(precision)) {\r\n        factor = Math.pow(10, precision);\r\n        spacing = Math.ceil(spacing * factor) / factor;\r\n    }\r\n    if (bounds === 'ticks') {\r\n        niceMin = Math.floor(rmin / spacing) * spacing;\r\n        niceMax = Math.ceil(rmax / spacing) * spacing;\r\n    } else {\r\n        niceMin = rmin;\r\n        niceMax = rmax;\r\n    }\r\n    if (minDefined && maxDefined && step && almostWhole((max - min) / step, spacing / 1000)) {\r\n        numSpaces = Math.round(Math.min((max - min) / spacing, maxTicks));\r\n        spacing = (max - min) / numSpaces;\r\n        niceMin = min;\r\n        niceMax = max;\r\n    } else if (countDefined) {\r\n        niceMin = minDefined ? min : niceMin;\r\n        niceMax = maxDefined ? max : niceMax;\r\n        numSpaces = count - 1;\r\n        spacing = (niceMax - niceMin) / numSpaces;\r\n    } else {\r\n        numSpaces = (niceMax - niceMin) / spacing;\r\n        if (almostEquals(numSpaces, Math.round(numSpaces), spacing / 1000)) {\r\n            numSpaces = Math.round(numSpaces);\r\n        } else {\r\n            numSpaces = Math.ceil(numSpaces);\r\n        }\r\n    }\r\n    const decimalPlaces = Math.max(_decimalPlaces(spacing), _decimalPlaces(niceMin));\r\n    factor = Math.pow(10, isNullOrUndef(precision) ? decimalPlaces : precision);\r\n    niceMin = Math.round(niceMin * factor) / factor;\r\n    niceMax = Math.round(niceMax * factor) / factor;\r\n    let j = 0;\r\n    if (minDefined) {\r\n        if (includeBounds && niceMin !== min) {\r\n            ticks.push({\r\n                value: min\r\n            });\r\n            if (niceMin < min) {\r\n                j++;\r\n            }\r\n            if (almostEquals(Math.round((niceMin + j * spacing) * factor) / factor, min, relativeLabelSize(min, minSpacing, generationOptions))) {\r\n                j++;\r\n            }\r\n        } else if (niceMin < min) {\r\n            j++;\r\n        }\r\n    }\r\n    for(; j < numSpaces; ++j){\r\n        const tickValue = Math.round((niceMin + j * spacing) * factor) / factor;\r\n        if (maxDefined && tickValue > max) {\r\n            break;\r\n        }\r\n        ticks.push({\r\n            value: tickValue\r\n        });\r\n    }\r\n    if (maxDefined && includeBounds && niceMax !== max) {\r\n        if (ticks.length && almostEquals(ticks[ticks.length - 1].value, max, relativeLabelSize(max, minSpacing, generationOptions))) {\r\n            ticks[ticks.length - 1].value = max;\r\n        } else {\r\n            ticks.push({\r\n                value: max\r\n            });\r\n        }\r\n    } else if (!maxDefined || niceMax === max) {\r\n        ticks.push({\r\n            value: niceMax\r\n        });\r\n    }\r\n    return ticks;\r\n}\r\nfunction relativeLabelSize(value, minSpacing, { horizontal , minRotation  }) {\r\n    const rad = toRadians(minRotation);\r\n    const ratio = (horizontal ? Math.sin(rad) : Math.cos(rad)) || 0.001;\r\n    const length = 0.75 * minSpacing * ('' + value).length;\r\n    return Math.min(minSpacing / ratio, length);\r\n}\r\nclass LinearScaleBase extends Scale {\r\n    constructor(cfg){\r\n        super(cfg);\r\n         this.start = undefined;\r\n         this.end = undefined;\r\n         this._startValue = undefined;\r\n         this._endValue = undefined;\r\n        this._valueRange = 0;\r\n    }\r\n    parse(raw, index) {\r\n        if (isNullOrUndef(raw)) {\r\n            return null;\r\n        }\r\n        if ((typeof raw === 'number' || raw instanceof Number) && !isFinite(+raw)) {\r\n            return null;\r\n        }\r\n        return +raw;\r\n    }\r\n    handleTickRangeOptions() {\r\n        const { beginAtZero  } = this.options;\r\n        const { minDefined , maxDefined  } = this.getUserBounds();\r\n        let { min , max  } = this;\r\n        const setMin = (v)=>min = minDefined ? min : v;\r\n        const setMax = (v)=>max = maxDefined ? max : v;\r\n        if (beginAtZero) {\r\n            const minSign = sign(min);\r\n            const maxSign = sign(max);\r\n            if (minSign < 0 && maxSign < 0) {\r\n                setMax(0);\r\n            } else if (minSign > 0 && maxSign > 0) {\r\n                setMin(0);\r\n            }\r\n        }\r\n        if (min === max) {\r\n            let offset = max === 0 ? 1 : Math.abs(max * 0.05);\r\n            setMax(max + offset);\r\n            if (!beginAtZero) {\r\n                setMin(min - offset);\r\n            }\r\n        }\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    getTickLimit() {\r\n        const tickOpts = this.options.ticks;\r\n        let { maxTicksLimit , stepSize  } = tickOpts;\r\n        let maxTicks;\r\n        if (stepSize) {\r\n            maxTicks = Math.ceil(this.max / stepSize) - Math.floor(this.min / stepSize) + 1;\r\n            if (maxTicks > 1000) {\r\n                console.warn(`scales.${this.id}.ticks.stepSize: ${stepSize} would result generating up to ${maxTicks} ticks. Limiting to 1000.`);\r\n                maxTicks = 1000;\r\n            }\r\n        } else {\r\n            maxTicks = this.computeTickLimit();\r\n            maxTicksLimit = maxTicksLimit || 11;\r\n        }\r\n        if (maxTicksLimit) {\r\n            maxTicks = Math.min(maxTicksLimit, maxTicks);\r\n        }\r\n        return maxTicks;\r\n    }\r\n computeTickLimit() {\r\n        return Number.POSITIVE_INFINITY;\r\n    }\r\n    buildTicks() {\r\n        const opts = this.options;\r\n        const tickOpts = opts.ticks;\r\n        let maxTicks = this.getTickLimit();\r\n        maxTicks = Math.max(2, maxTicks);\r\n        const numericGeneratorOptions = {\r\n            maxTicks,\r\n            bounds: opts.bounds,\r\n            min: opts.min,\r\n            max: opts.max,\r\n            precision: tickOpts.precision,\r\n            step: tickOpts.stepSize,\r\n            count: tickOpts.count,\r\n            maxDigits: this._maxDigits(),\r\n            horizontal: this.isHorizontal(),\r\n            minRotation: tickOpts.minRotation || 0,\r\n            includeBounds: tickOpts.includeBounds !== false\r\n        };\r\n        const dataRange = this._range || this;\r\n        const ticks = generateTicks$1(numericGeneratorOptions, dataRange);\r\n        if (opts.bounds === 'ticks') {\r\n            _setMinAndMaxByKey(ticks, this, 'value');\r\n        }\r\n        if (opts.reverse) {\r\n            ticks.reverse();\r\n            this.start = this.max;\r\n            this.end = this.min;\r\n        } else {\r\n            this.start = this.min;\r\n            this.end = this.max;\r\n        }\r\n        return ticks;\r\n    }\r\n configure() {\r\n        const ticks = this.ticks;\r\n        let start = this.min;\r\n        let end = this.max;\r\n        super.configure();\r\n        if (this.options.offset && ticks.length) {\r\n            const offset = (end - start) / Math.max(ticks.length - 1, 1) / 2;\r\n            start -= offset;\r\n            end += offset;\r\n        }\r\n        this._startValue = start;\r\n        this._endValue = end;\r\n        this._valueRange = end - start;\r\n    }\r\n    getLabelForValue(value) {\r\n        return formatNumber(value, this.chart.options.locale, this.options.ticks.format);\r\n    }\r\n}\r\n\r\nclass LinearScale extends LinearScaleBase {\r\n    static id = 'linear';\r\n static defaults = {\r\n        ticks: {\r\n            callback: Ticks.formatters.numeric\r\n        }\r\n    };\r\n    determineDataLimits() {\r\n        const { min , max  } = this.getMinMax(true);\r\n        this.min = isNumberFinite(min) ? min : 0;\r\n        this.max = isNumberFinite(max) ? max : 1;\r\n        this.handleTickRangeOptions();\r\n    }\r\n computeTickLimit() {\r\n        const horizontal = this.isHorizontal();\r\n        const length = horizontal ? this.width : this.height;\r\n        const minRotation = toRadians(this.options.ticks.minRotation);\r\n        const ratio = (horizontal ? Math.sin(minRotation) : Math.cos(minRotation)) || 0.001;\r\n        const tickFont = this._resolveTickFontOptions(0);\r\n        return Math.ceil(length / Math.min(40, tickFont.lineHeight / ratio));\r\n    }\r\n    getPixelForValue(value) {\r\n        return value === null ? NaN : this.getPixelForDecimal((value - this._startValue) / this._valueRange);\r\n    }\r\n    getValueForPixel(pixel) {\r\n        return this._startValue + this.getDecimalForPixel(pixel) * this._valueRange;\r\n    }\r\n}\r\n\r\nconst log10Floor = (v)=>Math.floor(log10(v));\r\nconst changeExponent = (v, m)=>Math.pow(10, log10Floor(v) + m);\r\nfunction isMajor(tickVal) {\r\n    const remain = tickVal / Math.pow(10, log10Floor(tickVal));\r\n    return remain === 1;\r\n}\r\nfunction steps(min, max, rangeExp) {\r\n    const rangeStep = Math.pow(10, rangeExp);\r\n    const start = Math.floor(min / rangeStep);\r\n    const end = Math.ceil(max / rangeStep);\r\n    return end - start;\r\n}\r\nfunction startExp(min, max) {\r\n    const range = max - min;\r\n    let rangeExp = log10Floor(range);\r\n    while(steps(min, max, rangeExp) > 10){\r\n        rangeExp++;\r\n    }\r\n    while(steps(min, max, rangeExp) < 10){\r\n        rangeExp--;\r\n    }\r\n    return Math.min(rangeExp, log10Floor(min));\r\n}\r\n function generateTicks(generationOptions, { min , max  }) {\r\n    min = finiteOrDefault(generationOptions.min, min);\r\n    const ticks = [];\r\n    const minExp = log10Floor(min);\r\n    let exp = startExp(min, max);\r\n    let precision = exp < 0 ? Math.pow(10, Math.abs(exp)) : 1;\r\n    const stepSize = Math.pow(10, exp);\r\n    const base = minExp > exp ? Math.pow(10, minExp) : 0;\r\n    const start = Math.round((min - base) * precision) / precision;\r\n    const offset = Math.floor((min - base) / stepSize / 10) * stepSize * 10;\r\n    let significand = Math.floor((start - offset) / Math.pow(10, exp));\r\n    let value = finiteOrDefault(generationOptions.min, Math.round((base + offset + significand * Math.pow(10, exp)) * precision) / precision);\r\n    while(value < max){\r\n        ticks.push({\r\n            value,\r\n            major: isMajor(value),\r\n            significand\r\n        });\r\n        if (significand >= 10) {\r\n            significand = significand < 15 ? 15 : 20;\r\n        } else {\r\n            significand++;\r\n        }\r\n        if (significand >= 20) {\r\n            exp++;\r\n            significand = 2;\r\n            precision = exp >= 0 ? 1 : precision;\r\n        }\r\n        value = Math.round((base + offset + significand * Math.pow(10, exp)) * precision) / precision;\r\n    }\r\n    const lastTick = finiteOrDefault(generationOptions.max, value);\r\n    ticks.push({\r\n        value: lastTick,\r\n        major: isMajor(lastTick),\r\n        significand\r\n    });\r\n    return ticks;\r\n}\r\nclass LogarithmicScale extends Scale {\r\n    static id = 'logarithmic';\r\n static defaults = {\r\n        ticks: {\r\n            callback: Ticks.formatters.logarithmic,\r\n            major: {\r\n                enabled: true\r\n            }\r\n        }\r\n    };\r\n    constructor(cfg){\r\n        super(cfg);\r\n         this.start = undefined;\r\n         this.end = undefined;\r\n         this._startValue = undefined;\r\n        this._valueRange = 0;\r\n    }\r\n    parse(raw, index) {\r\n        const value = LinearScaleBase.prototype.parse.apply(this, [\r\n            raw,\r\n            index\r\n        ]);\r\n        if (value === 0) {\r\n            this._zero = true;\r\n            return undefined;\r\n        }\r\n        return isNumberFinite(value) && value > 0 ? value : null;\r\n    }\r\n    determineDataLimits() {\r\n        const { min , max  } = this.getMinMax(true);\r\n        this.min = isNumberFinite(min) ? Math.max(0, min) : null;\r\n        this.max = isNumberFinite(max) ? Math.max(0, max) : null;\r\n        if (this.options.beginAtZero) {\r\n            this._zero = true;\r\n        }\r\n        if (this._zero && this.min !== this._suggestedMin && !isNumberFinite(this._userMin)) {\r\n            this.min = min === changeExponent(this.min, 0) ? changeExponent(this.min, -1) : changeExponent(this.min, 0);\r\n        }\r\n        this.handleTickRangeOptions();\r\n    }\r\n    handleTickRangeOptions() {\r\n        const { minDefined , maxDefined  } = this.getUserBounds();\r\n        let min = this.min;\r\n        let max = this.max;\r\n        const setMin = (v)=>min = minDefined ? min : v;\r\n        const setMax = (v)=>max = maxDefined ? max : v;\r\n        if (min === max) {\r\n            if (min <= 0) {\r\n                setMin(1);\r\n                setMax(10);\r\n            } else {\r\n                setMin(changeExponent(min, -1));\r\n                setMax(changeExponent(max, +1));\r\n            }\r\n        }\r\n        if (min <= 0) {\r\n            setMin(changeExponent(max, -1));\r\n        }\r\n        if (max <= 0) {\r\n            setMax(changeExponent(min, +1));\r\n        }\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    buildTicks() {\r\n        const opts = this.options;\r\n        const generationOptions = {\r\n            min: this._userMin,\r\n            max: this._userMax\r\n        };\r\n        const ticks = generateTicks(generationOptions, this);\r\n        if (opts.bounds === 'ticks') {\r\n            _setMinAndMaxByKey(ticks, this, 'value');\r\n        }\r\n        if (opts.reverse) {\r\n            ticks.reverse();\r\n            this.start = this.max;\r\n            this.end = this.min;\r\n        } else {\r\n            this.start = this.min;\r\n            this.end = this.max;\r\n        }\r\n        return ticks;\r\n    }\r\n getLabelForValue(value) {\r\n        return value === undefined ? '0' : formatNumber(value, this.chart.options.locale, this.options.ticks.format);\r\n    }\r\n configure() {\r\n        const start = this.min;\r\n        super.configure();\r\n        this._startValue = log10(start);\r\n        this._valueRange = log10(this.max) - log10(start);\r\n    }\r\n    getPixelForValue(value) {\r\n        if (value === undefined || value === 0) {\r\n            value = this.min;\r\n        }\r\n        if (value === null || isNaN(value)) {\r\n            return NaN;\r\n        }\r\n        return this.getPixelForDecimal(value === this.min ? 0 : (log10(value) - this._startValue) / this._valueRange);\r\n    }\r\n    getValueForPixel(pixel) {\r\n        const decimal = this.getDecimalForPixel(pixel);\r\n        return Math.pow(10, this._startValue + decimal * this._valueRange);\r\n    }\r\n}\r\n\r\nfunction getTickBackdropHeight(opts) {\r\n    const tickOpts = opts.ticks;\r\n    if (tickOpts.display && opts.display) {\r\n        const padding = toPadding(tickOpts.backdropPadding);\r\n        return valueOrDefault(tickOpts.font && tickOpts.font.size, defaults.font.size) + padding.height;\r\n    }\r\n    return 0;\r\n}\r\nfunction measureLabelSize(ctx, font, label) {\r\n    label = isArray(label) ? label : [\r\n        label\r\n    ];\r\n    return {\r\n        w: _longestText(ctx, font.string, label),\r\n        h: label.length * font.lineHeight\r\n    };\r\n}\r\nfunction determineLimits(angle, pos, size, min, max) {\r\n    if (angle === min || angle === max) {\r\n        return {\r\n            start: pos - size / 2,\r\n            end: pos + size / 2\r\n        };\r\n    } else if (angle < min || angle > max) {\r\n        return {\r\n            start: pos - size,\r\n            end: pos\r\n        };\r\n    }\r\n    return {\r\n        start: pos,\r\n        end: pos + size\r\n    };\r\n}\r\n function fitWithPointLabels(scale) {\r\n    const orig = {\r\n        l: scale.left + scale._padding.left,\r\n        r: scale.right - scale._padding.right,\r\n        t: scale.top + scale._padding.top,\r\n        b: scale.bottom - scale._padding.bottom\r\n    };\r\n    const limits = Object.assign({}, orig);\r\n    const labelSizes = [];\r\n    const padding = [];\r\n    const valueCount = scale._pointLabels.length;\r\n    const pointLabelOpts = scale.options.pointLabels;\r\n    const additionalAngle = pointLabelOpts.centerPointLabels ? PI / valueCount : 0;\r\n    for(let i = 0; i < valueCount; i++){\r\n        const opts = pointLabelOpts.setContext(scale.getPointLabelContext(i));\r\n        padding[i] = opts.padding;\r\n        const pointPosition = scale.getPointPosition(i, scale.drawingArea + padding[i], additionalAngle);\r\n        const plFont = toFont(opts.font);\r\n        const textSize = measureLabelSize(scale.ctx, plFont, scale._pointLabels[i]);\r\n        labelSizes[i] = textSize;\r\n        const angleRadians = _normalizeAngle(scale.getIndexAngle(i) + additionalAngle);\r\n        const angle = Math.round(toDegrees(angleRadians));\r\n        const hLimits = determineLimits(angle, pointPosition.x, textSize.w, 0, 180);\r\n        const vLimits = determineLimits(angle, pointPosition.y, textSize.h, 90, 270);\r\n        updateLimits(limits, orig, angleRadians, hLimits, vLimits);\r\n    }\r\n    scale.setCenterPoint(orig.l - limits.l, limits.r - orig.r, orig.t - limits.t, limits.b - orig.b);\r\n    scale._pointLabelItems = buildPointLabelItems(scale, labelSizes, padding);\r\n}\r\nfunction updateLimits(limits, orig, angle, hLimits, vLimits) {\r\n    const sin = Math.abs(Math.sin(angle));\r\n    const cos = Math.abs(Math.cos(angle));\r\n    let x = 0;\r\n    let y = 0;\r\n    if (hLimits.start < orig.l) {\r\n        x = (orig.l - hLimits.start) / sin;\r\n        limits.l = Math.min(limits.l, orig.l - x);\r\n    } else if (hLimits.end > orig.r) {\r\n        x = (hLimits.end - orig.r) / sin;\r\n        limits.r = Math.max(limits.r, orig.r + x);\r\n    }\r\n    if (vLimits.start < orig.t) {\r\n        y = (orig.t - vLimits.start) / cos;\r\n        limits.t = Math.min(limits.t, orig.t - y);\r\n    } else if (vLimits.end > orig.b) {\r\n        y = (vLimits.end - orig.b) / cos;\r\n        limits.b = Math.max(limits.b, orig.b + y);\r\n    }\r\n}\r\nfunction createPointLabelItem(scale, index, itemOpts) {\r\n    const outerDistance = scale.drawingArea;\r\n    const { extra , additionalAngle , padding , size  } = itemOpts;\r\n    const pointLabelPosition = scale.getPointPosition(index, outerDistance + extra + padding, additionalAngle);\r\n    const angle = Math.round(toDegrees(_normalizeAngle(pointLabelPosition.angle + HALF_PI)));\r\n    const y = yForAngle(pointLabelPosition.y, size.h, angle);\r\n    const textAlign = getTextAlignForAngle(angle);\r\n    const left = leftForTextAlign(pointLabelPosition.x, size.w, textAlign);\r\n    return {\r\n        visible: true,\r\n        x: pointLabelPosition.x,\r\n        y,\r\n        textAlign,\r\n        left,\r\n        top: y,\r\n        right: left + size.w,\r\n        bottom: y + size.h\r\n    };\r\n}\r\nfunction isNotOverlapped(item, area) {\r\n    if (!area) {\r\n        return true;\r\n    }\r\n    const { left , top , right , bottom  } = item;\r\n    const apexesInArea = _isPointInArea({\r\n        x: left,\r\n        y: top\r\n    }, area) || _isPointInArea({\r\n        x: left,\r\n        y: bottom\r\n    }, area) || _isPointInArea({\r\n        x: right,\r\n        y: top\r\n    }, area) || _isPointInArea({\r\n        x: right,\r\n        y: bottom\r\n    }, area);\r\n    return !apexesInArea;\r\n}\r\nfunction buildPointLabelItems(scale, labelSizes, padding) {\r\n    const items = [];\r\n    const valueCount = scale._pointLabels.length;\r\n    const opts = scale.options;\r\n    const { centerPointLabels , display  } = opts.pointLabels;\r\n    const itemOpts = {\r\n        extra: getTickBackdropHeight(opts) / 2,\r\n        additionalAngle: centerPointLabels ? PI / valueCount : 0\r\n    };\r\n    let area;\r\n    for(let i = 0; i < valueCount; i++){\r\n        itemOpts.padding = padding[i];\r\n        itemOpts.size = labelSizes[i];\r\n        const item = createPointLabelItem(scale, i, itemOpts);\r\n        items.push(item);\r\n        if (display === 'auto') {\r\n            item.visible = isNotOverlapped(item, area);\r\n            if (item.visible) {\r\n                area = item;\r\n            }\r\n        }\r\n    }\r\n    return items;\r\n}\r\nfunction getTextAlignForAngle(angle) {\r\n    if (angle === 0 || angle === 180) {\r\n        return 'center';\r\n    } else if (angle < 180) {\r\n        return 'left';\r\n    }\r\n    return 'right';\r\n}\r\nfunction leftForTextAlign(x, w, align) {\r\n    if (align === 'right') {\r\n        x -= w;\r\n    } else if (align === 'center') {\r\n        x -= w / 2;\r\n    }\r\n    return x;\r\n}\r\nfunction yForAngle(y, h, angle) {\r\n    if (angle === 90 || angle === 270) {\r\n        y -= h / 2;\r\n    } else if (angle > 270 || angle < 90) {\r\n        y -= h;\r\n    }\r\n    return y;\r\n}\r\nfunction drawPointLabelBox(ctx, opts, item) {\r\n    const { left , top , right , bottom  } = item;\r\n    const { backdropColor  } = opts;\r\n    if (!isNullOrUndef(backdropColor)) {\r\n        const borderRadius = toTRBLCorners(opts.borderRadius);\r\n        const padding = toPadding(opts.backdropPadding);\r\n        ctx.fillStyle = backdropColor;\r\n        const backdropLeft = left - padding.left;\r\n        const backdropTop = top - padding.top;\r\n        const backdropWidth = right - left + padding.width;\r\n        const backdropHeight = bottom - top + padding.height;\r\n        if (Object.values(borderRadius).some((v)=>v !== 0)) {\r\n            ctx.beginPath();\r\n            addRoundedRectPath(ctx, {\r\n                x: backdropLeft,\r\n                y: backdropTop,\r\n                w: backdropWidth,\r\n                h: backdropHeight,\r\n                radius: borderRadius\r\n            });\r\n            ctx.fill();\r\n        } else {\r\n            ctx.fillRect(backdropLeft, backdropTop, backdropWidth, backdropHeight);\r\n        }\r\n    }\r\n}\r\nfunction drawPointLabels(scale, labelCount) {\r\n    const { ctx , options: { pointLabels  }  } = scale;\r\n    for(let i = labelCount - 1; i >= 0; i--){\r\n        const item = scale._pointLabelItems[i];\r\n        if (!item.visible) {\r\n            continue;\r\n        }\r\n        const optsAtIndex = pointLabels.setContext(scale.getPointLabelContext(i));\r\n        drawPointLabelBox(ctx, optsAtIndex, item);\r\n        const plFont = toFont(optsAtIndex.font);\r\n        const { x , y , textAlign  } = item;\r\n        renderText(ctx, scale._pointLabels[i], x, y + plFont.lineHeight / 2, plFont, {\r\n            color: optsAtIndex.color,\r\n            textAlign: textAlign,\r\n            textBaseline: 'middle'\r\n        });\r\n    }\r\n}\r\nfunction pathRadiusLine(scale, radius, circular, labelCount) {\r\n    const { ctx  } = scale;\r\n    if (circular) {\r\n        ctx.arc(scale.xCenter, scale.yCenter, radius, 0, TAU);\r\n    } else {\r\n        let pointPosition = scale.getPointPosition(0, radius);\r\n        ctx.moveTo(pointPosition.x, pointPosition.y);\r\n        for(let i = 1; i < labelCount; i++){\r\n            pointPosition = scale.getPointPosition(i, radius);\r\n            ctx.lineTo(pointPosition.x, pointPosition.y);\r\n        }\r\n    }\r\n}\r\nfunction drawRadiusLine(scale, gridLineOpts, radius, labelCount, borderOpts) {\r\n    const ctx = scale.ctx;\r\n    const circular = gridLineOpts.circular;\r\n    const { color , lineWidth  } = gridLineOpts;\r\n    if (!circular && !labelCount || !color || !lineWidth || radius < 0) {\r\n        return;\r\n    }\r\n    ctx.save();\r\n    ctx.strokeStyle = color;\r\n    ctx.lineWidth = lineWidth;\r\n    ctx.setLineDash(borderOpts.dash || []);\r\n    ctx.lineDashOffset = borderOpts.dashOffset;\r\n    ctx.beginPath();\r\n    pathRadiusLine(scale, radius, circular, labelCount);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}\r\nfunction createPointLabelContext(parent, index, label) {\r\n    return createContext(parent, {\r\n        label,\r\n        index,\r\n        type: 'pointLabel'\r\n    });\r\n}\r\nclass RadialLinearScale extends LinearScaleBase {\r\n    static id = 'radialLinear';\r\n static defaults = {\r\n        display: true,\r\n        animate: true,\r\n        position: 'chartArea',\r\n        angleLines: {\r\n            display: true,\r\n            lineWidth: 1,\r\n            borderDash: [],\r\n            borderDashOffset: 0.0\r\n        },\r\n        grid: {\r\n            circular: false\r\n        },\r\n        startAngle: 0,\r\n        ticks: {\r\n            showLabelBackdrop: true,\r\n            callback: Ticks.formatters.numeric\r\n        },\r\n        pointLabels: {\r\n            backdropColor: undefined,\r\n            backdropPadding: 2,\r\n            display: true,\r\n            font: {\r\n                size: 10\r\n            },\r\n            callback (label) {\r\n                return label;\r\n            },\r\n            padding: 5,\r\n            centerPointLabels: false\r\n        }\r\n    };\r\n    static defaultRoutes = {\r\n        'angleLines.color': 'borderColor',\r\n        'pointLabels.color': 'color',\r\n        'ticks.color': 'color'\r\n    };\r\n    static descriptors = {\r\n        angleLines: {\r\n            _fallback: 'grid'\r\n        }\r\n    };\r\n    constructor(cfg){\r\n        super(cfg);\r\n         this.xCenter = undefined;\r\n         this.yCenter = undefined;\r\n         this.drawingArea = undefined;\r\n         this._pointLabels = [];\r\n        this._pointLabelItems = [];\r\n    }\r\n    setDimensions() {\r\n        const padding = this._padding = toPadding(getTickBackdropHeight(this.options) / 2);\r\n        const w = this.width = this.maxWidth - padding.width;\r\n        const h = this.height = this.maxHeight - padding.height;\r\n        this.xCenter = Math.floor(this.left + w / 2 + padding.left);\r\n        this.yCenter = Math.floor(this.top + h / 2 + padding.top);\r\n        this.drawingArea = Math.floor(Math.min(w, h) / 2);\r\n    }\r\n    determineDataLimits() {\r\n        const { min , max  } = this.getMinMax(false);\r\n        this.min = isNumberFinite(min) && !isNaN(min) ? min : 0;\r\n        this.max = isNumberFinite(max) && !isNaN(max) ? max : 0;\r\n        this.handleTickRangeOptions();\r\n    }\r\n computeTickLimit() {\r\n        return Math.ceil(this.drawingArea / getTickBackdropHeight(this.options));\r\n    }\r\n    generateTickLabels(ticks) {\r\n        LinearScaleBase.prototype.generateTickLabels.call(this, ticks);\r\n        this._pointLabels = this.getLabels().map((value, index)=>{\r\n            const label = callback(this.options.pointLabels.callback, [\r\n                value,\r\n                index\r\n            ], this);\r\n            return label || label === 0 ? label : '';\r\n        }).filter((v, i)=>this.chart.getDataVisibility(i));\r\n    }\r\n    fit() {\r\n        const opts = this.options;\r\n        if (opts.display && opts.pointLabels.display) {\r\n            fitWithPointLabels(this);\r\n        } else {\r\n            this.setCenterPoint(0, 0, 0, 0);\r\n        }\r\n    }\r\n    setCenterPoint(leftMovement, rightMovement, topMovement, bottomMovement) {\r\n        this.xCenter += Math.floor((leftMovement - rightMovement) / 2);\r\n        this.yCenter += Math.floor((topMovement - bottomMovement) / 2);\r\n        this.drawingArea -= Math.min(this.drawingArea / 2, Math.max(leftMovement, rightMovement, topMovement, bottomMovement));\r\n    }\r\n    getIndexAngle(index) {\r\n        const angleMultiplier = TAU / (this._pointLabels.length || 1);\r\n        const startAngle = this.options.startAngle || 0;\r\n        return _normalizeAngle(index * angleMultiplier + toRadians(startAngle));\r\n    }\r\n    getDistanceFromCenterForValue(value) {\r\n        if (isNullOrUndef(value)) {\r\n            return NaN;\r\n        }\r\n        const scalingFactor = this.drawingArea / (this.max - this.min);\r\n        if (this.options.reverse) {\r\n            return (this.max - value) * scalingFactor;\r\n        }\r\n        return (value - this.min) * scalingFactor;\r\n    }\r\n    getValueForDistanceFromCenter(distance) {\r\n        if (isNullOrUndef(distance)) {\r\n            return NaN;\r\n        }\r\n        const scaledDistance = distance / (this.drawingArea / (this.max - this.min));\r\n        return this.options.reverse ? this.max - scaledDistance : this.min + scaledDistance;\r\n    }\r\n    getPointLabelContext(index) {\r\n        const pointLabels = this._pointLabels || [];\r\n        if (index >= 0 && index < pointLabels.length) {\r\n            const pointLabel = pointLabels[index];\r\n            return createPointLabelContext(this.getContext(), index, pointLabel);\r\n        }\r\n    }\r\n    getPointPosition(index, distanceFromCenter, additionalAngle = 0) {\r\n        const angle = this.getIndexAngle(index) - HALF_PI + additionalAngle;\r\n        return {\r\n            x: Math.cos(angle) * distanceFromCenter + this.xCenter,\r\n            y: Math.sin(angle) * distanceFromCenter + this.yCenter,\r\n            angle\r\n        };\r\n    }\r\n    getPointPositionForValue(index, value) {\r\n        return this.getPointPosition(index, this.getDistanceFromCenterForValue(value));\r\n    }\r\n    getBasePosition(index) {\r\n        return this.getPointPositionForValue(index || 0, this.getBaseValue());\r\n    }\r\n    getPointLabelPosition(index) {\r\n        const { left , top , right , bottom  } = this._pointLabelItems[index];\r\n        return {\r\n            left,\r\n            top,\r\n            right,\r\n            bottom\r\n        };\r\n    }\r\n drawBackground() {\r\n        const { backgroundColor , grid: { circular  }  } = this.options;\r\n        if (backgroundColor) {\r\n            const ctx = this.ctx;\r\n            ctx.save();\r\n            ctx.beginPath();\r\n            pathRadiusLine(this, this.getDistanceFromCenterForValue(this._endValue), circular, this._pointLabels.length);\r\n            ctx.closePath();\r\n            ctx.fillStyle = backgroundColor;\r\n            ctx.fill();\r\n            ctx.restore();\r\n        }\r\n    }\r\n drawGrid() {\r\n        const ctx = this.ctx;\r\n        const opts = this.options;\r\n        const { angleLines , grid , border  } = opts;\r\n        const labelCount = this._pointLabels.length;\r\n        let i, offset, position;\r\n        if (opts.pointLabels.display) {\r\n            drawPointLabels(this, labelCount);\r\n        }\r\n        if (grid.display) {\r\n            this.ticks.forEach((tick, index)=>{\r\n                if (index !== 0 || index === 0 && this.min < 0) {\r\n                    offset = this.getDistanceFromCenterForValue(tick.value);\r\n                    const context = this.getContext(index);\r\n                    const optsAtIndex = grid.setContext(context);\r\n                    const optsAtIndexBorder = border.setContext(context);\r\n                    drawRadiusLine(this, optsAtIndex, offset, labelCount, optsAtIndexBorder);\r\n                }\r\n            });\r\n        }\r\n        if (angleLines.display) {\r\n            ctx.save();\r\n            for(i = labelCount - 1; i >= 0; i--){\r\n                const optsAtIndex = angleLines.setContext(this.getPointLabelContext(i));\r\n                const { color , lineWidth  } = optsAtIndex;\r\n                if (!lineWidth || !color) {\r\n                    continue;\r\n                }\r\n                ctx.lineWidth = lineWidth;\r\n                ctx.strokeStyle = color;\r\n                ctx.setLineDash(optsAtIndex.borderDash);\r\n                ctx.lineDashOffset = optsAtIndex.borderDashOffset;\r\n                offset = this.getDistanceFromCenterForValue(opts.reverse ? this.min : this.max);\r\n                position = this.getPointPosition(i, offset);\r\n                ctx.beginPath();\r\n                ctx.moveTo(this.xCenter, this.yCenter);\r\n                ctx.lineTo(position.x, position.y);\r\n                ctx.stroke();\r\n            }\r\n            ctx.restore();\r\n        }\r\n    }\r\n drawBorder() {}\r\n drawLabels() {\r\n        const ctx = this.ctx;\r\n        const opts = this.options;\r\n        const tickOpts = opts.ticks;\r\n        if (!tickOpts.display) {\r\n            return;\r\n        }\r\n        const startAngle = this.getIndexAngle(0);\r\n        let offset, width;\r\n        ctx.save();\r\n        ctx.translate(this.xCenter, this.yCenter);\r\n        ctx.rotate(startAngle);\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'middle';\r\n        this.ticks.forEach((tick, index)=>{\r\n            if (index === 0 && this.min >= 0 && !opts.reverse) {\r\n                return;\r\n            }\r\n            const optsAtIndex = tickOpts.setContext(this.getContext(index));\r\n            const tickFont = toFont(optsAtIndex.font);\r\n            offset = this.getDistanceFromCenterForValue(this.ticks[index].value);\r\n            if (optsAtIndex.showLabelBackdrop) {\r\n                ctx.font = tickFont.string;\r\n                width = ctx.measureText(tick.label).width;\r\n                ctx.fillStyle = optsAtIndex.backdropColor;\r\n                const padding = toPadding(optsAtIndex.backdropPadding);\r\n                ctx.fillRect(-width / 2 - padding.left, -offset - tickFont.size / 2 - padding.top, width + padding.width, tickFont.size + padding.height);\r\n            }\r\n            renderText(ctx, tick.label, 0, -offset, tickFont, {\r\n                color: optsAtIndex.color,\r\n                strokeColor: optsAtIndex.textStrokeColor,\r\n                strokeWidth: optsAtIndex.textStrokeWidth\r\n            });\r\n        });\r\n        ctx.restore();\r\n    }\r\n drawTitle() {}\r\n}\r\n\r\nconst INTERVALS = {\r\n    millisecond: {\r\n        common: true,\r\n        size: 1,\r\n        steps: 1000\r\n    },\r\n    second: {\r\n        common: true,\r\n        size: 1000,\r\n        steps: 60\r\n    },\r\n    minute: {\r\n        common: true,\r\n        size: 60000,\r\n        steps: 60\r\n    },\r\n    hour: {\r\n        common: true,\r\n        size: 3600000,\r\n        steps: 24\r\n    },\r\n    day: {\r\n        common: true,\r\n        size: 86400000,\r\n        steps: 30\r\n    },\r\n    week: {\r\n        common: false,\r\n        size: 604800000,\r\n        steps: 4\r\n    },\r\n    month: {\r\n        common: true,\r\n        size: 2.628e9,\r\n        steps: 12\r\n    },\r\n    quarter: {\r\n        common: false,\r\n        size: 7.884e9,\r\n        steps: 4\r\n    },\r\n    year: {\r\n        common: true,\r\n        size: 3.154e10\r\n    }\r\n};\r\n const UNITS =  /* #__PURE__ */ Object.keys(INTERVALS);\r\n function sorter(a, b) {\r\n    return a - b;\r\n}\r\n function parse(scale, input) {\r\n    if (isNullOrUndef(input)) {\r\n        return null;\r\n    }\r\n    const adapter = scale._adapter;\r\n    const { parser , round , isoWeekday  } = scale._parseOpts;\r\n    let value = input;\r\n    if (typeof parser === 'function') {\r\n        value = parser(value);\r\n    }\r\n    if (!isNumberFinite(value)) {\r\n        value = typeof parser === 'string' ? adapter.parse(value, parser) : adapter.parse(value);\r\n    }\r\n    if (value === null) {\r\n        return null;\r\n    }\r\n    if (round) {\r\n        value = round === 'week' && (isNumber(isoWeekday) || isoWeekday === true) ? adapter.startOf(value, 'isoWeek', isoWeekday) : adapter.startOf(value, round);\r\n    }\r\n    return +value;\r\n}\r\n function determineUnitForAutoTicks(minUnit, min, max, capacity) {\r\n    const ilen = UNITS.length;\r\n    for(let i = UNITS.indexOf(minUnit); i < ilen - 1; ++i){\r\n        const interval = INTERVALS[UNITS[i]];\r\n        const factor = interval.steps ? interval.steps : Number.MAX_SAFE_INTEGER;\r\n        if (interval.common && Math.ceil((max - min) / (factor * interval.size)) <= capacity) {\r\n            return UNITS[i];\r\n        }\r\n    }\r\n    return UNITS[ilen - 1];\r\n}\r\n function determineUnitForFormatting(scale, numTicks, minUnit, min, max) {\r\n    for(let i = UNITS.length - 1; i >= UNITS.indexOf(minUnit); i--){\r\n        const unit = UNITS[i];\r\n        if (INTERVALS[unit].common && scale._adapter.diff(max, min, unit) >= numTicks - 1) {\r\n            return unit;\r\n        }\r\n    }\r\n    return UNITS[minUnit ? UNITS.indexOf(minUnit) : 0];\r\n}\r\n function determineMajorUnit(unit) {\r\n    for(let i = UNITS.indexOf(unit) + 1, ilen = UNITS.length; i < ilen; ++i){\r\n        if (INTERVALS[UNITS[i]].common) {\r\n            return UNITS[i];\r\n        }\r\n    }\r\n}\r\n function addTick(ticks, time, timestamps) {\r\n    if (!timestamps) {\r\n        ticks[time] = true;\r\n    } else if (timestamps.length) {\r\n        const { lo , hi  } = _lookup(timestamps, time);\r\n        const timestamp = timestamps[lo] >= time ? timestamps[lo] : timestamps[hi];\r\n        ticks[timestamp] = true;\r\n    }\r\n}\r\n function setMajorTicks(scale, ticks, map, majorUnit) {\r\n    const adapter = scale._adapter;\r\n    const first = +adapter.startOf(ticks[0].value, majorUnit);\r\n    const last = ticks[ticks.length - 1].value;\r\n    let major, index;\r\n    for(major = first; major <= last; major = +adapter.add(major, 1, majorUnit)){\r\n        index = map[major];\r\n        if (index >= 0) {\r\n            ticks[index].major = true;\r\n        }\r\n    }\r\n    return ticks;\r\n}\r\n function ticksFromTimestamps(scale, values, majorUnit) {\r\n    const ticks = [];\r\n     const map = {};\r\n    const ilen = values.length;\r\n    let i, value;\r\n    for(i = 0; i < ilen; ++i){\r\n        value = values[i];\r\n        map[value] = i;\r\n        ticks.push({\r\n            value,\r\n            major: false\r\n        });\r\n    }\r\n    return ilen === 0 || !majorUnit ? ticks : setMajorTicks(scale, ticks, map, majorUnit);\r\n}\r\nclass TimeScale extends Scale {\r\n    static id = 'time';\r\n static defaults = {\r\n bounds: 'data',\r\n        adapters: {},\r\n        time: {\r\n            parser: false,\r\n            unit: false,\r\n            round: false,\r\n            isoWeekday: false,\r\n            minUnit: 'millisecond',\r\n            displayFormats: {}\r\n        },\r\n        ticks: {\r\n source: 'auto',\r\n            callback: false,\r\n            major: {\r\n                enabled: false\r\n            }\r\n        }\r\n    };\r\n constructor(props){\r\n        super(props);\r\n         this._cache = {\r\n            data: [],\r\n            labels: [],\r\n            all: []\r\n        };\r\n         this._unit = 'day';\r\n         this._majorUnit = undefined;\r\n        this._offsets = {};\r\n        this._normalized = false;\r\n        this._parseOpts = undefined;\r\n    }\r\n    init(scaleOpts, opts = {}) {\r\n        const time = scaleOpts.time || (scaleOpts.time = {});\r\n         const adapter = this._adapter = new adapters._date(scaleOpts.adapters.date);\r\n        adapter.init(opts);\r\n        mergeIf(time.displayFormats, adapter.formats());\r\n        this._parseOpts = {\r\n            parser: time.parser,\r\n            round: time.round,\r\n            isoWeekday: time.isoWeekday\r\n        };\r\n        super.init(scaleOpts);\r\n        this._normalized = opts.normalized;\r\n    }\r\n parse(raw, index) {\r\n        if (raw === undefined) {\r\n            return null;\r\n        }\r\n        return parse(this, raw);\r\n    }\r\n    beforeLayout() {\r\n        super.beforeLayout();\r\n        this._cache = {\r\n            data: [],\r\n            labels: [],\r\n            all: []\r\n        };\r\n    }\r\n    determineDataLimits() {\r\n        const options = this.options;\r\n        const adapter = this._adapter;\r\n        const unit = options.time.unit || 'day';\r\n        let { min , max , minDefined , maxDefined  } = this.getUserBounds();\r\n function _applyBounds(bounds) {\r\n            if (!minDefined && !isNaN(bounds.min)) {\r\n                min = Math.min(min, bounds.min);\r\n            }\r\n            if (!maxDefined && !isNaN(bounds.max)) {\r\n                max = Math.max(max, bounds.max);\r\n            }\r\n        }\r\n        if (!minDefined || !maxDefined) {\r\n            _applyBounds(this._getLabelBounds());\r\n            if (options.bounds !== 'ticks' || options.ticks.source !== 'labels') {\r\n                _applyBounds(this.getMinMax(false));\r\n            }\r\n        }\r\n        min = isNumberFinite(min) && !isNaN(min) ? min : +adapter.startOf(Date.now(), unit);\r\n        max = isNumberFinite(max) && !isNaN(max) ? max : +adapter.endOf(Date.now(), unit) + 1;\r\n        this.min = Math.min(min, max - 1);\r\n        this.max = Math.max(min + 1, max);\r\n    }\r\n _getLabelBounds() {\r\n        const arr = this.getLabelTimestamps();\r\n        let min = Number.POSITIVE_INFINITY;\r\n        let max = Number.NEGATIVE_INFINITY;\r\n        if (arr.length) {\r\n            min = arr[0];\r\n            max = arr[arr.length - 1];\r\n        }\r\n        return {\r\n            min,\r\n            max\r\n        };\r\n    }\r\n buildTicks() {\r\n        const options = this.options;\r\n        const timeOpts = options.time;\r\n        const tickOpts = options.ticks;\r\n        const timestamps = tickOpts.source === 'labels' ? this.getLabelTimestamps() : this._generate();\r\n        if (options.bounds === 'ticks' && timestamps.length) {\r\n            this.min = this._userMin || timestamps[0];\r\n            this.max = this._userMax || timestamps[timestamps.length - 1];\r\n        }\r\n        const min = this.min;\r\n        const max = this.max;\r\n        const ticks = _filterBetween(timestamps, min, max);\r\n        this._unit = timeOpts.unit || (tickOpts.autoSkip ? determineUnitForAutoTicks(timeOpts.minUnit, this.min, this.max, this._getLabelCapacity(min)) : determineUnitForFormatting(this, ticks.length, timeOpts.minUnit, this.min, this.max));\r\n        this._majorUnit = !tickOpts.major.enabled || this._unit === 'year' ? undefined : determineMajorUnit(this._unit);\r\n        this.initOffsets(timestamps);\r\n        if (options.reverse) {\r\n            ticks.reverse();\r\n        }\r\n        return ticksFromTimestamps(this, ticks, this._majorUnit);\r\n    }\r\n    afterAutoSkip() {\r\n        if (this.options.offsetAfterAutoskip) {\r\n            this.initOffsets(this.ticks.map((tick)=>+tick.value));\r\n        }\r\n    }\r\n initOffsets(timestamps = []) {\r\n        let start = 0;\r\n        let end = 0;\r\n        let first, last;\r\n        if (this.options.offset && timestamps.length) {\r\n            first = this.getDecimalForValue(timestamps[0]);\r\n            if (timestamps.length === 1) {\r\n                start = 1 - first;\r\n            } else {\r\n                start = (this.getDecimalForValue(timestamps[1]) - first) / 2;\r\n            }\r\n            last = this.getDecimalForValue(timestamps[timestamps.length - 1]);\r\n            if (timestamps.length === 1) {\r\n                end = last;\r\n            } else {\r\n                end = (last - this.getDecimalForValue(timestamps[timestamps.length - 2])) / 2;\r\n            }\r\n        }\r\n        const limit = timestamps.length < 3 ? 0.5 : 0.25;\r\n        start = _limitValue(start, 0, limit);\r\n        end = _limitValue(end, 0, limit);\r\n        this._offsets = {\r\n            start,\r\n            end,\r\n            factor: 1 / (start + 1 + end)\r\n        };\r\n    }\r\n _generate() {\r\n        const adapter = this._adapter;\r\n        const min = this.min;\r\n        const max = this.max;\r\n        const options = this.options;\r\n        const timeOpts = options.time;\r\n        const minor = timeOpts.unit || determineUnitForAutoTicks(timeOpts.minUnit, min, max, this._getLabelCapacity(min));\r\n        const stepSize = valueOrDefault(options.ticks.stepSize, 1);\r\n        const weekday = minor === 'week' ? timeOpts.isoWeekday : false;\r\n        const hasWeekday = isNumber(weekday) || weekday === true;\r\n        const ticks = {};\r\n        let first = min;\r\n        let time, count;\r\n        if (hasWeekday) {\r\n            first = +adapter.startOf(first, 'isoWeek', weekday);\r\n        }\r\n        first = +adapter.startOf(first, hasWeekday ? 'day' : minor);\r\n        if (adapter.diff(max, min, minor) > 100000 * stepSize) {\r\n            throw new Error(min + ' and ' + max + ' are too far apart with stepSize of ' + stepSize + ' ' + minor);\r\n        }\r\n        const timestamps = options.ticks.source === 'data' && this.getDataTimestamps();\r\n        for(time = first, count = 0; time < max; time = +adapter.add(time, stepSize, minor), count++){\r\n            addTick(ticks, time, timestamps);\r\n        }\r\n        if (time === max || options.bounds === 'ticks' || count === 1) {\r\n            addTick(ticks, time, timestamps);\r\n        }\r\n        return Object.keys(ticks).sort(sorter).map((x)=>+x);\r\n    }\r\n getLabelForValue(value) {\r\n        const adapter = this._adapter;\r\n        const timeOpts = this.options.time;\r\n        if (timeOpts.tooltipFormat) {\r\n            return adapter.format(value, timeOpts.tooltipFormat);\r\n        }\r\n        return adapter.format(value, timeOpts.displayFormats.datetime);\r\n    }\r\n format(value, format) {\r\n        const options = this.options;\r\n        const formats = options.time.displayFormats;\r\n        const unit = this._unit;\r\n        const fmt = format || formats[unit];\r\n        return this._adapter.format(value, fmt);\r\n    }\r\n _tickFormatFunction(time, index, ticks, format) {\r\n        const options = this.options;\r\n        const formatter = options.ticks.callback;\r\n        if (formatter) {\r\n            return callback(formatter, [\r\n                time,\r\n                index,\r\n                ticks\r\n            ], this);\r\n        }\r\n        const formats = options.time.displayFormats;\r\n        const unit = this._unit;\r\n        const majorUnit = this._majorUnit;\r\n        const minorFormat = unit && formats[unit];\r\n        const majorFormat = majorUnit && formats[majorUnit];\r\n        const tick = ticks[index];\r\n        const major = majorUnit && majorFormat && tick && tick.major;\r\n        return this._adapter.format(time, format || (major ? majorFormat : minorFormat));\r\n    }\r\n generateTickLabels(ticks) {\r\n        let i, ilen, tick;\r\n        for(i = 0, ilen = ticks.length; i < ilen; ++i){\r\n            tick = ticks[i];\r\n            tick.label = this._tickFormatFunction(tick.value, i, ticks);\r\n        }\r\n    }\r\n getDecimalForValue(value) {\r\n        return value === null ? NaN : (value - this.min) / (this.max - this.min);\r\n    }\r\n getPixelForValue(value) {\r\n        const offsets = this._offsets;\r\n        const pos = this.getDecimalForValue(value);\r\n        return this.getPixelForDecimal((offsets.start + pos) * offsets.factor);\r\n    }\r\n getValueForPixel(pixel) {\r\n        const offsets = this._offsets;\r\n        const pos = this.getDecimalForPixel(pixel) / offsets.factor - offsets.end;\r\n        return this.min + pos * (this.max - this.min);\r\n    }\r\n _getLabelSize(label) {\r\n        const ticksOpts = this.options.ticks;\r\n        const tickLabelWidth = this.ctx.measureText(label).width;\r\n        const angle = toRadians(this.isHorizontal() ? ticksOpts.maxRotation : ticksOpts.minRotation);\r\n        const cosRotation = Math.cos(angle);\r\n        const sinRotation = Math.sin(angle);\r\n        const tickFontSize = this._resolveTickFontOptions(0).size;\r\n        return {\r\n            w: tickLabelWidth * cosRotation + tickFontSize * sinRotation,\r\n            h: tickLabelWidth * sinRotation + tickFontSize * cosRotation\r\n        };\r\n    }\r\n _getLabelCapacity(exampleTime) {\r\n        const timeOpts = this.options.time;\r\n        const displayFormats = timeOpts.displayFormats;\r\n        const format = displayFormats[timeOpts.unit] || displayFormats.millisecond;\r\n        const exampleLabel = this._tickFormatFunction(exampleTime, 0, ticksFromTimestamps(this, [\r\n            exampleTime\r\n        ], this._majorUnit), format);\r\n        const size = this._getLabelSize(exampleLabel);\r\n        const capacity = Math.floor(this.isHorizontal() ? this.width / size.w : this.height / size.h) - 1;\r\n        return capacity > 0 ? capacity : 1;\r\n    }\r\n getDataTimestamps() {\r\n        let timestamps = this._cache.data || [];\r\n        let i, ilen;\r\n        if (timestamps.length) {\r\n            return timestamps;\r\n        }\r\n        const metas = this.getMatchingVisibleMetas();\r\n        if (this._normalized && metas.length) {\r\n            return this._cache.data = metas[0].controller.getAllParsedValues(this);\r\n        }\r\n        for(i = 0, ilen = metas.length; i < ilen; ++i){\r\n            timestamps = timestamps.concat(metas[i].controller.getAllParsedValues(this));\r\n        }\r\n        return this._cache.data = this.normalize(timestamps);\r\n    }\r\n getLabelTimestamps() {\r\n        const timestamps = this._cache.labels || [];\r\n        let i, ilen;\r\n        if (timestamps.length) {\r\n            return timestamps;\r\n        }\r\n        const labels = this.getLabels();\r\n        for(i = 0, ilen = labels.length; i < ilen; ++i){\r\n            timestamps.push(parse(this, labels[i]));\r\n        }\r\n        return this._cache.labels = this._normalized ? timestamps : this.normalize(timestamps);\r\n    }\r\n normalize(values) {\r\n        return _arrayUnique(values.sort(sorter));\r\n    }\r\n}\r\n\r\nfunction interpolate(table, val, reverse) {\r\n    let lo = 0;\r\n    let hi = table.length - 1;\r\n    let prevSource, nextSource, prevTarget, nextTarget;\r\n    if (reverse) {\r\n        if (val >= table[lo].pos && val <= table[hi].pos) {\r\n            ({ lo , hi  } = _lookupByKey(table, 'pos', val));\r\n        }\r\n        ({ pos: prevSource , time: prevTarget  } = table[lo]);\r\n        ({ pos: nextSource , time: nextTarget  } = table[hi]);\r\n    } else {\r\n        if (val >= table[lo].time && val <= table[hi].time) {\r\n            ({ lo , hi  } = _lookupByKey(table, 'time', val));\r\n        }\r\n        ({ time: prevSource , pos: prevTarget  } = table[lo]);\r\n        ({ time: nextSource , pos: nextTarget  } = table[hi]);\r\n    }\r\n    const span = nextSource - prevSource;\r\n    return span ? prevTarget + (nextTarget - prevTarget) * (val - prevSource) / span : prevTarget;\r\n}\r\nclass TimeSeriesScale extends TimeScale {\r\n    static id = 'timeseries';\r\n static defaults = TimeScale.defaults;\r\n constructor(props){\r\n        super(props);\r\n         this._table = [];\r\n         this._minPos = undefined;\r\n         this._tableRange = undefined;\r\n    }\r\n initOffsets() {\r\n        const timestamps = this._getTimestampsForTable();\r\n        const table = this._table = this.buildLookupTable(timestamps);\r\n        this._minPos = interpolate(table, this.min);\r\n        this._tableRange = interpolate(table, this.max) - this._minPos;\r\n        super.initOffsets(timestamps);\r\n    }\r\n buildLookupTable(timestamps) {\r\n        const { min , max  } = this;\r\n        const items = [];\r\n        const table = [];\r\n        let i, ilen, prev, curr, next;\r\n        for(i = 0, ilen = timestamps.length; i < ilen; ++i){\r\n            curr = timestamps[i];\r\n            if (curr >= min && curr <= max) {\r\n                items.push(curr);\r\n            }\r\n        }\r\n        if (items.length < 2) {\r\n            return [\r\n                {\r\n                    time: min,\r\n                    pos: 0\r\n                },\r\n                {\r\n                    time: max,\r\n                    pos: 1\r\n                }\r\n            ];\r\n        }\r\n        for(i = 0, ilen = items.length; i < ilen; ++i){\r\n            next = items[i + 1];\r\n            prev = items[i - 1];\r\n            curr = items[i];\r\n            if (Math.round((next + prev) / 2) !== curr) {\r\n                table.push({\r\n                    time: curr,\r\n                    pos: i / (ilen - 1)\r\n                });\r\n            }\r\n        }\r\n        return table;\r\n    }\r\n _generate() {\r\n        const min = this.min;\r\n        const max = this.max;\r\n        let timestamps = super.getDataTimestamps();\r\n        if (!timestamps.includes(min) || !timestamps.length) {\r\n            timestamps.splice(0, 0, min);\r\n        }\r\n        if (!timestamps.includes(max) || timestamps.length === 1) {\r\n            timestamps.push(max);\r\n        }\r\n        return timestamps.sort((a, b)=>a - b);\r\n    }\r\n _getTimestampsForTable() {\r\n        let timestamps = this._cache.all || [];\r\n        if (timestamps.length) {\r\n            return timestamps;\r\n        }\r\n        const data = this.getDataTimestamps();\r\n        const label = this.getLabelTimestamps();\r\n        if (data.length && label.length) {\r\n            timestamps = this.normalize(data.concat(label));\r\n        } else {\r\n            timestamps = data.length ? data : label;\r\n        }\r\n        timestamps = this._cache.all = timestamps;\r\n        return timestamps;\r\n    }\r\n getDecimalForValue(value) {\r\n        return (interpolate(this._table, value) - this._minPos) / this._tableRange;\r\n    }\r\n getValueForPixel(pixel) {\r\n        const offsets = this._offsets;\r\n        const decimal = this.getDecimalForPixel(pixel) / offsets.factor - offsets.end;\r\n        return interpolate(this._table, decimal * this._tableRange + this._minPos, true);\r\n    }\r\n}\r\n\r\nvar scales = /*#__PURE__*/Object.freeze({\r\n__proto__: null,\r\nCategoryScale: CategoryScale,\r\nLinearScale: LinearScale,\r\nLogarithmicScale: LogarithmicScale,\r\nRadialLinearScale: RadialLinearScale,\r\nTimeScale: TimeScale,\r\nTimeSeriesScale: TimeSeriesScale\r\n});\r\n\r\nconst registerables = [\r\n    controllers,\r\n    elements,\r\n    plugins,\r\n    scales\r\n];\r\n\r\nexport { Animation, Animations, ArcElement, BarController, BarElement, BasePlatform, BasicPlatform, BubbleController, CategoryScale, Chart, plugin_colors as Colors, DatasetController, plugin_decimation as Decimation, DomPlatform, DoughnutController, Element, index as Filler, Interaction, plugin_legend as Legend, LineController, LineElement, LinearScale, LogarithmicScale, PieController, PointElement, PolarAreaController, RadarController, RadialLinearScale, Scale, ScatterController, plugin_subtitle as SubTitle, Ticks, TimeScale, TimeSeriesScale, plugin_title as Title, plugin_tooltip as Tooltip, adapters as _adapters, _detectPlatform, animator, controllers, defaults, elements, layouts, plugins, registerables, registry, scales };\r\n//# sourceMappingURL=chart.js.map\r\n","import {\r\n  ItemView,\r\n  WorkspaceLeaf,\r\n  setIcon,\r\n  Notice,\r\n} from \"obsidian\";\r\nimport { TFile } from \"obsidian\";\r\n/* Moment.js is available globally in Obsidian */\r\ndeclare const moment: any;\r\nimport type { ViewStateResult } from \"obsidian\";\r\nimport { ProjectCache } from \"../services/cache\";\r\nimport { PmSettings } from \"../../settings\";\r\nimport { Chart, registerables } from 'chart.js';\r\n\r\n// Register Chart.js components\r\nChart.register(...registerables);\r\n\r\n// Load dashboard-specific stylesheet\r\nimport \"../../styles/styles-dashboard.css\";\r\n\r\n/** Helper: format a date or return an em-dash if undefined */\r\nfunction formatDate(d: string | number | Date | undefined): string {\r\n  if (!d) return \"—\";\r\n  return new Date(d).toLocaleDateString();\r\n}\r\n\r\n/** Detect whether a task is completed */\r\nfunction isTaskDone(t: any): boolean {\r\n  /* explicit flags from parsers */\r\n  if (t.done === true || t.checked === true) return true;\r\n  if (typeof t.done === \"string\" && t.done.toLowerCase() === \"done\") return true;\r\n\r\n  /* explicit status strings */\r\n  if (typeof t.status === \"string\") {\r\n    const s = t.status.toLowerCase();\r\n    if ([\"done\", \"complete\", \"completed\"].includes(s)) return true;\r\n  }\r\n\r\n  /* percent-complete field */\r\n  if (typeof t.percentComplete === \"number\" && t.percentComplete >= 1) return true;\r\n\r\n  /* markdown checkbox or bullet */\r\n  const raw = (t.raw ?? t.text ?? \"\").toString();\r\n  if (/^\\s*-\\s*\\[[xX]\\]/.test(raw)) return true;\r\n\r\n  /* completed:: 2025‑05‑01 inline field or front‑matter */\r\n  if (t.props?.completed || t.props?.[\"completionDate\"]) return true;\r\n\r\n  return false;\r\n}\r\n\r\n/** Get task status for categorization */\r\nfunction getTaskStatus(t: any): 'completed' | 'in-progress' | 'not-started' | 'on-hold' {\r\n  if (isTaskDone(t)) return 'completed';\r\n  \r\n  if (typeof t.status === \"string\") {\r\n    const s = t.status.toLowerCase();\r\n    if (s === \"in-progress\") return 'in-progress';\r\n    if (s === \"on-hold\") return 'on-hold';\r\n  }\r\n  \r\n  return 'not-started';\r\n}\r\n\r\n/** Get task type for categorization */\r\nfunction getTaskType(t: any): 'epic' | 'story' | 'subtask' | 'other' {\r\n  const id = (t.id ?? \"\").toUpperCase();\r\n  if (id.startsWith(\"E\")) return 'epic';\r\n  if (id.startsWith(\"S\") && !id.startsWith(\"SB\")) return 'story';\r\n  if (id.startsWith(\"SB\")) return 'subtask';\r\n  return 'other';\r\n}\r\n\r\nexport const VIEW_TYPE_PM_DASHBOARD = \"pm-dashboard-view\";\r\n\r\nexport class DashboardView extends ItemView {\r\n  /** icon shown on the view tab */\r\n  public icon = \"bar-chart-3\";\r\n  /** Optional set of project file paths to display (injected by Portfolio view) */\r\n  private filterPaths?: Set<string>;\r\n  /** Optional name of the portfolio that opened this dashboard */\r\n  private filterName?: string;\r\n  /** The initial project paths passed in from Portfolio (null = no portfolio) */\r\n  private originalPaths: string[] | null = null;\r\n  /** Optional set of assignees to filter by */\r\n  private filterAssignees?: Set<string>;\r\n  /** Optional name of the assignee filter that opened this dashboard */\r\n  private filterAssigneeName?: string;\r\n  /** The initial assignees passed in (null = no assignee filter) */\r\n  private originalAssignees: string[] | null = null;\r\n  /** Currently focused chart type (for drill-down view) */\r\n  private focusedChart?: 'status' | 'type' | 'assignee' | 'assignee-status' | 'project';\r\n  /** Toggle for mini charts: true = bar charts, false = pie charts */\r\n  private miniChartsAsBars: boolean = false;\r\n\r\n  private cache: ProjectCache;\r\n  private settings: PmSettings;\r\n  private container!: HTMLElement;\r\n  private detachFn: (() => void) | null = null;\r\n  private charts: Map<string, any> = new Map(); // Store chart instances\r\n\r\n  constructor(\r\n    leaf: WorkspaceLeaf,\r\n    cache: ProjectCache,\r\n    settings: PmSettings\r\n  ) {\r\n    super(leaf);\r\n    this.cache = cache;\r\n    this.settings = settings;\r\n  }\r\n\r\n  /** Called when leaf.setViewState({ state }) is invoked */\r\n  async setState(state: any, result: ViewStateResult): Promise<void> {\r\n    if (\r\n      Array.isArray(state.filterProjects) &&\r\n      state.filterProjects.length > 0\r\n    ) {\r\n      this.filterPaths   = new Set(state.filterProjects as string[]);\r\n      this.originalPaths = [...state.filterProjects];     // remember portfolio set\r\n    } else {\r\n      this.filterPaths   = undefined;          // empty array or undefined ⇒ show all\r\n      this.originalPaths = null;\r\n    }\r\n    if (typeof state?.filterName === \"string\" && state.filterName.trim() !== \"\") {\r\n      this.filterName = state.filterName.trim();\r\n    } else {\r\n      this.filterName = undefined;\r\n    }\r\n    // Mirror projects: support initial assignee filter passed via state\r\n    if (\r\n      Array.isArray(state.filterAssignees) &&\r\n      state.filterAssignees.length > 0\r\n    ) {\r\n      this.filterAssignees   = new Set(state.filterAssignees as string[]);\r\n      this.originalAssignees = [...state.filterAssignees];\r\n    } else {\r\n      this.filterAssignees   = undefined;\r\n      this.originalAssignees = null;\r\n    }\r\n    if (typeof state?.filterAssigneeName === \"string\" && state.filterAssigneeName.trim() !== \"\") {\r\n      this.filterAssigneeName = state.filterAssigneeName.trim();\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Update project filter & re-render.\r\n      Pass `null` => show ALL projects.                         */\r\n  public updateFilter(paths: string[] | null, name = \"\") {\r\n    if (paths === null) {\r\n      /* Show ALL projects */\r\n      this.filterPaths = undefined;\r\n    } else if (Array.isArray(paths)) {\r\n      /* Show NONE if empty array, else selected set */\r\n      this.filterPaths = paths.length ? new Set(paths) : new Set<string>();\r\n    }\r\n    this.filterName = name;\r\n    this.render();\r\n  }\r\n\r\n  /** Update assignee filter & re-render.\r\n      Pass `null` => show ALL assignees.                         */\r\n  public updateAssigneeFilter(assignees: string[] | null, name = \"\") {\r\n    if (assignees === null) {\r\n      /* Show ALL assignees */\r\n      this.filterAssignees = undefined;\r\n      // Don't clear filterAssigneeName - preserve it like projects filter\r\n    } else if (Array.isArray(assignees)) {\r\n      /* Show NONE if empty array, else selected set */\r\n      this.filterAssignees = assignees.length ? new Set(assignees) : new Set<string>();\r\n      \r\n      // Set originalAssignees if this is the first time we're setting a filter\r\n      if (!this.originalAssignees && assignees.length > 0) {\r\n        this.originalAssignees = [...assignees];\r\n      }\r\n    }\r\n    // Set the name if provided, otherwise keep existing\r\n    if (name) {\r\n      this.filterAssigneeName = name;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Focus on a specific chart type for drill-down view */\r\n  public focusChart(chartType: 'status' | 'type' | 'assignee' | 'assignee-status' | 'project' | null) {\r\n    this.focusedChart = chartType || undefined;\r\n    this.render();\r\n  }\r\n\r\n  getViewType(): string {\r\n    return VIEW_TYPE_PM_DASHBOARD;\r\n  }\r\n  getDisplayText(): string {\r\n    return this.filterName\r\n      ? `Dashboard – ${this.filterName}`\r\n      : \"Dashboard\";\r\n  }\r\n\r\n  getIcon(): string {\r\n    return \"bar-chart-3\";\r\n  }\r\n\r\n  async onOpen() {\r\n    this.container = this.contentEl;\r\n\r\n    /* Apply initial filterProjects / filterName passed via view‑state */\r\n    const st = (this.leaf.getViewState() as any).state ?? {};\r\n    if (Array.isArray(st.filterProjects) && st.filterProjects.length) {\r\n      this.filterPaths   = new Set(st.filterProjects);\r\n      this.originalPaths = [...st.filterProjects];        // keep original list\r\n    } else {\r\n      this.filterPaths   = undefined;\r\n      this.originalPaths = null;\r\n    }\r\n    this.filterName = typeof st.filterName === \"string\" ? st.filterName.trim() : \"\";\r\n\r\n    // Apply initial assignee state if provided\r\n    if (Array.isArray(st.filterAssignees) && st.filterAssignees.length) {\r\n      this.filterAssignees   = new Set(st.filterAssignees);\r\n      this.originalAssignees = [...st.filterAssignees];\r\n    } else {\r\n      this.filterAssignees   = undefined;\r\n      this.originalAssignees = null;\r\n    }\r\n    if (typeof st.filterAssigneeName === \"string\") {\r\n      this.filterAssigneeName = st.filterAssigneeName.trim();\r\n    }\r\n\r\n    this.render();\r\n    this.detachFn = this.cache.onChange(() => this.render());\r\n  }\r\n  async onClose() {\r\n    this.detachFn?.();\r\n    // Clean up charts\r\n    this.charts.forEach(chart => chart.destroy());\r\n    this.charts.clear();\r\n  }\r\n\r\n  /** Collect all tasks from filtered projects */\r\n  private collectTasks(): any[] {\r\n    const allTasks: any[] = [];\r\n    \r\n    this.cache.projects.forEach((project: any) => {\r\n      // Apply project filter\r\n      if (this.filterPaths && !this.filterPaths.has(project.file.path)) {\r\n        return;\r\n      }\r\n      \r\n      // Add project metadata to tasks\r\n      (project.tasks ?? []).forEach((task: any) => {\r\n        task.projectName = project.file.basename;\r\n        task.projectPath = project.file.path;\r\n        allTasks.push(task);\r\n      });\r\n    });\r\n    \r\n    // Apply assignee filter if set\r\n    if (this.filterAssignees && this.filterAssignees.size > 0) {\r\n      return allTasks.filter(task => {\r\n        const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n        return this.filterAssignees!.has(assignee);\r\n      });\r\n    }\r\n    \r\n    return allTasks;\r\n  }\r\n\r\n  /** Create chart data for task status distribution */\r\n  private createStatusChartData(tasks: any[]) {\r\n    const statusCounts = {\r\n      'completed': 0,\r\n      'in-progress': 0,\r\n      'not-started': 0,\r\n      'on-hold': 0\r\n    };\r\n    \r\n    tasks.forEach(task => {\r\n      const status = getTaskStatus(task);\r\n      statusCounts[status]++;\r\n    });\r\n    \r\n    return {\r\n      labels: ['Completed', 'In Progress', 'Not Started', 'On Hold'],\r\n      datasets: [{\r\n        data: [statusCounts.completed, statusCounts['in-progress'], statusCounts['not-started'], statusCounts['on-hold']],\r\n        backgroundColor: [\r\n          '#27ae60', // green for completed\r\n          '#f39c12', // orange for in-progress  \r\n          '#e74c3c', // red for not-started\r\n          '#3498db'  // blue for on-hold\r\n        ],\r\n        borderWidth: 2,\r\n        borderColor: 'var(--background-secondary)'\r\n      }]\r\n    };\r\n  }\r\n\r\n  /** Create chart data for task type distribution */\r\n  private createTypeChartData(tasks: any[]) {\r\n    const typeCounts = {\r\n      'epic': 0,\r\n      'story': 0,\r\n      'subtask': 0,\r\n      'other': 0\r\n    };\r\n    \r\n    tasks.forEach(task => {\r\n      const type = getTaskType(task);\r\n      typeCounts[type]++;\r\n    });\r\n    \r\n    return {\r\n      labels: ['Epics', 'Stories', 'Subtasks', 'Other'],\r\n      datasets: [{\r\n        data: [typeCounts.epic, typeCounts.story, typeCounts.subtask, typeCounts.other],\r\n        backgroundColor: [\r\n          '#8e44ad', // darker purple for epics\r\n          '#d68910', // darker orange for stories\r\n          '#16a085', // darker teal for subtasks\r\n          '#2c3e50'  // darker gray for other\r\n        ],\r\n        borderWidth: 2,\r\n        borderColor: 'var(--background-secondary)'\r\n      }]\r\n    };\r\n  }\r\n\r\n  /** Create chart data for assignee distribution */\r\n  private createAssigneeChartData(tasks: any[]) {\r\n    const assigneeCounts = new Map<string, number>();\r\n    \r\n    tasks.forEach(task => {\r\n      const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n      assigneeCounts.set(assignee, (assigneeCounts.get(assignee) || 0) + 1);\r\n    });\r\n    \r\n    // Sort by count descending - show all assignees\r\n    const sortedAssignees = Array.from(assigneeCounts.entries())\r\n      .sort((a, b) => b[1] - a[1]);\r\n    \r\n    // Generate enough colors for all assignees\r\n    const baseColors = [\r\n      '#c0392b', '#2980b9', '#27ae60', '#d68910',\r\n      '#8e44ad', '#16a085', '#d35400', '#2c3e50'\r\n    ];\r\n    \r\n    // Extend colors if we have more than 8 assignees\r\n    const colors = [...baseColors];\r\n    const additionalColors = [\r\n      '#e67e22', '#9b59b6', '#1abc9c', '#f1c40f',\r\n      '#e74c3c', '#3498db', '#2ecc71', '#f39c12',\r\n      '#8e44ad', '#16a085', '#d35400', '#2c3e50',\r\n      '#795548', '#607d8b', '#ff5722', '#9c27b0',\r\n      '#673ab7', '#3f51b5', '#2196f3', '#00bcd4'\r\n    ];\r\n    \r\n    let colorIndex = 0;\r\n    while (colors.length < sortedAssignees.length) {\r\n      colors.push(additionalColors[colorIndex % additionalColors.length]);\r\n      colorIndex++;\r\n    }\r\n    \r\n    return {\r\n      labels: sortedAssignees.map(([assignee]) => assignee),\r\n      datasets: [{\r\n        data: sortedAssignees.map(([, count]) => count),\r\n        backgroundColor: colors.slice(0, sortedAssignees.length),\r\n        borderWidth: 2,\r\n        borderColor: 'var(--background-secondary)'\r\n      }]\r\n    };\r\n  }\r\n\r\n  /** Create chart data for assignee per project distribution (stacked bar chart) */\r\n  private createAssigneeProjectChartData(tasks: any[]) {\r\n    const projectAssigneeCounts = new Map<string, Map<string, number>>();\r\n    const allAssignees = new Set<string>();\r\n    \r\n    // Initialize projects and collect all assignees\r\n    tasks.forEach(task => {\r\n      const projectName = task.projectName || \"Unknown Project\";\r\n      const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n      \r\n      allAssignees.add(assignee);\r\n      \r\n      if (!projectAssigneeCounts.has(projectName)) {\r\n        projectAssigneeCounts.set(projectName, new Map());\r\n      }\r\n    });\r\n    \r\n    // Initialize all assignees for all projects with zero counts\r\n    projectAssigneeCounts.forEach((assigneeMap) => {\r\n      allAssignees.forEach(assignee => {\r\n        if (!assigneeMap.has(assignee)) {\r\n          assigneeMap.set(assignee, 0);\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Count tasks by assignee for each project\r\n    tasks.forEach(task => {\r\n      const projectName = task.projectName || \"Unknown Project\";\r\n      const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n      \r\n      const assigneeMap = projectAssigneeCounts.get(projectName)!;\r\n      assigneeMap.set(assignee, (assigneeMap.get(assignee) || 0) + 1);\r\n    });\r\n    \r\n    // Sort projects by total task count\r\n    const sortedProjects = Array.from(projectAssigneeCounts.entries())\r\n      .sort((a, b) => {\r\n        const totalA = Array.from(a[1].values()).reduce((sum, count) => sum + count, 0);\r\n        const totalB = Array.from(b[1].values()).reduce((sum, count) => sum + count, 0);\r\n        return totalB - totalA;\r\n      });\r\n    \r\n    // Sort assignees by total task count\r\n    const assigneeTotals = new Map<string, number>();\r\n    allAssignees.forEach(assignee => {\r\n      let total = 0;\r\n      projectAssigneeCounts.forEach(assigneeMap => {\r\n        total += assigneeMap.get(assignee) || 0;\r\n      });\r\n      assigneeTotals.set(assignee, total);\r\n    });\r\n    \r\n    const sortedAssignees = Array.from(allAssignees).sort((a, b) => \r\n      (assigneeTotals.get(b) || 0) - (assigneeTotals.get(a) || 0)\r\n    );\r\n    \r\n    // Generate colors for assignees\r\n    const baseColors = [\r\n      '#e74c3c', '#f39c12', '#27ae60', '#3498db',\r\n      '#8e44ad', '#16a085', '#d35400', '#2c3e50'\r\n    ];\r\n    \r\n    const additionalColors = [\r\n      '#e67e22', '#9b59b6', '#1abc9c', '#f1c40f',\r\n      '#e74c3c', '#3498db', '#2ecc71', '#f39c12',\r\n      '#795548', '#607d8b', '#ff5722', '#9c27b0'\r\n    ];\r\n    \r\n    const colors = [...baseColors];\r\n    let colorIndex = 0;\r\n    while (colors.length < sortedAssignees.length) {\r\n      colors.push(additionalColors[colorIndex % additionalColors.length]);\r\n      colorIndex++;\r\n    }\r\n    \r\n    const datasets = sortedAssignees.map((assignee, index) => ({\r\n      label: assignee,\r\n      data: sortedProjects.map(([, assigneeMap]) => assigneeMap.get(assignee) || 0),\r\n      backgroundColor: colors[index],\r\n      borderWidth: 1,\r\n      borderColor: 'var(--background-secondary)'\r\n    }));\r\n    \r\n    return {\r\n      labels: sortedProjects.map(([projectName]) => projectName),\r\n      datasets: datasets\r\n    };\r\n  }\r\n\r\n  /** Create chart data for project status distribution (stacked bar chart) */\r\n  private createProjectStatusChartData(tasks: any[]) {\r\n    const projectStatusCounts = new Map<string, { 'completed': number, 'in-progress': number, 'not-started': number, 'on-hold': number }>();\r\n    \r\n    // Initialize all projects with zero counts\r\n    tasks.forEach(task => {\r\n      const projectName = task.projectName || \"Unknown Project\";\r\n      if (!projectStatusCounts.has(projectName)) {\r\n        projectStatusCounts.set(projectName, {\r\n          'completed': 0,\r\n          'in-progress': 0,\r\n          'not-started': 0,\r\n          'on-hold': 0\r\n        });\r\n      }\r\n    });\r\n    \r\n    // Count tasks by status for each project\r\n    tasks.forEach(task => {\r\n      const projectName = task.projectName || \"Unknown Project\";\r\n      const status = getTaskStatus(task);\r\n      const counts = projectStatusCounts.get(projectName)!;\r\n      counts[status]++;\r\n    });\r\n    \r\n    // Sort projects by total task count (descending)\r\n    const sortedProjects = Array.from(projectStatusCounts.entries())\r\n      .sort((a, b) => {\r\n        const totalA = a[1]['completed'] + a[1]['in-progress'] + a[1]['not-started'] + a[1]['on-hold'];\r\n        const totalB = b[1]['completed'] + b[1]['in-progress'] + b[1]['not-started'] + b[1]['on-hold'];\r\n        return totalB - totalA;\r\n      });\r\n    \r\n    return {\r\n      labels: sortedProjects.map(([projectName]) => projectName),\r\n      datasets: [\r\n        {\r\n          label: 'Completed',\r\n          data: sortedProjects.map(([, counts]) => counts['completed']),\r\n          backgroundColor: '#27ae60', // green\r\n          borderWidth: 1,\r\n          borderColor: 'var(--background-secondary)'\r\n        },\r\n        {\r\n          label: 'In Progress',\r\n          data: sortedProjects.map(([, counts]) => counts['in-progress']),\r\n          backgroundColor: '#f39c12', // orange\r\n          borderWidth: 1,\r\n          borderColor: 'var(--background-secondary)'\r\n        },\r\n        {\r\n          label: 'Not Started',\r\n          data: sortedProjects.map(([, counts]) => counts['not-started']),\r\n          backgroundColor: '#e74c3c', // red\r\n          borderWidth: 1,\r\n          borderColor: 'var(--background-secondary)'\r\n        },\r\n        {\r\n          label: 'On Hold',\r\n          data: sortedProjects.map(([, counts]) => counts['on-hold']),\r\n          backgroundColor: '#3498db', // blue\r\n          borderWidth: 1,\r\n          borderColor: 'var(--background-secondary)'\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /** Create chart data for assignee status distribution (stacked bar chart) */\r\n  private createAssigneeStatusChartData(tasks: any[]) {\r\n    const assigneeStatusCounts = new Map<string, { 'completed': number, 'in-progress': number, 'not-started': number, 'on-hold': number }>();\r\n    \r\n    // Initialize all assignees with zero counts\r\n    tasks.forEach(task => {\r\n      const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n      if (!assigneeStatusCounts.has(assignee)) {\r\n        assigneeStatusCounts.set(assignee, {\r\n          'completed': 0,\r\n          'in-progress': 0,\r\n          'not-started': 0,\r\n          'on-hold': 0\r\n        });\r\n      }\r\n    });\r\n    \r\n    // Count tasks by status for each assignee\r\n    tasks.forEach(task => {\r\n      const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n      const status = getTaskStatus(task);\r\n      const counts = assigneeStatusCounts.get(assignee)!;\r\n      counts[status]++;\r\n    });\r\n    \r\n    // Sort assignees by total task count (descending)\r\n    const sortedAssignees = Array.from(assigneeStatusCounts.entries())\r\n      .sort((a, b) => {\r\n        const totalA = a[1]['completed'] + a[1]['in-progress'] + a[1]['not-started'] + a[1]['on-hold'];\r\n        const totalB = b[1]['completed'] + b[1]['in-progress'] + b[1]['not-started'] + b[1]['on-hold'];\r\n        return totalB - totalA;\r\n      });\r\n    \r\n    return {\r\n      labels: sortedAssignees.map(([assignee]) => assignee),\r\n      datasets: [\r\n        {\r\n          label: 'Completed',\r\n          data: sortedAssignees.map(([, counts]) => counts['completed']),\r\n          backgroundColor: '#27ae60', // green\r\n          borderWidth: 1,\r\n          borderColor: 'var(--background-secondary)'\r\n        },\r\n        {\r\n          label: 'In Progress',\r\n          data: sortedAssignees.map(([, counts]) => counts['in-progress']),\r\n          backgroundColor: '#f39c12', // orange\r\n          borderWidth: 1,\r\n          borderColor: 'var(--background-secondary)'\r\n        },\r\n        {\r\n          label: 'Not Started',\r\n          data: sortedAssignees.map(([, counts]) => counts['not-started']),\r\n          backgroundColor: '#e74c3c', // red\r\n          borderWidth: 1,\r\n          borderColor: 'var(--background-secondary)'\r\n        },\r\n        {\r\n          label: 'On Hold',\r\n          data: sortedAssignees.map(([, counts]) => counts['on-hold']),\r\n          backgroundColor: '#3498db', // blue\r\n          borderWidth: 1,\r\n          borderColor: 'var(--background-secondary)'\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /** Create chart data for project distribution */\r\n  private createProjectChartData(tasks: any[]) {\r\n    const projectCounts = new Map<string, number>();\r\n    \r\n    tasks.forEach(task => {\r\n      const project = task.projectName || \"Unknown Project\";\r\n      const taskType = getTaskType(task);\r\n      \r\n      // Only count epics, stories, and subtasks (not individual tasks)\r\n      if (taskType === 'epic' || taskType === 'story' || taskType === 'subtask') {\r\n        projectCounts.set(project, (projectCounts.get(project) || 0) + 1);\r\n      }\r\n    });\r\n    \r\n    // Sort by count descending and show all projects\r\n    const sortedProjects = Array.from(projectCounts.entries())\r\n      .sort((a, b) => b[1] - a[1]);\r\n    \r\n    // Generate more colors if needed\r\n    const baseColors = [\r\n      '#c0392b', '#2980b9', '#27ae60', '#d68910',\r\n      '#8e44ad', '#16a085', '#d35400', '#2c3e50'\r\n    ];\r\n    \r\n    // Extend colors if we have more than 8 projects\r\n    const colors = [...baseColors];\r\n    const additionalColors = [\r\n      '#e67e22', '#9b59b6', '#1abc9c', '#f1c40f',\r\n      '#e74c3c', '#3498db', '#2ecc71', '#f39c12',\r\n      '#8e44ad', '#16a085', '#d35400', '#2c3e50'\r\n    ];\r\n    \r\n    let colorIndex = 0;\r\n    while (colors.length < sortedProjects.length) {\r\n      colors.push(additionalColors[colorIndex % additionalColors.length]);\r\n      colorIndex++;\r\n    }\r\n    \r\n    return {\r\n      labels: sortedProjects.map(([project]) => project),\r\n      datasets: [{\r\n        data: sortedProjects.map(([, count]) => count),\r\n        backgroundColor: colors.slice(0, sortedProjects.length),\r\n        borderWidth: 2,\r\n        borderColor: 'var(--background-secondary)'\r\n      }]\r\n    };\r\n  }\r\n\r\n  /** Render project breakdown summary for focused view */\r\n  private renderProjectBreakdown(container: HTMLElement, tasks: any[], chartType: string) {\r\n    const projectStats = new Map<string, any>();\r\n    \r\n    // Initialize project stats\r\n    tasks.forEach(task => {\r\n      const projectName = task.projectName || \"Unknown Project\";\r\n      if (!projectStats.has(projectName)) {\r\n        projectStats.set(projectName, {\r\n          total: 0,\r\n          completed: 0,\r\n          'in-progress': 0,\r\n          'not-started': 0,\r\n          'on-hold': 0,\r\n          epic: 0,\r\n          story: 0,\r\n          subtask: 0,\r\n          other: 0\r\n        });\r\n      }\r\n    });\r\n    \r\n    // Count stats per project\r\n    tasks.forEach(task => {\r\n      const projectName = task.projectName || \"Unknown Project\";\r\n      const stats = projectStats.get(projectName)!;\r\n      const status = getTaskStatus(task);\r\n      const type = getTaskType(task);\r\n      \r\n      stats.total++;\r\n      stats[status]++;\r\n      stats[type]++;\r\n    });\r\n    \r\n    // Sort projects by total task count\r\n    const sortedProjects = Array.from(projectStats.entries())\r\n      .sort((a, b) => b[1].total - a[1].total);\r\n    \r\n    const summaryContainer = container.createEl(\"div\", { cls: \"pm-project-breakdown\" });\r\n    \r\n    sortedProjects.forEach(([projectName, stats]) => {\r\n      const projectCard = summaryContainer.createEl(\"div\", { cls: \"pm-project-card\" });\r\n      \r\n      // Project header\r\n      const header = projectCard.createEl(\"div\", { cls: \"pm-project-header\" });\r\n      header.createEl(\"h4\", { text: projectName });\r\n      header.createEl(\"span\", { text: `${stats.total} tasks`, cls: \"pm-project-total\" });\r\n      \r\n      // Stats grid\r\n      const statsGrid = projectCard.createEl(\"div\", { cls: \"pm-project-stats\" });\r\n      \r\n      if (chartType === 'status' || chartType === 'assignee-status') {\r\n        const completedEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item completed\" });\r\n        completedEl.createEl(\"strong\", { text: \"Completed: \" });\r\n        completedEl.createEl(\"span\", { text: `${stats.completed}` });\r\n        \r\n        const inProgressEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item in-progress\" });\r\n        inProgressEl.createEl(\"strong\", { text: \"In Progress: \" });\r\n        inProgressEl.createEl(\"span\", { text: `${stats['in-progress']}` });\r\n        \r\n        const notStartedEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item not-started\" });\r\n        notStartedEl.createEl(\"strong\", { text: \"Not Started: \" });\r\n        notStartedEl.createEl(\"span\", { text: `${stats['not-started']}` });\r\n        \r\n        const onHoldEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item on-hold\" });\r\n        onHoldEl.createEl(\"strong\", { text: \"On Hold: \" });\r\n        onHoldEl.createEl(\"span\", { text: `${stats['on-hold']}` });\r\n      } else if (chartType === 'type') {\r\n        const epicEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item epic\" });\r\n        epicEl.createEl(\"strong\", { text: \"Epics: \" });\r\n        epicEl.createEl(\"span\", { text: `${stats.epic}` });\r\n        \r\n        const storyEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item story\" });\r\n        storyEl.createEl(\"strong\", { text: \"Stories: \" });\r\n        storyEl.createEl(\"span\", { text: `${stats.story}` });\r\n        \r\n        const subtaskEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item subtask\" });\r\n        subtaskEl.createEl(\"strong\", { text: \"Subtasks: \" });\r\n        subtaskEl.createEl(\"span\", { text: `${stats.subtask}` });\r\n        \r\n        const otherEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item other\" });\r\n        otherEl.createEl(\"strong\", { text: \"Other: \" });\r\n        otherEl.createEl(\"span\", { text: `${stats.other}` });\r\n      } else {\r\n        // For assignee and project charts, show both status and type\r\n        const completedEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item completed\" });\r\n        completedEl.createEl(\"strong\", { text: \"Completed: \" });\r\n        completedEl.createEl(\"span\", { text: `${stats.completed}` });\r\n        \r\n        const inProgressEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item in-progress\" });\r\n        inProgressEl.createEl(\"strong\", { text: \"In Progress: \" });\r\n        inProgressEl.createEl(\"span\", { text: `${stats['in-progress']}` });\r\n        \r\n        const epicEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item epic\" });\r\n        epicEl.createEl(\"strong\", { text: \"Epics: \" });\r\n        epicEl.createEl(\"span\", { text: `${stats.epic}` });\r\n        \r\n        const storyEl = statsGrid.createEl(\"div\", { cls: \"pm-stat-item story\" });\r\n        storyEl.createEl(\"strong\", { text: \"Stories: \" });\r\n        storyEl.createEl(\"span\", { text: `${stats.story}` });\r\n      }\r\n      \r\n      // Completion rate\r\n      const completionRate = stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0;\r\n      const rateEl = projectCard.createEl(\"div\", { cls: \"pm-completion-rate\" });\r\n      rateEl.createEl(\"strong\", { text: \"Completion Rate: \" });\r\n      rateEl.createEl(\"span\", { text: `${completionRate}%` });\r\n    });\r\n  }\r\n\r\n  /** Render assignee breakdown charts for focused view */\r\n  private renderAssigneeBreakdown(container: HTMLElement, tasks: any[], chartType: string) {\r\n    const assigneeStats = new Map<string, any>();\r\n    \r\n    // Initialize assignee stats\r\n    tasks.forEach(task => {\r\n      const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n      if (!assigneeStats.has(assignee)) {\r\n        assigneeStats.set(assignee, {\r\n          total: 0,\r\n          completed: 0,\r\n          'in-progress': 0,\r\n          'not-started': 0,\r\n          'on-hold': 0,\r\n          epic: 0,\r\n          story: 0,\r\n          subtask: 0,\r\n          other: 0\r\n        });\r\n      }\r\n    });\r\n    \r\n    // Count stats per assignee\r\n    tasks.forEach(task => {\r\n      const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n      const stats = assigneeStats.get(assignee)!;\r\n      const status = getTaskStatus(task);\r\n      const type = getTaskType(task);\r\n      \r\n      stats.total++;\r\n      stats[status]++;\r\n      stats[type]++;\r\n    });\r\n    \r\n    // Sort assignees by total task count\r\n    const sortedAssignees = Array.from(assigneeStats.entries())\r\n      .sort((a, b) => b[1].total - a[1].total);\r\n    \r\n    // Add toggle button for chart type\r\n    const toggleContainer = container.createEl(\"div\", { cls: \"pm-mini-chart-toggle\" });\r\n    const toggleBtn = toggleContainer.createEl(\"button\", { cls: \"pm-chart-toggle-btn\" });\r\n    const toggleIcon = toggleBtn.createSpan();\r\n    setIcon(toggleIcon, this.miniChartsAsBars ? \"pie-chart\" : \"bar-chart-3\");\r\n    toggleBtn.createSpan({ text: this.miniChartsAsBars ? \" Switch to Pie Charts\" : \" Switch to Bar Charts\" });\r\n    toggleBtn.onclick = () => {\r\n      this.miniChartsAsBars = !this.miniChartsAsBars;\r\n      this.render(); // Re-render to update all charts\r\n    };\r\n    \r\n    // Create mini charts for each assignee\r\n    const chartsContainer = container.createEl(\"div\", { cls: \"pm-assignee-charts\" });\r\n    \r\n    sortedAssignees.forEach(([assignee, stats], index) => {\r\n      const chartCard = chartsContainer.createEl(\"div\", { cls: \"pm-mini-chart-card\" });\r\n      \r\n      // Assignee header\r\n      const header = chartCard.createEl(\"div\", { cls: \"pm-assignee-header\" });\r\n      header.createEl(\"h5\", { text: assignee });\r\n      header.createEl(\"span\", { text: `${stats.total} tasks`, cls: \"pm-assignee-total\" });\r\n      \r\n      // Create mini chart data based on focus type\r\n      let chartData: any = null;\r\n      if (chartType === 'status' || chartType === 'assignee-status') {\r\n        chartData = {\r\n          labels: ['Completed', 'In Progress', 'Not Started', 'On Hold'],\r\n          datasets: [{\r\n            data: [stats.completed, stats['in-progress'], stats['not-started'], stats['on-hold']],\r\n            backgroundColor: ['#27ae60', '#f39c12', '#e74c3c', '#3498db'],\r\n            borderWidth: 1,\r\n            borderColor: 'var(--background-secondary)'\r\n          }]\r\n        };\r\n      } else if (chartType === 'type') {\r\n        chartData = {\r\n          labels: ['Epics', 'Stories', 'Subtasks', 'Other'],\r\n          datasets: [{\r\n            data: [stats.epic, stats.story, stats.subtask, stats.other],\r\n            backgroundColor: ['#8e44ad', '#d68910', '#16a085', '#2c3e50'],\r\n            borderWidth: 1,\r\n            borderColor: 'var(--background-secondary)'\r\n          }]\r\n        };\r\n      } else {\r\n        // For assignee and project charts, show status distribution\r\n        chartData = {\r\n          labels: ['Completed', 'In Progress', 'Not Started', 'On Hold'],\r\n          datasets: [{\r\n            data: [stats.completed, stats['in-progress'], stats['not-started'], stats['on-hold']],\r\n            backgroundColor: ['#27ae60', '#f39c12', '#e74c3c', '#3498db'],\r\n            borderWidth: 1,\r\n            borderColor: 'var(--background-secondary)'\r\n          }]\r\n        };\r\n      }\r\n      \r\n      // Create mini canvas\r\n      const miniCanvas = chartCard.createEl(\"canvas\", { cls: \"pm-mini-chart-canvas\" });\r\n      miniCanvas.id = `assignee-mini-chart-${index}`;\r\n      \r\n      // Use bar chart or pie chart based on toggle\r\n      if (this.miniChartsAsBars) {\r\n        this.createBarChart(miniCanvas, chartData, \"\", true);\r\n      } else {\r\n        this.createPieChart(miniCanvas, chartData, \"\", true);\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Create a bar chart */\r\n  private createBarChart(canvas: HTMLCanvasElement, data: any, title: string, isMiniChart: boolean = false) {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return null;\r\n    \r\n    // Destroy existing chart if it exists\r\n    const existingChart = this.charts.get(canvas.id);\r\n    if (existingChart) {\r\n      existingChart.destroy();\r\n    }\r\n    \r\n    // Check if dark mode is active\r\n    const isDarkMode = document.body.classList.contains('theme-dark');\r\n    const textColor = isDarkMode ? '#ffffff' : '#000000';\r\n    const tooltipTextColor = '#ffffff'; // Always white for tooltips (they have dark backgrounds)\r\n    const bgColor = isDarkMode ? '#2d3748' : '#1f2937'; // Dark background for tooltips in both modes\r\n    const borderColor = isDarkMode ? '#4a5568' : '#374151';\r\n    \r\n    // Create new chart\r\n    const chart = new Chart(ctx, {\r\n      type: 'bar',\r\n      data: data,\r\n      options: {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        color: textColor, // Global text color\r\n        scales: {\r\n          x: {\r\n            stacked: !isMiniChart, // Only stack for main charts, not mini charts\r\n            ticks: {\r\n              color: textColor,\r\n              font: {\r\n                size: isMiniChart ? 8 : 11\r\n              }\r\n            },\r\n            grid: {\r\n              color: isDarkMode ? '#4a5568' : '#e5e7eb'\r\n            }\r\n          },\r\n          y: {\r\n            stacked: !isMiniChart, // Only stack for main charts, not mini charts\r\n            ticks: {\r\n              color: textColor,\r\n              font: {\r\n                size: isMiniChart ? 8 : 11\r\n              }\r\n            },\r\n            grid: {\r\n              color: isDarkMode ? '#4a5568' : '#e5e7eb'\r\n            }\r\n          }\r\n        },\r\n        plugins: {\r\n          legend: {\r\n            display: !isMiniChart, // Hide legend for mini charts\r\n            position: 'bottom',\r\n            labels: {\r\n              color: textColor,\r\n              font: {\r\n                size: 12\r\n              }\r\n            }\r\n          },\r\n          title: {\r\n            display: title.length > 0,\r\n            text: title,\r\n            color: textColor,\r\n            font: {\r\n              size: isMiniChart ? 12 : 16,\r\n              weight: 'bold'\r\n            }\r\n          },\r\n          tooltip: {\r\n            backgroundColor: bgColor,\r\n            titleColor: tooltipTextColor,\r\n            bodyColor: tooltipTextColor,\r\n            borderColor: borderColor,\r\n            borderWidth: 1,\r\n            titleFont: {\r\n              size: isMiniChart ? 10 : 14,\r\n              weight: 'bold'\r\n            },\r\n            bodyFont: {\r\n              size: isMiniChart ? 10 : 12\r\n            },\r\n            callbacks: {\r\n              label: (context) => {\r\n                const label = context.dataset.label || '';\r\n                const value = context.parsed.y;\r\n                return `${label}: ${value}`;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n    \r\n    this.charts.set(canvas.id, chart);\r\n    return chart;\r\n  }\r\n\r\n  /** Create a pie chart */\r\n  private createPieChart(canvas: HTMLCanvasElement, data: any, title: string, isMiniChart: boolean = false) {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return null;\r\n    \r\n    // Destroy existing chart if it exists\r\n    const existingChart = this.charts.get(canvas.id);\r\n    if (existingChart) {\r\n      existingChart.destroy();\r\n    }\r\n    \r\n    // Check if dark mode is active\r\n    const isDarkMode = document.body.classList.contains('theme-dark');\r\n    const textColor = isDarkMode ? '#ffffff' : '#000000';\r\n    const tooltipTextColor = '#ffffff'; // Always white for tooltips (they have dark backgrounds)\r\n    const bgColor = isDarkMode ? '#2d3748' : '#1f2937'; // Dark background for tooltips in both modes\r\n    const borderColor = isDarkMode ? '#4a5568' : '#374151';\r\n    \r\n    // Create new chart\r\n    const chart = new Chart(ctx, {\r\n      type: 'pie',\r\n      data: data,\r\n      options: {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        color: textColor, // Global text color\r\n        plugins: {\r\n          legend: {\r\n            display: !isMiniChart, // Hide legend for mini charts\r\n            position: 'bottom',\r\n            labels: {\r\n              color: textColor,\r\n              font: {\r\n                size: isMiniChart ? 8 : 12\r\n              }\r\n            }\r\n          },\r\n          title: {\r\n            display: title.length > 0,\r\n            text: title,\r\n            color: textColor,\r\n            font: {\r\n              size: isMiniChart ? 12 : 16,\r\n              weight: 'bold'\r\n            }\r\n          },\r\n          tooltip: {\r\n            backgroundColor: bgColor,\r\n            titleColor: tooltipTextColor,\r\n            bodyColor: tooltipTextColor,\r\n            borderColor: borderColor,\r\n            borderWidth: 1,\r\n            titleFont: {\r\n              size: isMiniChart ? 10 : 14,\r\n              weight: 'bold'\r\n            },\r\n            bodyFont: {\r\n              size: isMiniChart ? 10 : 12\r\n            },\r\n            callbacks: {\r\n              label: (context) => {\r\n                const label = context.label || '';\r\n                const value = context.parsed;\r\n                const total = context.dataset.data.reduce((a: number, b: number) => a + b, 0);\r\n                const percentage = ((value / total) * 100).toFixed(1);\r\n                return `${label}: ${value} (${percentage}%)`;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n    \r\n    this.charts.set(canvas.id, chart);\r\n    return chart;\r\n  }\r\n\r\n  private render() {\r\n    this.container.empty();\r\n    this.container.addClass(\"pm-dashboard-view\");\r\n\r\n    /* ── Top bar ───────────────────────── */\r\n    const topbar = this.container.createEl(\"div\", { cls: \"pm-dash-topbar\" });\r\n    topbar.createEl(\"span\", { text: \"Dashboard\" });\r\n\r\n    /* ── Projects dropdown (checkbox list) ─────────────────── */\r\n    const projBtn = topbar.createEl(\"button\", { cls: \"pm-proj-btn\" });\r\n    /* Label */\r\n    projBtn.createSpan({ text: \"Projects \" });\r\n    /* Lucide chevron-down icon */\r\n    const caret = projBtn.createSpan();\r\n    setIcon(caret, \"chevron-down\");\r\n\r\n    /* ── Assignees dropdown (checkbox list) ─────────────────── */\r\n    const assigneeBtn = topbar.createEl(\"button\", { cls: \"pm-proj-btn\" });\r\n    /* Label */\r\n    const assigneeBtnText = this.filterAssigneeName ?? \"Assignees\";\r\n    assigneeBtn.createSpan({ text: assigneeBtnText + \" \" });\r\n    /* Lucide chevron-down icon */\r\n    const assigneeCaret = assigneeBtn.createSpan();\r\n    setIcon(assigneeCaret, \"chevron-down\");\r\n\r\n    let ddOpen = false;\r\n    let ddEl: HTMLElement | null = null;\r\n    let assigneeDdOpen = false;\r\n    let assigneeDdEl: HTMLElement | null = null;\r\n\r\n    const buildDropdown = (projectList: any[]) => {\r\n      ddEl = document.createElement(\"div\");\r\n      ddEl.className = \"pm-proj-dd\";\r\n\r\n      /* Select/Deselect controls */\r\n      const controls = ddEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n      /* ALL */\r\n      controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        /* Keep current portfolio name so middle option remains visible */\r\n        this.updateFilter(null, this.filterName ?? \"\");\r\n        /* Update checkboxes without closing dropdown */\r\n        const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n        checkIcons.forEach(icon => {\r\n          icon.setAttribute(\"data-checked\", \"true\");\r\n          setIcon(icon, \"check-circle\");\r\n        });\r\n      };\r\n\r\n      /* PORTFOLIO (only if originalPaths present) */\r\n      if (this.originalPaths && this.originalPaths.length) {\r\n        controls.createSpan({ text: \" | \" });\r\n        controls.createEl(\"a\", { text: this.filterName ?? \"Portfolio\" }).onclick = (e) => {\r\n          e.preventDefault();\r\n          this.updateFilter([...this.originalPaths!], this.filterName ?? \"\");\r\n          /* Update checkboxes without closing dropdown */\r\n          const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n          checkIcons.forEach(icon => {\r\n            const projectPath = icon.getAttribute(\"data-project-path\");\r\n            const isChecked = this.originalPaths!.includes(projectPath!);\r\n            icon.setAttribute(\"data-checked\", isChecked.toString());\r\n            setIcon(icon, isChecked ? \"check-circle\" : \"circle\");\r\n          });\r\n        };\r\n      }\r\n\r\n      /* NONE */\r\n      controls.createSpan({ text: \" | \" });\r\n      controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        /* Preserve portfolio name so the middle option stays visible */\r\n        this.updateFilter([], this.filterName ?? \"\");\r\n        /* Update checkboxes without closing dropdown */\r\n        const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n        checkIcons.forEach(icon => {\r\n          icon.setAttribute(\"data-checked\", \"false\");\r\n          setIcon(icon, \"circle\");\r\n        });\r\n      };\r\n\r\n      /* Checkbox list */\r\n      projectList.forEach((p: any) => {\r\n        const wrap = ddEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n        const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n        cb.style.cursor = \"pointer\";\r\n        cb.style.marginRight = \"8px\";\r\n        cb.style.display = \"inline-block\";\r\n        cb.style.width = \"16px\";\r\n        cb.style.height = \"16px\";\r\n        wrap.createSpan({ text: ` ${p.file.basename}` });\r\n\r\n        const isChecked = !this.filterPaths || this.filterPaths.has(p.file.path);\r\n        setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n        \r\n        // Store the project path on the element for easy access\r\n        cb.setAttribute(\"data-project-path\", p.file.path);\r\n        cb.setAttribute(\"data-checked\", isChecked.toString());\r\n        wrap.onclick = () => {\r\n          const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n          const newChecked = !currentChecked;\r\n          \r\n          cb.setAttribute(\"data-checked\", newChecked.toString());\r\n          setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n          \r\n          /* gather all check icons to compute new filter */\r\n          const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\"));\r\n          const selected = checkIcons\r\n            .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n            .map(icon => icon.getAttribute(\"data-project-path\")!);\r\n\r\n          const newFilter =\r\n            selected.length === projectList.length ? null : selected;\r\n\r\n          /* Pass through existing filterName so it doesn't get cleared */\r\n          this.updateFilter(newFilter, this.filterName ?? \"\");\r\n        };\r\n      });\r\n\r\n      document.body.appendChild(ddEl);\r\n      /* Position below the button, but prevent overflow */\r\n      const r   = projBtn.getBoundingClientRect();\r\n      const pad = 4;                         // minimal margin from window edge\r\n\r\n      let left = r.left;\r\n      let top  = r.bottom + pad;             // default: below button\r\n\r\n      /* Measure after insertion */\r\n      const ddW = ddEl.offsetWidth  || 240;\r\n      const ddH = ddEl.offsetHeight || 260;\r\n\r\n      /* Prevent horizontal overflow - check both left and right edges */\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      /* Prevent vertical overflow – if no room below, place above */\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        const above = r.top - ddH - pad;\r\n        top = above >= pad ? above\r\n                           : Math.max(window.innerHeight - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      ddEl.style.left = `${left}px`;\r\n      ddEl.style.top  = `${top}px`;\r\n    };\r\n\r\n    const closeDropdown = () => {\r\n      ddEl?.remove();\r\n      ddEl = null;\r\n      ddOpen = false;\r\n      setIcon(caret, \"chevron-down\");\r\n    };\r\n\r\n    const closeAssigneeDropdown = () => {\r\n      assigneeDdEl?.remove();\r\n      assigneeDdEl = null;\r\n      assigneeDdOpen = false;\r\n      setIcon(assigneeCaret, \"chevron-down\");\r\n    };\r\n\r\n    projBtn.onclick = () => {\r\n      if (ddOpen) {\r\n        closeDropdown();\r\n        return;\r\n      }\r\n      ddOpen = true;\r\n      setIcon(caret, \"chevron-up\");\r\n\r\n      /* Build project list based on current cache + initial portfolio filter */\r\n      const projectList = Array.from(this.cache.projects.values())   // list every project\r\n        .sort((a, b) => a.file.basename.localeCompare(b.file.basename)); // sort A-Z\r\n      buildDropdown(projectList);\r\n\r\n      /* Close on outside click */\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (ddEl && !ddEl.contains(e.target as Node) && e.target !== projBtn) {\r\n          closeDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    /* ── Assignees dropdown functionality ─────────────────── */\r\n    const buildAssigneeDropdown = (assigneeList: string[]) => {\r\n      assigneeDdEl = document.createElement(\"div\");\r\n      assigneeDdEl.className = \"pm-proj-dd\";\r\n\r\n      /* Select/Deselect controls */\r\n      const controls = assigneeDdEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n      // Ensure we have an initial baseline like projects' originalPaths,\r\n      // so the middle option is available immediately.\r\n      if (!this.originalAssignees) {\r\n        if (!this.filterAssignees) {\r\n          // No filter applied ⇒ baseline is all assignees\r\n          this.originalAssignees = [...assigneeList];\r\n        } else if (this.filterAssignees.size > 0) {\r\n          // Baseline is the currently selected set\r\n          this.originalAssignees = Array.from(this.filterAssignees);\r\n        } else {\r\n          // Explicit none selected\r\n          this.originalAssignees = [];\r\n        }\r\n      }\r\n\r\n      /* ALL */\r\n      controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        /* Keep current assignee name so middle option remains visible */\r\n        this.updateAssigneeFilter(null);\r\n        /* Update checkboxes without closing dropdown */\r\n        const checkIcons = Array.from(assigneeDdEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n        checkIcons.forEach(icon => {\r\n          icon.setAttribute(\"data-checked\", \"true\");\r\n          setIcon(icon, \"check-circle\");\r\n        });\r\n      };\r\n\r\n      /* ASSIGNEES (only if originalAssignees present) */\r\n      if (this.originalAssignees && this.originalAssignees.length >= 0) {\r\n        controls.createSpan({ text: \" | \" });\r\n        controls.createEl(\"a\", { text: this.filterAssigneeName ?? this.filterName ?? \"Portfolio\" }).onclick = (e) => {\r\n          e.preventDefault();\r\n          this.updateAssigneeFilter([...this.originalAssignees!], this.filterAssigneeName ?? \"\");\r\n          /* Update checkboxes without closing dropdown */\r\n          const checkIcons = Array.from(assigneeDdEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n          checkIcons.forEach(icon => {\r\n            const assignee = icon.getAttribute(\"data-assignee\");\r\n            const isChecked = this.originalAssignees!.includes(assignee!);\r\n            icon.setAttribute(\"data-checked\", isChecked.toString());\r\n            setIcon(icon, isChecked ? \"check-circle\" : \"circle\");\r\n          });\r\n        };\r\n      }\r\n\r\n      /* NONE */\r\n      controls.createSpan({ text: \" | \" });\r\n      controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        /* Preserve assignee name so the middle option stays visible */\r\n        this.updateAssigneeFilter([]);\r\n        /* Update checkboxes without closing dropdown */\r\n        const checkIcons = Array.from(assigneeDdEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n        checkIcons.forEach(icon => {\r\n          icon.setAttribute(\"data-checked\", \"false\");\r\n          setIcon(icon, \"circle\");\r\n        });\r\n      };\r\n\r\n      /* Checkbox list */\r\n      assigneeList.forEach((assignee: string) => {\r\n        const wrap = assigneeDdEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n        const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n        cb.style.cursor = \"pointer\";\r\n        cb.style.marginRight = \"8px\";\r\n        cb.style.display = \"inline-block\";\r\n        cb.style.width = \"16px\";\r\n        cb.style.height = \"16px\";\r\n        wrap.createSpan({ text: ` ${assignee}` });\r\n\r\n        const isChecked = !this.filterAssignees || this.filterAssignees.has(assignee);\r\n        setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n        \r\n        // Store the assignee on the element for easy access\r\n        cb.setAttribute(\"data-assignee\", assignee);\r\n        cb.setAttribute(\"data-checked\", isChecked.toString());\r\n        wrap.onclick = () => {\r\n          const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n          const newChecked = !currentChecked;\r\n          \r\n          cb.setAttribute(\"data-checked\", newChecked.toString());\r\n          setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n          \r\n          /* gather all check icons to compute new filter */\r\n          const checkIcons = Array.from(assigneeDdEl!.querySelectorAll(\".pm-dd-check\"));\r\n          const selected = checkIcons\r\n            .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n            .map(icon => icon.getAttribute(\"data-assignee\")!);\r\n\r\n          const newFilter =\r\n            selected.length === assigneeList.length ? null : selected;\r\n\r\n          this.updateAssigneeFilter(newFilter, this.filterAssigneeName ?? \"\");\r\n        };\r\n      });\r\n\r\n      document.body.appendChild(assigneeDdEl);\r\n      /* Position below the button, but prevent overflow */\r\n      const r   = assigneeBtn.getBoundingClientRect();\r\n      const pad = 4;                         // minimal margin from window edge\r\n\r\n      let left = r.left;\r\n      let top  = r.bottom + pad;             // default: below button\r\n\r\n      /* Measure after insertion */\r\n      const ddW = assigneeDdEl.offsetWidth  || 240;\r\n      const ddH = assigneeDdEl.offsetHeight || 260;\r\n\r\n      /* Prevent horizontal overflow - check both left and right edges */\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      /* Prevent vertical overflow – if no room below, place above */\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        const above = r.top - ddH - pad;\r\n        top = above >= pad ? above\r\n                           : Math.max(window.innerHeight - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      assigneeDdEl.style.left = `${left}px`;\r\n      assigneeDdEl.style.top  = `${top}px`;\r\n    };\r\n\r\n    assigneeBtn.onclick = () => {\r\n      if (assigneeDdOpen) {\r\n        closeAssigneeDropdown();\r\n        return;\r\n      }\r\n      assigneeDdOpen = true;\r\n      setIcon(assigneeCaret, \"chevron-up\");\r\n\r\n      /* Build assignee list from all tasks (before filtering) */\r\n      const allTasks: any[] = [];\r\n      this.cache.projects.forEach((project: any) => {\r\n        // Apply project filter only\r\n        if (this.filterPaths && !this.filterPaths.has(project.file.path)) {\r\n          return;\r\n        }\r\n        \r\n        // Add project metadata to tasks\r\n        (project.tasks ?? []).forEach((task: any) => {\r\n          task.projectName = project.file.basename;\r\n          task.projectPath = project.file.path;\r\n          allTasks.push(task);\r\n        });\r\n      });\r\n      \r\n      const assigneeSet = new Set<string>();\r\n      allTasks.forEach(task => {\r\n        const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n        assigneeSet.add(assignee);\r\n      });\r\n      const assigneeList = Array.from(assigneeSet).sort();\r\n\r\n      buildAssigneeDropdown(assigneeList);\r\n\r\n      /* Close on outside click */\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (assigneeDdEl && !assigneeDdEl.contains(e.target as Node) && e.target !== assigneeBtn) {\r\n          closeAssigneeDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    /* ── Collect data ───────────────────────── */\r\n    const tasks = this.collectTasks();\r\n    \r\n    if (tasks.length === 0) {\r\n      this.container.createEl(\"p\", {\r\n        text: \"No tasks found. Try adjusting the project filter.\",\r\n        cls: \"pm-no-data\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    /* ── Dashboard content container ───────────────────────── */\r\n    const dashboardContent = this.container.createEl(\"div\", { cls: \"pm-dashboard-content\" });\r\n    \r\n    /* ── Dashboard grid ───────────────────────── */\r\n    const dashboardGrid = dashboardContent.createEl(\"div\", { cls: \"pm-dashboard-grid\" });\r\n\r\n    /* ── Handle focused chart view ───────────────────────── */\r\n    if (this.focusedChart) {\r\n      // Create layout for focused view\r\n      dashboardGrid.style.gridTemplateColumns = \"1fr 1fr\";\r\n      \r\n      // Add back button in header\r\n      const backBtn = dashboardContent.createEl(\"button\", { cls: \"pm-chart-back-btn\" });\r\n      const backIcon = backBtn.createSpan();\r\n      setIcon(backIcon, \"arrow-left\");\r\n      backBtn.createSpan({ text: \" Back to All Charts\" });\r\n      backBtn.onclick = () => this.focusChart(null);\r\n      backBtn.style.marginBottom = \"20px\";\r\n      \r\n      let focusedTitle = \"\";\r\n      let focusedData: any = null;\r\n      \r\n      switch (this.focusedChart) {\r\n        case 'status':\r\n          focusedTitle = \"Task Status Distribution\";\r\n          focusedData = this.createStatusChartData(tasks);\r\n          break;\r\n        case 'type':\r\n          focusedTitle = \"Task Type Distribution\";\r\n          focusedData = this.createTypeChartData(tasks);\r\n          break;\r\n        case 'assignee':\r\n          focusedTitle = \"Assignee Distribution\";\r\n          focusedData = this.createAssigneeChartData(tasks);\r\n          break;\r\n        case 'assignee-status':\r\n          focusedTitle = \"Assignee Status Distribution\";\r\n          focusedData = this.createAssigneeStatusChartData(tasks);\r\n          break;\r\n        case 'project':\r\n          focusedTitle = \"Project Distribution\";\r\n          focusedData = this.createProjectChartData(tasks);\r\n          break;\r\n      }\r\n      \r\n      // Main chart section\r\n      const mainChartCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n      mainChartCard.createEl(\"h3\", { text: focusedTitle });\r\n      const focusedCanvas = mainChartCard.createEl(\"canvas\", { cls: \"pm-chart-canvas\" });\r\n      focusedCanvas.id = \"focused-chart\";\r\n      \r\n      // Use bar chart for assignee-status, pie chart for others\r\n      if (this.focusedChart === 'assignee-status') {\r\n        this.createBarChart(focusedCanvas, focusedData, focusedTitle);\r\n      } else {\r\n        this.createPieChart(focusedCanvas, focusedData, focusedTitle);\r\n      }\r\n      \r\n      // Project summary breakdown section\r\n      const projectSummaryCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n      projectSummaryCard.createEl(\"h3\", { text: \"Breakdown by Project\" });\r\n      this.renderProjectBreakdown(projectSummaryCard, tasks, this.focusedChart);\r\n      \r\n      // Project Status Bar Chart section (full width) - only for project distribution zoom\r\n      if (this.focusedChart === 'project') {\r\n        const projectStatusCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n        projectStatusCard.style.gridColumn = \"1 / -1\";\r\n        projectStatusCard.createEl(\"h3\", { text: \"Project Status Distribution\" });\r\n        const projectStatusCanvas = projectStatusCard.createEl(\"canvas\", { cls: \"pm-chart-canvas\" });\r\n        projectStatusCanvas.id = \"project-status-chart\";\r\n        const projectStatusData = this.createProjectStatusChartData(tasks);\r\n        this.createBarChart(projectStatusCanvas, projectStatusData, \"Tasks by Status per Project\");\r\n      }\r\n\r\n      // Assignee per Project Bar Chart section (full width) - only for assignee distribution zoom\r\n      if (this.focusedChart === 'assignee') {\r\n        const assigneeProjectCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n        assigneeProjectCard.style.gridColumn = \"1 / -1\";\r\n        assigneeProjectCard.createEl(\"h3\", { text: \"Assignee Distribution per Project\" });\r\n        const assigneeProjectCanvas = assigneeProjectCard.createEl(\"canvas\", { cls: \"pm-chart-canvas\" });\r\n        assigneeProjectCanvas.id = \"assignee-project-chart\";\r\n        const assigneeProjectData = this.createAssigneeProjectChartData(tasks);\r\n        this.createBarChart(assigneeProjectCanvas, assigneeProjectData, \"Tasks by Assignee per Project\");\r\n      }\r\n\r\n      // Assignee charts section (full width)\r\n      const assigneeChartsCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n      assigneeChartsCard.style.gridColumn = \"1 / -1\";\r\n      this.renderAssigneeBreakdown(assigneeChartsCard, tasks, this.focusedChart);\r\n      \r\n      return; // Exit early, don't show other charts\r\n    }\r\n\r\n    /* ── Task Status Chart ───────────────────────── */\r\n    const statusCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n    const statusHeader = statusCard.createEl(\"div\", { cls: \"pm-chart-header\" });\r\n    statusHeader.createEl(\"h3\", { text: \"Task Status Distribution\" });\r\n    const statusZoomBtn = statusHeader.createEl(\"button\", { cls: \"pm-chart-zoom-btn\" });\r\n    const statusZoomIcon = statusZoomBtn.createSpan();\r\n    setIcon(statusZoomIcon, \"search\");\r\n    statusZoomBtn.onclick = () => this.focusChart('status');\r\n    \r\n    const statusCanvas = statusCard.createEl(\"canvas\", { \r\n      cls: \"pm-chart-canvas\"\r\n    });\r\n    statusCanvas.id = \"status-chart\";\r\n    \r\n    const statusData = this.createStatusChartData(tasks);\r\n    this.createPieChart(statusCanvas, statusData, \"Task Status\");\r\n\r\n    /* ── Task Type Chart ───────────────────────── */\r\n    const typeCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n    const typeHeader = typeCard.createEl(\"div\", { cls: \"pm-chart-header\" });\r\n    typeHeader.createEl(\"h3\", { text: \"Task Type Distribution\" });\r\n    const typeZoomBtn = typeHeader.createEl(\"button\", { cls: \"pm-chart-zoom-btn\" });\r\n    const typeZoomIcon = typeZoomBtn.createSpan();\r\n    setIcon(typeZoomIcon, \"search\");\r\n    typeZoomBtn.onclick = () => this.focusChart('type');\r\n    \r\n    const typeCanvas = typeCard.createEl(\"canvas\", { \r\n      cls: \"pm-chart-canvas\"\r\n    });\r\n    typeCanvas.id = \"type-chart\";\r\n    \r\n    const typeData = this.createTypeChartData(tasks);\r\n    this.createPieChart(typeCanvas, typeData, \"Task Types\");\r\n\r\n    /* ── Assignee Chart ───────────────────────── */\r\n    const assigneeCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n    const assigneeHeader = assigneeCard.createEl(\"div\", { cls: \"pm-chart-header\" });\r\n    assigneeHeader.createEl(\"h3\", { text: \"Assignee Distribution\" });\r\n    const assigneeZoomBtn = assigneeHeader.createEl(\"button\", { cls: \"pm-chart-zoom-btn\" });\r\n    const assigneeZoomIcon = assigneeZoomBtn.createSpan();\r\n    setIcon(assigneeZoomIcon, \"search\");\r\n    assigneeZoomBtn.onclick = () => this.focusChart('assignee');\r\n    \r\n    const assigneeCanvas = assigneeCard.createEl(\"canvas\", { \r\n      cls: \"pm-chart-canvas\"\r\n    });\r\n    assigneeCanvas.id = \"assignee-chart\";\r\n    \r\n    const assigneeData = this.createAssigneeChartData(tasks);\r\n    this.createPieChart(assigneeCanvas, assigneeData, \"Tasks per Assignee\");\r\n\r\n    /* ── Project Chart ───────────────────────── */\r\n    const projectCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n    const projectHeader = projectCard.createEl(\"div\", { cls: \"pm-chart-header\" });\r\n    projectHeader.createEl(\"h3\", { text: \"Project Distribution\" });\r\n    const projectZoomBtn = projectHeader.createEl(\"button\", { cls: \"pm-chart-zoom-btn\" });\r\n    const projectZoomIcon = projectZoomBtn.createSpan();\r\n    setIcon(projectZoomIcon, \"search\");\r\n    projectZoomBtn.onclick = () => this.focusChart('project');\r\n    \r\n    const projectCanvas = projectCard.createEl(\"canvas\", { \r\n      cls: \"pm-chart-canvas\"\r\n    });\r\n    projectCanvas.id = \"project-chart\";\r\n    \r\n    const projectData = this.createProjectChartData(tasks);\r\n    this.createPieChart(projectCanvas, projectData, \"Tasks per Project\");\r\n\r\n    /* ── Assignee Status Chart ───────────────────────── */\r\n    const assigneeStatusCard = dashboardGrid.createEl(\"div\", { cls: \"pm-chart-card\" });\r\n    const assigneeStatusHeader = assigneeStatusCard.createEl(\"div\", { cls: \"pm-chart-header\" });\r\n    assigneeStatusHeader.createEl(\"h3\", { text: \"Assignee Status Distribution\" });\r\n    const assigneeStatusZoomBtn = assigneeStatusHeader.createEl(\"button\", { cls: \"pm-chart-zoom-btn\" });\r\n    const assigneeStatusZoomIcon = assigneeStatusZoomBtn.createSpan();\r\n    setIcon(assigneeStatusZoomIcon, \"search\");\r\n    assigneeStatusZoomBtn.onclick = () => this.focusChart('assignee-status');\r\n    \r\n    const assigneeStatusCanvas = assigneeStatusCard.createEl(\"canvas\", { \r\n      cls: \"pm-chart-canvas\"\r\n    });\r\n    assigneeStatusCanvas.id = \"assignee-status-chart\";\r\n    \r\n    const assigneeStatusData = this.createAssigneeStatusChartData(tasks);\r\n    this.createBarChart(assigneeStatusCanvas, assigneeStatusData, \"Tasks by Status per Assignee\");\r\n\r\n    /* ── Summary Stats ───────────────────────── */\r\n    const summaryCard = dashboardGrid.createEl(\"div\", { cls: \"pm-summary-card\" });\r\n    const summaryTitle = summaryCard.createEl(\"h3\", { text: \"Summary\" });\r\n    \r\n    const totalTasks = tasks.length;\r\n    const completedTasks = tasks.filter(isTaskDone).length;\r\n    const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;\r\n    \r\n    const summaryStats = summaryCard.createEl(\"div\", { cls: \"pm-summary-stats\" });\r\n    const totalTasksDiv = summaryStats.createEl(\"div\", { \r\n      cls: \"pm-stat-item\"\r\n    });\r\n    totalTasksDiv.createEl(\"strong\", { text: \"Total Tasks: \" });\r\n    totalTasksDiv.createEl(\"span\", { text: `${totalTasks}` });\r\n    \r\n    const completedTasksDiv = summaryStats.createEl(\"div\", { \r\n      cls: \"pm-stat-item\"\r\n    });\r\n    completedTasksDiv.createEl(\"strong\", { text: \"Completed: \" });\r\n    completedTasksDiv.createEl(\"span\", { text: `${completedTasks}` });\r\n    \r\n    const completionRateDiv = summaryStats.createEl(\"div\", { \r\n      cls: \"pm-stat-item\"\r\n    });\r\n    completionRateDiv.createEl(\"strong\", { text: \"Completion Rate: \" });\r\n    completionRateDiv.createEl(\"span\", { text: `${completionRate}%` });\r\n    \r\n    const uniqueProjects = new Set(tasks.map(t => t.projectName)).size;\r\n    const uniqueAssignees = new Set(tasks.map(t => \r\n      (t.assignee ?? t.props?.assignee ?? t.owner ?? t.props?.owner ?? \"Unassigned\").toString().trim()\r\n    )).size;\r\n    \r\n    const projectsDiv = summaryStats.createEl(\"div\", { \r\n      cls: \"pm-stat-item\"\r\n    });\r\n    projectsDiv.createEl(\"strong\", { text: \"Projects: \" });\r\n    projectsDiv.createEl(\"span\", { text: `${uniqueProjects}` });\r\n    \r\n    const assigneesDiv = summaryStats.createEl(\"div\", { \r\n      cls: \"pm-stat-item\"\r\n    });\r\n    assigneesDiv.createEl(\"strong\", { text: \"Assignees: \" });\r\n    assigneesDiv.createEl(\"span\", { text: `${uniqueAssignees}` });\r\n  }\r\n}\r\n","import {\r\n  ItemView,\r\n  WorkspaceLeaf,\r\n  setIcon,\r\n  Notice,\r\n} from \"obsidian\";\r\nimport { TFile } from \"obsidian\";\r\n/* Moment.js is available globally in Obsidian */\r\ndeclare const moment: any;\r\nimport { ProjectCache, TaskItem, ProjectEntry } from \"../services/cache\";\r\nimport { PmSettings } from \"../../settings\";\r\n\r\n// Extended task interface for today view functions\r\ninterface ExtendedTaskItem extends TaskItem {\r\n  done?: boolean | string;\r\n  percentComplete?: number;\r\n  raw?: string;\r\n  priority?: string;\r\n  start?: string;\r\n  due?: string;\r\n  projectName?: string;\r\n  projectPath?: string;\r\n  assignee?: string;\r\n  owner?: string;\r\n}\r\n\r\n// Load today-specific stylesheet\r\nimport \"../../styles/styles-today.css\";\r\n\r\n/** Helper: format a date or return an em-dash if undefined */\r\nfunction formatDate(d: string | number | Date | undefined): string {\r\n  if (!d) return \"—\";\r\n  return new Date(d).toLocaleDateString();\r\n}\r\n\r\n/** Detect whether a task is completed */\r\nfunction isTaskCompleted(t: ExtendedTaskItem): boolean {\r\n  /* explicit flags from parsers */\r\n  if (t.done === true || t.checked === true) return true;\r\n  if (typeof t.done === \"string\" && t.done.toLowerCase() === \"completed\") return true;\r\n\r\n  /* explicit status strings */\r\n  if (typeof t.status === \"string\") {\r\n    const s = t.status.toLowerCase();\r\n    if ([\"completed\", \"complete\", \"finished\", \"done\"].includes(s)) return true;\r\n  }\r\n\r\n  /* percent-complete field */\r\n  if (typeof t.percentComplete === \"number\" && t.percentComplete >= 1) return true;\r\n\r\n  /* markdown checkbox or bullet */\r\n  const raw = (t.raw ?? t.text ?? \"\").toString();\r\n  if (/^\\s*-\\s*\\[[xX]\\]/.test(raw)) return true;\r\n\r\n  /* completed:: 2025‑05‑01 inline field or front‑matter */\r\n  if (t.props?.completed || t.props?.[\"completionDate\"]) return true;\r\n\r\n  return false;\r\n}\r\n\r\n/** Get task priority level */\r\nfunction getTaskPriority(task: ExtendedTaskItem): 'high' | 'medium' | 'low' | 'none' {\r\n  // Check explicit priority fields\r\n  if (task.priority) {\r\n    const p = task.priority.toString().toLowerCase();\r\n    if (['high', 'h', '1', 'p1'].includes(p)) return 'high';\r\n    if (['medium', 'med', 'm', '2', 'p2'].includes(p)) return 'medium';\r\n    if (['low', 'l', '3', 'p3'].includes(p)) return 'low';\r\n  }\r\n  \r\n  // Check props for priority\r\n  if (task.props?.priority) {\r\n    const p = task.props.priority.toString().toLowerCase();\r\n    if (['high', 'h', '1', 'p1'].includes(p)) return 'high';\r\n    if (['medium', 'med', 'm', '2', 'p2'].includes(p)) return 'medium';\r\n    if (['low', 'l', '3', 'p3'].includes(p)) return 'low';\r\n  }\r\n  \r\n  // Check for priority in tags or text\r\n  const text = (task.text || task.raw || \"\").toLowerCase();\r\n  if (text.includes('#high') || text.includes('#priority')) return 'high';\r\n  if (text.includes('#medium') || text.includes('#med')) return 'medium';\r\n  if (text.includes('#low')) return 'low';\r\n  \r\n  return 'none';\r\n}\r\n\r\n/** Check if task is due today or overdue */\r\nfunction isTaskDueToday(task: ExtendedTaskItem, testDate?: string): boolean {\r\n  // Use test date if provided, otherwise use current date\r\n  const today = testDate ? moment(testDate).startOf('day') : moment().startOf('day');\r\n  \r\n  // Check due date\r\n  if (task.due) {\r\n    const dueDate = moment(task.due).startOf('day');\r\n    return dueDate.isSameOrBefore(today);\r\n  }\r\n  \r\n  // Check due date in props\r\n  if (task.props?.due) {\r\n    const dueDate = moment(task.props.due).startOf('day');\r\n    return dueDate.isSameOrBefore(today);\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\n/** Check if task should be started (start date is today or in the past) */\r\nfunction shouldTaskBeStarted(task: ExtendedTaskItem, testDate?: string): boolean {\r\n  // Use test date if provided, otherwise use current date\r\n  const today = testDate ? moment(testDate).startOf('day') : moment().startOf('day');\r\n  \r\n  // Check start date\r\n  if (task.start) {\r\n    const startDate = moment(task.start).startOf('day');\r\n    return startDate.isSameOrBefore(today);\r\n  }\r\n  \r\n  // Check start date in props\r\n  if (task.props?.start) {\r\n    const startDate = moment(task.props.start).startOf('day');\r\n    return startDate.isSameOrBefore(today);\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\n/** Get days until start (negative if start date has passed) */\r\nfunction getDaysUntilStart(task: ExtendedTaskItem, testDate?: string): number {\r\n  // Use test date if provided, otherwise use current date\r\n  const today = testDate ? moment(testDate).startOf('day') : moment().startOf('day');\r\n  \r\n  // Check start date\r\n  if (task.start) {\r\n    const startDate = moment(task.start).startOf('day');\r\n    return startDate.diff(today, 'days');\r\n  }\r\n  \r\n  // Check start date in props\r\n  if (task.props?.start) {\r\n    const startDate = moment(task.props.start).startOf('day');\r\n    return startDate.diff(today, 'days');\r\n  }\r\n  \r\n  return 999; // No start date\r\n}\r\n\r\n/** Check if task is overdue */\r\nfunction isTaskOverdue(task: ExtendedTaskItem, testDate?: string): boolean {\r\n  // Use test date if provided, otherwise use current date\r\n  const today = testDate ? moment(testDate).startOf('day') : moment().startOf('day');\r\n  \r\n  // Check due date\r\n  if (task.due) {\r\n    const dueDate = moment(task.due).startOf('day');\r\n    return dueDate.isBefore(today);\r\n  }\r\n  \r\n  // Check due date in props\r\n  if (task.props?.due) {\r\n    const dueDate = moment(task.props.due).startOf('day');\r\n    return dueDate.isBefore(today);\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\n/** Get days until due (negative if overdue) */\r\nfunction getDaysUntilDue(task: ExtendedTaskItem, testDate?: string): number {\r\n  // Use test date if provided, otherwise use current date\r\n  const today = testDate ? moment(testDate).startOf('day') : moment().startOf('day');\r\n  \r\n  // Check due date\r\n  if (task.due) {\r\n    const dueDate = moment(task.due).startOf('day');\r\n    return dueDate.diff(today, 'days');\r\n  }\r\n  \r\n  // Check due date in props\r\n  if (task.props?.due) {\r\n    const dueDate = moment(task.props.due).startOf('day');\r\n    return dueDate.diff(today, 'days');\r\n  }\r\n  \r\n  return 999; // No due date\r\n}\r\n\r\nexport const VIEW_TYPE_PM_TODAY = \"pm-today-view\";\r\n\r\nexport class TodayView extends ItemView {\r\n  private cache: ProjectCache;\r\n  private settings: PmSettings;\r\n  private container!: HTMLElement;\r\n  private detachFn: (() => void) | null = null;\r\n  private showSubtasksOnly: boolean = true;\r\n  private showCompleted: boolean = false;\r\n  private showOverdueOnly: boolean = false;\r\n  private lastScrollTop: number = 0;\r\n  private collapsedSections: Set<string> = new Set();\r\n  private selectedDate: string = moment().format('YYYY-MM-DD'); // Use current date as default\r\n  /** Optional set of project file paths to display */\r\n  private filterPaths?: Set<string>;\r\n\r\n  constructor(\r\n    leaf: WorkspaceLeaf,\r\n    cache: ProjectCache,\r\n    settings: PmSettings\r\n  ) {\r\n    super(leaf);\r\n    this.cache = cache;\r\n    this.settings = settings;\r\n  }\r\n\r\n  getViewType(): string {\r\n    return VIEW_TYPE_PM_TODAY;\r\n  }\r\n\r\n  getDisplayText(): string {\r\n    return \"Today\";\r\n  }\r\n\r\n  getIcon(): string {\r\n    return \"calendar\";\r\n  }\r\n\r\n  async onOpen() {\r\n    this.container = this.contentEl;\r\n    this.render();\r\n    this.detachFn = this.cache.onChange(() => this.render());\r\n  }\r\n\r\n  async onClose() {\r\n    this.detachFn?.();\r\n  }\r\n\r\n  /** Collect all tasks with intelligent recommendations */\r\n  private collectTodayTasks(): ExtendedTaskItem[] {\r\n    const allTasks: ExtendedTaskItem[] = [];\r\n    \r\n    this.cache.projects.forEach((project: ProjectEntry) => {\r\n      // Add project metadata to tasks\r\n      (project.tasks ?? []).forEach((task: TaskItem) => {\r\n        const extendedTask = task as ExtendedTaskItem;\r\n        extendedTask.projectName = project.file.basename;\r\n        extendedTask.projectPath = project.file.path;\r\n        allTasks.push(extendedTask);\r\n      });\r\n    });\r\n    \r\n    // Filter to only incomplete tasks\r\n    const incompleteTasks = allTasks.filter(task => !isTaskCompleted(task));\r\n    \r\n    // Sort by intelligent priority scoring\r\n    const sortedTasks = incompleteTasks.sort((a, b) => {\r\n      const aScore = this.calculateTaskScore(a);\r\n      const bScore = this.calculateTaskScore(b);\r\n      return bScore - aScore; // Higher score first\r\n    });\r\n    \r\n    return sortedTasks;\r\n  }\r\n\r\n  /** Calculate intelligent priority score for a task */\r\n  private calculateTaskScore(task: ExtendedTaskItem): number {\r\n    let score = 0;\r\n    \r\n    // Priority multiplier\r\n    const priorityMultiplier = { 'high': 3, 'medium': 2, 'low': 1, 'none': 0.5 };\r\n    const priority = getTaskPriority(task);\r\n    score += priorityMultiplier[priority] * 100;\r\n    \r\n    // Due date urgency\r\n    const daysUntilDue = getDaysUntilDue(task);\r\n    if (daysUntilDue < 0) {\r\n      // Overdue tasks get high score\r\n      score += Math.abs(daysUntilDue) * 50 + 200;\r\n    } else if (daysUntilDue === 0) {\r\n      // Due today\r\n      score += 150;\r\n    } else if (daysUntilDue <= 2) {\r\n      // Due in next 2 days\r\n      score += 100;\r\n    } else if (daysUntilDue <= 5) {\r\n      // Due this week\r\n      score += 50;\r\n    } else if (daysUntilDue <= 14) {\r\n      // Due in next 2 weeks\r\n      score += 25;\r\n    }\r\n    \r\n    // Status-based scoring\r\n    if (task.status) {\r\n      const status = task.status.toLowerCase();\r\n      if (status === 'in-progress' || status === 'doing') {\r\n        score += 75; // Active tasks get bonus\r\n      } else if (status === 'review' || status === 'testing') {\r\n        score += 50; // Review tasks get bonus\r\n      } else if (status === 'blocked' || status === 'on-hold') {\r\n        score -= 25; // Blocked tasks get penalty\r\n      }\r\n    }\r\n    \r\n    // Task type scoring\r\n    const taskType = this.getTaskType(task);\r\n    if (taskType === 'epic') {\r\n      score += 30; // Epics are important\r\n    } else if (taskType === 'story') {\r\n      score += 20; // Stories are important\r\n    }\r\n    \r\n    // Assignee scoring (if assigned to current user or unassigned)\r\n    const assignee = task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner;\r\n    if (!assignee || assignee === 'Unassigned') {\r\n      score += 15; // Unassigned tasks need attention\r\n    }\r\n    \r\n    return score;\r\n  }\r\n\r\n  /** Get task type for categorization */\r\n  private getTaskType(task: ExtendedTaskItem): 'epic' | 'story' | 'subtask' | 'other' {\r\n    const id = (task.id ?? \"\").toUpperCase();\r\n    if (id.startsWith(\"E\")) return 'epic';\r\n    if (id.startsWith(\"S\") && !id.startsWith(\"SB\")) return 'story';\r\n    if (id.startsWith(\"SB\")) return 'subtask';\r\n    return 'other';\r\n  }\r\n\r\n  /** Update project filter & re-render */\r\n  public updateFilter(paths: string[] | null) {\r\n    if (paths === null) {\r\n      // Show ALL projects\r\n      this.filterPaths = undefined;\r\n    } else if (Array.isArray(paths)) {\r\n      // Show NONE if empty array, else selected set\r\n      this.filterPaths = paths.length ? new Set(paths) : new Set<string>();\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Get task status for color coding */\r\n  private getTaskStatus(task: ExtendedTaskItem): 'not-started' | 'in-progress' | 'completed' | 'on-hold' {\r\n    // Check if task is completed\r\n    if (isTaskCompleted(task)) {\r\n      return 'completed';\r\n    }\r\n    \r\n    // Check explicit status field\r\n    if (task.status) {\r\n      const status = task.status.toLowerCase();\r\n      if (['on-hold', 'on hold', 'blocked', 'paused', 'waiting', 'hold'].includes(status)) {\r\n        return 'on-hold';\r\n      }\r\n      if (['in-progress', 'doing', 'active', 'started', 'working'].includes(status)) {\r\n        return 'in-progress';\r\n      }\r\n      if (['not-started', 'todo', 'pending', 'new', 'open'].includes(status)) {\r\n        return 'not-started';\r\n      }\r\n    }\r\n    \r\n    // Check props for status\r\n    if (task.props?.status) {\r\n      const status = task.props.status.toLowerCase();\r\n      if (['on-hold', 'on hold', 'blocked', 'paused', 'waiting', 'hold'].includes(status)) {\r\n        return 'on-hold';\r\n      }\r\n      if (['in-progress', 'doing', 'active', 'started', 'working'].includes(status)) {\r\n        return 'in-progress';\r\n      }\r\n      if (['not-started', 'todo', 'pending', 'new', 'open'].includes(status)) {\r\n        return 'not-started';\r\n      }\r\n    }\r\n    \r\n    // Default to not-started if no explicit status\r\n    return 'not-started';\r\n  }\r\n\r\n  private render() {\r\n    // Save current scroll position\r\n    this.lastScrollTop = this.container.scrollTop || 0;\r\n    \r\n    this.container.empty();\r\n    this.container.addClass(\"pm-today-view\");\r\n\r\n    /* ── Header ───────────────────────── */\r\n    const header = this.container.createEl(\"div\", { cls: \"pm-today-header\" });\r\n    const title = header.createEl(\"h2\", { text: \"All Projects & Assignees\" });\r\n    const subtitle = header.createEl(\"div\", { \r\n      cls: \"pm-today-subtitle\",\r\n      text: \"Tasks due or starting from 2 weeks ago to 2 weeks ahead, plus tasks without dates\"\r\n    });\r\n    \r\n    // Date row with formatted date and date picker\r\n    const dateRow = header.createEl(\"div\", { cls: \"pm-today-date-row\" });\r\n    const date = dateRow.createEl(\"div\", { \r\n      cls: \"pm-today-date\",\r\n      text: moment(this.selectedDate).format('dddd, MMMM Do YYYY')\r\n    });\r\n    \r\n    const datePicker = dateRow.createEl(\"input\", { \r\n      cls: \"pm-today-date-picker\",\r\n      type: \"date\"\r\n    }) as HTMLInputElement;\r\n    datePicker.value = this.selectedDate;\r\n    \r\n    // Add date picker change handler\r\n    datePicker.onchange = () => {\r\n      this.selectedDate = datePicker.value;\r\n      this.render();\r\n    };\r\n    \r\n    // Filter controls\r\n    const filterControls = header.createEl(\"div\", { cls: \"pm-today-filters\" });\r\n    \r\n    // Projects dropdown\r\n    const projBtn = filterControls.createEl(\"button\", { cls: \"pm-today-filter-btn pm-proj-btn\" });\r\n    projBtn.createSpan({ text: \"Projects \" });\r\n    const caret = projBtn.createSpan();\r\n    setIcon(caret, \"chevron-down\");\r\n\r\n    let ddOpen = false;\r\n    let ddEl: HTMLElement | null = null;\r\n\r\n    const buildDropdown = (projectList: ProjectEntry[]) => {\r\n      ddEl = document.createElement(\"div\");\r\n      ddEl.className = \"pm-proj-dd\";\r\n\r\n      // Select/Deselect controls\r\n      const controls = ddEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n      \r\n      // ALL\r\n      controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        this.updateFilter(null);\r\n        const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n        checkIcons.forEach(icon => {\r\n          icon.setAttribute(\"data-checked\", \"true\");\r\n          setIcon(icon, \"check-circle\");\r\n        });\r\n      };\r\n\r\n      // NONE\r\n      controls.createSpan({ text: \" | \" });\r\n      controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n        e.preventDefault();\r\n        this.updateFilter([]);\r\n        const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n        checkIcons.forEach(icon => {\r\n          icon.setAttribute(\"data-checked\", \"false\");\r\n          setIcon(icon, \"circle\");\r\n        });\r\n      };\r\n\r\n      // Checkbox list\r\n      projectList.forEach((p: ProjectEntry) => {\r\n        const wrap = ddEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n        const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n        wrap.createSpan({ text: ` ${p.file.basename}` });\r\n\r\n        const isChecked = !this.filterPaths || this.filterPaths.has(p.file.path);\r\n        setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n        \r\n        cb.setAttribute(\"data-project-path\", p.file.path);\r\n        cb.setAttribute(\"data-checked\", isChecked.toString());\r\n        wrap.onclick = () => {\r\n          const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n          const newChecked = !currentChecked;\r\n          \r\n          cb.setAttribute(\"data-checked\", newChecked.toString());\r\n          setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n          \r\n          const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\"));\r\n          const selected = checkIcons\r\n            .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n            .map(icon => icon.getAttribute(\"data-project-path\")!);\r\n\r\n          const newFilter = selected.length === projectList.length ? null : selected;\r\n          this.updateFilter(newFilter);\r\n        };\r\n      });\r\n\r\n      document.body.appendChild(ddEl);\r\n      \r\n      // Position dropdown\r\n      const r = projBtn.getBoundingClientRect();\r\n      const pad = 4;\r\n      let left = r.left;\r\n      let top = r.bottom + pad;\r\n\r\n      const ddW = ddEl.offsetWidth || 240;\r\n      const ddH = ddEl.offsetHeight || 260;\r\n\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        const above = r.top - ddH - pad;\r\n        top = above >= pad ? above : Math.max(window.innerHeight - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      ddEl.style.left = `${left}px`;\r\n      ddEl.style.top = `${top}px`;\r\n      ddEl.classList.add(\"pm-dropdown-positioned\");\r\n    };\r\n\r\n    const closeDropdown = () => {\r\n      ddEl?.remove();\r\n      ddEl = null;\r\n      ddOpen = false;\r\n      setIcon(caret, \"chevron-down\");\r\n    };\r\n\r\n    projBtn.onclick = () => {\r\n      if (ddOpen) {\r\n        closeDropdown();\r\n        return;\r\n      }\r\n      ddOpen = true;\r\n      setIcon(caret, \"chevron-up\");\r\n\r\n      const projectList = Array.from(this.cache.projects.values())\r\n        .sort((a, b) => a.file.basename.localeCompare(b.file.basename));\r\n      buildDropdown(projectList);\r\n\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (ddEl && !ddEl.contains(e.target as Node) && e.target !== projBtn) {\r\n          closeDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n    \r\n    const subtaskToggle = filterControls.createEl(\"button\", { \r\n      cls: `pm-today-filter-btn ${this.showSubtasksOnly ? 'active' : ''}`,\r\n      text: this.showSubtasksOnly ? \"Show Epics and Stories\" : \"Show Subtasks Only\"\r\n    });\r\n    \r\n    const completedToggle = filterControls.createEl(\"button\", { \r\n      cls: `pm-today-filter-btn ${this.showCompleted ? 'active' : ''}`,\r\n      text: this.showCompleted ? \"Hide Completed\" : \"Show Completed\"\r\n    });\r\n    \r\n    const overdueToggle = filterControls.createEl(\"button\", { \r\n      cls: `pm-today-filter-btn ${this.showOverdueOnly ? 'active' : ''}`,\r\n      text: this.showOverdueOnly ? \"Show All\" : \"Show Overdue\"\r\n    });\r\n    \r\n    subtaskToggle.onclick = () => {\r\n      this.showSubtasksOnly = !this.showSubtasksOnly;\r\n      this.render();\r\n    };\r\n    \r\n    completedToggle.onclick = () => {\r\n      this.showCompleted = !this.showCompleted;\r\n      this.render();\r\n    };\r\n    \r\n    overdueToggle.onclick = () => {\r\n      this.showOverdueOnly = !this.showOverdueOnly;\r\n      this.render();\r\n    };\r\n\r\n    /* ── Collect tasks within 2-week window from all projects ───────────────────────── */\r\n    const allTasks: any[] = [];\r\n\r\n    \r\n    let projectIndex = 0;\r\n    this.cache.projects.forEach((project: any, projectKey: string) => {\r\n      projectIndex++;\r\n\r\n      // Apply project filter\r\n      if (this.filterPaths && !this.filterPaths.has(project.file.path)) {\r\n        return;\r\n      }\r\n      \r\n      (project.tasks ?? []).forEach((task: any, taskIndex: number) => {\r\n        const isCompleted = isTaskCompleted(task);\r\n        \r\n        // Skip completed tasks unless we're showing them\r\n        if (isCompleted && !this.showCompleted) {\r\n\r\n          return;\r\n        }\r\n        \r\n        // Skip non-overdue tasks if we're only showing overdue\r\n        if (this.showOverdueOnly) {\r\n          const daysUntilDue = getDaysUntilDue(task, this.selectedDate);\r\n          const daysUntilStart = getDaysUntilStart(task, this.selectedDate);\r\n          const isCompleted = isTaskCompleted(task);\r\n          \r\n          // Include tasks that are:\r\n          // 1. Past due date (daysUntilDue < 0), OR\r\n          // 2. Past start date but not started (daysUntilStart < 0 and not completed)\r\n          const isOverdue = daysUntilDue < 0;\r\n          const shouldHaveStarted = daysUntilStart < 0 && !isCompleted;\r\n          \r\n          if (!isOverdue && !shouldHaveStarted) {\r\n            return;\r\n          }\r\n        }\r\n        \r\n        // Check if this is a subtask\r\n        const taskType = this.getTaskType(task);\r\n        const isSubtask = taskType === 'subtask';\r\n        \r\n        // Skip if we're filtering for subtasks only and this isn't a subtask\r\n        if (this.showSubtasksOnly && !isSubtask) {\r\n\r\n          return;\r\n        }\r\n        \r\n        const daysUntilDue = getDaysUntilDue(task, this.selectedDate);\r\n        const daysUntilStart = getDaysUntilStart(task, this.selectedDate);\r\n        \r\n        // In overdue mode, include ALL overdue tasks regardless of 2-week window\r\n        if (this.showOverdueOnly) {\r\n          // Already filtered for overdue above, so include all overdue tasks\r\n          task.projectName = project.file.basename;\r\n          task.projectPath = project.file.path;\r\n          allTasks.push(task);\r\n\r\n        } else {\r\n          // Normal mode: Include tasks that are:\r\n          // 1. Due within 2 weeks ago to 2 weeks in the future, OR\r\n          // 2. Should be started within 2 weeks ago to 2 weeks in the future, OR\r\n          // 3. Have no due date AND no start date\r\n          const isDueInWindow = daysUntilDue >= -14 && daysUntilDue <= 14;\r\n          const isStartInWindow = daysUntilStart >= -14 && daysUntilStart <= 14;\r\n          const hasNoDates = daysUntilDue === 999 && daysUntilStart === 999;\r\n          \r\n          if (isDueInWindow || isStartInWindow || hasNoDates) {\r\n            task.projectName = project.file.basename;\r\n            task.projectPath = project.file.path;\r\n            allTasks.push(task);\r\n\r\n          }\r\n        }\r\n      });\r\n    });\r\n    \r\n\r\n    \r\n    if (allTasks.length === 0) {\r\n      this.container.createEl(\"div\", {\r\n        cls: \"pm-today-empty\",\r\n        text: \"🎉 No tasks to work on today! All caught up.\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    /* ── Task sections ───────────────────────── */\r\n    const sections = this.container.createEl(\"div\", { cls: \"pm-today-sections\" });\r\n\r\n    // Group tasks by assignee\r\n    const assigneeGroups = new Map<string, any[]>();\r\n    \r\n    allTasks.forEach(task => {\r\n      const assignee = task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\";\r\n      if (!assigneeGroups.has(assignee)) {\r\n        assigneeGroups.set(assignee, []);\r\n      }\r\n      assigneeGroups.get(assignee)!.push(task);\r\n    });\r\n    \r\n\r\n\r\n    // Sort assignees alphabetically\r\n    const sortedAssignees = Array.from(assigneeGroups.keys()).sort((a, b) => {\r\n      if (a === \"Unassigned\") return 1;\r\n      if (b === \"Unassigned\") return 1;\r\n      return a.localeCompare(b);\r\n    });\r\n\r\n    // Render assignee sections\r\n    sortedAssignees.forEach(assignee => {\r\n      const assigneeTasks = assigneeGroups.get(assignee)!;\r\n      const sectionClass = assignee === \"Unassigned\" ? \"unassigned\" : \"assignee\";\r\n      const emoji = assignee === \"Unassigned\" ? \"❓\" : \"👤\";\r\n      this.renderTaskSection(sections, `${emoji} ${assignee}`, assigneeTasks, sectionClass);\r\n    });\r\n    \r\n    // Restore scroll position after rendering\r\n    if (this.lastScrollTop > 0) {\r\n      setTimeout(() => {\r\n        this.container.scrollTop = this.lastScrollTop;\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  private renderTaskSection(container: HTMLElement, title: string, tasks: any[], sectionClass: string) {\r\n\r\n    \r\n    const section = container.createEl(\"div\", { cls: `pm-today-section ${sectionClass}` });\r\n    \r\n    const sectionHeader = section.createEl(\"div\", { cls: \"pm-today-section-header collapsible\" });\r\n    \r\n    // Add collapse/expand icon\r\n    const collapseIcon = sectionHeader.createEl(\"span\", { cls: \"pm-today-collapse-icon\" });\r\n    \r\n    const sectionTitle = sectionHeader.createEl(\"h3\", { text: title });\r\n    const taskCount = sectionHeader.createEl(\"span\", { \r\n      cls: \"pm-today-count\",\r\n      text: `${tasks.length} task${tasks.length !== 1 ? 's' : ''}`\r\n    });\r\n\r\n    const taskList = section.createEl(\"div\", { cls: \"pm-today-task-list\" });\r\n    \r\n    // Check if this section should be collapsed based on previous state\r\n    const shouldBeCollapsed = this.collapsedSections.has(title);\r\n    if (shouldBeCollapsed) {\r\n      section.addClass(\"collapsed\");\r\n      setIcon(collapseIcon, \"chevron-right\");\r\n                taskList.classList.add(\"pm-task-list-hidden\");\r\n          taskList.classList.remove(\"pm-task-list-visible\");\r\n    } else {\r\n      setIcon(collapseIcon, \"chevron-down\");\r\n    }\r\n    \r\n    // Add click handler to toggle collapse\r\n    sectionHeader.onclick = () => {\r\n      const isCollapsed = section.hasClass(\"collapsed\");\r\n      if (isCollapsed) {\r\n        section.removeClass(\"collapsed\");\r\n        setIcon(collapseIcon, \"chevron-down\");\r\n        taskList.classList.add(\"pm-task-list-visible\");\r\n        taskList.classList.remove(\"pm-task-list-hidden\");\r\n        this.collapsedSections.delete(title);\r\n      } else {\r\n        section.addClass(\"collapsed\");\r\n        setIcon(collapseIcon, \"chevron-right\");\r\n        taskList.classList.add(\"pm-task-list-hidden\");\r\n        taskList.classList.remove(\"pm-task-list-visible\");\r\n        this.collapsedSections.add(title);\r\n      }\r\n    };\r\n    \r\n    tasks.forEach((task, index) => {\r\n\r\n      this.renderTask(taskList, task);\r\n    });\r\n  }\r\n\r\n  private renderTask(container: HTMLElement, task: any) {\r\n    // Determine status for color coding\r\n    const status = this.getTaskStatus(task);\r\n    const taskEl = container.createEl(\"div\", { cls: `pm-today-task status-${status}` });\r\n    \r\n    // Task header\r\n    const taskHeader = taskEl.createEl(\"div\", { cls: \"pm-today-task-header\" });\r\n    \r\n    // Status indicator\r\n    const statusEl = taskHeader.createEl(\"div\", { \r\n      cls: `pm-today-status-indicator status-${status}`,\r\n      title: `Status: ${status.replace('-', ' ')}`\r\n    });\r\n    \r\n    // On-hold indicator\r\n    if (status === 'on-hold') {\r\n      const onHoldIndicator = taskHeader.createEl(\"div\", { \r\n        cls: \"pm-today-on-hold-indicator\",\r\n        title: \"Task is on hold\"\r\n      });\r\n      setIcon(onHoldIndicator, \"pause\");\r\n    }\r\n    \r\n    // Priority indicator\r\n    const priority = getTaskPriority(task);\r\n    if (priority !== 'none') {\r\n      const priorityEl = taskHeader.createEl(\"span\", { \r\n        cls: `pm-today-priority pm-priority-${priority}`,\r\n        text: priority.charAt(0).toUpperCase() + priority.slice(1)\r\n      });\r\n    }\r\n    \r\n    // Task title\r\n    const taskTitle = taskHeader.createEl(\"div\", { \r\n      cls: \"pm-today-task-title\",\r\n      text: task.text || task.title || \"Untitled Task\"\r\n    });\r\n    \r\n    // Start date (now first)\r\n    const startDate = task.start || task.props?.start;\r\n    if (startDate) {\r\n      const daysUntilStart = getDaysUntilStart(task, this.selectedDate);\r\n      const shouldStart = shouldTaskBeStarted(task, this.selectedDate);\r\n      \r\n      // Check if task is actually in progress\r\n      const taskStatus = this.getTaskStatus(task);\r\n      const isInProgress = taskStatus === 'in-progress';\r\n      const isOnHold = taskStatus === 'on-hold';\r\n      const isCompleted = taskStatus === 'completed';\r\n      \r\n      // Determine color class based on days until start, but prioritize \"started\" status\r\n      let colorClass = '';\r\n      if (isInProgress) {\r\n        // If task is started, don't apply timing-based colors\r\n        colorClass = '';\r\n      } else if (daysUntilStart < 0) {\r\n        colorClass = 'overdue'; // Already passed\r\n      } else if (daysUntilStart >= 7) {\r\n        colorClass = 'distant'; // 7+ days = green\r\n      } else if (daysUntilStart >= 3) {\r\n        colorClass = 'soon'; // 3-6 days = yellow\r\n      } else {\r\n        colorClass = 'urgent'; // 0-2 days = red\r\n      }\r\n      \r\n\r\n      \r\n      // Generate appropriate text based on timing and status\r\n      let startText = '';\r\n      \r\n      if (isCompleted) {\r\n        // Completed tasks always show \"Completed\" regardless of timing\r\n        startText = '✅ Completed';\r\n      } else if (isOnHold) {\r\n        // On hold tasks always show \"On hold\" regardless of timing\r\n        startText = '⏸️ On hold';\r\n      } else if (shouldStart) {\r\n        if (isInProgress) {\r\n          if (daysUntilStart === 0) {\r\n            startText = '✅ Started today';\r\n          } else if (daysUntilStart === -1) {\r\n            startText = '✅ Started yesterday';\r\n          } else if (daysUntilStart < 0) {\r\n            startText = `✅ Started (${Math.abs(daysUntilStart)} days ago)`;\r\n          } else if (daysUntilStart === 1) {\r\n            startText = '✅ Started tomorrow';\r\n          } else {\r\n            startText = `✅ Started (in ${daysUntilStart} days)`;\r\n          }\r\n        } else {\r\n          if (daysUntilStart === 0) {\r\n            startText = '🚀 Should start today';\r\n          } else if (daysUntilStart === -1) {\r\n            startText = '🚀 Should have started yesterday';\r\n          } else if (daysUntilStart < 0) {\r\n            startText = `🚀 Should be started (${Math.abs(daysUntilStart)} days ago)`;\r\n          } else if (daysUntilStart === 1) {\r\n            startText = '🚀 Should start tomorrow';\r\n          } else {\r\n            startText = `🚀 Should start (in ${daysUntilStart} days)`;\r\n          }\r\n        }\r\n      } else {\r\n        if (daysUntilStart === 0) {\r\n          startText = 'Start today';\r\n        } else if (daysUntilStart === 1) {\r\n          startText = 'Start tomorrow';\r\n        } else {\r\n          startText = `Start in ${daysUntilStart} days`;\r\n        }\r\n      }\r\n      \r\n      // Determine status class for styling\r\n      let statusClass = '';\r\n      if (isCompleted) {\r\n        statusClass = 'completed';\r\n      } else if (isOnHold) {\r\n        statusClass = 'on-hold';\r\n      } else if (shouldStart) {\r\n        statusClass = isInProgress ? 'started' : 'should-start';\r\n      }\r\n      \r\n      const startEl = taskHeader.createEl(\"div\", { \r\n        cls: `pm-today-start ${statusClass} ${colorClass}`,\r\n        text: startText\r\n      });\r\n    }\r\n    \r\n    // Due date (now second)\r\n    const dueDate = task.due || task.props?.due;\r\n    if (dueDate) {\r\n      const daysUntilDue = getDaysUntilDue(task, this.selectedDate);\r\n      const taskStatus = this.getTaskStatus(task);\r\n      const isCompleted = taskStatus === 'completed';\r\n      \r\n      // Determine color class based on days until due\r\n      let colorClass = '';\r\n      if (isCompleted) {\r\n        colorClass = 'completed'; // Completed tasks get completed styling\r\n      } else if (daysUntilDue < 0) {\r\n        colorClass = 'overdue'; // Already overdue\r\n      } else if (daysUntilDue === 0) {\r\n        colorClass = 'due-today'; // Due today\r\n      } else if (daysUntilDue >= 7) {\r\n        colorClass = 'distant'; // 7+ days = green\r\n      } else if (daysUntilDue >= 3) {\r\n        colorClass = 'soon'; // 3-6 days = yellow\r\n      } else {\r\n        colorClass = 'urgent'; // 1-2 days = red\r\n      }\r\n      \r\n      // Generate appropriate due date text\r\n      let dueText = '';\r\n      if (isCompleted) {\r\n        dueText = \"✅ Completed\";\r\n      } else if (daysUntilDue === -1) {\r\n        dueText = \"Due yesterday\";\r\n      } else if (daysUntilDue < 0) {\r\n        dueText = `${Math.abs(daysUntilDue)} days overdue`;\r\n      } else if (daysUntilDue === 0) {\r\n        dueText = \"Due today\";\r\n      } else if (daysUntilDue === 1) {\r\n        dueText = \"Due tomorrow\";\r\n      } else {\r\n        dueText = `Due in ${daysUntilDue} days`;\r\n      }\r\n      \r\n      const dueEl = taskHeader.createEl(\"div\", { \r\n        cls: `pm-today-due ${colorClass}`,\r\n        text: dueText\r\n      });\r\n    }\r\n    \r\n    // Task details\r\n    const taskDetails = taskEl.createEl(\"div\", { cls: \"pm-today-task-details\" });\r\n    \r\n    // Project with task type icon\r\n    if (task.projectName) {\r\n      const projectEl = taskDetails.createEl(\"div\", { \r\n        cls: \"pm-today-project\"\r\n      });\r\n      \r\n      // Add task type icon\r\n      const taskType = this.getTaskType(task);\r\n      const iconEl = projectEl.createEl(\"span\", { cls: \"pm-today-task-type-icon\" });\r\n      \r\n      switch (taskType) {\r\n        case 'epic':\r\n          setIcon(iconEl, \"crown\");\r\n          break;\r\n        case 'story':\r\n          setIcon(iconEl, \"file-text\");\r\n          break;\r\n        case 'subtask':\r\n          setIcon(iconEl, \"list\");\r\n          break;\r\n        default:\r\n          setIcon(iconEl, \"file\");\r\n          break;\r\n      }\r\n      \r\n      projectEl.createEl(\"span\", { text: ` ${task.projectName}` });\r\n    }\r\n    \r\n    // Assignee\r\n    const assignee = task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner;\r\n    if (assignee) {\r\n      const assigneeEl = taskDetails.createEl(\"div\", { \r\n        cls: \"pm-today-assignee\",\r\n        text: `👤 ${assignee}`\r\n      });\r\n    }\r\n    \r\n    // Task ID\r\n    if (task.id) {\r\n      const idEl = taskDetails.createEl(\"div\", { \r\n        cls: \"pm-today-id\",\r\n        text: `#${task.id}`\r\n      });\r\n    }\r\n    \r\n    // Status\r\n    if (task.status) {\r\n      const statusEl = taskDetails.createEl(\"div\", { \r\n        cls: \"pm-today-status\",\r\n        text: `📊 ${task.status}`\r\n      });\r\n    }\r\n  }\r\n}\r\n","import {\r\n  ItemView,\r\n  WorkspaceLeaf,\r\n  setIcon,\r\n  Notice,\r\n} from \"obsidian\";\r\nimport { TFile } from \"obsidian\";\r\n/* Moment.js is available globally in Obsidian */\r\ndeclare const moment: any;\r\nimport type { ViewStateResult } from \"obsidian\";\r\nimport { ProjectCache, TaskItem, ProjectEntry } from \"../services/cache\";\r\nimport { PmSettings } from \"../../settings\";\r\n\r\n// Extended task interface for calendar view functions\r\ninterface ExtendedTaskItem extends TaskItem {\r\n  done?: boolean | string;\r\n  percentComplete?: number;\r\n  raw?: string;\r\n  priority?: string;\r\n  start?: string;\r\n  due?: string;\r\n  projectName?: string;\r\n  projectPath?: string;\r\n  assignee?: string;\r\n  owner?: string;\r\n}\r\n\r\n// Calendar day interface\r\ninterface CalendarDay {\r\n  date: string;\r\n  dueTasks: ExtendedTaskItem[];\r\n  startingTasks: ExtendedTaskItem[];\r\n  isToday: boolean;\r\n  isCurrentMonth: boolean;\r\n}\r\n\r\n// Load calendar-specific stylesheet\r\nimport \"../../styles/styles-calendar.css\";\r\n\r\n/** Helper: format a date or return an em-dash if undefined */\r\nfunction formatDate(d: string | number | Date | undefined): string {\r\n  if (!d) return \"—\";\r\n  return new Date(d).toLocaleDateString();\r\n}\r\n\r\n/** Detect whether a task is completed */\r\nfunction isTaskCompleted(t: ExtendedTaskItem): boolean {\r\n  /* explicit flags from parsers */\r\n  if (t.done === true || t.checked === true) return true;\r\n  if (typeof t.done === \"string\" && t.done.toLowerCase() === \"completed\") return true;\r\n\r\n  /* explicit status strings */\r\n  if (typeof t.status === \"string\") {\r\n    const s = t.status.toLowerCase();\r\n    if ([\"completed\", \"complete\", \"finished\", \"done\"].includes(s)) return true;\r\n  }\r\n\r\n  /* percent-complete field */\r\n  if (typeof t.percentComplete === \"number\" && t.percentComplete >= 1) return true;\r\n\r\n  /* markdown checkbox or bullet */\r\n  const raw = (t.raw ?? t.text ?? \"\").toString();\r\n  if (/^\\s*-\\s*\\[[xX]\\]/.test(raw)) return true;\r\n\r\n  /* completed:: 2025‑05‑01 inline field or front‑matter */\r\n  if (t.props?.completed || t.props?.[\"completionDate\"]) return true;\r\n\r\n  return false;\r\n}\r\n\r\n/** Get task priority level */\r\nfunction getTaskPriority(task: ExtendedTaskItem): 'high' | 'medium' | 'low' | 'none' {\r\n  // Check explicit priority fields\r\n  if (task.priority) {\r\n    const p = task.priority.toString().toLowerCase();\r\n    if (['high', 'h', '1', 'p1'].includes(p)) return 'high';\r\n    if (['medium', 'med', 'm', '2', 'p2'].includes(p)) return 'medium';\r\n    if (['low', 'l', '3', 'p3'].includes(p)) return 'low';\r\n  }\r\n  \r\n  // Check props for priority\r\n  if (task.props?.priority) {\r\n    const p = task.props.priority.toString().toLowerCase();\r\n    if (['high', 'h', '1', 'p1'].includes(p)) return 'high';\r\n    if (['medium', 'med', 'm', '2', 'p2'].includes(p)) return 'medium';\r\n    if (['low', 'l', '3', 'p3'].includes(p)) return 'low';\r\n  }\r\n  \r\n  // Check for priority in tags or text\r\n  const text = (task.text || task.raw || \"\").toLowerCase();\r\n  if (text.includes('#high') || text.includes('#priority')) return 'high';\r\n  if (text.includes('#medium') || text.includes('#med')) return 'medium';\r\n  if (text.includes('#low')) return 'low';\r\n  \r\n  return 'none';\r\n}\r\n\r\n/** Check if task is due on a specific date */\r\nfunction isTaskDueOnDate(task: ExtendedTaskItem, targetDate: string): boolean {\r\n  if (!task.due && !task.props?.due) return false;\r\n  \r\n  const dueDate = task.due || task.props?.due;\r\n  const target = moment(targetDate).startOf('day');\r\n  const due = moment(dueDate).startOf('day');\r\n  \r\n  return due.isSame(target);\r\n}\r\n\r\n/** Check if task starts on a specific date */\r\nfunction isTaskStartingOnDate(task: ExtendedTaskItem, targetDate: string): boolean {\r\n  if (!task.start && !task.props?.start) return false;\r\n  \r\n  const startDate = task.start || task.props?.start;\r\n  const target = moment(targetDate).startOf('day');\r\n  const start = moment(startDate).startOf('day');\r\n  \r\n  return start.isSame(target);\r\n}\r\n\r\n/** Get days until due */\r\nfunction getDaysUntilDue(task: ExtendedTaskItem, testDate?: string): number {\r\n  const today = testDate ? moment(testDate).startOf('day') : moment().startOf('day');\r\n  \r\n  if (task.due) {\r\n    const dueDate = moment(task.due).startOf('day');\r\n    return dueDate.diff(today, 'days');\r\n  }\r\n  \r\n  if (task.props?.due) {\r\n    const dueDate = moment(task.props.due).startOf('day');\r\n    return dueDate.diff(today, 'days');\r\n  }\r\n  \r\n  return 999; // No due date\r\n}\r\n\r\nexport const VIEW_TYPE_PM_CALENDAR = \"pm-calendar-view\";\r\n\r\nexport class CalendarView extends ItemView {\r\n  /** icon shown on the view tab */\r\n  public icon = \"calendar-days\";\r\n  /** Optional set of project file paths to display */\r\n  private filterPaths?: Set<string>;\r\n  /** Optional name of the portfolio that opened this calendar */\r\n  private filterName?: string;\r\n  /** The initial project paths passed in from Portfolio (null = no portfolio) */\r\n  private originalPaths: string[] | null = null;\r\n  /** Project filter dropdown state */\r\n  private filterDropdownOpen = false;\r\n  /** Optional assignees to filter by */\r\n  private filterAssignees: string[] | null = null;\r\n  private originalAssignees: string[] | null = null;\r\n  /** Assignee filter dropdown state */\r\n  private assigneeDropdownOpen = false;\r\n  private currentDate: string = moment().format('YYYY-MM-DD');\r\n  private collapsed = new Set<string>();\r\n  private firstRender = true;\r\n  private lastScrollTop = 0;\r\n\r\n  private cache: ProjectCache;\r\n  private settings: PmSettings;\r\n  private container!: HTMLElement;\r\n  private detachFn: (() => void) | null = null;\r\n\r\n  private filterText = \"\";                 // live text in the quick-filter box\r\n  private showEpics = true;                // show/hide epics\r\n  private showStories = true;              // show/hide stories\r\n  private showSubTasks = true;             // show/hide sub-tasks\r\n\r\n  constructor(\r\n    leaf: WorkspaceLeaf,\r\n    cache: ProjectCache,\r\n    settings: PmSettings\r\n  ) {\r\n    super(leaf);\r\n    this.cache = cache;\r\n    this.settings = settings;\r\n  }\r\n\r\n  /** Called when leaf.setViewState({ state }) is invoked */\r\n  async setState(state: { filterProjects?: string[]; filterName?: string } | undefined, result: ViewStateResult): Promise<void> {\r\n    if (\r\n      state &&\r\n      Array.isArray(state.filterProjects) &&\r\n      state.filterProjects.length > 0\r\n    ) {\r\n      this.filterPaths   = new Set(state.filterProjects as string[]);\r\n      this.originalPaths = [...state.filterProjects];     // remember portfolio set\r\n    } else {\r\n      this.filterPaths   = undefined;          // empty array or undefined ⇒ show all\r\n      this.originalPaths = null;\r\n    }\r\n    if (typeof state?.filterName === \"string\" && state.filterName.trim() !== \"\") {\r\n      this.filterName = state.filterName.trim();\r\n    } else {\r\n      this.filterName = undefined;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  getViewType(): string {\r\n    return VIEW_TYPE_PM_CALENDAR;\r\n  }\r\n\r\n  getDisplayText(): string {\r\n    return this.filterName ? `Calendar: ${this.filterName}` : \"Calendar\";\r\n  }\r\n\r\n  getIcon(): string {\r\n    return \"calendar-days\";\r\n  }\r\n\r\n  async onOpen() {\r\n    this.container = this.contentEl;\r\n    this.render();\r\n    this.detachFn = this.cache.onChange(() => {\r\n      this.cleanupPopups();\r\n      this.render();\r\n    });\r\n  }\r\n\r\n  async onClose() {\r\n    this.detachFn?.();\r\n    \r\n    // Clean up any open popups/dropdowns\r\n    this.cleanupPopups();\r\n  }\r\n\r\n  /** Collect all tasks for the current view period */\r\n  private collectTasksForPeriod(): ExtendedTaskItem[] {\r\n    const allTasks: ExtendedTaskItem[] = [];\r\n    \r\n    this.cache.projects.forEach((project: ProjectEntry) => {\r\n      // Skip if project is filtered out\r\n      if (this.filterPaths && !this.filterPaths.has(project.file.path)) {\r\n        return;\r\n      }\r\n\r\n      // Add project metadata to tasks\r\n      (project.tasks ?? []).forEach((task: TaskItem) => {\r\n        const extendedTask = task as ExtendedTaskItem;\r\n        extendedTask.projectName = project.file.basename;\r\n        extendedTask.projectPath = project.file.path;\r\n        allTasks.push(extendedTask);\r\n      });\r\n    });\r\n    \r\n    // Filter to only incomplete tasks\r\n    let incompleteTasks = allTasks.filter(task => !isTaskCompleted(task));\r\n    \r\n    // Apply assignee filter\r\n    if (this.filterAssignees && this.filterAssignees.length > 0) {\r\n      incompleteTasks = incompleteTasks.filter(task => {\r\n        const assignee = (task.assignee ?? task.props?.assignee ?? task.owner ?? task.props?.owner ?? \"Unassigned\").toString().trim();\r\n        return this.filterAssignees!.includes(assignee);\r\n      });\r\n    }\r\n    \r\n    return incompleteTasks;\r\n  }\r\n\r\n  /** Generate calendar days for the current month */\r\n  private generateCalendarDays(): CalendarDay[] {\r\n    const days: CalendarDay[] = [];\r\n    const current = moment(this.currentDate);\r\n    const startOfMonth = current.clone().startOf('month');\r\n    const endOfMonth = current.clone().endOf('month');\r\n    const startOfCalendar = startOfMonth.clone().startOf('isoWeek');\r\n    const endOfCalendar = endOfMonth.clone().endOf('isoWeek');\r\n    \r\n    const today = moment().startOf('day');\r\n    \r\n    let day = startOfCalendar.clone();\r\n    while (day.isSameOrBefore(endOfCalendar)) {\r\n      const dateStr = day.format('YYYY-MM-DD');\r\n      const { dueTasks, startingTasks } = this.getTasksForDate(dateStr);\r\n      \r\n      days.push({\r\n        date: dateStr,\r\n        dueTasks: dueTasks,\r\n        startingTasks: startingTasks,\r\n        isToday: day.isSame(today),\r\n        isCurrentMonth: day.isSame(current, 'month')\r\n      });\r\n      \r\n      day.add(1, 'day');\r\n    }\r\n    \r\n    return days;\r\n  }\r\n\r\n  /** Clean up any open popups/dropdowns */\r\n  private cleanupPopups() {\r\n    // Remove day expansion popups\r\n    const expansions = document.querySelectorAll('.pm-day-expansion');\r\n    expansions.forEach(expansion => expansion.remove());\r\n    \r\n    // Remove project and assignee filter dropdowns\r\n    const dropdowns = document.querySelectorAll('.pm-proj-dd');\r\n    dropdowns.forEach(dropdown => dropdown.remove());\r\n    \r\n    // Reset dropdown states\r\n    this.filterDropdownOpen = false;\r\n    this.assigneeDropdownOpen = false;\r\n  }\r\n\r\n  /** Update project filter & re-render */\r\n  public updateFilter(paths: string[] | null) {\r\n    if (paths === null) {\r\n      // Show ALL projects\r\n      this.filterPaths = undefined;\r\n    } else if (Array.isArray(paths)) {\r\n      // Show NONE if empty array, else selected set\r\n      this.filterPaths = paths.length ? new Set(paths) : new Set<string>();\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /** Update assignee filter & re-render */\r\n  public updateAssigneeFilter(assignees: string[] | null) {\r\n    if (assignees === null) {\r\n      // Show ALL assignees\r\n      this.filterAssignees = null;\r\n    } else if (Array.isArray(assignees)) {\r\n      // Show NONE if empty array, else selected set\r\n      this.filterAssignees = assignees.length ? assignees : [];\r\n    }\r\n    this.render();\r\n  }\r\n\r\n\r\n\r\n  /** Get tasks for a specific date */\r\n  private getTasksForDate(dateStr: string): { dueTasks: ExtendedTaskItem[], startingTasks: ExtendedTaskItem[] } {\r\n    const allTasks = this.collectTasksForPeriod();\r\n    const dueTasks = allTasks.filter(task => isTaskDueOnDate(task, dateStr));\r\n    const startingTasks = allTasks.filter(task => isTaskStartingOnDate(task, dateStr));\r\n    \r\n    return { dueTasks, startingTasks };\r\n  }\r\n\r\n  /** Render the calendar view */\r\n  private render() {\r\n    this.container.empty();\r\n    \r\n    // Create main calendar container with flex layout\r\n    const calendarView = this.container.createEl(\"div\", { cls: \"pm-calendar-view\" });\r\n    \r\n    // Save scroll position from content container if it exists\r\n    const existingContent = this.container.querySelector('.pm-calendar-content');\r\n    if (existingContent) {\r\n      this.lastScrollTop = existingContent.scrollTop;\r\n    }\r\n\r\n    // Header with navigation and controls\r\n    const header = calendarView.createEl(\"div\", { cls: \"pm-calendar-header\" });\r\n    \r\n    // Navigation controls\r\n    const navControls = header.createEl(\"div\", { cls: \"pm-calendar-nav\" });\r\n    \r\n    // Previous month button\r\n    const prevBtn = navControls.createEl(\"button\", { cls: \"pm-calendar-nav-btn\" });\r\n    setIcon(prevBtn, \"chevron-left\");\r\n    prevBtn.onclick = () => {\r\n      this.cleanupPopups();\r\n      this.currentDate = moment(this.currentDate).subtract(1, 'month').format('YYYY-MM-DD');\r\n      this.render();\r\n    };\r\n\r\n    // Current month display\r\n    const periodDisplay = navControls.createEl(\"div\", { cls: \"pm-calendar-period\" });\r\n    periodDisplay.textContent = moment(this.currentDate).format('MMMM YYYY');\r\n\r\n    // Next month button\r\n    const nextBtn = navControls.createEl(\"button\", { cls: \"pm-calendar-nav-btn\" });\r\n    setIcon(nextBtn, \"chevron-right\");\r\n    nextBtn.onclick = () => {\r\n      this.cleanupPopups();\r\n      this.currentDate = moment(this.currentDate).add(1, 'month').format('YYYY-MM-DD');\r\n      this.render();\r\n    };\r\n\r\n    // Today button\r\n    const todayBtn = navControls.createEl(\"button\", { cls: \"pm-calendar-today-btn\" });\r\n    todayBtn.textContent = \"Today\";\r\n    todayBtn.onclick = () => {\r\n      this.cleanupPopups();\r\n      this.currentDate = moment().format('YYYY-MM-DD');\r\n      this.render();\r\n    };\r\n\r\n    // Project filter button\r\n    const projBtn = navControls.createEl(\"button\", { cls: \"pm-proj-btn\" });\r\n    projBtn.createSpan({ text: \"Projects \" });\r\n    const caret = projBtn.createSpan();\r\n    setIcon(caret, \"chevron-down\");\r\n\r\n    // Dropdown state variables (like dashboard)\r\n    let ddOpen = false;\r\n    let ddEl: HTMLElement | null = null;\r\n    let assigneeDdOpen = false;\r\n    let assigneeDdEl: HTMLElement | null = null;\r\n\r\n    const closeDropdown = () => {\r\n      ddEl?.remove();\r\n      ddEl = null;\r\n      ddOpen = false;\r\n      setIcon(caret, \"chevron-down\");\r\n    };\r\n\r\n    const closeAssigneeDropdown = () => {\r\n      assigneeDdEl?.remove();\r\n      assigneeDdEl = null;\r\n      assigneeDdOpen = false;\r\n      setIcon(assigneeCaret, \"chevron-down\");\r\n    };\r\n\r\n    const buildProjectDropdown = (projectList: any[]) => {\r\n      ddEl = document.createElement(\"div\");\r\n      ddEl.className = \"pm-proj-dd\";\r\n\r\n      /* Select/Deselect controls */\r\n      const controls = ddEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n             /* ALL */\r\n       controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n         e.preventDefault();\r\n         this.updateFilter(null);\r\n         /* Update checkboxes without closing dropdown */\r\n         const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n         checkIcons.forEach(icon => {\r\n           icon.setAttribute(\"data-checked\", \"true\");\r\n           setIcon(icon, \"check-circle\");\r\n         });\r\n       };\r\n\r\n       /* PORTFOLIO (only if originalPaths present) */\r\n       if (this.originalPaths && this.originalPaths.length) {\r\n         controls.createSpan({ text: \" | \" });\r\n         controls.createEl(\"a\", { text: this.filterName ?? \"Portfolio\" }).onclick = (e) => {\r\n           e.preventDefault();\r\n           this.updateFilter([...this.originalPaths!]);\r\n           /* Update checkboxes without closing dropdown */\r\n           const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n           checkIcons.forEach(icon => {\r\n             const projectPath = icon.getAttribute(\"data-project-path\");\r\n             const isChecked = this.originalPaths!.includes(projectPath!);\r\n             icon.setAttribute(\"data-checked\", isChecked.toString());\r\n             setIcon(icon, isChecked ? \"check-circle\" : \"circle\");\r\n           });\r\n         };\r\n       }\r\n\r\n       /* NONE */\r\n       controls.createSpan({ text: \" | \" });\r\n       controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n         e.preventDefault();\r\n         this.updateFilter([]);\r\n         /* Update checkboxes without closing dropdown */\r\n         const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n         checkIcons.forEach(icon => {\r\n           icon.setAttribute(\"data-checked\", \"false\");\r\n           setIcon(icon, \"circle\");\r\n         });\r\n       };\r\n\r\n       // Checkbox list\r\n       projectList.forEach((p: any) => {\r\n         const wrap = ddEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n         const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n         wrap.createSpan({ text: ` ${p.file.basename}` });\r\n\r\n         const isChecked = !this.filterPaths || this.filterPaths.has(p.file.path);\r\n         setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n         \r\n         cb.setAttribute(\"data-project-path\", p.file.path);\r\n         cb.setAttribute(\"data-checked\", isChecked.toString());\r\n         wrap.onclick = () => {\r\n           const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n           const newChecked = !currentChecked;\r\n           \r\n           cb.setAttribute(\"data-checked\", newChecked.toString());\r\n           setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n           \r\n           const checkIcons = Array.from(ddEl!.querySelectorAll(\".pm-dd-check\"));\r\n           const selected = checkIcons\r\n             .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n             .map(icon => icon.getAttribute(\"data-project-path\")!);\r\n\r\n           const newFilter = selected.length === projectList.length ? null : selected;\r\n           this.updateFilter(newFilter);\r\n         };\r\n       });\r\n\r\n      document.body.appendChild(ddEl);\r\n      \r\n      // Position dropdown\r\n      const r = projBtn.getBoundingClientRect();\r\n      const pad = 4;\r\n      let left = r.left;\r\n      let top = r.bottom + pad;\r\n\r\n      const ddW = ddEl.offsetWidth || 240;\r\n      const ddH = ddEl.offsetHeight || 260;\r\n\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        top = Math.max(r.top - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      ddEl.style.left = `${left}px`;\r\n      ddEl.style.top = `${top}px`;\r\n\r\n\r\n    };\r\n\r\n    const buildAssigneeDropdown = (assigneeList: string[]) => {\r\n      assigneeDdEl = document.createElement(\"div\");\r\n      assigneeDdEl.className = \"pm-proj-dd\";\r\n\r\n      /* Select/Deselect controls */\r\n      const controls = assigneeDdEl.createEl(\"div\", { cls: \"pm-proj-dd-ctl\" });\r\n\r\n             /* ALL */\r\n       controls.createEl(\"a\", { text: \"All\" }).onclick = (e) => {\r\n         e.preventDefault();\r\n         this.updateAssigneeFilter(null);\r\n         /* Update checkboxes without closing dropdown */\r\n         const checkIcons = Array.from(assigneeDdEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n         checkIcons.forEach(icon => {\r\n           icon.setAttribute(\"data-checked\", \"true\");\r\n           setIcon(icon, \"check-circle\");\r\n         });\r\n       };\r\n\r\n       // Ensure we have an initial baseline like projects' originalPaths,\r\n       // so the middle option is available immediately.\r\n       if (!this.originalAssignees) {\r\n         if (!this.filterAssignees) {\r\n           // No filter applied ⇒ baseline is all assignees\r\n           this.originalAssignees = [...assigneeList];\r\n         } else if (this.filterAssignees.length > 0) {\r\n           // Baseline is the currently selected set\r\n           this.originalAssignees = [...this.filterAssignees];\r\n         } else {\r\n           // Explicit none selected\r\n           this.originalAssignees = [];\r\n         }\r\n       }\r\n\r\n       /* ASSIGNEES (only if originalAssignees present) */\r\n       if (this.originalAssignees && this.originalAssignees.length >= 0) {\r\n         controls.createSpan({ text: \" | \" });\r\n         controls.createEl(\"a\", { text: this.filterName ?? \"Portfolio\" }).onclick = (e) => {\r\n           e.preventDefault();\r\n           this.updateAssigneeFilter([...this.originalAssignees!]);\r\n           /* Update checkboxes without closing dropdown */\r\n           const checkIcons = Array.from(assigneeDdEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n           checkIcons.forEach(icon => {\r\n             const assignee = icon.getAttribute(\"data-assignee\");\r\n             const isChecked = this.originalAssignees!.includes(assignee!);\r\n             icon.setAttribute(\"data-checked\", isChecked.toString());\r\n             setIcon(icon, isChecked ? \"check-circle\" : \"circle\");\r\n           });\r\n         };\r\n       }\r\n\r\n       /* NONE */\r\n       controls.createSpan({ text: \" | \" });\r\n       controls.createEl(\"a\", { text: \"None\" }).onclick = (e) => {\r\n         e.preventDefault();\r\n         this.updateAssigneeFilter([]);\r\n         /* Update checkboxes without closing dropdown */\r\n         const checkIcons = Array.from(assigneeDdEl!.querySelectorAll(\".pm-dd-check\")) as HTMLElement[];\r\n         checkIcons.forEach(icon => {\r\n           icon.setAttribute(\"data-checked\", \"false\");\r\n           setIcon(icon, \"circle\");\r\n         });\r\n       };\r\n\r\n       // If no assignees found, show a message\r\n       if (assigneeList.length === 0) {\r\n         const noAssignees = assigneeDdEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n         noAssignees.createSpan({ text: \"No assignees found\" });\r\n         noAssignees.style.fontStyle = \"italic\";\r\n         noAssignees.style.color = \"var(--text-muted)\";\r\n       } else {\r\n         // Checkbox list\r\n         assigneeList.forEach((assignee: string) => {\r\n           const wrap = assigneeDdEl!.createEl(\"div\", { cls: \"pm-proj-dd-item\" });\r\n           const cb = wrap.createEl(\"span\", { cls: \"pm-dd-check\" });\r\n           wrap.createSpan({ text: ` ${assignee}` });\r\n\r\n           const isChecked = !this.filterAssignees || this.filterAssignees.includes(assignee);\r\n           setIcon(cb, isChecked ? \"check-circle\" : \"circle\");\r\n           \r\n           cb.setAttribute(\"data-assignee\", assignee);\r\n           cb.setAttribute(\"data-checked\", isChecked.toString());\r\n           wrap.onclick = () => {\r\n             const currentChecked = cb.getAttribute(\"data-checked\") === \"true\";\r\n             const newChecked = !currentChecked;\r\n             \r\n             cb.setAttribute(\"data-checked\", newChecked.toString());\r\n             setIcon(cb, newChecked ? \"check-circle\" : \"circle\");\r\n             \r\n             const checkIcons = Array.from(assigneeDdEl!.querySelectorAll(\".pm-dd-check\"));\r\n             const selected = checkIcons\r\n               .filter(icon => icon.getAttribute(\"data-checked\") === \"true\")\r\n               .map(icon => icon.getAttribute(\"data-assignee\")!);\r\n\r\n             const newFilter = selected.length === assigneeList.length ? null : selected;\r\n             this.updateAssigneeFilter(newFilter);\r\n           };\r\n         });\r\n       }\r\n\r\n      document.body.appendChild(assigneeDdEl);\r\n      \r\n      // Position dropdown\r\n      const r = assigneeBtn.getBoundingClientRect();\r\n      const pad = 4;\r\n      let left = r.left;\r\n      let top = r.bottom + pad;\r\n\r\n      const ddW = assigneeDdEl.offsetWidth || 240;\r\n      const ddH = assigneeDdEl.offsetHeight || 260;\r\n\r\n      if (left + ddW > window.innerWidth - pad) {\r\n        left = Math.max(window.innerWidth - ddW - pad, pad);\r\n      }\r\n      if (left < pad) {\r\n        left = pad;\r\n      }\r\n\r\n      if (top + ddH > window.innerHeight - pad) {\r\n        top = Math.max(r.top - ddH - pad, pad);\r\n      }\r\n      if (top < pad) {\r\n        top = pad;\r\n      }\r\n\r\n      assigneeDdEl.style.left = `${left}px`;\r\n      assigneeDdEl.style.top = `${top}px`;\r\n\r\n    };\r\n\r\n    projBtn.onclick = () => {\r\n      if (ddOpen) {\r\n        closeDropdown();\r\n        return;\r\n      }\r\n      ddOpen = true;\r\n      setIcon(caret, \"chevron-up\");\r\n      \r\n      // Build project list\r\n      const projectList = Array.from(this.cache.projects.values()).sort((a, b) => \r\n        a.file.basename.localeCompare(b.file.basename)\r\n      );\r\n      \r\n      buildProjectDropdown(projectList);\r\n      \r\n      // Close on outside click\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (ddEl && !ddEl.contains(e.target as Node) && e.target !== projBtn) {\r\n          closeDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    // Assignee filter button\r\n    const assigneeBtn = navControls.createEl(\"button\", { cls: \"pm-proj-btn\" });\r\n    assigneeBtn.createSpan({ text: \"Assignees \" });\r\n    const assigneeCaret = assigneeBtn.createSpan();\r\n    setIcon(assigneeCaret, \"chevron-down\");\r\n\r\n    assigneeBtn.onclick = () => {\r\n      if (assigneeDdOpen) {\r\n        closeAssigneeDropdown();\r\n        return;\r\n      }\r\n      assigneeDdOpen = true;\r\n      setIcon(assigneeCaret, \"chevron-up\");\r\n      \r\n      // Build assignee list from ALL projects (not just filtered ones)\r\n      const assigneeSet = new Set<string>();\r\n      this.cache.projects.forEach(project => {\r\n        // Don't apply project filter when building assignee list\r\n        if (project.tasks) {\r\n          project.tasks.forEach(task => {\r\n            const extTask = task as ExtendedTaskItem;\r\n            const assignee = (extTask.assignee ?? extTask.props?.assignee ?? extTask.owner ?? extTask.props?.owner ?? \"Unassigned\").toString().trim();\r\n            assigneeSet.add(assignee);\r\n          });\r\n        }\r\n      });\r\n      const assigneeList = Array.from(assigneeSet).sort();\r\n      \r\n      buildAssigneeDropdown(assigneeList);\r\n      \r\n      // Close on outside click\r\n      const onDoc = (e: MouseEvent) => {\r\n        if (assigneeDdEl && !assigneeDdEl.contains(e.target as Node) && e.target !== assigneeBtn) {\r\n          closeAssigneeDropdown();\r\n          document.removeEventListener(\"mousedown\", onDoc);\r\n        }\r\n      };\r\n      setTimeout(() => document.addEventListener(\"mousedown\", onDoc));\r\n    };\r\n\r\n    // Calendar content container (scrollable)\r\n    const calendarContent = calendarView.createEl(\"div\", { cls: \"pm-calendar-content\" });\r\n    \r\n    // Calendar grid\r\n    const calendarGrid = calendarContent.createEl(\"div\", { cls: \"pm-calendar-grid\" });\r\n    this.renderMonthView(calendarGrid);\r\n\r\n    // Restore scroll position\r\n    if (this.lastScrollTop > 0) {\r\n      setTimeout(() => {\r\n        calendarContent.scrollTop = this.lastScrollTop;\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  /** Render month view */\r\n  private renderMonthView(container: HTMLElement) {\r\n    // Day headers\r\n    const dayHeaders = container.createEl(\"div\", { cls: \"pm-calendar-day-headers\" });\r\n    \r\n    // Week number header\r\n    const weekHeader = dayHeaders.createEl(\"div\", { cls: \"pm-calendar-week-header\" });\r\n    weekHeader.textContent = \"W\";\r\n    \r\n    const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];\r\n    dayNames.forEach(dayName => {\r\n      const header = dayHeaders.createEl(\"div\", { cls: \"pm-calendar-day-header\" });\r\n      header.textContent = dayName;\r\n    });\r\n\r\n    // Calendar days with week numbers\r\n    const daysGrid = container.createEl(\"div\", { cls: \"pm-calendar-days-grid\" });\r\n    const days = this.generateCalendarDays();\r\n    \r\n    // Group days by week\r\n    const weeks: CalendarDay[][] = [];\r\n    for (let i = 0; i < days.length; i += 7) {\r\n      weeks.push(days.slice(i, i + 7));\r\n    }\r\n    \r\n    weeks.forEach(week => {\r\n      // Add week number cell\r\n      const weekNumber = daysGrid.createEl(\"div\", { cls: \"pm-calendar-week-number\" });\r\n      const mondayOfWeek = week[0]; // First day is Monday\r\n      const weekNum = moment(mondayOfWeek.date).isoWeek();\r\n      weekNumber.textContent = weekNum.toString();\r\n      weekNumber.title = `ISO Week ${weekNum}`;\r\n      \r\n      // Add day cells for this week\r\n      week.forEach(day => {\r\n        this.renderDayCell(daysGrid, day);\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n\r\n  /** Render a single day cell */\r\n  private renderDayCell(container: HTMLElement, day: CalendarDay) {\r\n    const totalTasks = day.dueTasks.length + day.startingTasks.length;\r\n    \r\n    // Create a wrapper div for the day cell and preview\r\n    const dayWrapper = container.createEl(\"div\", { cls: \"pm-calendar-day-wrapper\" });\r\n    \r\n    const dayCell = dayWrapper.createEl(\"div\", { \r\n      cls: `pm-calendar-day ${day.isToday ? 'pm-calendar-day-today' : ''} ${!day.isCurrentMonth ? 'pm-calendar-day-other-month' : ''} ${totalTasks > 0 ? 'pm-calendar-day-has-tasks' : ''}`\r\n    });\r\n    \r\n    // Day number\r\n    const dayNumber = dayCell.createEl(\"div\", { cls: \"pm-calendar-day-number\" });\r\n    dayNumber.textContent = moment(day.date).format('D');\r\n    \r\n    // Task count with color coding\r\n    if (totalTasks > 0) {\r\n      const taskCount = dayCell.createEl(\"div\", { cls: \"pm-calendar-task-count\" });\r\n      taskCount.textContent = totalTasks.toString();\r\n      \r\n      // Add color coding based on task count\r\n      if (totalTasks >= 10) {\r\n        taskCount.classList.add(\"pm-task-count-high\");\r\n      } else if (totalTasks >= 5) {\r\n        taskCount.classList.add(\"pm-task-count-medium\");\r\n      } else {\r\n        taskCount.classList.add(\"pm-task-count-low\");\r\n      }\r\n    }\r\n    \r\n    // Task indicators (due tasks and starting tasks)\r\n    if (totalTasks > 0) {\r\n      const taskIndicators = dayCell.createEl(\"div\", { cls: \"pm-calendar-task-indicators\" });\r\n      \r\n      // Due tasks indicator\r\n      if (day.dueTasks.length > 0) {\r\n        const dueIndicator = taskIndicators.createEl(\"div\", { cls: \"pm-calendar-due-indicator\" });\r\n        dueIndicator.textContent = `${day.dueTasks.length} due`;\r\n        dueIndicator.title = `${day.dueTasks.length} task${day.dueTasks.length === 1 ? '' : 's'} due`;\r\n      }\r\n      \r\n      // Starting tasks indicator\r\n      if (day.startingTasks.length > 0) {\r\n        const startIndicator = taskIndicators.createEl(\"div\", { cls: \"pm-calendar-start-indicator\" });\r\n        startIndicator.textContent = `${day.startingTasks.length} start`;\r\n        startIndicator.title = `${day.startingTasks.length} task${day.startingTasks.length === 1 ? '' : 's'} starting`;\r\n      }\r\n    }\r\n    \r\n    // Click handler for day expansion\r\n    dayCell.onclick = () => {\r\n      // Close any existing day expansions before opening new one\r\n      const existingExpansions = document.querySelectorAll('.pm-day-expansion');\r\n      existingExpansions.forEach(expansion => expansion.remove());\r\n      \r\n      this.showDayExpansion(dayCell, day);\r\n    };\r\n    \r\n    // Remove hover handlers - no hover preview needed\r\n  }\r\n\r\n  /** Show day expansion with task details */\r\n  private showDayExpansion(dayCell: HTMLElement, day: CalendarDay) {\r\n    // Remove existing expansion\r\n    const existingExpansion = this.container.querySelector('.pm-day-expansion');\r\n    if (existingExpansion) {\r\n      existingExpansion.remove();\r\n    }\r\n    \r\n    const expansion = document.createElement('div');\r\n    expansion.className = 'pm-day-expansion';\r\n    \r\n    const header = expansion.createEl('div', { cls: 'pm-day-expansion-header' });\r\n    header.textContent = moment(day.date).format('dddd, MMMM D, YYYY');\r\n    \r\n    const closeBtn = header.createEl('button', { cls: 'pm-day-expansion-close' });\r\n    setIcon(closeBtn, 'x');\r\n    closeBtn.onclick = () => expansion.remove();\r\n    \r\n    const totalTasks = day.dueTasks.length + day.startingTasks.length;\r\n    if (totalTasks === 0) {\r\n      const emptyMsg = expansion.createEl('div', { cls: 'pm-day-expansion-empty' });\r\n      emptyMsg.textContent = 'No tasks on this day';\r\n    } else {\r\n      const taskList = expansion.createEl('div', { cls: 'pm-day-expansion-tasks' });\r\n      \r\n      // Due Tasks Section\r\n      if (day.dueTasks.length > 0) {\r\n        const dueSection = taskList.createEl('div', { cls: 'pm-task-section pm-task-section-due' });\r\n        dueSection.createEl('h3', { text: `📅 Tasks Due (${day.dueTasks.length})` });\r\n        \r\n        // Group due tasks by priority\r\n        const dueTasks = day.dueTasks;\r\n        const highDue = dueTasks.filter(t => getTaskPriority(t) === 'high');\r\n        const medDue = dueTasks.filter(t => getTaskPriority(t) === 'medium');\r\n        const lowDue = dueTasks.filter(t => getTaskPriority(t) === 'low');\r\n        const noneDue = dueTasks.filter(t => getTaskPriority(t) === 'none');\r\n        \r\n        if (highDue.length > 0) {\r\n          const highSection = dueSection.createEl('div', { cls: 'pm-task-subsection' });\r\n          highSection.createEl('h4', { text: '🔴 High Priority' });\r\n          highDue.forEach(task => this.renderTaskItem(highSection, task, 'due'));\r\n        }\r\n        if (medDue.length > 0) {\r\n          const medSection = dueSection.createEl('div', { cls: 'pm-task-subsection' });\r\n          medSection.createEl('h4', { text: '🟡 Medium Priority' });\r\n          medDue.forEach(task => this.renderTaskItem(medSection, task, 'due'));\r\n        }\r\n        if (lowDue.length > 0) {\r\n          const lowSection = dueSection.createEl('div', { cls: 'pm-task-subsection' });\r\n          lowSection.createEl('h4', { text: '🟢 Low Priority' });\r\n          lowDue.forEach(task => this.renderTaskItem(lowSection, task, 'due'));\r\n        }\r\n        if (noneDue.length > 0) {\r\n          const noneSection = dueSection.createEl('div', { cls: 'pm-task-subsection' });\r\n          noneSection.createEl('h4', { text: '⚪ No Priority' });\r\n          noneDue.forEach(task => this.renderTaskItem(noneSection, task, 'due'));\r\n        }\r\n      }\r\n      \r\n      // Starting Tasks Section\r\n      if (day.startingTasks.length > 0) {\r\n        const startSection = taskList.createEl('div', { cls: 'pm-task-section pm-task-section-start' });\r\n        startSection.createEl('h3', { text: `🚀 Tasks Starting (${day.startingTasks.length})` });\r\n        \r\n        // Group starting tasks by priority\r\n        const startTasks = day.startingTasks;\r\n        const highStart = startTasks.filter(t => getTaskPriority(t) === 'high');\r\n        const medStart = startTasks.filter(t => getTaskPriority(t) === 'medium');\r\n        const lowStart = startTasks.filter(t => getTaskPriority(t) === 'low');\r\n        const noneStart = startTasks.filter(t => getTaskPriority(t) === 'none');\r\n        \r\n        if (highStart.length > 0) {\r\n          const highSection = startSection.createEl('div', { cls: 'pm-task-subsection' });\r\n          highSection.createEl('h4', { text: '🔴 High Priority' });\r\n          highStart.forEach(task => this.renderTaskItem(highSection, task, 'start'));\r\n        }\r\n        if (medStart.length > 0) {\r\n          const medSection = startSection.createEl('div', { cls: 'pm-task-subsection' });\r\n          medSection.createEl('h4', { text: '🟡 Medium Priority' });\r\n          medStart.forEach(task => this.renderTaskItem(medSection, task, 'start'));\r\n        }\r\n        if (lowStart.length > 0) {\r\n          const lowSection = startSection.createEl('div', { cls: 'pm-task-subsection' });\r\n          lowSection.createEl('h4', { text: '🟢 Low Priority' });\r\n          lowStart.forEach(task => this.renderTaskItem(lowSection, task, 'start'));\r\n        }\r\n        if (noneStart.length > 0) {\r\n          const noneSection = startSection.createEl('div', { cls: 'pm-task-subsection' });\r\n          noneSection.createEl('h4', { text: '⚪ No Priority' });\r\n          noneStart.forEach(task => this.renderTaskItem(noneSection, task, 'start'));\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Position expansion near the day cell with viewport awareness\r\n    const rect = dayCell.getBoundingClientRect();\r\n    expansion.style.position = 'absolute';\r\n    expansion.style.zIndex = '99999';\r\n    \r\n    // First, add to DOM to measure its size\r\n    document.body.appendChild(expansion);\r\n    const expansionRect = expansion.getBoundingClientRect();\r\n    \r\n    // Calculate optimal position\r\n    let left = rect.left;\r\n    let top = rect.bottom + 5;\r\n    \r\n    // Check if expansion would go off the right edge\r\n    if (left + expansionRect.width > window.innerWidth - 20) {\r\n      left = Math.max(20, window.innerWidth - expansionRect.width - 20);\r\n    }\r\n    \r\n    // Check if expansion would go off the bottom edge\r\n    if (top + expansionRect.height > window.innerHeight - 20) {\r\n      // Position above the day cell instead\r\n      top = Math.max(20, rect.top - expansionRect.height - 5);\r\n    }\r\n    \r\n    // Check if expansion would go off the left edge\r\n    if (left < 20) {\r\n      left = 20;\r\n    }\r\n    \r\n    // Check if expansion would go off the top edge (when positioned above)\r\n    if (top < 20) {\r\n      // Position below again but adjust top position\r\n      top = Math.max(20, window.innerHeight - expansionRect.height - 20);\r\n    }\r\n    \r\n    expansion.style.left = `${left}px`;\r\n    expansion.style.top = `${top}px`;\r\n  }\r\n\r\n\r\n\r\n  /** Render a single task item in the expansion */\r\n  private renderTaskItem(container: HTMLElement, task: ExtendedTaskItem, type: 'due' | 'start') {\r\n    const taskItem = container.createEl('div', { cls: `pm-task-item pm-task-item-${type}` });\r\n    \r\n    const taskText = taskItem.createEl('div', { cls: 'pm-task-text' });\r\n    taskText.textContent = task.text || 'Untitled Task';\r\n    \r\n    const taskMeta = taskItem.createEl('div', { cls: 'pm-task-meta' });\r\n    \r\n    if (task.projectName) {\r\n      const projectSpan = taskMeta.createEl('span', { cls: 'pm-task-project' });\r\n      projectSpan.textContent = task.projectName;\r\n    }\r\n    \r\n    if (task.assignee) {\r\n      const assigneeSpan = taskMeta.createEl('span', { cls: 'pm-task-assignee' });\r\n      assigneeSpan.textContent = `👤 ${task.assignee}`;\r\n    }\r\n    \r\n    // Show the relevant date\r\n    const dateSpan = taskMeta.createEl('span', { cls: 'pm-task-date' });\r\n    if (type === 'due' && task.due) {\r\n      dateSpan.textContent = `📅 Due: ${moment(task.due).format('MMM D')}`;\r\n    } else if (type === 'start' && task.start) {\r\n      dateSpan.textContent = `🚀 Start: ${moment(task.start).format('MMM D')}`;\r\n    }\r\n  }\r\n}\r\n","import {\r\n  App,\r\n  ItemView,\r\n  WorkspaceLeaf,\r\n  setIcon,\r\n  Modal,\r\n  TFile,\r\n  normalizePath,\r\n  Notice,\r\n  parseYaml,\r\n  stringifyYaml,\r\n  TFolder,\r\n  FuzzySuggestModal,\r\n} from \"obsidian\";\r\nimport { ProjectCache } from \"../services/cache\";\r\nimport { newProject } from \"../newProject\";\r\nimport { newActionItem } from \"../newActionItem\";\r\nimport { PmSettings } from \"../../settings\";\r\nimport { VIEW_TYPE_PM_PROGRESS } from \"./progress\";\r\nimport { VIEW_TYPE_PM_TIMELINE } from \"./timeline\";\r\nimport { VIEW_TYPE_PM_TASKWEEKS } from \"./task_weeks\";\r\nimport { VIEW_TYPE_PM_RESOURCES } from \"./resources\";\r\nimport { VIEW_TYPE_PM_DASHBOARD } from \"./dashboard\";\r\nimport { VIEW_TYPE_PM_TODAY } from \"./today\";\r\nimport { VIEW_TYPE_PM_CALENDAR } from \"./calendar\";\r\n\r\n// Load portfolio-specific styles\r\nimport \"../../styles/styles-portfolio.css\";\r\n\r\nexport const VIEW_TYPE_PM_PORTFOLIO = \"pm-portfolio-view\";\r\n\r\n/* ───────────────────────── Types & constants ───────────────────────── */\r\n\r\n// --- Simple input modal for user prompts ---\r\nclass PromptModal extends Modal {\r\n  private resolveFn: ((value: string | null) => void) | null = null;\r\n  constructor(app: any, private title: string, private initial: string = \"\") {\r\n    super(app);\r\n  }\r\n  onOpen() {\r\n    const { contentEl } = this;\r\n    contentEl.empty();\r\n    contentEl.createEl(\"h3\", { text: this.title });\r\n    const input = contentEl.createEl(\"input\", {\r\n      type: \"text\",\r\n      value: this.initial,\r\n    });\r\n    input.focus();\r\n    const btnBar = contentEl.createDiv({ cls: \"modal-button-container\" });\r\n    const ok = btnBar.createEl(\"button\", { text: \"OK\" });\r\n    const cancel = btnBar.createEl(\"button\", { text: \"Cancel\" });\r\n\r\n    ok.onclick = () => {\r\n      this.close();\r\n      this.resolveFn?.(input.value.trim() || null);\r\n    };\r\n    cancel.onclick = () => {\r\n      this.close();\r\n      this.resolveFn?.(null);\r\n    };\r\n  }\r\n  public async prompt(): Promise<string | null> {\r\n    return new Promise<string | null>((res) => {\r\n      this.resolveFn = res;\r\n      this.open();\r\n    });\r\n  }\r\n}\r\n\r\n/** Folder chooser that calls its callback exactly once */\r\nclass FolderSelectModal extends FuzzySuggestModal<TFolder> {\r\n  private picked = false;\r\n  constructor(app: App, private onPick: (folder: TFolder | null) => void) {\r\n    super(app);\r\n    this.setPlaceholder(\"Select folder for new project…\");\r\n  }\r\n  getItems(): TFolder[] {\r\n    return this.app.vault.getAllLoadedFiles().filter(\r\n      (f): f is TFolder => f instanceof TFolder\r\n    );\r\n  }\r\n  getItemText(item: TFolder) { return item.path; }\r\n\r\n  onChooseItem(item: TFolder) {\r\n    this.picked = true;\r\n    this.onPick(item);   // fire once with the chosen folder\r\n  }\r\n\r\n  onClose() {\r\n    // Fire with null only if user closed without selecting\r\n    if (!this.picked) this.onPick(null);\r\n  }\r\n}\r\ninterface PortfolioFile {\r\n  id: string;\r\n  name: string;\r\n  projectPaths: string[];\r\n  /** One‑paragraph summary shown in the UI */\r\n  description?: string;\r\n  owner?: string;\r\n  created: number;\r\n  modified: number;\r\n  /** Saved height of the description textarea (px) */\r\n  descHeight?: number;\r\n}\r\n\r\n\r\n// Store portfolio YAML files in the new sync-friendly folder\r\nconst PORT_DIR = \"Portfolios\";\r\n\r\nasync function migrateOldPortfolios(app: App) {\r\n  try {\r\n    // Use vault's config directory instead of hardcoded .obsidian\r\n    const oldPath = normalizePath(`${app.vault.configDir}/plugins/project-management/pm`);\r\n    const newPath = normalizePath(PORT_DIR);\r\n\r\n    // Ensure new folder exists\r\n    try { await app.vault.adapter.mkdir(newPath); } catch (_) {}\r\n\r\n    const listing = await app.vault.adapter.list(oldPath);\r\n    for (const file of listing.files) {\r\n      if (file.endsWith(\".yml\") || file.endsWith(\".yaml\")) {\r\n        const baseName = file.substring(file.lastIndexOf(\"/\") + 1);\r\n        const targetPath = `${newPath}/${baseName}`;\r\n        // Copy file contents to new location\r\n        const data = await app.vault.adapter.read(file);\r\n        await app.vault.adapter.write(targetPath, data);\r\n        // Optionally delete old file\r\n        try { await app.vault.adapter.remove(file); } catch (_) {}\r\n      }\r\n    }\r\n  } catch (err) {\r\n\r\n  }\r\n}\r\n\r\nconst SB_WIDTH_KEY = \"pm-portfolio-sidebar-width\";\r\nconst SB_COLLAPSE_KEY = \"pm-portfolio-sidebar-collapsed\";\r\n\r\n/* ───────────────────────── View class ──────────────────────────────── */\r\nexport class PortfolioView extends ItemView {\r\n  public icon = \"layers\";\r\n\r\n  /* Data */\r\n  private portfolios: PortfolioFile[] = [];\r\n  private selectedId: string | null = null;\r\n  private descBox?: HTMLTextAreaElement;   // ref to description textarea\r\n  /** Active sidebar tooltip so we can close it on render/change */\r\n  private descTip: HTMLElement | null = null;\r\n\r\n  /** Sorting key and direction (1 = asc, -1 = desc) */\r\n  private sortKey: \"name\" | \"area\" | \"priority\" = \"name\";\r\n  private sortDir: 1 | -1 = 1;\r\n\r\n  constructor(\r\n    leaf: WorkspaceLeaf,\r\n    private cache: ProjectCache,\r\n    private settings: PmSettings,\r\n    private plugin: any\r\n  ) {\r\n    super(leaf);\r\n  }\r\n\r\n  /* -------------------------------------------------- identity ------- */\r\n  getViewType(): string {\r\n    return VIEW_TYPE_PM_PORTFOLIO;\r\n  }\r\n  getDisplayText(): string {\r\n    return \"Project Management\";\r\n  }\r\n\r\n  /* -------------------------------------------------- lifecycle ------ */\r\n  async onOpen() {\r\n    await migrateOldPortfolios(this.app);\r\n    await this.ensureFolder();\r\n    await this.loadPortfolios();\r\n    \r\n    // Try to restore the last selected portfolio, otherwise use the first one\r\n    const lastSelected = this.settings.lastSelectedPortfolio;\r\n    const lastPortfolio = lastSelected ? this.portfolios.find(p => p.id === lastSelected) : null;\r\n    \r\n    if (lastPortfolio) {\r\n      this.selectedId = lastPortfolio.id;\r\n    } else if (this.portfolios[0]) {\r\n      this.selectedId = this.portfolios[0].id;\r\n    }\r\n\r\n    /* If vault indexing isn't finished, refresh once \"resolved\" fires */\r\n    if ((this.app.metadataCache as any).resolved === false) {\r\n      const ref = this.app.metadataCache.on(\"resolved\", async () => {\r\n        await this.loadPortfolios();\r\n        this.render();                 // projects are ready now\r\n      });\r\n      // Register the event so it is automatically cleaned up with the view\r\n      this.registerEvent(ref);\r\n    }\r\n\r\n    this.render();\r\n  }\r\n  async onClose() {\r\n    if (!this.descBox) return;\r\n    const sel = this.portfolios.find((pf) => pf.id === this.selectedId);\r\n    if (sel) {\r\n      const h = this.descBox.clientHeight;\r\n      if (h && h !== sel.descHeight) {\r\n        sel.descHeight = h;\r\n        await this.savePortfolio(sel);   // persist on pane close\r\n      }\r\n    }\r\n  }\r\n\r\n  /* -------------------------------------------------- FS helpers ----- */\r\n  private async ensureFolder() {\r\n    const path = normalizePath(PORT_DIR);\r\n    try {\r\n      await this.app.vault.adapter.mkdir(path);\r\n    } catch (_) {\r\n      /* folder already exists or cannot create */\r\n    }\r\n  }\r\n\r\n  private async loadPortfolios() {\r\n    /* use adapter.list to catch .yml in plugin folder */\r\n    const dirPath = normalizePath(PORT_DIR);\r\n    let files: string[] = [];\r\n    try {\r\n      const listing = await this.app.vault.adapter.list(dirPath);\r\n      files = listing.files.filter(\r\n        (p) => p.endsWith(\".yml\") || p.endsWith(\".yaml\")\r\n      );\r\n    } catch (err) {\r\n\r\n    }\r\n\r\n    /* Fallback: if adapter.list found nothing, try vault.getFiles() */\r\n    if (files.length === 0) {\r\n      files = this.app.vault\r\n        .getFiles()\r\n        .filter(\r\n          (f) =>\r\n            f.path.startsWith(`${PORT_DIR}/`) &&\r\n            (f.extension.toLowerCase() === \"yml\" ||\r\n              f.extension.toLowerCase() === \"yaml\")\r\n        )\r\n        .map((f) => f.path);\r\n    }\r\n\r\n    const out: PortfolioFile[] = [];\r\n    for (const pth of files) {\r\n      try {\r\n        const raw = await this.app.vault.adapter.read(pth);\r\n        const data = parseYaml(raw) as any;\r\n        const base =\r\n          pth.substring(pth.lastIndexOf(\"/\") + 1, pth.lastIndexOf(\".\"));\r\n        \r\n        // Clean up invalid project paths and try to find renamed files\r\n        let projectPaths = Array.isArray(data.projectPaths) ? data.projectPaths : [];\r\n        const validPaths: string[] = [];\r\n        const invalidPaths: string[] = [];\r\n        \r\n        for (const path of projectPaths) {\r\n          const file = this.app.vault.getFileByPath(path);\r\n          if (file && file instanceof TFile) {\r\n            validPaths.push(path);\r\n          } else {\r\n            // Try to find the file by name (it might have been renamed)\r\n            const fileName = path.substring(path.lastIndexOf(\"/\") + 1);\r\n            const foundFile = this.findFileByName(fileName);\r\n            if (foundFile) {\r\n              // Verify that the found file is actually a project file\r\n              const isProject = await this.isProjectFile(foundFile);\r\n              if (isProject) {\r\n                validPaths.push(foundFile.path);\r\n              } else {\r\n                invalidPaths.push(path);\r\n              }\r\n            } else {\r\n              // Also check if the file exists but with a different path structure\r\n              const allFiles = this.app.vault.getFiles();\r\n              const matchingFile = allFiles.find(f => f.name === fileName);\r\n              if (matchingFile) {\r\n                // Verify that the found file is actually a project file\r\n                const isProject = await this.isProjectFile(matchingFile);\r\n                if (isProject) {\r\n                  validPaths.push(matchingFile.path);\r\n                } else {\r\n                  invalidPaths.push(path);\r\n                }\r\n              } else {\r\n                invalidPaths.push(path);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        \r\n        // If we found invalid paths, update the portfolio\r\n        if (invalidPaths.length > 0) {\r\n          const updatedData = {\r\n            ...data,\r\n            projectPaths: validPaths,\r\n            modified: Date.now()\r\n          };\r\n          const updatedYaml = stringifyYaml(updatedData);\r\n          await this.app.vault.adapter.write(pth, updatedYaml);\r\n        }\r\n        \r\n        out.push({\r\n          id: data.id ?? base,\r\n          name: data.name ?? base,\r\n          projectPaths: validPaths,\r\n          description: data.description ?? \"\",\r\n          owner: data.owner,\r\n          created: data.created ?? Date.now(),\r\n          modified: data.modified ?? Date.now(),\r\n          descHeight: typeof data.descHeight === \"number\" ? data.descHeight : undefined,\r\n        });\r\n      } catch (e) {\r\n\r\n      }\r\n    }\r\n    this.portfolios = out.sort((a, b) => a.name.localeCompare(b.name));\r\n  }\r\n\r\n  /** Try to find a file by its name (for handling renamed files) */\r\n  private findFileByName(fileName: string): TFile | null {\r\n    const files = this.app.vault.getFiles();\r\n    // First try exact name match\r\n    let foundFile = files.find(file => file.name === fileName);\r\n    \r\n    if (foundFile) {\r\n      return foundFile;\r\n    }\r\n    \r\n    // If no exact match, try to find files that might be the same project\r\n    // Look for files with similar names (ignoring case and common variations)\r\n    const normalizedFileName = fileName.toLowerCase().replace(/\\.md$/, '');\r\n    \r\n    for (const file of files) {\r\n      const normalizedFile = file.name.toLowerCase().replace(/\\.md$/, '');\r\n      \r\n      // Check if this might be the same file (exact match without extension)\r\n      if (normalizedFile === normalizedFileName) {\r\n        return file;\r\n      }\r\n      \r\n      // Check if it's a close match (e.g., \"project-name\" vs \"project_name\")\r\n      const fileVariations = [\r\n        normalizedFile,\r\n        normalizedFile.replace(/[-_]/g, ''),\r\n        normalizedFile.replace(/[-_]/g, '-'),\r\n        normalizedFile.replace(/[-_]/g, '_')\r\n      ];\r\n      \r\n      if (fileVariations.includes(normalizedFileName)) {\r\n        return file;\r\n      }\r\n    }\r\n    \r\n    return null;\r\n  }\r\n\r\n  /** Check if a file is a project file by looking at its front matter */\r\n  private async isProjectFile(file: TFile): Promise<boolean> {\r\n    try {\r\n      const content = await this.app.vault.read(file);\r\n      const frontMatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---\\n/);\r\n      if (!frontMatterMatch) return false;\r\n      \r\n      const frontMatter = frontMatterMatch[1];\r\n      const projectFlag = this.settings.projectFlagProperty;\r\n      \r\n      // Check if the project flag is set to true\r\n      const flagRegex = new RegExp(`^${projectFlag}\\\\s*:\\\\s*true\\\\s*$`, 'm');\r\n      return flagRegex.test(frontMatter);\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /** Persist the YAML back to the portfolio storage folder */\r\n  private async savePortfolio(p: PortfolioFile) {\r\n    p.modified = Date.now();\r\n    const yaml = stringifyYaml({\r\n      id:            p.id,\r\n      name:          p.name,\r\n      description:   p.description ?? \"\",\r\n      owner:         p.owner ?? \"\",\r\n      projectPaths:  p.projectPaths,\r\n      created:       p.created,\r\n      modified:      p.modified,\r\n      descHeight:    p.descHeight ?? undefined,\r\n    });\r\n    const filePath = `${PORT_DIR}/${p.id}.yml`;\r\n    const existing = this.app.vault.getFileByPath(filePath);\r\n\r\n    if (existing instanceof TFile) {\r\n      /* Portfolio already indexed by Obsidian — use modify */\r\n      await this.app.vault.modify(existing, yaml);\r\n    } else {\r\n      /* File not in vault index (common in .obsidian folder) — write via adapter */\r\n      await this.app.vault.adapter.write(filePath, yaml);\r\n    }\r\n    await this.loadPortfolios();\r\n  }\r\n\r\n  /** Delete a portfolio YAML and refresh list */\r\n  private async deletePortfolio(id: string) {\r\n    const filePath = `${PORT_DIR}/${id}.yml`;\r\n    const file = this.app.vault.getFileByPath(filePath);\r\n\r\n    if (file && file instanceof TFile) {\r\n      // File is indexed by the vault – safe to delete via file manager (respects user preferences)\r\n      await this.app.fileManager.trashFile(file);\r\n    } else {\r\n      // Not indexed (common for .obsidian folder) – remove via adapter\r\n      try {\r\n        await this.app.vault.adapter.remove(filePath);\r\n      } catch (err) {\r\n\r\n      }\r\n    }\r\n\r\n    await this.loadPortfolios();\r\n    if (this.selectedId === id) this.selectedId = this.portfolios[0]?.id ?? null;\r\n  }\r\n\r\n  /* -------------------------------------------------- helpers -------- */\r\n  /** Open Progress view showing only projects in the selected portfolio */\r\n  private async openProgress() {\r\n    // Get project paths for current portfolio\r\n    const sel    = this.portfolios.find((pf) => pf.id === this.selectedId);\r\n    const filter = sel?.projectPaths ?? [];\r\n\r\n    // Reuse an existing Progress leaf; otherwise open in bottom pane\r\n    let leaf: WorkspaceLeaf | undefined;\r\n    if (this.settings.reuseProgressPane) {\r\n      leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_PROGRESS)[0];\r\n    }\r\n    if (!leaf) leaf = this.app.workspace.splitActiveLeaf(\"horizontal\");\r\n\r\n    // Push the filter into the viewState (works for fresh & existing)\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_PROGRESS,\r\n      active: true,\r\n      state:  {\r\n        filterProjects: filter,\r\n        filterName:     sel?.name ?? \"\",\r\n      },\r\n    });\r\n\r\n    // If the view instance already exists, call its runtime updater\r\n    const view: any = leaf.view;\r\n    if (view?.updateFilter) view.updateFilter(filter, sel?.name ?? \"\");\r\n\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  /** Open Dashboard showing only projects in the selected portfolio */\r\n  private async openDashboard() {\r\n    // Get project paths for current portfolio\r\n    const sel    = this.portfolios.find((pf) => pf.id === this.selectedId);\r\n    const filter = sel?.projectPaths ?? [];\r\n\r\n    // Reuse an existing Dashboard leaf; otherwise create new leaf\r\n    let leaf: WorkspaceLeaf | undefined;\r\n    if (this.settings.reuseProgressPane) {\r\n      leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_DASHBOARD)[0];\r\n    }\r\n    if (!leaf) leaf = this.app.workspace.getLeaf();\r\n\r\n    // Push the filter into the viewState (works for fresh & existing)\r\n    if (leaf) {\r\n      await leaf.setViewState({\r\n        type:   VIEW_TYPE_PM_DASHBOARD,\r\n        active: true,\r\n        state:  {\r\n          filterProjects: filter,\r\n          filterName:     sel?.name ?? \"\",\r\n        },\r\n      });\r\n\r\n      // If the view instance already exists, call its runtime updater\r\n      const view: any = leaf.view;\r\n      if (view?.updateFilter) view.updateFilter(filter, sel?.name ?? \"\");\r\n\r\n      this.app.workspace.revealLeaf(leaf);\r\n    }\r\n  }\r\n\r\n  /** Open Today view showing task recommendations */\r\n  private async openToday() {\r\n    // Reuse an existing Today leaf; otherwise create new leaf\r\n    let leaf: WorkspaceLeaf | undefined;\r\n    if (this.settings.reuseProgressPane) {\r\n      leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TODAY)[0];\r\n    }\r\n    if (!leaf) leaf = this.app.workspace.getLeaf();\r\n\r\n    if (leaf) {\r\n      await leaf.setViewState({\r\n        type:   VIEW_TYPE_PM_TODAY,\r\n        active: true,\r\n      });\r\n\r\n      this.app.workspace.revealLeaf(leaf);\r\n    }\r\n  }\r\n\r\n  /** Open Calendar view showing task calendar for this portfolio */\r\n  private async openCalendar() {\r\n    // Collect project paths for the active portfolio\r\n    const sel    = this.portfolios.find((pf) => pf.id === this.selectedId);\r\n    const filter = sel?.projectPaths ?? [];\r\n\r\n    // Reuse an existing Calendar leaf; otherwise create new leaf\r\n    let leaf: WorkspaceLeaf | undefined;\r\n    if (this.settings.reuseProgressPane) {\r\n      leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_CALENDAR)[0];\r\n    }\r\n    if (!leaf) leaf = this.app.workspace.getLeaf();\r\n\r\n    if (leaf) {\r\n      await leaf.setViewState({\r\n        type:   VIEW_TYPE_PM_CALENDAR,\r\n        active: true,\r\n        state:  {\r\n          filterProjects: filter,\r\n          filterName:     sel?.name ?? \"\",\r\n        },\r\n      });\r\n\r\n      this.app.workspace.revealLeaf(leaf);\r\n    }\r\n  }\r\n\r\n  /** Open Timeline showing only projects in the selected portfolio */\r\n  private async openTimeline() {\r\n    // Collect project paths for the active portfolio\r\n    const sel    = this.portfolios.find((pf) => pf.id === this.selectedId);\r\n    const filter = sel?.projectPaths ?? [];\r\n\r\n    /* Re‑use an existing Timeline pane if one is open */\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE)[0];\r\n    if (!leaf) {\r\n      leaf = this.app.workspace.splitActiveLeaf(\"horizontal\");\r\n    }\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_TIMELINE,\r\n      active: true,\r\n      state:  {\r\n        filterProjects: filter,\r\n        filterName:     sel?.name ?? \"\",\r\n      },\r\n    });\r\n\r\n    // If the view instance already exists, call its runtime updater\r\n    const view: any = leaf.view;\r\n    if (view?.updateFilter) view.updateFilter(filter, sel?.name ?? \"\");\r\n\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  private toggleSort(key: \"name\" | \"area\" | \"priority\") {\r\n    if (this.sortKey === key) {\r\n      this.sortDir = this.sortDir === 1 ? -1 : 1;\r\n    } else {\r\n      this.sortKey = key;\r\n      this.sortDir = 1;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /* -------------------------------------------------- render --------- */\r\n  private render() {\r\n    const el = this.contentEl;\r\n    /* Close lingering sidebar tooltip, if any */\r\n    if (this.descTip) {\r\n      this.descTip.remove();\r\n      this.descTip = null;\r\n    }\r\n    el.empty();\r\n\r\n    /** Shared hover‑tooltip helper (reuses the .pm-port-tooltip styling) */\r\n    function attachTip(target: HTMLElement, text: string) {\r\n      let tip: HTMLElement | null = null;\r\n\r\n      target.addEventListener(\"mouseenter\", (ev: MouseEvent) => {\r\n        tip = document.createElement(\"div\");\r\n        tip.classList.add(\"pm-port-tooltip\");\r\n        tip.textContent = text;\r\n        document.body.appendChild(tip);\r\n\r\n        /* Position beside the cursor, clamped to viewport */\r\n        const pad = 8;\r\n        const w   = tip.offsetWidth  || 120;\r\n        const h   = tip.offsetHeight || 40;\r\n\r\n        let left = ev.clientX + 12;\r\n        let top  = ev.clientY + 12;\r\n\r\n        if (left + w > window.innerWidth - pad) {\r\n          left = Math.max(ev.clientX - w - 12, pad);\r\n        }\r\n        if (top + h > window.innerHeight - pad) {\r\n          top = Math.max(window.innerHeight - h - pad, pad);\r\n        }\r\n\r\n        tip.style.left = `${left}px`;\r\n        tip.style.top  = `${top}px`;\r\n      });\r\n\r\n      const remove = () => { tip?.remove(); tip = null; };\r\n      target.addEventListener(\"mouseleave\", remove);\r\n      target.addEventListener(\"mousedown\", remove);  // hide when clicked\r\n    }\r\n\r\n    const wrap = el.createDiv({ cls: \"pm-port-wrap\" });\r\n    const sidebar = wrap.createDiv({ cls: \"pm-port-sidebar\" });\r\n    /* Apply stored width or collapsed state using CSS custom properties */\r\n    const savedW = Number(localStorage.getItem(SB_WIDTH_KEY));\r\n    const isCollapsed = localStorage.getItem(SB_COLLAPSE_KEY) === \"1\";\r\n    if (isCollapsed) {\r\n      sidebar.style.setProperty(\"--sidebar-width\", \"0px\");\r\n      sidebar.style.display = \"none\";\r\n    } else if (!isNaN(savedW) && savedW >= 120 && savedW <= 400) {\r\n      sidebar.style.setProperty(\"--sidebar-width\", `${savedW}px`);\r\n    } else {\r\n      sidebar.style.setProperty(\"--sidebar-width\", \"180px\");\r\n    }\r\n\r\n    /* Draggable splitter + chevron toggle that stays visible */\r\n    const split = wrap.createDiv({ cls: \"pm-port-split\" });\r\n    const toggleBtn = split.createSpan();\r\n    setIcon(toggleBtn, isCollapsed ? \"chevron-right\" : \"chevron-left\");\r\n    toggleBtn.style.cursor = \"pointer\";\r\n    toggleBtn.style.display = \"block\";\r\n    toggleBtn.style.margin = \"4px auto\";\r\n    toggleBtn.style.fontSize = \"14px\";\r\n    toggleBtn.onmousedown = (e) => { e.stopPropagation(); e.preventDefault(); };\r\n    toggleBtn.onclick = () => {\r\n      const goingCollapsed = !(localStorage.getItem(SB_COLLAPSE_KEY) === \"1\");\r\n      if (goingCollapsed) {\r\n        const w = sidebar.getBoundingClientRect().width;\r\n        if (w >= 120 && w <= 400) localStorage.setItem(SB_WIDTH_KEY, String(w));\r\n        localStorage.setItem(SB_COLLAPSE_KEY, \"1\");\r\n        sidebar.style.display = \"none\";\r\n        sidebar.style.setProperty(\"--sidebar-width\", \"0px\");\r\n      } else {\r\n        localStorage.setItem(SB_COLLAPSE_KEY, \"0\");\r\n        const savedW = Number(localStorage.getItem(SB_WIDTH_KEY));\r\n        if (!isNaN(savedW) && savedW >= 120 && savedW <= 400) {\r\n          sidebar.style.setProperty(\"--sidebar-width\", `${savedW}px`);\r\n        } else {\r\n          sidebar.style.setProperty(\"--sidebar-width\", \"180px\");\r\n        }\r\n        sidebar.style.display = \"\"; // revert to default block\r\n      }\r\n      this.render();\r\n    };\r\n\r\n    const panel = wrap.createDiv({ cls: \"pm-port-panel\" });\r\n\r\n    /* ── Splitter drag logic ────────────────────────────────────────────── */\r\n    (() => {\r\n      let startX = 0;\r\n      let startW = 180;\r\n      let isDragging = false;\r\n\r\n      const onMove = (e: MouseEvent) => {\r\n        if (!isDragging) return;\r\n        const dx = e.clientX - startX;\r\n        const newW = Math.max(0, Math.min(400, startW + dx));\r\n        sidebar.style.setProperty(\"--sidebar-width\", `${newW}px`);\r\n        setIcon(toggleBtn, newW <= 20 ? \"chevron-right\" : \"chevron-left\");\r\n      };\r\n\r\n      const stop = () => {\r\n        if (!isDragging) return;\r\n        isDragging = false;\r\n        \r\n        const w = sidebar.getBoundingClientRect().width;\r\n        const nowCollapsed = w <= 20;\r\n        \r\n        if (!nowCollapsed) {\r\n          localStorage.setItem(SB_WIDTH_KEY, `${w}`);\r\n          localStorage.setItem(SB_COLLAPSE_KEY, \"0\");\r\n        } else {\r\n          localStorage.setItem(SB_COLLAPSE_KEY, \"1\");\r\n          sidebar.style.display = \"none\";\r\n          sidebar.style.setProperty(\"--sidebar-width\", \"0px\");\r\n        }\r\n\r\n        document.removeEventListener(\"mousemove\", onMove);\r\n        document.removeEventListener(\"mouseup\", stop);\r\n      };\r\n\r\n      split.addEventListener(\"mousedown\", (e) => {\r\n        if ((e.target as HTMLElement)?.closest(\"span\") === toggleBtn) return;\r\n        \r\n        e.preventDefault();\r\n        isDragging = true;\r\n        startX = e.clientX;\r\n        startW = sidebar.getBoundingClientRect().width;\r\n        // If currently collapsed/hidden, make it visible before dragging\r\n        if (getComputedStyle(sidebar).display === \"none\") {\r\n          sidebar.style.display = \"\"; // default block\r\n          // start from previous saved width or minimal width\r\n          const savedW = Number(localStorage.getItem(SB_WIDTH_KEY));\r\n          const initial = !isNaN(savedW) && savedW >= 120 && savedW <= 400 ? savedW : 180;\r\n          sidebar.style.setProperty(\"--sidebar-width\", `${initial}px`);\r\n          localStorage.setItem(SB_COLLAPSE_KEY, \"0\");\r\n          setIcon(toggleBtn, \"chevron-left\");\r\n        }\r\n        \r\n        document.addEventListener(\"mousemove\", onMove);\r\n        document.addEventListener(\"mouseup\", stop);\r\n      });\r\n    })();\r\n\r\n    /* ---- sidebar header ---- */\r\n    const listHeader = sidebar.createDiv({ cls: \"pm-port-sb-head\" });\r\n    \r\n    // Left side: briefcase icon and text\r\n    const leftSide = listHeader.createEl(\"div\");\r\n    leftSide.style.display = \"flex\";\r\n    leftSide.style.alignItems = \"center\";\r\n    \r\n    // Add briefcase icon before the text\r\n    const briefcaseIcon = leftSide.createEl(\"span\");\r\n    setIcon(briefcaseIcon, \"briefcase\");\r\n    briefcaseIcon.style.marginRight = \"8px\";\r\n    \r\n    leftSide.createEl(\"span\", { text: \"Portfolios\" });\r\n    \r\n    // Right side: plus button\r\n    const addBtn = listHeader.createEl(\"span\");\r\n    addBtn.style.marginLeft = \"auto\";\r\n    setIcon(addBtn, \"plus\");\r\n    addBtn.style.cursor = \"pointer\";\r\n    attachTip(addBtn, \"Add new portfolio\");\r\n    addBtn.onclick = async () => {\r\n      const name = await new PromptModal(this.app, \"New portfolio name\").prompt();\r\n      if (!name) return;\r\n\r\n      const id = `pf-${Date.now()}`;\r\n      const pf: PortfolioFile = {\r\n        id,\r\n        name,\r\n        projectPaths: [],\r\n        created: Date.now(),\r\n        modified: Date.now(),\r\n      };\r\n      await this.savePortfolio(pf);\r\n      this.selectedId = id;\r\n      \r\n      // Save the selected portfolio to settings\r\n      this.settings.lastSelectedPortfolio = id;\r\n      await this.plugin.saveSettings();\r\n      \r\n      this.render();\r\n    };\r\n\r\n    /* ---- sidebar list ---- */\r\n    const ul = sidebar.createEl(\"ul\", { cls: \"pm-port-ul\" });\r\n    for (const p of this.portfolios) {\r\n      const li = ul.createEl(\"li\", { cls: p.id === this.selectedId ? \"active\" : \"\" });\r\n\r\n      /* Bullet column – shows “•” only for the active portfolio */\r\n      li.createSpan({\r\n        text: p.id === this.selectedId ? \"•\" : \"\",\r\n        cls:  \"pm-port-bullet\",\r\n      });\r\n\r\n      /* Portfolio name */\r\n      const nameSpan = li.createSpan({ text: p.name, cls: \"pm-port-name\" });\r\n      nameSpan.onclick = async () => {\r\n        /* Close any active tooltip */\r\n        this.descTip?.remove();\r\n        this.descTip = null;\r\n        this.selectedId = p.id;\r\n        \r\n        // Save the selected portfolio to settings\r\n        this.settings.lastSelectedPortfolio = p.id;\r\n        await this.plugin.saveSettings();\r\n        \r\n        this.render();\r\n      };\r\n      /* Hover tooltip with portfolio description */\r\n      if (p.description && p.description.trim() !== \"\") {\r\n        const showTip = (ev: MouseEvent) => {\r\n          /* Kill any previous tooltip */\r\n          this.descTip?.remove();\r\n\r\n          this.descTip = document.createElement(\"div\");\r\n          this.descTip.classList.add(\"pm-port-tooltip\");\r\n          this.descTip.textContent = p.description!;\r\n          document.body.appendChild(this.descTip);\r\n\r\n          /* Hide when the cursor leaves the tooltip itself */\r\n          this.descTip.addEventListener(\"mouseleave\", () => {\r\n            this.descTip?.remove();\r\n            this.descTip = null;\r\n          });\r\n\r\n          /* Position beside the cursor, clamped to viewport */\r\n          const pad = 8;\r\n          const w   = this.descTip.offsetWidth  || 200;\r\n          const h   = this.descTip.offsetHeight || 80;\r\n\r\n          let left = ev.clientX + 12;\r\n          let top  = ev.clientY + 12;\r\n\r\n          if (left + w > window.innerWidth - pad) {\r\n            left = Math.max(ev.clientX - w - 12, pad);\r\n          }\r\n          if (top + h > window.innerHeight - pad) {\r\n            top = Math.max(window.innerHeight - h - pad, pad);\r\n          }\r\n\r\n          this.descTip.style.left = `${left}px`;\r\n          this.descTip.style.top  = `${top}px`;\r\n        };\r\n\r\n        const hideTip = () => { this.descTip?.remove(); this.descTip = null; };\r\n\r\n        nameSpan.addEventListener(\"mouseenter\", showTip);\r\n        nameSpan.addEventListener(\"mouseleave\", hideTip);\r\n      }\r\n\r\n      /* rename */\r\n      const ren = li.createSpan({ cls: \"pm-port-ico\" });\r\n      setIcon(ren, \"pencil\");\r\n      attachTip(ren, \"Rename this portfolio\");\r\n      ren.onclick = async (e) => {\r\n        e.stopPropagation();\r\n        const newName = await new PromptModal(this.app, \"Rename portfolio\", p.name).prompt();\r\n        if (newName) {\r\n          p.name = newName;\r\n          await this.savePortfolio(p);\r\n          this.render();\r\n        }\r\n      };\r\n\r\n      /* delete */\r\n      const del = li.createSpan({ cls: \"pm-port-ico\" });\r\n      setIcon(del, \"trash\");\r\n      attachTip(del, \"Delete this portfolio\");\r\n      del.onclick = async (e) => {\r\n        e.stopPropagation();\r\n        if (confirm(`Delete portfolio “${p.name}”?\\nThis cannot be undone.`)) {\r\n          await this.deletePortfolio(p.id);\r\n          this.render();\r\n        }\r\n      };\r\n    }\r\n\r\n    /* ── Create Project and Task buttons under list ──────────────────── */\r\n    const createWrap = sidebar.createDiv({ cls: \"pm-create-proj\" });\r\n    \r\n    const createBtn  = createWrap.createEl(\"button\", { text: \"Create Project\" });\r\n    attachTip(createBtn, \"Create a new project in the selected folder\");\r\n\r\n    createBtn.onclick = () => {\r\n      new FolderSelectModal(this.app, async (folder) => {\r\n        if (!folder) return;                       // user cancelled\r\n\r\n        // 1) create the new project note\r\n        await (newProject as any)(this.app, folder);\r\n\r\n        // 2) give Obsidian a moment to index the note, then refresh\r\n        setTimeout(async () => {\r\n          await this.loadPortfolios();   // reload portfolio YAMLs\r\n          this.render();                 // re‑render sidebar + table\r\n        }, 250);\r\n      }).open();\r\n    };\r\n\r\n    const createTaskBtn = createWrap.createEl(\"button\", { text: \"Create Task\" });\r\n    attachTip(createTaskBtn, \"Create a new action item in an existing project\");\r\n\r\n    createTaskBtn.onclick = () => {\r\n      newActionItem(this.app, this.cache);\r\n    };\r\n\r\n    /* ---- main panel ---- */\r\n    const selected = this.portfolios.find((pf) => pf.id === this.selectedId);\r\n    if (!selected) {\r\n      panel.createEl(\"p\", { text: \"No portfolio selected. Create at least one portfolio to see any projects.\" });\r\n      return;\r\n    }\r\n\r\n    const titleRow = panel.createDiv({ cls: \"pm-port-title\", text: selected.name });\r\n    /* Column header row: Project | Category | Priority */\r\n    /*const colHead = panel.createDiv({ cls: \"pm-port-col-head\" });\r\n    [\"Project\", \"Category\", \"Priority\"].forEach((txt) =>\r\n      colHead.createEl(\"span\", { text: txt })\r\n    );*/\r\n    const openBtns = titleRow.createDiv({ cls: \"pm-port-open\" });\r\n\r\n    /* Calendar */\r\n    const calendarBtn = openBtns.createEl(\"button\");\r\n    const icoCalendar = calendarBtn.createSpan();\r\n    setIcon(icoCalendar, \"calendar-days\");\r\n    icoCalendar.style.marginRight = \"4px\";\r\n    calendarBtn.createSpan({ text: \"Calendar\" });\r\n    attachTip(calendarBtn, \"Open calendar view for this portfolio\");\r\n    calendarBtn.onclick = () => this.openCalendar();\r\n\r\n    /* Today */\r\n    const todayBtn = openBtns.createEl(\"button\");\r\n    const icoToday = todayBtn.createSpan();\r\n    setIcon(icoToday, \"calendar\");\r\n    icoToday.style.marginRight = \"4px\";\r\n    todayBtn.createSpan({ text: \"Today\" });\r\n    attachTip(todayBtn, \"Open today's task recommendations\");\r\n    todayBtn.onclick = () => this.openToday();\r\n\r\n    /* Dashboard */\r\n    const dashboardBtn = openBtns.createEl(\"button\");\r\n    const icoDashboard = dashboardBtn.createSpan();\r\n    setIcon(icoDashboard, \"pie-chart\");\r\n    icoDashboard.style.marginRight = \"4px\";\r\n    dashboardBtn.createSpan({ text: \"Dashboard\" });\r\n    attachTip(dashboardBtn, \"Open analytics dashboard for this portfolio\");\r\n    dashboardBtn.onclick = () => this.openDashboard();\r\n\r\n    /* Progress */\r\n    const dashBtn = openBtns.createEl(\"button\");\r\n    const icoDash = dashBtn.createSpan();\r\n    setIcon(icoDash, \"bar-chart-2\");\r\n    icoDash.style.marginRight = \"4px\";\r\n    dashBtn.createSpan({ text: \"Progress\" });\r\n    attachTip(dashBtn, \"Open progress dashboard for this portfolio\");\r\n    dashBtn.onclick = () => this.openProgress();\r\n\r\n    /* Timeline */\r\n    const tlBtn = openBtns.createEl(\"button\");\r\n    const icoTl = tlBtn.createSpan();\r\n    setIcon(icoTl, \"calendar-clock\");\r\n    icoTl.style.marginRight = \"4px\";\r\n    tlBtn.createSpan({ text: \"Timeline\" });\r\n    attachTip(tlBtn, \"Open timeline view for this portfolio\");\r\n    tlBtn.onclick = () => this.openTimeline();\r\n\r\n    /* Weekly view */\r\n    const wkBtn = openBtns.createEl(\"button\");\r\n    const icoWk = wkBtn.createSpan();\r\n    setIcon(icoWk, \"calendar-check\");\r\n    icoWk.style.marginRight = \"4px\";\r\n    wkBtn.createSpan({ text: \"Weekly\" });\r\n    attachTip(wkBtn, \"Open weekly task view for this portfolio\");\r\n    wkBtn.onclick = () => this.openTaskWeeks();\r\n\r\n    /* Resources */\r\n    const resBtn = openBtns.createEl(\"button\");\r\n    const icoRs = resBtn.createSpan();\r\n    setIcon(icoRs, \"users\");\r\n    icoRs.style.marginRight = \"4px\";\r\n    resBtn.createSpan({ text: \"Resources\" });\r\n    attachTip(resBtn, \"Open resources allocation view for this portfolio\");\r\n    resBtn.onclick = () => this.openResources();\r\n\r\n\r\n    /* Description textarea – row beneath the header buttons */\r\n    const descRow = panel.createDiv({ cls: \"pm-port-desc-row\" });\r\n    const descBox = (this.descBox = descRow.createEl(\"textarea\", {\r\n      cls: \"pm-port-desc\",\r\n      text: selected.description ?? \"\",\r\n      attr: { placeholder: \"Add a brief description…\" },\r\n    }));\r\n    if (selected.descHeight) descBox.style.height = `${selected.descHeight}px`;\r\n\r\n    const saveHeight = async () => {\r\n      const h = descBox.clientHeight;\r\n      if (h && h !== selected.descHeight) {\r\n        selected.descHeight = h;\r\n        await this.savePortfolio(selected);\r\n      }\r\n    };\r\n    /* Auto‑persist height whenever user resizes textarea */\r\n    const ro = new ResizeObserver(() => {\r\n      const h = descBox.clientHeight;\r\n      if (h && h !== selected.descHeight) {\r\n        selected.descHeight = h;\r\n        this.savePortfolio(selected);    // fire‑and‑forget; no await needed\r\n      }\r\n    });\r\n    ro.observe(descBox);\r\n    this.register(() => ro.disconnect());\r\n    const saveDesc = async () => {\r\n      selected.description = descBox.value.trim();\r\n      await this.savePortfolio(selected);        // persist YAML right away\r\n      await saveHeight();\r\n    };\r\n    descBox.addEventListener(\"change\", saveDesc);\r\n    descBox.addEventListener(\"blur\",   saveDesc);  // safety if user tabs away\r\n    // descBox.addEventListener(\"mouseup\", saveHeight);   // user finished resize\r\n\r\n    /* ---- project picker ---- */\r\n    const tbl = panel.createEl(\"table\", { cls: \"pm-port-proj-table\" });\r\n    const thead = tbl.createEl(\"thead\");\r\n    const headRow = thead.createEl(\"tr\");\r\n\r\n    headRow.createEl(\"th\");   // blank checkbox column\r\n\r\n    /* ---- Project ---- */\r\n    const nameHead  = headRow.createEl(\"th\", { cls: \"pm-click-sort\" });\r\n    nameHead.createSpan({ text: \"Project\" });\r\n    const icoName   = nameHead.createSpan({ cls: \"pm-sort-ico\" });\r\n    if (this.sortKey === \"name\") {\r\n      setIcon(icoName, this.sortDir === 1 ? \"chevron-up\" : \"chevron-down\");\r\n      icoName.style.opacity = \"\";\r\n    } else {\r\n      setIcon(icoName, \"chevrons-up-down\");\r\n      icoName.style.opacity = \"0.5\";\r\n    }\r\n    nameHead.onclick = () => this.toggleSort(\"name\");\r\n\r\n    /* ---- Area ---- */\r\n    const areaHead  = headRow.createEl(\"th\", { cls: \"pm-click-sort\" });\r\n    areaHead.createSpan({ text: \"Area\" });\r\n    const icoArea   = areaHead.createSpan({ cls: \"pm-sort-ico\" });\r\n    if (this.sortKey === \"area\") {\r\n      setIcon(icoArea, this.sortDir === 1 ? \"chevron-up\" : \"chevron-down\");\r\n      icoArea.style.opacity = \"\";\r\n    } else {\r\n      setIcon(icoArea, \"chevrons-up-down\");\r\n      icoArea.style.opacity = \"0.5\";\r\n    }\r\n    areaHead.onclick = () => this.toggleSort(\"area\");\r\n\r\n    /* ---- Priority ---- */\r\n    const prioHead  = headRow.createEl(\"th\", { cls: \"pm-click-sort\" });\r\n    prioHead.createSpan({ text: \"Priority\" });\r\n    const icoPrio   = prioHead.createSpan({ cls: \"pm-sort-ico\" });\r\n    if (this.sortKey === \"priority\") {\r\n      setIcon(icoPrio, this.sortDir === 1 ? \"chevron-up\" : \"chevron-down\");\r\n      icoPrio.style.opacity = \"\";\r\n    } else {\r\n      setIcon(icoPrio, \"chevrons-up-down\");\r\n      icoPrio.style.opacity = \"0.5\";\r\n    }\r\n    prioHead.onclick = () => this.toggleSort(\"priority\");\r\n\r\n    headRow.createEl(\"th\");   // blank actions column\r\n\r\n    const tbody = tbl.createEl(\"tbody\");\r\n\r\n    /* Build helper map for category / priority */\r\n    const projMeta = new Map<string, { cat: string; prio: number | null }>();\r\n    /* Normalise front‑matter keys: strip non‑letters and lowercase */\r\n    const normKey = (s: string) => s.replace(/[^a-z]/gi, \"\").toLowerCase();\r\n\r\n\r\n    for (const p of this.cache.projects.values()) {\r\n      const cacheFm = this.app.metadataCache.getFileCache(p.file)?.frontmatter ?? {};\r\n      const val = (key: string) => {\r\n        const want = normKey(key);\r\n        const found = Object.entries(cacheFm).find(\r\n          ([k]) => normKey(k) === want\r\n        );\r\n        return found ? found[1] : undefined;\r\n      };\r\n      const cat = (val(\"area\") as string) ?? p.file.parent?.name ?? \"—\";\r\n      const pr  = Number(val(\"priority\"));\r\n      projMeta.set(p.file.path, { cat, prio: isNaN(pr) ? null : pr });\r\n    }\r\n\r\n    const projects = Array.from(this.cache.projects.values()).sort((a, b) => {\r\n      const metaA = projMeta.get(a.file.path)!;\r\n      const metaB = projMeta.get(b.file.path)!;\r\n\r\n      if (this.sortKey === \"area\") {\r\n        return this.sortDir * metaA.cat.localeCompare(metaB.cat);\r\n      }\r\n      if (this.sortKey === \"priority\") {\r\n        return this.sortDir * ((metaA.prio ?? 999) - (metaB.prio ?? 999));\r\n      }\r\n      // default name\r\n      return this.sortDir * a.file.basename.localeCompare(b.file.basename);\r\n    });\r\n\r\n    for (const proj of projects) {\r\n      const isSelected = selected.projectPaths.includes(proj.file.path);\r\n      const row = tbody.createEl(\"tr\", { cls: isSelected ? \"active\" : \"\" });\r\n      if (!isSelected) row.style.opacity = \"0.5\";  // grey out unselected rows\r\n      const cellChk = row.createEl(\"td\");\r\n      const chk = cellChk.createEl(\"span\", { cls: \"pm-port-check\" });\r\n      chk.style.cursor = \"pointer\";\r\n      chk.style.display = \"inline-block\";\r\n      chk.style.width = \"16px\";\r\n      chk.style.height = \"16px\";\r\n      \r\n      // Set initial icon state\r\n      setIcon(chk, isSelected ? \"check-circle\" : \"circle\");\r\n      \r\n      chk.onclick = () => {\r\n        const newSelected = !selected.projectPaths.includes(proj.file.path);\r\n        if (newSelected) {\r\n          if (!selected.projectPaths.includes(proj.file.path))\r\n            selected.projectPaths.push(proj.file.path);\r\n          row.addClass(\"active\");\r\n          row.style.opacity = \"1\";\r\n          setIcon(chk, \"check-circle\");\r\n        } else {\r\n          selected.projectPaths = selected.projectPaths.filter(\r\n            (p) => p !== proj.file.path\r\n          );\r\n          row.removeClass(\"active\");\r\n          row.style.opacity = \"0.5\";\r\n          setIcon(chk, \"circle\");\r\n        }\r\n      };\r\n      // Name cell: clickable link opens the project note\r\n      const nameCell = row.createEl(\"td\");\r\n      const link = nameCell.createEl(\"a\", {\r\n        text: proj.file.basename,\r\n        cls: \"pm-port-proj-link\",\r\n        href: \"#\",\r\n      });\r\n      link.onclick = (e) => {\r\n        e.preventDefault();\r\n        this.app.workspace.openLinkText(proj.file.path, \"\", false);\r\n      };\r\n      /* ── Hover tooltip showing front‑matter ─────────────────────── */\r\n      let hoverEl: HTMLElement | null = null;\r\n\r\n      link.addEventListener(\"mouseenter\", () => {\r\n        const cache = this.app.metadataCache.getFileCache(proj.file);\r\n        const fm: Record<string, any> = cache?.frontmatter ?? {};\r\n\r\n        const get = (k: string) =>\r\n          fm[k] ??\r\n          fm[k.replace(/ /g, \"\").toLowerCase()] ??\r\n          \"—\";\r\n\r\n        const html = `\r\n          <strong>${proj.file.basename}</strong><br>\r\n          <em>${get(\"Description\")}</em><br>\r\n          <span>Start: ${get(\"Start Date\")}</span><br>\r\n          <span>Due  : ${get(\"End Date\") || get(\"Due Date\")}</span>\r\n        `;\r\n\r\n        hoverEl = document.createElement(\"div\");\r\n        hoverEl.classList.add(\"pm-port-tooltip\");\r\n        hoverEl.innerHTML = html;\r\n        document.body.appendChild(hoverEl);\r\n\r\n        const rect = link.getBoundingClientRect();\r\n        const pad  = 8;                              // gap from window edges\r\n\r\n        /* Default position: to the right of the link */\r\n        let left = rect.right + 8;\r\n        let top  = rect.top;\r\n\r\n        /* Measure tooltip after it’s in the DOM */\r\n        const tipW = hoverEl.offsetWidth  || 220;    // fallback width\r\n        const tipH = hoverEl.offsetHeight || 140;    // fallback height\r\n\r\n        /* Horizontal overflow – flip to left side */\r\n        if (left + tipW > window.innerWidth - pad) {\r\n          left = Math.max(rect.left - tipW - 8, pad);\r\n        }\r\n\r\n        /* Vertical overflow – clamp within viewport */\r\n        if (top + tipH > window.innerHeight - pad) {\r\n          top = Math.max(window.innerHeight - tipH - pad, pad);\r\n        }\r\n\r\n        hoverEl.style.left = `${left}px`;\r\n        hoverEl.style.top  = `${top}px`;\r\n      });\r\n\r\n      link.addEventListener(\"mouseleave\", () => {\r\n        hoverEl?.remove();\r\n        hoverEl = null;\r\n      });\r\n\r\n      /* ----------------------------------------------------------------\r\n         Pull fresh front‑matter from Obsidian’s metadata cache           */\r\n      const cache = this.app.metadataCache.getFileCache(proj.file);\r\n      const fm: Record<string, any> = cache?.frontmatter ?? {};\r\n\r\n      /**\r\n       * Grab a front‑matter value using case‑insensitive comparison and by\r\n       * stripping non‑letter characters (so “Priority” or “priority::” both match).\r\n       */\r\n      const fmVal = (want: string) => {\r\n        const norm = (s: string) => s.replace(/[^a-z]/gi, \"\").toLowerCase();\r\n        const wantNorm = norm(want);\r\n        for (const [k, v] of Object.entries(fm)) {\r\n          if (norm(k) === wantNorm) {\r\n            if (typeof v === \"string\" || typeof v === \"number\") return v;\r\n            if (Array.isArray(v)) return v.join(\", \");\r\n          }\r\n        }\r\n        return undefined;\r\n      };\r\n\r\n      const meta = projMeta.get(proj.file.path)!;\r\n      row.createEl(\"td\", { text: meta.cat });\r\n\r\n      const prioText = meta.prio !== null ? String(meta.prio) : \"—\";\r\n      row.createEl(\"td\", { text: prioText });\r\n\r\n      /* Actions: open this single project in Dashboard or Timeline */\r\n      const actCell = row.createEl(\"td\", { cls: \"pm-port-actions\" });\r\n\r\n      const icoDash = actCell.createSpan();\r\n      setIcon(icoDash, \"bar-chart-2\");        // new bar‑chart icon\r\n      icoDash.classList.add(\"clickable-icon\");\r\n      attachTip(icoDash, \"Open Progress\");    // updated tooltip\r\n      icoDash.onclick = () => this.openDashboardFor([proj.file.path]);\r\n\r\n      const icoTl = actCell.createSpan();\r\n      setIcon(icoTl, \"calendar-clock\");\r\n      icoTl.classList.add(\"clickable-icon\");\r\n      attachTip(icoTl, \"Open Timeline\");\r\n      icoTl.onclick = () => this.openTimelineFor([proj.file.path]);\r\n\r\n      const icoWk = actCell.createSpan();\r\n      setIcon(icoWk, \"calendar-check\");\r\n      icoWk.classList.add(\"clickable-icon\");\r\n      attachTip(icoWk, \"Open Weekly\");\r\n      icoWk.onclick = () => this.openTaskWeeksFor([proj.file.path]);\r\n\r\n      const icoRes = actCell.createSpan();\r\n      setIcon(icoRes, \"users\");\r\n      icoRes.classList.add(\"clickable-icon\");\r\n      attachTip(icoRes, \"Open Resources\");\r\n      icoRes.onclick = () => this.openResourcesFor([proj.file.path]);\r\n    }\r\n\r\n    const saveBtn = panel.createEl(\"button\", { text: \"Save\", cls: \"pm-port-save\" });\r\n    saveBtn.onclick = async () => {\r\n      await saveHeight();                   // capture latest resize first\r\n      await this.savePortfolio(selected);   // writes YAML + reloads list\r\n      this.render();                        // re-render UI with latest data\r\n      new Notice(\"Portfolio saved\");\r\n    };\r\n    attachTip(saveBtn, \"Save description, layout and selection changes\");\r\n  }\r\n  /** Open Dashboard filtered to the supplied project paths */\r\n  private async openDashboardFor(paths: string[]) {\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_PROGRESS)[0];\r\n    if (!leaf) {\r\n      leaf = this.app.workspace.getLeaf();\r\n    }\r\n\r\n    // Type-safe: only use basename if TFile\r\n    const projFile = paths.length === 1\r\n      ? this.app.vault.getFileByPath(paths[0])\r\n      : null;\r\n    const projName = projFile instanceof TFile ? projFile.basename : \"\";\r\n\r\n    if (leaf) {\r\n      await leaf.setViewState({\r\n        type:   VIEW_TYPE_PM_PROGRESS,\r\n        active: true,\r\n        state:  {\r\n          filterProjects: paths,\r\n          filterName:     projName,          // \"Progress - <project>\"\r\n        },\r\n      });\r\n\r\n      const view: any = leaf.view;\r\n      if (view?.updateFilter) view.updateFilter(paths, projName);\r\n\r\n      this.app.workspace.revealLeaf(leaf);\r\n    }\r\n  }\r\n\r\n  /** Open Timeline filtered to the supplied project paths */\r\n  private async openTimelineFor(paths: string[]) {\r\n    /* Re‑use an existing Timeline pane if the setting is enabled */\r\n    let leaf: WorkspaceLeaf | undefined;\r\n    if (this.settings.reuseTimelinePane) {\r\n      leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE)[0];\r\n    }\r\n    if (!leaf) leaf = this.app.workspace.splitActiveLeaf(\"horizontal\");\r\n\r\n    const projFile = paths.length === 1\r\n      ? this.app.vault.getFileByPath(paths[0])\r\n      : null;\r\n    const projName = projFile instanceof TFile ? projFile.basename : \"\";\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_TIMELINE,\r\n      active: true,\r\n      state:  {\r\n        filterProjects: paths,\r\n        filterName:     projName,\r\n      },\r\n    });\r\n\r\n    const view: any = leaf.view;\r\n    if (view?.updateFilter) view.updateFilter(paths, projName);\r\n\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n  /** Open Task Weeks filtered to the current portfolio */\r\n  private async openTaskWeeks() {\r\n    const sel    = this.portfolios.find((pf) => pf.id === this.selectedId);\r\n    const filter = sel?.projectPaths ?? [];\r\n\r\n    // Re-use existing leaf, or create a new bottom pane if none exists\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TASKWEEKS)[0];\r\n\r\n    if (!leaf) {\r\n      // No Task‑Weeks view open yet → create a new bottom pane\r\n      leaf = this.app.workspace.splitActiveLeaf(\"horizontal\");\r\n    }\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_TASKWEEKS,\r\n      active: true,\r\n      state:  {\r\n        filterProjects: filter,\r\n        filterName:     sel?.name ?? \"\",\r\n      },\r\n    });\r\n\r\n    const view: any = leaf.view;\r\n    if (view?.updateFilter) view.updateFilter(filter, sel?.name ?? \"\");\r\n\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  /** Open Task Weeks filtered to the supplied project paths */\r\n  private async openTaskWeeksFor(paths: string[]) {\r\n    /* Re‑use an existing Task‑Weeks pane only if the setting is enabled */\r\n    let leaf: WorkspaceLeaf | undefined;\r\n    if (this.settings.reuseTaskWeeksPane) {\r\n      leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TASKWEEKS)[0];\r\n    }\r\n    if (!leaf) leaf = this.app.workspace.splitActiveLeaf(\"horizontal\");\r\n\r\n    const projFile = paths.length === 1\r\n      ? this.app.vault.getFileByPath(paths[0])\r\n      : null;\r\n    const projName = projFile instanceof TFile ? projFile.basename : \"\";\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_TASKWEEKS,\r\n      active: true,\r\n      state:  {\r\n        filterProjects: paths,\r\n        filterName:     projName,\r\n      },\r\n    });\r\n\r\n    const view: any = leaf.view;\r\n    if (view?.updateFilter) view.updateFilter(paths, projName);\r\n\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  /** Open Resources view filtered to current portfolio */\r\n  private async openResources() {\r\n    const sel    = this.portfolios.find((pf) => pf.id === this.selectedId);\r\n    const filter = sel?.projectPaths ?? [];\r\n\r\n    /* Prefer an existing Resources leaf; otherwise open in bottom pane */\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_RESOURCES)[0];\r\n\r\n    if (!leaf) {\r\n      // Create a new horizontal split (bottom pane)\r\n      leaf = this.app.workspace.splitActiveLeaf(\"horizontal\");\r\n    }\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_RESOURCES,\r\n      active: true,\r\n      state:  {\r\n        filterProjects: filter,\r\n        filterName:     sel?.name ?? \"\",\r\n      },\r\n    });\r\n\r\n    const view: any = leaf.view;\r\n    if (view?.updateFilter) view.updateFilter(filter, sel?.name ?? \"\");\r\n\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  /** Open Resources view filtered to the supplied project paths */\r\n  private async openResourcesFor(paths: string[]) {\r\n    /* Re‑use an existing Resources pane only if the setting is enabled */\r\n    let leaf: WorkspaceLeaf | undefined;\r\n    if (this.settings.reuseResourcesPane) {\r\n      leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_RESOURCES)[0];\r\n    }\r\n    if (!leaf) leaf = this.app.workspace.splitActiveLeaf(\"horizontal\");\r\n\r\n    const projFile = paths.length === 1\r\n      ? this.app.vault.getFileByPath(paths[0])\r\n      : null;\r\n    const projName = projFile instanceof TFile ? projFile.basename : \"\";\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_RESOURCES,\r\n      active: true,\r\n      state:  {\r\n        filterProjects: paths,\r\n        filterName:     projName,\r\n      },\r\n    });\r\n\r\n    const view: any = leaf.view;\r\n    if (view?.updateFilter) view.updateFilter(paths, projName);\r\n\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n}\r\n","import { App, TFile, ListItemCache, CachedMetadata } from \"obsidian\";\r\nimport { PmSettings } from \"../../settings\";\r\nimport type ProjectManagementPlugin from \"../main\";\r\n\r\n/** One milestone row extracted from a Markdown table */\r\nexport interface Milestone {\r\n  id: string;\r\n  title: string;\r\n  date: string;      // ISO YYYY-MM-DD\r\n  desc?: string;\r\n  /** vault‑relative path of the note that owns this milestone row */\r\n  file: string;\r\n}\r\n\r\n/** A single markdown checkbox (task) inside any project note */\r\nexport interface TaskItem {\r\n  /** Obsidian-generated block id (e.g. ^abc123) – unique inside a vault  */\r\n  id: string;\r\n  file: TFile;\r\n  line: number;\r\n  text: string;\r\n  props: Record<string, string>;\r\n  checked: boolean;\r\n  /** block IDs this task depends on (parsed from `depends:: ^id1, ^id2`) */\r\n  depends: string[];\r\n  /**\r\n   * Status of the task, derived from checkbox:\r\n   * - \"not-started\": [ ]\r\n   * - \"in-progress\": [/]\r\n   * - \"on-hold\": [-]\r\n   * - \"done\": [x] or [X]\r\n   */\r\n  status: \"not-started\" | \"in-progress\" | \"on-hold\" | \"done\";\r\n}\r\n\r\n/** Aggregated data for one project note */\r\nexport interface ProjectEntry {\r\n  file: TFile;\r\n  tasks: TaskItem[];\r\n  /** 0 ⇢ 1 numeric ratio */\r\n  percentComplete: number;\r\n  /** ISO date of the next open task or undefined */\r\n  nextDue?: string;\r\n    /** Number of completed tasks in the project (dashboard) */\r\n  completedTasks?: number;\r\n  /** Total number of tasks in the project (dashboard) */\r\n  totalTasks?: number;\r\n}\r\n\r\n/**\r\n * Central in-memory index of every project & task.\r\n * All UI views should read from here instead of scanning metadata directly.\r\n */\r\nexport class ProjectCache {\r\n  private app: App;\r\n  private plugin: ProjectManagementPlugin; // Reference to the main plugin instance\r\n\r\n  /** Dev‑tools helpers: dumpRows, dumpHeaders */\r\n  public _debug: {\r\n    dumpRows: (path: string) => Promise<void>;\r\n    dumpHeaders: (path: string) => Promise<void>;\r\n  };\r\n\r\n  /** path → project entry */\r\n  public projects = new Map<string, ProjectEntry>();\r\n\r\n  /** blockId → task (quick lookup for DnD, status moves, etc.) */\r\n  public tasks = new Map<string, TaskItem>();\r\n\r\n  /** Global milestone list (across all project notes) */\r\n  public milestones: Milestone[] = [];\r\n\r\n  /** simple event system so views can react to changes  */\r\n  private listeners = new Set<() => void>();\r\n\r\n  /** Compose a unique key from vault‑path + task id (lower‑cased) */\r\n  private makeTaskKey(filePath: string, id: string): string {\r\n    return `${filePath.toLowerCase()}::${id.toLowerCase()}`;\r\n  }\r\n  constructor(app: App, plugin: ProjectManagementPlugin) {\r\n    this.app = app;\r\n    this.plugin = plugin;\r\n\r\n    /* ── dev‑tools helper ───────────────────────────────────────────── *\r\n     * In DevTools you can now run:\r\n     *   pmPlugin.cache._debug.dumpRows(\"path/to/file.md\")\r\n     *   pmPlugin.cache._debug.dumpHeaders(\"path/to/file.md\")\r\n     * ---------------------------------------------------------------- */\r\n    this._debug = {\r\n      /** Print every pipe‑table row that contains a checkbox bullet */\r\n      dumpRows: async (filePath: string) => {\r\n        const file = this.app.vault.getFileByPath(filePath);\r\n        if (!file || !(file instanceof TFile)) return;\r\n        const lines = (await this.app.vault.read(file)).split(\"\\n\");\r\n        lines\r\n          .filter(l => /^\\s*\\|.*-\\s*\\[[ xX/]\\]/.test(l))\r\n\r\n      },\r\n\r\n      /** Show the header cells Obsidian thinks this table has */\r\n      dumpHeaders: async (filePath: string) => {\r\n        const file = this.app.vault.getFileByPath(filePath);\r\n        if (!file || !(file instanceof TFile)) return;\r\n        const lines = (await this.app.vault.read(file)).split(\"\\n\");\r\n        const hdr = lines.find(l => /^\\s*\\|\\s*id\\s*\\|/i.test(l));\r\n        if (!hdr) return;\r\n        const cells = hdr.split(\"|\").map(c => c.replace(/\\u00A0/g,\" \").trim());\r\n\r\n      },\r\n    };\r\n  }\r\n\r\n  /** Subscribe – returns an unsubscribe fn */\r\n  onChange(cb: () => void): () => void {\r\n    this.listeners.add(cb);\r\n    return () => this.listeners.delete(cb);\r\n  }\r\n  private notify() {\r\n    this.listeners.forEach((f) => f());\r\n  }\r\n\r\n  /** Full vault scan – call on plugin load & on 'metadata-resolved' */\r\n  async reindex() {\r\n    this.projects.clear();\r\n    this.tasks.clear();\r\n    this.milestones = [];\r\n\r\n    const files = this.app.vault.getMarkdownFiles();\r\n    for (const file of files) {\r\n      const meta = this.app.metadataCache.getFileCache(file);\r\n      const flag = this.plugin.settings.projectFlagProperty || \"project\";\r\n      if (!meta?.frontmatter || !meta.frontmatter[flag]) continue;\r\n\r\n      const fileLines = (await this.app.vault.read(file)).split(\"\\n\");\r\n\r\n      const tasks: TaskItem[] = [];\r\n\r\nmeta.listItems?.forEach((item: any) => {\r\n  /* -----------------------------------------------------------\r\n     Recognise tasks that live *inside* Markdown tables.\r\n     Obsidian's `item.task` is undefined for those, so fall back\r\n     to a regex on the source line.\r\n  ----------------------------------------------------------- */\r\n  const firstLineRaw = fileLines[item.position.start.line] ?? \"\";\r\n  // Accept [ ], [x], [X], [/], or [-] for open/in-progress/on-hold/done states\r\n  const tableTaskMatch = /^\\s*\\|.*-\\s*\\[[ xX/\\-]\\]/.test(firstLineRaw);\r\n\r\n  if (!item.task && !tableTaskMatch) return;        // not a task at all\r\n\r\n  /* ---------- pull the full list-item block (can span multiple lines) ---------- */\r\n  const startIdx = item.position.start.line;\r\n  const endIdx   = (item.position.end?.line ?? startIdx);\r\n  let rawBlock   = fileLines.slice(startIdx, endIdx + 1).join(\"\\n\");\r\n\r\n  // Normalize whitespace + NBSP\r\n  rawBlock = rawBlock.replace(/\\u00A0/g, \" \").replace(/\\s+\\n/g, \"\\n\");\r\n\r\n  // First line (with checkbox) for props parsing\r\n  const firstLine = fileLines[startIdx] ?? \"\";\r\n\r\n  const props: Record<string, string> = {};\r\n  /* ---------- collect props ---------- */\r\n  // 1) attributes array provided by Obsidian (may be stale immediately after edit)\r\n  (item.attributes ?? []).forEach((attr: any) => {\r\n    props[attr.key.toLowerCase()] = String(attr.value);\r\n  });\r\n\r\n  // 2) Parse inline props anywhere in the *table row*, even after a pipe.\r\n  //    We join the first line of the row (which contains all cells) with\r\n  //    the full list‑item block so props on continuation lines still count.\r\n  //\r\n  //    Reg‑exp stops at whitespace **or** a pipe, so\r\n  //      due:: 2025-07-31 |\r\n  //    is captured as due ⇒ 2025-07-31\r\n  //\r\n  const rowText = fileLines[startIdx] ?? \"\";\r\n  [...rowText.matchAll(/([A-Za-z0-9_-]+)::\\s*([^|\\n]+)/g)]\r\n    .forEach(([, k, v]) => (props[k.toLowerCase()] = v.trim()));\r\n\r\n  // 2b) If this list‑item lives inside a pipe table, pull the “Description” cell\r\n  if (rowText.includes(\"|\")) {\r\n    const cells = rowText.split(\"|\").map(c => c.replace(/\\u00A0/g, \" \").trim());\r\n    if (cells.length && cells[0] === \"\") cells.shift();                    // leading pipe\r\n    if (cells.length && cells[cells.length - 1] === \"\") cells.pop();       // trailing pipe\r\n    \r\n\r\n    \r\n    // Extract epic reference from table structure (for stories)\r\n    if (cells.length >= 2 && cells[1] && cells[1].trim().match(/^[Ee]-\\d+$/)) {\r\n      props[\"epic\"] = cells[1].trim();\r\n    }\r\n    \r\n    // Extract story reference from table structure (for subtasks)\r\n    if (cells.length >= 2 && cells[1] && cells[1].trim().match(/^[Ss]-\\d+$/)) {\r\n      props[\"story\"] = cells[1].trim();\r\n    }\r\n    \r\n    // Extract priority from table cells\r\n    for (let i = 0; i < cells.length; i++) {\r\n      const cell = cells[i].toLowerCase().trim();\r\n      if (['critical', 'crit', 'c', 'p0', 'highest', 'high', 'h', '1', 'p1', 'medium', 'med', 'm', '2', 'p2', 'low', 'l', '3', 'p3'].includes(cell)) {\r\n        props[\"priority\"] = cells[i].trim();\r\n        break;\r\n      }\r\n    }\r\n    \r\n    /* Heuristic: walk from right to left until we find the first non‑date cell */\r\n    const dateRe = /^\\d{4}-\\d{2}-\\d{2}$/;\r\n    for (let i = cells.length - 1; i >= 2; i--) {  // skip ID + Summary columns\r\n      const cand = cells[i];\r\n      if (cand && !dateRe.test(cand)) {\r\n        props[\"description\"] = cand;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  // 3) Parse Tasks plugin emoji dates (🔜 ⏳ 📅 ✅ 🛫) – tolerate NBSPs, tabs, newlines\r\n  [...rawBlock.matchAll(/([🔜⏳📅✅🛫])\\uFE0F?[\\u00A0 \\t\\r\\n]*([0-9]{4}-[0-9]{2}-[0-9]{2})/gu)]\r\n    .forEach(([, icon, date]) => {\r\n      let d = date.trim();  // strip trailing NBSP/newlines\r\n      switch (icon) {\r\n        case \"🔜\":   // start\r\n        case \"⏳\":   // scheduled\r\n        case \"🛫\":   // plane takeoff as start\r\n          props[\"start\"] = d;\r\n          break;\r\n        case \"📅\":   // due\r\n          props[\"due\"] = d;\r\n          break;\r\n        case \"✅\":   // done / completion\r\n          props[\"done\"] = d;\r\n          break;\r\n      }\r\n    });\r\n\r\n  /* ---------- dependency list ---------- */\r\n  const depends: string[] = [];\r\n  const depAttr = props[\"depends\"];\r\n  if (depAttr) {\r\n    depAttr.split(/[, ]+/).forEach((d) => {\r\n      const id = d.replace(/^\\^/, \"\").trim().toLowerCase();\r\n      if (id) depends.push(id);\r\n    });\r\n  }\r\n\r\n  /* ---------- derive text, checked, and status ---------- */\r\n  const stripped = rawBlock\r\n    .replace(/^\\s*\\|?\\s*/g, \"\")            // drop leading pipe / whitespace\r\n    .replace(/^\\s*-\\s*\\[[\\sxX/\\-]\\]\\s*/, \"\")  // remove leading checkbox (includes /, -)\r\n    .replace(/(\\w+)::\\s*[^\\s]+/g, \"\")      // drop inline props\r\n    .trim();\r\n  // Only [x] or [X] is checked; [/] is in-progress, [-] is on-hold but not checked\r\n  const isChecked =\r\n    Boolean(item.task?.checked) || /\\-\\s*\\[[xX]\\]/.test(firstLineRaw);\r\n  // Status: [x] or [X] = done, [/] = in-progress, [-] = on-hold, else not-started\r\n  let status: \"not-started\" | \"in-progress\" | \"on-hold\" | \"done\";\r\n  if (/\\-\\s*\\[[xX]\\]/.test(firstLineRaw)) {\r\n    status = \"done\";\r\n  } else if (/\\-\\s*\\[\\/\\]/.test(firstLineRaw)) {\r\n    status = \"in-progress\";\r\n  } else if (/\\-\\s*\\[\\-\\]/.test(firstLineRaw)) {\r\n    status = \"on-hold\";\r\n  } else {\r\n    status = \"not-started\";\r\n  }\r\n\r\n  /* ---------- assemble task ---------- */\r\n  const task: TaskItem = {\r\n    id: item.id ?? `${file.path}-${item.position?.start?.line}`,\r\n    file,\r\n    line: item.position.start.line,\r\n    text: stripped || \"(no text)\",\r\n    props,\r\n    checked: isChecked,\r\n    depends,\r\n    status,\r\n  };\r\n\r\n  tasks.push(task);\r\n  this.tasks.set(this.makeTaskKey(file.path, task.id), task);\r\n});\r\n\r\n/* ============================================================\r\n   Fallback: Obsidian’s metadataCache skips tasks inside tables\r\n   in some versions.  Scan each line for a checklist bullet\r\n   inside a table row that we haven’t already collected.\r\n============================================================ */\r\nfileLines.forEach((line, idx) => {\r\n  // pattern: | … - [ ] … |, allow [ ], [x], [X], [/], [-] for all statuses\r\n  if (!/^\\s*\\|.*-\\s*\\[[ xX/\\\\-]\\]/.test(line)) return;\r\n\r\n  // avoid duplicates (if future versions start emitting listItems)\r\n  if (tasks.find(t => t.line === idx)) return;\r\n\r\n  const props: Record<string, string> = {};\r\n\r\n  // capture inline props across the row\r\n  [...line.matchAll(/([A-Za-z0-9_-]+)::\\s*([^|\\n]+)/g)]\r\n    .forEach(([, k, v]) => (props[k.toLowerCase()] = v.trim()));\r\n\r\n  // Also capture the “Description” cell from this pipe row\r\n  if (line.includes(\"|\")) {\r\n    const cells = line.split(\"|\").map(c => c.replace(/\\u00A0/g, \" \").trim());\r\n    if (cells.length && cells[0] === \"\") cells.shift();\r\n    if (cells.length && cells[cells.length - 1] === \"\") cells.pop();\r\n\r\n    // Extract epic reference from table structure (for stories)\r\n    if (cells.length >= 2 && cells[1] && cells[1].trim().match(/^[Ee]-\\d+$/)) {\r\n      props[\"epic\"] = cells[1].trim();\r\n    }\r\n    \r\n    // Extract story reference from table structure (for subtasks)\r\n    if (cells.length >= 2 && cells[1] && cells[1].trim().match(/^[Ss]-\\d+$/)) {\r\n      props[\"story\"] = cells[1].trim();\r\n    }\r\n\r\n    // Extract priority from table cells\r\n    for (let i = 0; i < cells.length; i++) {\r\n      const cell = cells[i].toLowerCase().trim();\r\n      if (['critical', 'crit', 'c', 'p0', 'highest', 'high', 'h', '1', 'p1', 'medium', 'med', 'm', '2', 'p2', 'low', 'l', '3', 'p3'].includes(cell)) {\r\n        props[\"priority\"] = cells[i].trim();\r\n        break;\r\n      }\r\n    }\r\n\r\n    const dateRe = /^\\d{4}-\\d{2}-\\d{2}$/;\r\n    for (let i = cells.length - 1; i >= 2; i--) {\r\n      const cand = cells[i];\r\n      if (cand && !dateRe.test(cand)) {\r\n        props[\"description\"] = cand;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  /* ---------- dependency list ---------- */\r\n  const depends: string[] = [];\r\n  const depAttr = props[\"depends\"];\r\n  if (depAttr) {\r\n    depAttr.split(/[, ]+/).forEach((d) => {\r\n      const id = d.replace(/^\\^/, \"\").trim().toLowerCase();\r\n      if (id) depends.push(id);\r\n    });\r\n  }\r\n\r\n  const cells = line.split(\"|\").map(c => c.trim());\r\n\r\n  // derive checked state, status, and stripped text\r\n  // Only [x] or [X] is checked; [/] is in-progress but not checked\r\n  const isChecked = /\\-\\s*\\[[xX]\\]/.test(line);\r\n  let status: \"not-started\" | \"in-progress\" | \"on-hold\" | \"done\";\r\n  if (/\\-\\s*\\[[xX]\\]/.test(line)) {\r\n    status = \"done\";\r\n  } else if (/\\-\\s*\\[\\/\\]/.test(line)) {\r\n    status = \"in-progress\";\r\n  } else if (/\\-\\s*\\[\\-\\]/.test(line)) {\r\n    status = \"on-hold\";\r\n  } else {\r\n    status = \"not-started\";\r\n  }\r\n  const stripped  = line\r\n    .replace(/^\\s*\\|.*?-\\s*\\[[\\sxX\\/\\-]\\]\\s*/, \"\")   // from bullet to first cell (includes /, -)\r\n    .replace(/\\|.*/, \"\")                         // drop remaining cells\r\n    .replace(/(\\w+)::\\s*[^|]+/g, \"\")             // drop inline props\r\n    .trim();\r\n\r\n  /* -------------------------------------------------------------\r\n     Block‑ID precedence for table rows\r\n     1. Caret at end of row  (^s-1)\r\n     2. First column text    (e.g. \"S-1\", \"SB-3\", \"E-1\")\r\n     3. Fallback synthetic   (file‑path + line)\r\n  ------------------------------------------------------------- */\r\n  // #1 caret suffix\r\n  let id: string | undefined;\r\n  const caretMatch = line.match(/\\^([A-Za-z0-9_-]+)\\s*$/);\r\n  if (caretMatch) id = caretMatch[1];\r\n\r\n  // #2 ID column\r\n  if (!id) {\r\n    const idCell = line.match(/^\\s*\\|\\s*([A-Za-z0-9_-]+)\\s*\\|/);\r\n    if (idCell) id = idCell[1];\r\n  }\r\n\r\n  // #3 synthetic fallback\r\n  if (!id) id = `${file.path}-row-${idx}`;\r\n\r\n  id = id.toLowerCase();   // ensure consistent matching for depends arrows\r\n\r\n  const task: TaskItem = {\r\n    id,\r\n    file,\r\n    line: idx,\r\n    text: stripped || \"(no text)\",\r\n    props,\r\n    checked: isChecked,\r\n    depends,\r\n    status,\r\n  };\r\n\r\n  tasks.push(task);\r\n  this.tasks.set(this.makeTaskKey(file.path, task.id), task);\r\n\r\n  /* ---------- collect Milestones table (ID | Title | Date ...) ---------- */\r\n  fileLines.forEach((line, idx) => {\r\n    // Detect header row\r\n    if (!/^\\s*\\|/.test(line)) return; // must start with pipe\r\n    if (!/\\bDate\\b/i.test(line)) return; // includes \"Date\"\r\n    if (!/\\bTitle\\b/i.test(line)) return; // includes \"Title\"\r\n\r\n    // iter subsequent rows until blank / no pipe\r\n    for (let r = idx + 1; r < fileLines.length; r++) {\r\n      const row = fileLines[r];\r\n      if (!/^\\s*\\|/.test(row)) break;       // end of table\r\n\r\n      const cells = row.split(\"|\").map(c => c.trim());\r\n      if (cells.length < 4) continue;\r\n\r\n      const id    = cells[1] ?? \"\";\r\n      const title = cells[2] ?? \"\";\r\n      const date  = cells[3] ?? \"\";\r\n      const desc  = cells[4] ?? \"\";\r\n\r\n      if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) continue;\r\n\r\n      this.milestones.push({ id, title, date, desc, file: file.path });\r\n    }\r\n  });\r\n});\r\n\r\n      const done = tasks.filter((t) => t.checked).length;\r\n      const percentComplete = tasks.length === 0 ? 1 : done / tasks.length;\r\n\r\n      // compute nearest open due date\r\n      let nextDue: string | undefined;\r\n      tasks.forEach((t) => {\r\n        const due = t.props[this.plugin.settings.dueProperty];\r\n        if (due && !t.checked && (!nextDue || due < nextDue)) nextDue = due;\r\n      });\r\n\r\n      this.projects.set(file.path, { file, tasks, percentComplete, nextDue });\r\n    }\r\n\r\n    this.notify();\r\n  }\r\n\r\n  // ---------- helpers ----------------------------------------------------\r\n\r\n  getProject(filePath: string): ProjectEntry | undefined {\r\n    return this.projects.get(filePath);\r\n  }\r\n\r\n  /**\r\n   * Get a task by raw id. If duplicate IDs exist, returns the *first* match.\r\n   * Prefer makeTaskKey(file,id) when you know the file path.\r\n   */\r\n  getTask(taskId: string): TaskItem | undefined {\r\n    // direct hit with composite key\r\n    if (this.tasks.has(taskId)) return this.tasks.get(taskId);\r\n    // else fall back: scan by id suffix\r\n    for (const [key, task] of this.tasks) {\r\n      if (key.endsWith(`::${taskId.toLowerCase()}`)) return task;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Update a task’s metadata & persist to disk.\r\n   * Only supports simple inline attributes for now (e.g. `due:: 2025-08-01`).\r\n   */\r\n  async updateTask(\r\n    taskId: string,\r\n    changes: Partial<\r\n      TaskItem[\"props\"] & { checked?: boolean; text?: string }\r\n    >\r\n  ) {\r\n    const task = this.tasks.get(taskId);\r\n    if (!task) return;\r\n\r\n    const fileText = await this.app.vault.read(task.file);\r\n    const lines = fileText.split(\"\\n\");\r\n    let line = lines[task.line];\r\n\r\n    // Checkbox state\r\n    if (typeof changes.checked === \"boolean\") {\r\n      line = line.replace(\r\n        /^\\s*-\\s*\\[[ xX]\\]/,\r\n        `- [${changes.checked ? \"x\" : \" \"}]`\r\n      );\r\n      task.checked = changes.checked;\r\n    }\r\n    // Raw text\r\n    if (changes.text !== undefined) {\r\n      line = line.replace(/\\](.*?)(\\^\\w+)?$/, `] ${changes.text} ${task.id}`);\r\n      task.text = changes.text;\r\n    }\r\n\r\n    // Inline props\r\n    const propKeys = Object.keys(changes).filter(\r\n      (k) => k !== \"checked\" && k !== \"text\"\r\n    );\r\n    if (propKeys.length) {\r\n      const nextLineIdx = task.line + 1;\r\n      let attrLine = lines[nextLineIdx] ?? \"\";\r\n      propKeys.forEach((k) => {\r\n        const val = changes[k as keyof typeof changes];\r\n        if (val === undefined) return;\r\n        const regex = new RegExp(`${k}::\\\\s*[^\\\\s]+`);\r\n        if (regex.test(attrLine)) {\r\n          attrLine = attrLine.replace(regex, `${k}:: ${val}`);\r\n        } else {\r\n          attrLine += `  ${k}:: ${val}`;\r\n        }\r\n        task.props[k] = val;\r\n      });\r\n      lines[nextLineIdx] = attrLine;\r\n    }\r\n\r\n    // Write file back & refresh cache\r\n    lines[task.line] = line;\r\n    await this.app.vault.modify(task.file, lines.join(\"\\n\"));\r\n    await this.reindex();\r\n  }\r\n\r\n  /**\r\n   * Convenience: move task to a new status value.\r\n   * Relies on a scalar `status` property key in settings.\r\n   */\r\n  async moveTaskToStatus(taskId: string, status: string) {\r\n    await this.updateTask(taskId, { [this.plugin.settings.statusProperty]: status });\r\n  }\r\n\r\n  /**\r\n   * Get all project files from the cache\r\n   */\r\n  async getProjectFiles(): Promise<TFile[]> {\r\n    return Array.from(this.projects.values()).map(project => project.file);\r\n  }\r\n\r\n  /**\r\n   * Get tasks for a specific project\r\n   */\r\n  getProjectTasks(projectPath: string): TaskItem[] {\r\n    const project = this.projects.get(projectPath);\r\n    return project ? project.tasks : [];\r\n  }\r\n}\r\n","import { App, PluginSettingTab, Setting } from \"obsidian\";\r\nimport type ProjectManagementPlugin from \"./src/main\";\r\nimport { VIEW_TYPE_PM_PROGRESS }  from \"./src/views/progress\";\r\nimport { VIEW_TYPE_PM_TIMELINE }  from \"./src/views/timeline\";\r\nimport { VIEW_TYPE_PM_TASKWEEKS } from \"./src/views/task_weeks\";\r\nimport { VIEW_TYPE_PM_RESOURCES } from \"./src/views/resources\";\r\nimport { VIEW_TYPE_PM_PORTFOLIO } from \"./src/views/portfolio\";\r\n\r\nexport interface PmSettings {\r\n  // ===== Core Properties =====\r\n  statusProperty: string;\r\n  dueProperty: string;\r\n  ownerProperty: string;\r\n  /** Front‑matter boolean key that marks a note as a Project (default: \"project\") */\r\n  projectFlagProperty: string;\r\n  /** Vault‑relative path to a markdown file that will be used as the template\r\n   *  when `New Project` creates a project note.  Blank = use the built‑in\r\n   *  default template bundled with the plugin. */\r\n  projectTemplate: string;\r\n  statusValues: string[];\r\n\r\n  // ===== Timeline View Settings =====\r\n  showTasksInTimeline: boolean;      // new toggle\r\n  showArrows: boolean;            // new toggle\r\n  showHeatmap: boolean;      // new toggle\r\n  showAssignees: boolean;   // toggle assignee labels\r\n  showMilestones: boolean;\r\n  showTooltips: boolean;          // toggle bar tooltips/popups\r\n  showBarShadows: boolean;        // toggle bar shadows\r\n  allowBarMove: boolean;           // enable Alt‑drag bar move\r\n  hideCompletedTasks: boolean;     // hide completed/done tasks\r\n  hideOnHoldTasks: boolean;        // hide on-hold tasks\r\n  timelineStart?: string;         // ISO YYYY‑MM‑DD for timeline start (empty = today)\r\n  timelineEnd?:   string;         // ISO YYYY‑MM‑DD for timeline end   (empty = auto)\r\n  zoomPxPerDay: number;      // default zoom level (px per day)\r\n  heatMin: number;              // counts ≤ heatMin → coolest colour\r\n  heatMax: number;              // counts ≥ heatMax → hottest colour\r\n\r\n  // ===== Resources View Settings =====\r\n  resourcesOverloadThreshold: number; // total tasks above this shows red alert\r\n\r\n  // ===== Task Weeks View Settings =====\r\n  taskWeeksOverloadThreshold: number; // weekly tasks above this shows red exclamation\r\n\r\n  // ===== Light Mode Colors =====\r\n  barColorE: string;        // colour for \"E\" tasks\r\n  barColorS: string;        // colour for \"S\" tasks\r\n  barColorSB: string;       // colour for \"SB\" tasks\r\n  completedBarLight: string;\r\n  milestoneLineLight: string;\r\n\r\n  // ===== Dark Mode Colors =====\r\n  barColorE_dark: string;      // dark‑mode E bar\r\n  barColorS_dark: string;      // dark‑mode S bar\r\n  barColorSB_dark: string;     // dark‑mode SB bar\r\n  completedBarDark: string;\r\n  milestoneLineDark:  string;\r\n\r\n  // ===== Ribbon Icon Settings =====\r\n  showProgressRibbon: boolean;\r\n  showTimelineRibbon:  boolean;\r\n  showTaskRibbon:      boolean;   // Task Weeks\r\n  showResourcesRibbon: boolean;\r\n  showCalendarRibbon: boolean;\r\n\r\n\r\n  // ===== Pane Reuse Settings =====\r\n  reuseProgressPane:  boolean;\r\n  reuseTimelinePane:   boolean;\r\n  reuseTaskWeeksPane:  boolean;\r\n  reuseResourcesPane:  boolean;\r\n\r\n  // ===== Portfolio Settings =====\r\n  lastSelectedPortfolio?: string;\r\n}\r\n\r\nexport const DEFAULT_SETTINGS: PmSettings = {\r\n  // ===== Core Properties =====\r\n  statusProperty: \"status\",\r\n  dueProperty: \"due\",\r\n  ownerProperty: \"owner\",\r\n  projectFlagProperty: \"project\",\r\n  projectTemplate: \"\",\r\n  statusValues: [\"Todo\", \"Doing\", \"Review\", \"Done\"],\r\n\r\n  // ===== Timeline View Settings =====\r\n  showTasksInTimeline: true,\r\n  showArrows: true,\r\n  showHeatmap: true,\r\n  showAssignees: true,\r\n  showMilestones: true,\r\n  showTooltips: true,\r\n  showBarShadows: true,\r\n  allowBarMove: true,\r\n  hideCompletedTasks: false,\r\n  hideOnHoldTasks: false,\r\n  timelineStart: \"\",\r\n  timelineEnd: \"\",\r\n  zoomPxPerDay: 4,\r\n  heatMin: 20,\r\n  heatMax: 30,\r\n\r\n  // ===== Resources View Settings =====\r\n  resourcesOverloadThreshold: 20,\r\n\r\n  // ===== Task Weeks View Settings =====\r\n  taskWeeksOverloadThreshold: 5,\r\n\r\n  // ===== Light Mode Colors =====\r\n  barColorE: \"#d9534f\",   // red\r\n  barColorS: \"#6c757d\",   // grey\r\n  barColorSB: \"#5bc0de\",  // light-blue\r\n  completedBarLight: \"#9acd32\", // light-mode done colour (yellow-green)\r\n  milestoneLineLight: \"#ff9900\",\r\n\r\n  // ===== Dark Mode Colors =====\r\n  barColorE_dark: \"#ff7670\",  // softer red for dark bg\r\n  barColorS_dark: \"#adb5bd\",  // muted grey\r\n  barColorSB_dark: \"#66d9ef\", // cyan-ish blue\r\n  completedBarDark: \"#6fbf3a\", // dark-mode done colour\r\n  milestoneLineDark: \"#ffb84d\",\r\n\r\n  // ===== Ribbon Icon Settings =====\r\n  showProgressRibbon: true,\r\n  showTimelineRibbon: true,\r\n  showTaskRibbon: true,\r\n  showResourcesRibbon: true,\r\n  showCalendarRibbon: true,\r\n\r\n\r\n  // ===== Pane Reuse Settings =====\r\n  reuseProgressPane: true,\r\n  reuseTimelinePane: true,\r\n  reuseTaskWeeksPane: true,\r\n  reuseResourcesPane: true,\r\n\r\n  // ===== Portfolio Settings =====\r\n  lastSelectedPortfolio: undefined,\r\n};\r\n\r\nexport class PmSettingsTab extends PluginSettingTab {\r\n  plugin: ProjectManagementPlugin;\r\n\r\n  constructor(app: App, plugin: ProjectManagementPlugin) {\r\n    super(app, plugin);\r\n    this.plugin = plugin;\r\n  }\r\n\r\n  display(): void {\r\n    const { containerEl } = this;\r\n    containerEl.empty();\r\n    containerEl.createEl(\"h2\", { text: \"Project Management Settings\" });\r\n\r\n    // ===== Core Properties =====\r\n    const coreSection = containerEl.createEl(\"details\", { cls: \"pm-settings-section\" });\r\n    const coreSummary = coreSection.createEl(\"summary\", { cls: \"pm-settings-summary\" });\r\n    coreSummary.createEl(\"h2\", { text: \"Core Properties\" });\r\n    \r\n    new Setting(coreSection)\r\n      .setName(\"Status property key\")\r\n      .setDesc(\"Front‑matter/Property key to read & write task status.\")\r\n      .addText((text) =>\r\n        text\r\n          .setPlaceholder(\"status\")\r\n          .setValue(this.plugin.settings.statusProperty)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.statusProperty = value.trim();\r\n            await this.plugin.saveSettings();\r\n          })\r\n      );\r\n\r\n    new Setting(coreSection)\r\n      .setName(\"Due date property key\")\r\n      .setDesc(\"Front‑matter/Property key for due date.\")\r\n      .addText((text) =>\r\n        text\r\n          .setPlaceholder(\"due\")\r\n          .setValue(this.plugin.settings.dueProperty)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.dueProperty = value.trim();\r\n            await this.plugin.saveSettings();\r\n          })\r\n      );\r\n\r\n    new Setting(coreSection)\r\n      .setName(\"Project flag property key\")\r\n      .setDesc(\"Front‑matter boolean key used to detect a Project note.\")\r\n      .addText((text) =>\r\n        text\r\n          .setPlaceholder(\"project\")\r\n          .setValue(this.plugin.settings.projectFlagProperty)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.projectFlagProperty = value.trim() || \"project\";\r\n            await this.plugin.saveSettings();\r\n\r\n            // Re‑index cache to pick up projects with the new front matter key\r\n            // @ts-ignore cache has reindex method\r\n            if (typeof this.plugin.cache?.reindex === \"function\") {\r\n              await this.plugin.cache.reindex();\r\n            }\r\n\r\n            // Refresh all project management views\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_PROGRESS).forEach((leaf) => {\r\n              const view = leaf.view as any;\r\n              if (typeof view.render === \"function\") {\r\n                view.render();\r\n              }\r\n            });\r\n\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE).forEach((leaf) => {\r\n              const view = leaf.view as any;\r\n              if (typeof view.saveAndRender === \"function\") {\r\n                view.saveAndRender();\r\n              } else if (typeof view.render === \"function\") {\r\n                view.render();\r\n              }\r\n            });\r\n\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TASKWEEKS).forEach((leaf) => {\r\n              const view = leaf.view as any;\r\n              if (typeof view.render === \"function\") {\r\n                view.render();\r\n              }\r\n            });\r\n\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_RESOURCES).forEach((leaf) => {\r\n              const view = leaf.view as any;\r\n              if (typeof view.render === \"function\") {\r\n                view.render();\r\n              }\r\n            });\r\n\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_PORTFOLIO).forEach((leaf) => {\r\n              const view = leaf.view as any;\r\n              if (typeof view.render === \"function\") {\r\n                view.render();\r\n              }\r\n            });\r\n          })\r\n      );\r\n\r\n    /* ========= Project template ==================================================== */\r\n    new Setting(coreSection)\r\n      .setName(\"Project note template\")\r\n      .setDesc(\"Vault‑relative path to a Markdown file whose content will be \"\r\n             + \"used when creating a new project. Leave blank to use the plugin’s \"\r\n             + \"default built‑in template.\")\r\n      .addText(text =>\r\n        text\r\n          .setPlaceholder(\"Templates/ProjectTemplate.md   (blank = default)\")\r\n          .setValue(this.plugin.settings.projectTemplate)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.projectTemplate = value.trim();\r\n            await this.plugin.saveSettings();\r\n          })\r\n      );\r\n\r\n    // ===== Timeline View Settings =====\r\n    const timelineSection = containerEl.createEl(\"details\", { cls: \"pm-settings-section\" });\r\n    const timelineSummary = timelineSection.createEl(\"summary\", { cls: \"pm-settings-summary\" });\r\n    timelineSummary.createEl(\"h2\", { text: \"Timeline View\" });\r\n    \r\n    new Setting(timelineSection)\r\n      .setName(\"Show tasks on Timeline\")\r\n      .setDesc(\"Toggle display of individual task bars in the Timeline view.\")\r\n      .addToggle((toggle) =>\r\n        toggle\r\n          .setValue(this.plugin.settings.showTasksInTimeline)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.showTasksInTimeline = value;\r\n            await this.plugin.saveSettings();\r\n\r\n            // Re‑index cache and force each Timeline view to save its scroll, then refresh\r\n            // @ts-ignore cache has reindex method\r\n            if (typeof this.plugin.cache?.reindex === \"function\") {\r\n              this.plugin.cache.reindex();\r\n            }\r\n\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE).forEach((leaf) => {\r\n              {\r\n                const view = leaf.view as any;\r\n                if (typeof view.saveAndRender === \"function\") {\r\n                  view.saveAndRender();\r\n                } else if (typeof view.render === \"function\") {\r\n                  view.render();\r\n                }\r\n              }\r\n            });\r\n          })\r\n      );\r\n\r\n    // ===== Resources View Settings =====\r\n    const resourcesSection = containerEl.createEl(\"details\", { cls: \"pm-settings-section\" });\r\n    const resourcesSummary = resourcesSection.createEl(\"summary\", { cls: \"pm-settings-summary\" });\r\n    resourcesSummary.createEl(\"h2\", { text: \"Resources View\" });\r\n\r\n    new Setting(resourcesSection)\r\n      .setName(\"Overload threshold (tasks)\")\r\n      .setDesc(\"If an assignee’s total tasks exceed this number, show a red exclamation in Resources.\")\r\n      .addText((text) =>\r\n        text\r\n          .setPlaceholder(\"20\")\r\n          .setValue(String(this.plugin.settings.resourcesOverloadThreshold))\r\n          .onChange(async (value) => {\r\n            const n = Number(value);\r\n            if (!Number.isNaN(n)) {\r\n              this.plugin.settings.resourcesOverloadThreshold = n;\r\n              await this.plugin.saveSettings();\r\n              // Refresh Resources views\r\n              this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_RESOURCES).forEach((leaf) => {\r\n                const view = leaf.view as any;\r\n                if (typeof view.render === \"function\") view.render();\r\n              });\r\n            }\r\n          })\r\n      );\r\n\r\n    // ===== Task Weeks View Settings =====\r\n    const taskWeeksSection = containerEl.createEl(\"details\", { cls: \"pm-settings-section\" });\r\n    const taskWeeksSummary = taskWeeksSection.createEl(\"summary\", { cls: \"pm-settings-summary\" });\r\n    taskWeeksSummary.createEl(\"h2\", { text: \"Task Weeks View\" });\r\n\r\n    new Setting(taskWeeksSection)\r\n      .setName(\"Weekly overload threshold (tasks)\")\r\n      .setDesc(\"If a week's total tasks exceed this number, show a red exclamation in Task Weeks.\")\r\n      .addText((text) =>\r\n        text\r\n          .setPlaceholder(\"5\")\r\n          .setValue(String(this.plugin.settings.taskWeeksOverloadThreshold))\r\n          .onChange(async (value) => {\r\n            const n = Number(value);\r\n            if (!Number.isNaN(n)) {\r\n              this.plugin.settings.taskWeeksOverloadThreshold = n;\r\n              await this.plugin.saveSettings();\r\n              // Refresh Task Weeks views\r\n              this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TASKWEEKS).forEach((leaf) => {\r\n                const view = leaf.view as any;\r\n                if (typeof view.render === \"function\") view.render();\r\n              });\r\n            }\r\n          })\r\n      );\r\n\r\n    new Setting(timelineSection)\r\n      .setName(\"Show dependency arrows\")\r\n      .setDesc(\"Toggle display of arrows that connect tasks with depends:: links in Timeline view.\")\r\n      .addToggle((toggle) =>\r\n        toggle\r\n          .setValue(this.plugin.settings.showArrows)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.showArrows = value;\r\n            await this.plugin.saveSettings();\r\n\r\n            // Re‑index cache and force each Timeline view to save its scroll, then refresh\r\n            // @ts-ignore cache has reindex method\r\n            if (typeof this.plugin.cache?.reindex === \"function\") {\r\n              this.plugin.cache.reindex();\r\n            }\r\n\r\n            this.app.workspace.getLeavesOfType(\"pm-timeline\").forEach((leaf) => {\r\n              {\r\n                const view = leaf.view as any;\r\n                if (typeof view.saveAndRender === \"function\") {\r\n                  view.saveAndRender();\r\n                } else if (typeof view.render === \"function\") {\r\n                  view.render();\r\n                }\r\n              }\r\n            });\r\n          })\r\n      );\r\n\r\n    new Setting(timelineSection)\r\n      .setName(\"Show workload heat‑map\")\r\n      .setDesc(\"Thin colour strip under the header shows how many tasks overlap each day.\")\r\n      .addToggle((toggle) =>\r\n        toggle\r\n          .setValue(this.plugin.settings.showHeatmap)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.showHeatmap = value;\r\n            await this.plugin.saveSettings();\r\n\r\n            // Refresh Timeline views without losing scroll\r\n            this.app.workspace.getLeavesOfType(\"pm-timeline\").forEach((leaf) => {\r\n              const v = leaf.view as any;\r\n              if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n              else if (typeof v.render === \"function\") v.render();\r\n            });\r\n          })\r\n      );\r\n\r\n    /* Heat‑map intensity range */\r\n    new Setting(timelineSection)\r\n      .setName(\"Heat‑map minimum (tasks)\")\r\n      .setDesc(\"Daily counts at or below this value are shown in the coolest colour.\")\r\n      .addText(text =>\r\n        text\r\n          .setPlaceholder(\"20\")\r\n          .setValue(String(this.plugin.settings.heatMin))\r\n          .onChange(async (value) => {\r\n            const n = Number(value);\r\n            if (!isNaN(n)) {\r\n              this.plugin.settings.heatMin = n;\r\n              await this.plugin.saveSettings();\r\n\r\n              /* Refresh Timeline views */\r\n              this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE).forEach((leaf) => {\r\n                const v = leaf.view as any;\r\n                if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n                else if (typeof v.render === \"function\") v.render();\r\n              });\r\n            }\r\n          })\r\n      );\r\n\r\n    new Setting(timelineSection)\r\n      .setName(\"Heat‑map maximum (tasks)\")\r\n      .setDesc(\"Daily counts at or above this value are rendered in the hottest colour.\")\r\n      .addText(text =>\r\n        text\r\n          .setPlaceholder(\"30\")\r\n          .setValue(String(this.plugin.settings.heatMax))\r\n          .onChange(async (value) => {\r\n            const n = Number(value);\r\n            if (!isNaN(n)) {\r\n              this.plugin.settings.heatMax = n;\r\n              await this.plugin.saveSettings();\r\n\r\n              /* Refresh Timeline views */\r\n              this.app.workspace.getLeavesOfType(\"pm-timeline\").forEach((leaf) => {\r\n                const v = leaf.view as any;\r\n                if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n                else if (typeof v.render === \"function\") v.render();\r\n              });\r\n            }\r\n          })\r\n      );\r\n\r\n    /* ---- Timeline date range ---- */\r\n    new Setting(timelineSection)\r\n      .setName(\"Timeline start date\")\r\n      .setDesc(\"Anchor the left edge of the Timeline. YYYY‑MM‑DD, blank = today.\")\r\n      .addText(text =>\r\n        text\r\n          .setPlaceholder(\"YYYY-MM-DD\")\r\n          .setValue(this.plugin.settings.timelineStart ?? \"\")\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.timelineStart = value.trim();\r\n            await this.plugin.saveSettings();\r\n\r\n            /* Refresh all open Timeline views */\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE).forEach((leaf) => {\r\n              const v = leaf.view as any;\r\n              if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n              else if (typeof v.render === \"function\") v.render();\r\n            });\r\n          })\r\n      );\r\n\r\n    new Setting(timelineSection)\r\n      .setName(\"Timeline end date\")\r\n      .setDesc(\"Right edge of the Timeline. YYYY‑MM‑DD, blank = auto horizon.\")\r\n      .addText(text =>\r\n        text\r\n          .setPlaceholder(\"YYYY-MM-DD\")\r\n          .setValue(this.plugin.settings.timelineEnd ?? \"\")\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.timelineEnd = value.trim();\r\n            await this.plugin.saveSettings();\r\n\r\n            /* Refresh all open Timeline views */\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE).forEach((leaf) => {\r\n              const v = leaf.view as any;\r\n              if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n              else if (typeof v.render === \"function\") v.render();\r\n            });\r\n          })\r\n      );\r\n\r\n    new Setting(timelineSection)\r\n      .setName(\"Show bar shadows\")\r\n      .setDesc(\"Toggle the drop‑shadow beneath each task bar in Timeline view.\")\r\n      .addToggle((toggle) =>\r\n        toggle\r\n          .setValue(this.plugin.settings.showBarShadows)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.showBarShadows = value;\r\n            await this.plugin.saveSettings();\r\n\r\n            // Refresh Timeline views without losing scroll\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE).forEach((leaf) => {\r\n              const v = leaf.view as any;\r\n              if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n              else if (typeof v.render === \"function\") v.render();\r\n            });\r\n          })\r\n      );\r\n\r\n    new Setting(timelineSection)\r\n      .setName(\"Show assignee labels\")\r\n      .setDesc(\"Display the assignee name next to each task bar.\")\r\n      .addToggle((toggle) =>\r\n        toggle\r\n          .setValue(this.plugin.settings.showAssignees)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.showAssignees = value;\r\n            await this.plugin.saveSettings();\r\n\r\n            /* Refresh Timeline views without losing scroll */\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE).forEach((leaf) => {\r\n              const v = leaf.view as any;\r\n              if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n              else if (typeof v.render === \"function\") v.render();\r\n            });\r\n          })\r\n      );\r\n\r\n    new Setting(timelineSection)\r\n      .setName(\"Show bar tooltips\")\r\n      .setDesc(\"Display information popups when hovering over task bars.\")\r\n      .addToggle((toggle) =>\r\n        toggle\r\n          .setValue(this.plugin.settings.showTooltips)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.showTooltips = value;\r\n            await this.plugin.saveSettings();\r\n\r\n            /* Refresh Timeline views without losing scroll */\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE).forEach((leaf) => {\r\n              const v = leaf.view as any;\r\n              if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n              else if (typeof v.render === \"function\") v.render();\r\n            });\r\n          })\r\n      );\r\n\r\n    new Setting(timelineSection)\r\n      .setName(\"Enable bar drag‑to‑move\")\r\n      .setDesc(\"Allow Alt‑dragging a bar in the timeline to shift its start/due dates.\")\r\n      .addToggle((toggle) =>\r\n        toggle\r\n          .setValue(this.plugin.settings.allowBarMove)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.allowBarMove = value;\r\n            await this.plugin.saveSettings();\r\n\r\n            /* Refresh Timeline views without losing scroll */\r\n            this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE).forEach((leaf) => {\r\n              const v = leaf.view as any;\r\n              if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n              else if (typeof v.render === \"function\") v.render();\r\n            });\r\n          })\r\n      );\r\n\r\n    /* Zoom level (px per day) slider */\r\n    new Setting(timelineSection)\r\n      .setName(\"Default zoom (px per day)\")\r\n      .setDesc(\"Sets the initial horizontal scale for Timeline views.\")\r\n      .addSlider((slider) =>\r\n        slider\r\n          .setLimits(2, 10, 1)\r\n          .setValue(this.plugin.settings.zoomPxPerDay)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.zoomPxPerDay = value;\r\n            await this.plugin.saveSettings();\r\n\r\n            /* Refresh open Timeline views with new default zoom */\r\n            this.app.workspace.getLeavesOfType(\"pm-timeline\").forEach((leaf) => {\r\n              const v = leaf.view as any;\r\n              if (typeof v.saveAndRender === \"function\") v.saveAndRender();\r\n              else if (typeof v.render === \"function\") v.render();\r\n            });\r\n          })\r\n      );\r\n\r\n    /* Milestone settings */\r\n    new Setting(timelineSection)\r\n      .setName(\"Show milestone lines\")\r\n      .setDesc(\"Display vertical guideline bars for milestones in the Timeline.\")\r\n      .addToggle(t =>\r\n        t.setValue(this.plugin.settings.showMilestones)\r\n         .onChange(async v => {\r\n           this.plugin.settings.showMilestones = v;\r\n           await this.plugin.saveSettings();\r\n           this.plugin.applyBarColours?.();\r\n           this.app.workspace.getLeavesOfType(\"pm-timeline\")\r\n             .forEach(l => ((l.view as any).saveAndRender?.() ?? (l.view as any).render?.()));\r\n         })\r\n      );\r\n\r\n    // ===== Light Mode Colors =====\r\n    const lightColorsSection = containerEl.createEl(\"details\", { cls: \"pm-settings-section\" });\r\n    const lightColorsSummary = lightColorsSection.createEl(\"summary\", { cls: \"pm-settings-summary\" });\r\n    lightColorsSummary.createEl(\"h2\", { text: \"Light Mode Colors\" });\r\n    \r\n    /* Bar colour pickers */\r\n    new Setting(lightColorsSection)\r\n      .setName(\"Bar colour – E tasks\")\r\n      .addColorPicker((cp) =>\r\n        cp\r\n          .setValue(this.plugin.settings.barColorE)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.barColorE = value;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours();   // refresh CSS vars if helper exists\r\n          })\r\n      );\r\n\r\n    new Setting(lightColorsSection)\r\n      .setName(\"Bar colour – S tasks\")\r\n      .addColorPicker((cp) =>\r\n        cp\r\n          .setValue(this.plugin.settings.barColorS)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.barColorS = value;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours();\r\n          })\r\n      );\r\n\r\n    new Setting(lightColorsSection)\r\n      .setName(\"Bar colour – SB tasks\")\r\n      .addColorPicker((cp) =>\r\n        cp\r\n          .setValue(this.plugin.settings.barColorSB)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.barColorSB = value;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours();\r\n          })\r\n      );\r\n\r\n    new Setting(lightColorsSection)\r\n      .setName(\"Completed-task bar\")\r\n      .addColorPicker(cp =>\r\n        cp.setValue(this.plugin.settings.completedBarLight)\r\n          .onChange(async (val) => {\r\n            this.plugin.settings.completedBarLight = val;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours?.();   // refresh CSS vars\r\n          })\r\n    );\r\n\r\n    new Setting(lightColorsSection)\r\n      .setName(\"Milestone line\")\r\n      .addColorPicker(cp =>\r\n        cp.setValue(this.plugin.settings.milestoneLineLight)\r\n          .onChange(async val => {\r\n            this.plugin.settings.milestoneLineLight = val;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours?.();\r\n          })\r\n      );\r\n\r\n    // ===== Dark Mode Colors =====\r\n    const darkColorsSection = containerEl.createEl(\"details\", { cls: \"pm-settings-section\" });\r\n    const darkColorsSummary = darkColorsSection.createEl(\"summary\", { cls: \"pm-settings-summary\" });\r\n    darkColorsSummary.createEl(\"h2\", { text: \"Dark Mode Colors\" });\r\n\r\n    new Setting(darkColorsSection)\r\n      .setName(\"Bar colour – E tasks (dark)\")\r\n      .addColorPicker((cp) =>\r\n        cp\r\n          .setValue(this.plugin.settings.barColorE_dark)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.barColorE_dark = value;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours();\r\n          })\r\n      );\r\n\r\n    new Setting(darkColorsSection)\r\n      .setName(\"Bar colour – S tasks (dark)\")\r\n      .addColorPicker((cp) =>\r\n        cp\r\n          .setValue(this.plugin.settings.barColorS_dark)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.barColorS_dark = value;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours();\r\n          })\r\n      );\r\n\r\n    new Setting(darkColorsSection)\r\n      .setName(\"Bar colour – SB tasks (dark)\")\r\n      .addColorPicker((cp) =>\r\n        cp\r\n          .setValue(this.plugin.settings.barColorSB_dark)\r\n          .onChange(async (value) => {\r\n            this.plugin.settings.barColorSB_dark = value;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours();\r\n          })\r\n    );\r\n    \r\n    new Setting(darkColorsSection)\r\n      .setName(\"Completed-task bar (dark)\")\r\n      .addColorPicker(cp =>\r\n        cp.setValue(this.plugin.settings.completedBarDark)\r\n          .onChange(async (val) => {\r\n            this.plugin.settings.completedBarDark = val;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours?.();\r\n          })\r\n    );\r\n\r\n    new Setting(darkColorsSection)\r\n      .setName(\"Milestone line (dark)\")\r\n      .addColorPicker(cp =>\r\n        cp.setValue(this.plugin.settings.milestoneLineDark)\r\n          .onChange(async val => {\r\n            this.plugin.settings.milestoneLineDark = val;\r\n            await this.plugin.saveSettings();\r\n            this.plugin.applyBarColours?.();\r\n          })\r\n      );\r\n\r\n    // ===== Ribbon Icon Settings =====\r\n    const ribbonSection = containerEl.createEl(\"details\", { cls: \"pm-settings-section\" });\r\n    const ribbonSummary = ribbonSection.createEl(\"summary\", { cls: \"pm-settings-summary\" });\r\n    ribbonSummary.createEl(\"h2\", { text: \"Ribbon Icons\" });\r\n\r\n    new Setting(ribbonSection)\r\n      .setName(\"Progress ribbon icon\")\r\n      .setDesc(\"Show or hide the Progress view icon in Obsidian’s ribbon.\")\r\n      .addToggle(t =>\r\n        t.setValue(this.plugin.settings.showProgressRibbon)\r\n         .onChange(async v => {\r\n           this.plugin.settings.showProgressRibbon = v;\r\n           await this.plugin.saveSettings();\r\n           (this.plugin as any).refreshRibbonIcons?.();\r\n         })\r\n      );\r\n\r\n    new Setting(ribbonSection)\r\n      .setName(\"Timeline ribbon icon\")\r\n      .setDesc(\"Show or hide the Timeline icon in the ribbon.\")\r\n      .addToggle(t =>\r\n        t.setValue(this.plugin.settings.showTimelineRibbon)\r\n         .onChange(async v => {\r\n           this.plugin.settings.showTimelineRibbon = v;\r\n           await this.plugin.saveSettings();\r\n           (this.plugin as any).refreshRibbonIcons?.();\r\n         })\r\n      );\r\n\r\n    new Setting(ribbonSection)\r\n      .setName(\"Task‑Weeks ribbon icon\")\r\n      .setDesc(\"Show or hide the Task view icon in the ribbon.\")\r\n      .addToggle(t =>\r\n        t.setValue(this.plugin.settings.showTaskRibbon)\r\n         .onChange(async v => {\r\n           this.plugin.settings.showTaskRibbon = v;\r\n           await this.plugin.saveSettings();\r\n           (this.plugin as any).refreshRibbonIcons?.();\r\n         })\r\n      );\r\n\r\n    new Setting(ribbonSection)\r\n      .setName(\"Resources ribbon icon\")\r\n      .setDesc(\"Show or hide the Resources view icon in the ribbon.\")\r\n      .addToggle(t =>\r\n        t.setValue(this.plugin.settings.showResourcesRibbon)\r\n         .onChange(async v => {\r\n           this.plugin.settings.showResourcesRibbon = v;\r\n           await this.plugin.saveSettings();\r\n           (this.plugin as any).refreshRibbonIcons?.();\r\n         })\r\n      );\r\n\r\n    new Setting(ribbonSection)\r\n      .setName(\"Calendar ribbon icon\")\r\n      .setDesc(\"Show or hide the Calendar view icon in the ribbon.\")\r\n      .addToggle(t =>\r\n        t.setValue(this.plugin.settings.showCalendarRibbon)\r\n         .onChange(async v => {\r\n           this.plugin.settings.showCalendarRibbon = v;\r\n           await this.plugin.saveSettings();\r\n           (this.plugin as any).refreshRibbonIcons?.();\r\n         })\r\n      );\r\n\r\n\r\n\r\n    // ===== Pane Reuse Settings =====\r\n    const paneReuseSection = containerEl.createEl(\"details\", { cls: \"pm-settings-section\" });\r\n    const paneReuseSummary = paneReuseSection.createEl(\"summary\", { cls: \"pm-settings-summary\" });\r\n    paneReuseSummary.createEl(\"h2\", { text: \"Pane Reuse\" });\r\n\r\n    const reuseToggles: [keyof PmSettings, string][] = [\r\n      [\"reuseProgressPane\",  \"Reuse Progress pane\"],\r\n      [\"reuseTimelinePane\",   \"Reuse Timeline pane\"],\r\n      [\"reuseTaskWeeksPane\",  \"Reuse Weekly‑tasks pane\"],\r\n      [\"reuseResourcesPane\",  \"Reuse Resources pane\"],\r\n    ];\r\n\r\n    reuseToggles.forEach(([key, label]) => {\r\n      new Setting(paneReuseSection)\r\n        .setName(label)\r\n        .setDesc(\"If enabled, clicking a button will update an existing \"\r\n               + \"pane of this type instead of opening a new split.\")\r\n        .addToggle(t =>\r\n          t.setValue((this.plugin.settings as any)[key])\r\n            .onChange(async v => {\r\n              (this.plugin.settings as any)[key] = v;\r\n              await this.plugin.saveSettings();\r\n            })\r\n        );\r\n    });\r\n    \r\n  }\r\n}\r\n","import { Plugin, WorkspaceLeaf, TFile, TFolder, Notice, Menu, MenuItem } from \"obsidian\";\r\nimport { ProjectProgressView, VIEW_TYPE_PM_PROGRESS } from \"./views/progress\";\r\nimport { TimelineView, VIEW_TYPE_PM_TIMELINE } from \"./views/timeline\";\r\nimport { PortfolioView, VIEW_TYPE_PM_PORTFOLIO } from \"./views/portfolio\";\r\nimport { TaskWeeksView, VIEW_TYPE_PM_TASKWEEKS } from \"./views/task_weeks\";\r\nimport { ResourcesView, VIEW_TYPE_PM_RESOURCES } from \"./views/resources\";\r\nimport { DashboardView, VIEW_TYPE_PM_DASHBOARD } from \"./views/dashboard\";\r\nimport { TodayView, VIEW_TYPE_PM_TODAY } from \"./views/today\";\r\nimport { CalendarView, VIEW_TYPE_PM_CALENDAR } from \"./views/calendar\";\r\nimport { ProjectCache } from \"./services/cache\";\r\nimport { PmSettings, DEFAULT_SETTINGS, PmSettingsTab } from \"../settings\";\r\nimport { newProject } from \"./newProject\";\r\nimport { newActionItem } from \"./newActionItem\";\r\n\r\nexport default class ProjectManagementPlugin extends Plugin {\r\n  public settings!: PmSettings;\r\n  public cache!: ProjectCache;\r\n  /** Track ribbon icons so we can show/hide them on‑the‑fly from Settings */\r\n  private ribbons: {\r\n    progress?: HTMLElement;\r\n    timeline?:  HTMLElement;\r\n    taskWeeks?: HTMLElement;\r\n    resources?: HTMLElement;\r\n    portfolio?: HTMLElement;\r\n    dashboard?: HTMLElement;\r\n    calendar?: HTMLElement;\r\n  } = {};\r\n  private addedPortfolio: boolean = false;\r\n\r\n  async onload() {\r\n    await this.loadSettings();\r\n    this.applyBarColours();          // inject CSS variables for bar colours\r\n\r\n    this.cache = new ProjectCache(this.app, this);\r\n    await this.cache.reindex(); // initial scan\r\n\r\n    // Ribbon icons according to user settings\r\n    this.refreshRibbonIcons();\r\n\r\n    // Command palette\r\n    this.addCommand({\r\n      id: \"open-project-progress\",\r\n      name: \"Open Project Progress\",\r\n      callback: () => this.activateProgress(),\r\n    });\r\n    this.addCommand({\r\n      id: \"open-project-timeline\",\r\n      name: \"Open Project Timeline\",\r\n      callback: () => this.activateTimeline(),\r\n    });\r\n    this.addCommand({\r\n      id: \"open-portfolio-configurator\",\r\n      name: \"Open Projects\",\r\n      callback: () => this.activatePortfolio(),\r\n    });\r\n    this.addCommand({\r\n      id: \"pm-new-project\",\r\n      name: \"Create New Project Note\",\r\n      callback: () => newProject(this.app),\r\n    });\r\n    this.addCommand({\r\n      id: \"pm-new-action-item\",\r\n      name: \"Create New Action Item\",\r\n      callback: () => newActionItem(this.app, this.cache),\r\n    });\r\n    this.addCommand({\r\n      id: \"open-weekly-task-view\",\r\n      name: \"Open Weekly Task View\",\r\n      callback: () => this.activateTaskWeeks(),\r\n    });\r\n    this.addCommand({\r\n      id: \"open-resources-view\",\r\n      name: \"Open Resources View\",\r\n      callback: () => this.activateResources(),\r\n    });\r\n    this.addCommand({\r\n      id: \"open-dashboard-view\",\r\n      name: \"Open Dashboard View\",\r\n      callback: () => this.activateDashboard(),\r\n    });\r\n    this.addCommand({\r\n      id: \"open-calendar-view\",\r\n      name: \"Open Calendar View\",\r\n      callback: () => this.activateCalendar(),\r\n    });\r\n\r\n\r\n    /* Manual re‑index command */\r\n    this.addCommand({\r\n      id: \"pm-reindex-cache\",\r\n      name: \"Re‑index Project/Task Cache\",\r\n      callback: async () => {\r\n        new Notice(\"Re‑indexing project cache…\");\r\n        await this.cache.reindex();\r\n        new Notice(\"Project cache re‑indexed.\");\r\n      },\r\n    });\r\n\r\n    // Register custom view\r\n    this.registerView(\r\n      VIEW_TYPE_PM_PROGRESS,\r\n      (leaf: WorkspaceLeaf) =>\r\n        new ProjectProgressView(leaf, this.cache, this.settings)\r\n    );\r\n    this.registerView(\r\n      VIEW_TYPE_PM_TIMELINE,\r\n      (leaf: WorkspaceLeaf) => new TimelineView(leaf, this.cache, this)\r\n    );\r\n    this.registerView(\r\n      VIEW_TYPE_PM_PORTFOLIO,\r\n      (leaf: WorkspaceLeaf) => new PortfolioView(leaf, this.cache, this.settings, this)\r\n    );\r\n    this.registerView(\r\n      VIEW_TYPE_PM_TASKWEEKS,\r\n      (leaf: WorkspaceLeaf) => new TaskWeeksView(leaf, this.cache, this.settings)\r\n    );\r\n    this.registerView(\r\n      VIEW_TYPE_PM_RESOURCES,\r\n      (leaf: WorkspaceLeaf) => new ResourcesView(leaf, this.cache, this.settings)\r\n    );\r\n    this.registerView(\r\n      VIEW_TYPE_PM_DASHBOARD,\r\n      (leaf: WorkspaceLeaf) => new DashboardView(leaf, this.cache, this.settings)\r\n    );\r\n    this.registerView(\r\n      VIEW_TYPE_PM_TODAY,\r\n      (leaf: WorkspaceLeaf) => new TodayView(leaf, this.cache, this.settings)\r\n    );\r\n    this.registerView(\r\n      VIEW_TYPE_PM_CALENDAR,\r\n      (leaf: WorkspaceLeaf) => new CalendarView(leaf, this.cache, this.settings)\r\n    );\r\n\r\n    // Keep cache updated when metadata is resolved\r\n    this.registerEvent(\r\n      this.app.metadataCache.on(\"resolved\", () => this.cache.reindex())\r\n    );\r\n\r\n    // Re‑index project/task cache when a note is modified (so newly‑added\r\n    // project flag front‑matter shows up without reloading the plugin)\r\n    this.registerEvent(\r\n      this.app.vault.on(\"modify\", () => this.cache.reindex())\r\n    );\r\n\r\n    /* Right‑click: create Project Note in selected folder */\r\n    this.registerEvent(\r\n      (this.app.workspace as any).on(\"file-menu\", (menu: Menu, file: TFile | TFolder) => {\r\n        if (file && file.constructor?.name === \"TFolder\") {\r\n          menu.addItem((item: MenuItem) =>\r\n            item\r\n              .setTitle(\"New Project Note here\")\r\n              .setIcon(\"document-plus\")\r\n              .onClick(() => newProject(this.app, file as TFolder))\r\n          );\r\n        }\r\n      })\r\n    );\r\n\r\n    // Settings tab\r\n    this.addSettingTab(new PmSettingsTab(this.app, this));\r\n\r\n    // Listen for Alt‑drag reschedule events from Timeline\r\n    this.registerDomEvent(document, \"pm-bar-moved\" as keyof HTMLElementEventMap, (e: Event) => {\r\n      const ev = e as CustomEvent<{ taskKey: string; deltaDays: number }>;\r\n      if (ev?.detail) this.handleBarMove(ev.detail.taskKey, ev.detail.deltaDays);\r\n    });\r\n\r\n    // Listen for resize‑edge events from Timeline\r\n    this.registerDomEvent(document, \"pm-bar-resized\" as keyof HTMLElementEventMap, (e: Event) => {\r\n      const ev = e as CustomEvent<{ taskKey: string; deltaStart: number; deltaDue: number }>;\r\n      if (ev?.detail) this.handleBarResize(ev.detail.taskKey, ev.detail.deltaStart, ev.detail.deltaDue);\r\n    });\r\n\r\n    /* Listen for project‑bar drags (shift Start/End dates in YAML) */\r\n    this.registerDomEvent(document, \"pm-project-bar-moved\" as keyof HTMLElementEventMap, async (e: Event) => {\r\n      const ev = e as CustomEvent<{ projectPath: string; deltaDays: number }>;\r\n      if (!ev?.detail) return;\r\n      const { projectPath, deltaDays } = ev.detail;\r\n      if (!projectPath || !Number.isInteger(deltaDays) || deltaDays === 0) return;\r\n\r\n      const file = this.app.vault.getFileByPath(projectPath);\r\n      if (!(file && file instanceof TFile)) return;\r\n\r\n      const raw = await this.app.vault.read(file);\r\n      const fmMatch = raw.match(/^---\\n([\\s\\S]*?)\\n---\\n/);\r\n      if (!fmMatch) return;                     // no front‑matter\r\n\r\n      const blockLines = fmMatch[1].split(/\\r?\\n/);\r\n\r\n      const findIdx = (keys: string[]): number =>\r\n        blockLines.findIndex(l =>\r\n          keys.some(k => l.toLowerCase().replace(/\\s|_/g,\"\").startsWith(k))\r\n        );\r\n\r\n      const idxS = findIdx([\"startdate\",\"start\"]);\r\n      const idxE = findIdx([\"enddate\",\"end\"]);\r\n      if (idxS === -1 || idxE === -1) return;\r\n\r\n      const getISO = (idx: number) => blockLines[idx].split(\":\")[1].trim();\r\n      const momentFn = (window as any).moment;\r\n      const shift = (iso: string) =>\r\n        momentFn(iso, [ \"YYYY-MM-DD\", momentFn.ISO_8601 ], true)\r\n          .add(deltaDays, \"days\")\r\n          .format(\"YYYY-MM-DD\");\r\n\r\n      blockLines[idxS] = blockLines[idxS].replace(/:\\s*.*/, `: ${shift(getISO(idxS))}`);\r\n      blockLines[idxE] = blockLines[idxE].replace(/:\\s*.*/, `: ${shift(getISO(idxE))}`);\r\n\r\n      const newRaw = raw.replace(fmMatch[0], `---\\n${blockLines.join(\"\\n\")}\\n---\\n`);\r\n      await this.app.vault.modify(file, newRaw);\r\n\r\n      //new Notice(`Moved project by ${deltaDays} day${deltaDays===1?\"\":\"s\"}.`);\r\n\r\n      // Refresh cache so timeline updates immediately\r\n      await this.cache.reindex();\r\n    });\r\n\r\n    /* Listen for project‑bar resize (shift only Start or End) */\r\n    this.registerDomEvent(document, \"pm-project-bar-resized\" as keyof HTMLElementEventMap, async (e: Event) => {\r\n      const ev = e as CustomEvent<{ projectPath: string; deltaStart: number; deltaEnd: number }>;\r\n      if (!ev?.detail) return;\r\n      const { projectPath, deltaStart, deltaEnd } = ev.detail;\r\n      if (!projectPath || (!deltaStart && !deltaEnd)) return;\r\n\r\n      const file = this.app.vault.getFileByPath(projectPath);\r\n      if (!(file && file instanceof TFile)) return;\r\n\r\n      const raw = await this.app.vault.read(file);\r\n      const fmMatch = raw.match(/^---\\n([\\s\\S]*?)\\n---\\n/);\r\n      if (!fmMatch) return;\r\n\r\n      const lines = fmMatch[1].split(/\\r?\\n/);\r\n      const find = (keys: string[]) =>\r\n        lines.findIndex(l => keys.some(k => l.toLowerCase().replace(/\\s|_/g,\"\").startsWith(k)));\r\n\r\n      const iS = find([\"startdate\",\"start\"]);\r\n      const iE = find([\"enddate\",\"end\"]);\r\n      if (iS === -1 || iE === -1) return;\r\n\r\n      const iso = (idx: number) => lines[idx].split(\":\")[1].trim();\r\n      const m = (window as any).moment;\r\n      const fmt = (iso: string, d: number) =>\r\n        m(iso, [\"YYYY-MM-DD\", m.ISO_8601], true).add(d, \"days\").format(\"YYYY-MM-DD\");\r\n\r\n      if (deltaStart) lines[iS] = lines[iS].replace(/:\\s*.*/, `: ${fmt(iso(iS), deltaStart)}`);\r\n      if (deltaEnd)   lines[iE] = lines[iE].replace(/:\\s*.*/, `: ${fmt(iso(iE), deltaEnd)}`);\r\n\r\n      const newRaw = raw.replace(fmMatch[0], `---\\n${lines.join(\"\\n\")}\\n---\\n`);\r\n      await this.app.vault.modify(file, newRaw);\r\n      await this.cache.reindex();\r\n    });\r\n  }\r\n\r\n  onunload() {\r\n    /* Remove ribbon icons */\r\n    Object.values(this.ribbons).forEach(el => el?.detach());\r\n    this.app.workspace\r\n      .getLeavesOfType(VIEW_TYPE_PM_PROGRESS)\r\n      .forEach((leaf) => leaf.detach());\r\n    this.app.workspace\r\n      .getLeavesOfType(VIEW_TYPE_PM_PORTFOLIO)\r\n      .forEach((leaf) => leaf.detach());\r\n    this.app.workspace\r\n      .getLeavesOfType(VIEW_TYPE_PM_TASKWEEKS)\r\n      .forEach((leaf) => leaf.detach());\r\n    this.app.workspace\r\n      .getLeavesOfType(VIEW_TYPE_PM_RESOURCES)\r\n      .forEach((leaf) => leaf.detach());\r\n  }\r\n\r\n  async activateProgress() {\r\n    // Use existing dashboard if open, else grab the upper‑left main pane\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_PROGRESS)[0];\r\n\r\n    if (!leaf) {\r\n      // Try to get the main editor leaf\r\n      leaf = this.app.workspace.getLeaf(\"tab\");\r\n\r\n      // If that fails, try any leaf\r\n      if (!leaf) leaf = this.app.workspace.getLeaf();\r\n    }\r\n\r\n    if (!leaf) leaf = this.app.workspace.getLeaf(true); // final fallback\r\n    await leaf.setViewState({ type: VIEW_TYPE_PM_PROGRESS });\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  async activateTimeline() {\r\n    /** Re‑use an existing Timeline view if one is already open… */\r\n    let leaf =\r\n      this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TIMELINE)[0];\r\n\r\n    /** …otherwise create a new leaf directly *below* the active note. */\r\n    if (!leaf) {\r\n      const active = this.app.workspace.activeLeaf;\r\n      if (active) {\r\n        // Split the active leaf downward (horizontal split)\r\n        leaf = this.app.workspace.splitActiveLeaf(\"horizontal\");\r\n      } else {\r\n        leaf = this.app.workspace.getLeaf(true);  // fallback: new main leaf\r\n      }\r\n    }\r\n\r\n    await leaf.setViewState({\r\n      type: VIEW_TYPE_PM_TIMELINE,\r\n      active: true,\r\n    });\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  async activatePortfolio() {\r\n    // Re‑use existing Portfolio view if open\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_PORTFOLIO)[0];\r\n\r\n    // Otherwise open it to the right of a pinned pane; fall back to new main leaf\r\n    if (!leaf) {\r\n      const active = this.app.workspace.activeLeaf;\r\n      if ((active as any)?.pinned) {   // if a pinned tab is active\r\n        // Open a new tab in the same pane group (after the pinned tabs)\r\n        leaf = this.app.workspace.getLeaf(false);\r\n      } else {\r\n        // Default: create or reuse an unpinned leaf in the main area\r\n        leaf = this.app.workspace.getLeaf(true);\r\n      }\r\n    }\r\n\r\n    await leaf.setViewState({ type: VIEW_TYPE_PM_PORTFOLIO, active: true });\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  async loadSettings() {\r\n    const saved: Partial<PmSettings> = (await this.loadData()) || {};\r\n    const migrated: PmSettings = { ...DEFAULT_SETTINGS, ...saved };\r\n\r\n    // Backward-compat: migrate old Dashboard keys to Progress\r\n    if (Object.prototype.hasOwnProperty.call(saved, \"showDashboardRibbon\")\r\n        && !Object.prototype.hasOwnProperty.call(saved, \"showProgressRibbon\")) {\r\n      migrated.showProgressRibbon = !!(saved as any).showDashboardRibbon;\r\n    }\r\n    if (Object.prototype.hasOwnProperty.call(saved, \"reuseDashboardPane\")\r\n        && !Object.prototype.hasOwnProperty.call(saved, \"reuseProgressPane\")) {\r\n      migrated.reuseProgressPane = !!(saved as any).reuseDashboardPane;\r\n    }\r\n\r\n    this.settings = migrated as PmSettings;\r\n\r\n    // Persist migration silently (avoid full saveSettings side-effects on load)\r\n    if (Object.prototype.hasOwnProperty.call(saved, \"showDashboardRibbon\") ||\r\n        Object.prototype.hasOwnProperty.call(saved, \"reuseDashboardPane\")) {\r\n      await this.saveData(this.settings);\r\n    }\r\n  }\r\n\r\n  async saveSettings() {\r\n    await this.saveData(this.settings);\r\n    this.applyBarColours();        // update CSS variables\r\n    this.refreshAllTimelines();    // refresh timelines immediately\r\n    this.refreshRibbonIcons();\r\n  }\r\n\r\n  /** Re‑render all open Timeline views (invoked after settings change). */\r\n  private refreshAllTimelines() {\r\n    this.app.workspace\r\n      .getLeavesOfType(VIEW_TYPE_PM_TIMELINE)\r\n      .forEach((leaf) => {\r\n        const v = leaf.view as any;\r\n        if (typeof v.saveAndRender === \"function\") {\r\n          v.saveAndRender();           // preserves scroll offsets\r\n        } else if (typeof v.render === \"function\") {\r\n          v.render();\r\n        }\r\n      });\r\n  }\r\n\r\n  /** Push user‑chosen bar colours into CSS variables and toggle shadows. */\r\n  public applyBarColours() {\r\n    const st = document.documentElement.style;\r\n\r\n    /* Light‑mode palette (existing settings) */\r\n    st.setProperty(\"--pm-bar-e-color-light\",  this.settings.barColorE);\r\n    st.setProperty(\"--pm-bar-s-color-light\",  this.settings.barColorS);\r\n    st.setProperty(\"--pm-bar-sb-color-light\", this.settings.barColorSB);\r\n\r\n    /* Dark‑mode palette — fall back to light if not yet in settings */\r\n    // @ts-ignore – dark variants may not exist yet in earlier config versions\r\n    st.setProperty(\"--pm-bar-e-color-dark\",  (this.settings.barColorE_dark  ?? this.settings.barColorE));\r\n    // @ts-ignore\r\n    st.setProperty(\"--pm-bar-s-color-dark\",  (this.settings.barColorS_dark  ?? this.settings.barColorS));\r\n    // @ts-ignore\r\n    st.setProperty(\"--pm-bar-sb-color-dark\", (this.settings.barColorSB_dark ?? this.settings.barColorSB));\r\n\r\n    /* Maintain convenience vars used by existing CSS */\r\n    st.setProperty(\"--pm-bar-e-color\",  \"var(--pm-bar-e-color-light)\");\r\n    st.setProperty(\"--pm-bar-s-color\",  \"var(--pm-bar-s-color-light)\");\r\n    st.setProperty(\"--pm-bar-sb-color\", \"var(--pm-bar-sb-color-light)\");\r\n\r\n    st.setProperty(\"--pm-bar-done-light\", this.settings.completedBarLight);\r\n    st.setProperty(\"--pm-bar-done-dark\", this.settings.completedBarDark);\r\n    \r\n    /* Milestone guideline colours */\r\n    st.setProperty(\"--pm-milestone-line-light\", this.settings.milestoneLineLight);\r\n    st.setProperty(\"--pm-milestone-line-dark\", this.settings.milestoneLineDark);\r\n    \r\n    /* Toggle bar shadows */\r\n    const htmlEl = document.documentElement;\r\n    htmlEl.classList.toggle(\"pm-no-shadows\", !this.settings.showBarShadows);\r\n  }\r\n\r\n  /** Shift the inline `start::` / `due::` properties on the specific task line. */\r\n  private async handleBarMove(taskKey: string, deltaDays: number) {\r\n    const [filePath, taskId] = taskKey.split(\"::\");\r\n    const file = this.app.vault.getFileByPath(filePath);\r\n    if (!file || !(file instanceof TFile)) return;\r\n\r\n    const raw = await this.app.vault.read(file);\r\n    const lines = raw.split(\"\\n\");\r\n    const momentFn = (window as any).moment;\r\n    const isoRE   = /\\d{4}-\\d{2}-\\d{2}/;\r\n\r\n    const shiftIso = (iso: string) =>\r\n      momentFn(iso, momentFn.ISO_8601, true)\r\n        .add(deltaDays, \"days\")\r\n        .format(\"YYYY-MM-DD\");\r\n\r\n    let changed = false;\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const line = lines[i];\r\n\r\n      const lineLower = line.toLowerCase();\r\n      const idLower   = (taskId ?? \"\").toLowerCase();\r\n\r\n      /* Identify the task line:\r\n         – Exact caret anchor ^id   (e.g. ^s-1)\r\n         – Any occurrence of the id text (fallback)\r\n         – Or, if no id, first checkbox line */\r\n      const isTarget =\r\n        (idLower && lineLower.includes(\"^\" + idLower)) ||\r\n        (idLower && lineLower.includes(idLower)) ||\r\n        (!idLower && /^\\s*[-*]\\s+\\[.\\]/.test(lineLower));\r\n\r\n      if (!isTarget) continue;\r\n\r\n      // Replace inline start:: and due:: dates on this line\r\n      lines[i] = line.replace(/(start::\\s*)(\\d{4}-\\d{2}-\\d{2})/i, (_, p1, iso) => {\r\n        changed = true;\r\n        return p1 + shiftIso(iso);\r\n      });\r\n\r\n      lines[i] = lines[i].replace(/(due::\\s*)(\\d{4}-\\d{2}-\\d{2})/i, (_, p1, iso) => {\r\n        changed = true;\r\n        return p1 + shiftIso(iso);\r\n      });\r\n\r\n      break; // only shift the first matching task line\r\n    }\r\n\r\n    if (!changed) return;\r\n\r\n    await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n    await this.cache.reindex();\r\n  }\r\n\r\n  /** Shift start and/or due by delta days based on resize edge. */\r\n  private async handleBarResize(taskKey: string, deltaStart: number, deltaDue: number) {\r\n    if (deltaStart === 0 && deltaDue === 0) return;  // nothing to do\r\n\r\n    const [filePath, taskId] = taskKey.split(\"::\");\r\n    const file = this.app.vault.getFileByPath(filePath);\r\n    if (!file || !(file instanceof TFile)) return;\r\n\r\n    const raw   = await this.app.vault.read(file);\r\n    const lines = raw.split(\"\\n\");\r\n    const momentFn = (window as any).moment;\r\n\r\n    const shift = (iso: string, delta: number) =>\r\n      momentFn(iso, momentFn.ISO_8601, true)\r\n        .add(delta, \"days\")\r\n        .format(\"YYYY-MM-DD\");\r\n\r\n    let changed = false;\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const line = lines[i];\r\n      if (!line.toLowerCase().includes((taskId ?? \"\").toLowerCase())) continue;\r\n\r\n      if (deltaStart !== 0) {\r\n        lines[i] = lines[i].replace(/(start::\\s*)(\\d{4}-\\d{2}-\\d{2})/i, (_, p1, iso) => {\r\n          changed = true;\r\n          return p1 + shift(iso, deltaStart);\r\n        });\r\n      }\r\n\r\n      if (deltaDue !== 0) {\r\n        lines[i] = lines[i].replace(/(due::\\s*)(\\d{4}-\\d{2}-\\d{2})/i, (_, p1, iso) => {\r\n          changed = true;\r\n          return p1 + shift(iso, deltaDue);\r\n        });\r\n      }\r\n      break;  // edited the target line; stop searching\r\n    }\r\n\r\n    if (!changed) return;\r\n    await this.app.vault.modify(file, lines.join(\"\\n\"));\r\n    await this.cache.reindex();\r\n  }\r\n\r\n  /**\r\n   * Open the Task Weeks view.\r\n   * @param filterProjects  array of project paths to pre‑filter (empty = all)\r\n   * @param filterName      optional label shown in the view header\r\n   */\r\n  async activateTaskWeeks(filterProjects: string[] = [], filterName: string = \"\") {\r\n    // Re‑use an existing Task View if one is open\r\n    let leaf =\r\n      this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TASKWEEKS)[0];\r\n\r\n    // Otherwise open below the active note like Timeline\r\n    if (!leaf) {\r\n      const active = this.app.workspace.activeLeaf;\r\n      leaf = active\r\n        ? this.app.workspace.splitActiveLeaf(\"horizontal\")\r\n        : this.app.workspace.getLeaf(true);\r\n    }\r\n\r\n    await leaf.setViewState({\r\n      type: VIEW_TYPE_PM_TASKWEEKS,\r\n      active: true,\r\n      state: {\r\n        filterProjects,\r\n        filterName,\r\n      },\r\n    });\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n  /**\r\n   * Open the Resources view.\r\n   * @param filterProjects  array of project paths to pre‑filter (empty = all)\r\n   * @param filterName      optional label shown in the view header\r\n   */\r\n  async activateResources(filterProjects: string[] | null = null, filterName: string = \"\") {\r\n    // If filterProjects is empty, treat it as \"show all\"\r\n    if (Array.isArray(filterProjects) && filterProjects.length === 0) {\r\n      filterProjects = null;\r\n    }\r\n    // Re‑use an existing Resources view if open\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_RESOURCES)[0];\r\n\r\n    // Otherwise create a new leaf to the right of the active pane\r\n    if (!leaf) {\r\n      const active = this.app.workspace.activeLeaf;\r\n      leaf = active\r\n        ? this.app.workspace.splitActiveLeaf(\"vertical\")\r\n        : this.app.workspace.getLeaf(true);\r\n    }\r\n\r\n    // Conditionally omit filterProjects if null, so view defaults to \"all\"\r\n    const stateObj: { filterName: string; filterProjects?: string[] } = { filterName };\r\n    if (filterProjects) stateObj.filterProjects = filterProjects;\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_RESOURCES,\r\n      active: true,\r\n      state:  stateObj,\r\n    });\r\n    // If the view is already mounted, update its filter in-place\r\n    const v = leaf.view as ResourcesView;\r\n    if (v?.updateFilter)\r\n      v.updateFilter(filterProjects ?? null, filterName);\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n  /**\r\n   * Open the Dashboard view.\r\n   * @param filterProjects  array of project paths to pre‑filter (empty = all)\r\n   * @param filterName      optional label shown in the view header\r\n   */\r\n  async activateDashboard(filterProjects: string[] | null = null, filterName: string = \"\") {\r\n    // If filterProjects is empty, treat it as \"show all\"\r\n    if (Array.isArray(filterProjects) && filterProjects.length === 0) {\r\n      filterProjects = null;\r\n    }\r\n    // Re‑use an existing Dashboard view if open\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_DASHBOARD)[0];\r\n\r\n    // Otherwise create a new leaf to the right of the active pane\r\n    if (!leaf) {\r\n      const active = this.app.workspace.activeLeaf;\r\n      leaf = active\r\n        ? this.app.workspace.splitActiveLeaf(\"vertical\")\r\n        : this.app.workspace.getLeaf(true);\r\n    }\r\n\r\n    // Conditionally omit filterProjects if null, so view defaults to \"all\"\r\n    const stateObj: { filterName: string; filterProjects?: string[] } = { filterName };\r\n    if (filterProjects) stateObj.filterProjects = filterProjects;\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_DASHBOARD,\r\n      active: true,\r\n      state:  stateObj,\r\n    });\r\n    // If the view is already mounted, update its filter in-place\r\n    const v = leaf.view as DashboardView;\r\n    if (v?.updateFilter)\r\n      v.updateFilter(filterProjects ?? null, filterName);\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  /**\r\n   * Open the Today view.\r\n   */\r\n  async activateToday() {\r\n    // Re‑use an existing Today view if open\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_TODAY)[0];\r\n\r\n    // Otherwise create a new leaf to the right of the active pane\r\n    if (!leaf) {\r\n      const active = this.app.workspace.activeLeaf;\r\n      leaf = active\r\n        ? this.app.workspace.splitActiveLeaf(\"vertical\")\r\n        : this.app.workspace.getLeaf(true);\r\n    }\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_TODAY,\r\n      active: true,\r\n    });\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n\r\n  /**\r\n   * Open the Calendar view.\r\n   */\r\n  async activateCalendar() {\r\n    // Re‑use an existing Calendar view if open\r\n    let leaf = this.app.workspace.getLeavesOfType(VIEW_TYPE_PM_CALENDAR)[0];\r\n\r\n    // Otherwise create a new leaf to the right of the active pane\r\n    if (!leaf) {\r\n      const active = this.app.workspace.activeLeaf;\r\n      leaf = active\r\n        ? this.app.workspace.splitActiveLeaf(\"vertical\")\r\n        : this.app.workspace.getLeaf(true);\r\n    }\r\n\r\n    await leaf.setViewState({\r\n      type:   VIEW_TYPE_PM_CALENDAR,\r\n      active: true,\r\n    });\r\n    this.app.workspace.revealLeaf(leaf);\r\n  }\r\n  /**\r\n   * Create or remove ribbon icons according to current settings.\r\n   * Called onload() and whenever a toggle changes in Settings.\r\n   */\r\n  public refreshRibbonIcons() {\r\n    const s = this.settings;\r\n\r\n    /* Progress */\r\n    if (s.showProgressRibbon && !this.ribbons.progress) {\r\n      this.ribbons.progress = this.addRibbonIcon(\r\n        \"bar-chart-2\",\r\n        \"Open Project Progress\",\r\n        () => this.activateProgress()\r\n      );\r\n    } else if (!s.showProgressRibbon && this.ribbons.progress) {\r\n      this.ribbons.progress.detach();\r\n      delete this.ribbons.progress;\r\n    }\r\n\r\n    /* Timeline */\r\n    if (s.showTimelineRibbon && !this.ribbons.timeline) {\r\n      this.ribbons.timeline = this.addRibbonIcon(\r\n        \"calendar-clock\",\r\n        \"Open Project Timeline\",\r\n        () => this.activateTimeline()\r\n      );\r\n    } else if (!s.showTimelineRibbon && this.ribbons.timeline) {\r\n      this.ribbons.timeline.detach();\r\n      delete this.ribbons.timeline;\r\n    }\r\n\r\n    /* Task‑Weeks */\r\n    if (s.showTaskRibbon && !this.ribbons.taskWeeks) {\r\n      this.ribbons.taskWeeks = this.addRibbonIcon(\r\n        \"calendar-check\",\r\n        \"Open Weekly Task View\",\r\n        () => this.activateTaskWeeks()\r\n      );\r\n    } else if (!s.showTaskRibbon && this.ribbons.taskWeeks) {\r\n      this.ribbons.taskWeeks.detach();\r\n      delete this.ribbons.taskWeeks;\r\n    }\r\n\r\n    /* Resources */\r\n    if (s.showResourcesRibbon && !this.ribbons.resources) {\r\n      this.ribbons.resources = this.addRibbonIcon(\r\n        \"users\",\r\n        \"Open Resources View\",\r\n        () => this.activateResources()\r\n      );\r\n    } else if (!s.showResourcesRibbon && this.ribbons.resources) {\r\n      this.ribbons.resources.detach();\r\n      delete this.ribbons.resources;\r\n    }\r\n\r\n    /* Portfolio icon is always shown – nothing to toggle */\r\n    if (!this.ribbons.portfolio && !this.addedPortfolio) {\r\n      this.addRibbonIcon(\"layers\", \"Open Project Management\", () =>\r\n        this.activatePortfolio()\r\n      );\r\n      this.addedPortfolio = true;\r\n    }\r\n\r\n    /* Calendar */\r\n    if (s.showCalendarRibbon && !this.ribbons.calendar) {\r\n      this.ribbons.calendar = this.addRibbonIcon(\r\n        \"calendar-days\",\r\n        \"Open Calendar View\",\r\n        () => this.activateCalendar()\r\n      );\r\n    } else if (!s.showCalendarRibbon && this.ribbons.calendar) {\r\n      this.ribbons.calendar.detach();\r\n      delete this.ribbons.calendar;\r\n    }\r\n\r\n\r\n  }\r\n}"],"names":["styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","formatDate","d","Date","toLocaleDateString","projectStatus","nextDue","pct","overrideOnTrack","label","cls","today","diff","getTime","progressClass","statusTooltip","due","Math","ceil","isTaskDone","t","done","checked","toLowerCase","status","s","includes","percentComplete","raw","_a","text","_b","toString","test","_c","props","completed","_d","orderTasksDash","tasks","Set","out","storiesByEpic","Map","subsByStory","forEach","id","epicRef","epic","trim","get","set","push","storyRef","_f","_e","story","_g","pushCascade","has","add","VIEW_TYPE_PM_PROGRESS","ProjectProgressView","ItemView","constructor","leaf","cache","settings","super","this","icon","sortField","sortAsc","collapsed","firstRender","showEpics","showStories","showSubTasks","originalPaths","filterText","detachFn","setState","state","result","filterProjects","Array","isArray","filterPaths","undefined","filterName","render","updateFilter","paths","name","length","getViewType","getDisplayText","onOpen","container","contentEl","onChange","onClose","call","allCollapsed","size","projects","toggleAll","clear","values","map","p","file","path","toggle","delete","querySelectorAll","el","remove","empty","addClass","topbar","createEl","globalCaret","setIcon","cursor","onclick","searchInput","placeholder","value","oninput","caretPos","selectionStart","again","querySelector","focus","setSelectionRange","projBtn","createSpan","caret","ddOpen","ddEl","buildDropdown","projectList","className","controls","e","preventDefault","wrap","cb","marginRight","display","width","height","isChecked","setAttribute","basename","newChecked","getAttribute","selected","from","filter","body","r","getBoundingClientRect","left","top","bottom","ddW","offsetWidth","ddH","offsetHeight","window","innerWidth","max","innerHeight","above","closeDropdown","sort","a","b","localeCompare","onDoc","contains","target","removeEventListener","setTimeout","addEventListener","assigneesBtn","assigneesCaret","assigneesDdOpen","assigneesDdEl","buildAssigneesDropdown","assigneesList","filterAssignees","portfolioAssignees","proj","assignee","owner","split","n","cleaned","closeAssigneesDropdown","assigneesMap","entries","epicIcon","marginLeft","opacity","setAttr","epicTip","classList","textContent","storyIcon","storyTip","subTasksIcon","subTasksTip","table","colgroup","w","attr","headerRow","field","th","ico","tbody","attachStatusPopup","cell","msg","tip","ev","mouse","h","clientX","clientY","some","dir","statusRank","indexOf","ratio","completedTasks","totalTasks","dv","Number","POSITIVE_INFINITY","stat","mtime","project","matchesFilter","autoExpand","row","isCollapsed","nameCell","stopPropagation","projLink","href","app","workspace","openLinkText","doneTasks","projHover","metadataCache","getFileCache","fm","frontmatter","val","k","replace","html","innerHTML","right","projTasks","toUpperCase","startsWith","progCell","pctNum","round","stTd","renderedEpics","renderedStories","idU","isEpic","isStory","isSubTask","epicCell","colspan","paddingLeft","epicLink","_h","_j","filePath","description","tipW","tipH","storyCell","storyLink","_k","_l","_m","tRow","tName","idTag","_o","indentLevel","chk","prefix","match","anchor","_p","_q","_r","hoverTip","idUpper","_s","tProg","pctRaw","_t","tPct","_u","childTasks","sb","depends","pctSum","reduce","sum","st","pcRaw","min","idUp","taskText","gatherDescendants","rootId","desc","seen","queue","pid","shift","candidate","cid","cand","tasksCell","isDone","toggleBtn","tooltip","rect","hideToggleTip","capture","once","async","toggleTaskCompletion","hideToggleTip2","setText","taskDueIso","_w","_v","taskStartIso","_y","_x","taskDue","taskMtime","_3","_2","_1","_z","updated","taskStatusVal","idUpForStatus","_4","isEpicRow","isStoryRow","isSBRow","pctForStatus","tLabel0","tCls0","tLabel","tCls","statusCell","whiteSpace","badgeEl","iconBtn","verticalAlign","hideStatusTip1","hideStatusTip2","hideStatusTip3","lines","vault","read","checkboxRegex","found","lineIdx","line","i","box","replacement","join","modify","popup","closest","projectFlagProperty","task","focusSearch","getTaskPriority","priority","triggerNativeDatePicker","currentDate","onSelect","console","log","dateInput","position","transform","zIndex","pointerEvents","removeChild","showPicker","ZOOM_STOPS","currentDrag","currentProjDrag","VIEW_TYPE_PM_TIMELINE","TimelineView","plugin","pluginInst","heatLayerEl","renderQueued","labelWidth","zoomPxPerDay","saved","plugins","zoomRenderScheduled","timelineRows","zoomStyleUpdateScheduled","sortByStartDate","pendingScroll","hiddenProjects","hideBarsWhenCollapsed","collapsedTasks","splitterRO","renderTimeout","pendingSettingsChanges","renderBatchTimeout","pendingRenderOperations","getIcon","saveAndRender","debouncedRender","delay","clearTimeout","saveAndRenderDebounced","saveSettings","batchRender","operation","renderFlatTaskList","leftPane","rightPane","pxPerDay","horizon","getDescription","rawK","rawV","Object","v","cells","pop","dateRe","slice","Boolean","anyT","isTaskOnHold","renderTask","rowLeft","rowRight","minWidth","hold","taskLink","idLower","num","indent","availableWidth","showTip","shortTxt","idPrefix","idL","who","fmt","startIso","dueIso","x","y","hideTip","openAndScroll","barWrap","start","moment","isValid","startOff","spanDays","bar","isOnHold","dOff","showTooltips","buildHtml","priorityText","charAt","barTooltip","dragMoved","dragStartX","allowBarMove","origSpan","leftHandle","rightHandle","touchAction","background","button","setPointerCapture","pointerId","currentLeft","parseFloat","currentDayOffset","currentWidth","currentSpan","barEl","startClientX","originalDayOffset","originalSpan","taskPath","mode","abs","deltaPx","deltaDays","newOffset","newSpan","releasePointerCapture","containerEl","dispatchEvent","CustomEvent","detail","offsetX","clientWidth","allTasks","hideCompletedTasks","hideOnHoldTasks","aStart","bStart","showHeatmap","heat","allSubtasks","dayOffset","renderHeatmap","headerWrap","hl","updateZoomStyles","disconnect","blockId","startTime","now","tryScroll","mdView","getActiveViewOfType","MarkdownView","requestAnimationFrame","scrollIntoView","behavior","block","editor","ch","to","barTip","showBarTip","hideBarTip","attachTip","iconTip","m","prevRight","restoreScroll","scrollTop","scrollLeft","topHeader","topControls","rightControls","alignIcons","splitRect","globalSplit","headerRect","off","svg","outer","barsById","tasksById","norm","key","taskOrId","milestoneOffsets","milestoneMap","addHeat","startOffset","span","dayOfWeek","startOf","day","allTasksByPath","arr","overflow","overflowX","deltaY","passive","arrowLayer","createElementNS","lastRow","headerHeight","totalHeight","offsetTop","addLine","div","fullData","format","fake","gridRow","offsetLeft","showMilestones","offset","leftPx","milestoneData","parts","labelText","fontSize","fontWeight","color","backgroundColor","padding","borderRadius","boxShadow","border","rightSpacer","flexShrink","leftSpacer","arrowsEnabled","showArrows","barsMode","showTasksInTimeline","heatmapEnabled","normPath","tlIsTaskDone","tlIsTaskOnHold","filterSet","isProjectVisible","timelineStart","latestEndDays","latest","iso","isAfter","lastDay","endOf","oneYearDays","timelineEnd","end","syncSplitterHeight","viewportH","clientHeight","minHeight","scrollHeight","ResizeObserver","observe","splitDragId","dragging","userSelect","labels","widest","l","scrollWidth","maxWidth","newWidth","hdr","hasCaret","previousElementSibling","indentPx","caretW","extraWidth","parentElement","prevSibling","nextSibling","nextElementSibling","endSplitDrag","monthRow","syncZoomPos","zoomWrap","slider","alignItems","gap","step","idx","valueAsNumber","newPx","timeNavSep","margin","timeSlider","dateDisplay","rightEl","totalWidth","viewportWidth","maxScroll","updateDateDisplay","endDayOffset","startDate","clone","endDate","scrollPos","scrollPercent","dragStartValIdx","stepPxPerStop","onDragMove","rawIdx","newIdx","onDragEnd","onpointerdown","trackWidth","realToday","date","dayCell","isSame","weekLabel","textAlign","marginTop","daysInMonth","nameHeader","sortIcon","toggleIcon","allCaret","allCaretIcon","hideBarsToggle","updateHideBarsIcon","heatToggle","updateHeatIcon","moveToggle","updateMoveIcon","arrowToggle","updateArrowIcon","assigneeToggle","updateAssigneeIcon","showAssignees","tooltipToggle","updateTooltipIcon","hideCompletedToggle","updateHideCompletedIcon","hideOnHoldToggle","updateHideOnHoldIcon","exportImageToggle","exportAsImage","exportHtmlToggle","exportAsHtml","milestoneToggle","updateMilestoneIcon","startDateSortToggle","updateStartDateSortIcon","startCal","startLabel","endCal","endLabel","refreshCalLabels","orderTasks","projectPath","epicId","storyId","getTaskStartDate","taskList","isSub","storyKey","String","epicField","pushStoryWithSubs","kids","epics","stories","standaloneStories","remainingTasks","projMilestones","normP","milestones","fileStr","title","dataset","eyeSpan","eyeIcon","isHidden","updateEyeVis","hide","TFile","want","keys","eyeW","taskKey","highlightArrows","fakeRect","isPlainS","projStart","projEnd","NEGATIVE_INFINITY","fileCache","pick","endIso","ISO_8601","isSameOrAfter","isFinite","base","baseTip","showBaseTip","hideBaseTip","dia","showBars","taskRowLeft","taskId","durationDays","show","rawLine","low","origOffset","bubbles","deltaStart","deltaDue","lbl","leftPx2","widthPx","projBar","projBaseTip","showProjBaseTip","hideProjBaseTip","edge","originalStart","originalWidth","deltaEnd","firstLine","shortText","numMatch","taskRowRight","taskBarWrap","dueIsoBar","startIsoBar","suppress","stopImmediatePropagation","unhook","projTip","showProjTip","hideProjTip","on","src","dst","setProperty","hovUrl","removeProperty","removeAttribute","baseUrl","drawArrows","containerRect","svgNS","defs","uniq","random","markerId","hoverMarkerId","marker","markerHover","headHover","depStr","linkType","depId","colon","srcId","srcTask","srcRect","dstRect","y1","y2","srcLeft","srcRight","dstLeft","dstRight","x1","x2","padH","midY","hoverMarker","hoverPath","pmBars","count","heatMin","heatMax","fracRaw","frac","hue","light","dateStr","Notice","leftClone","cloneNode","rightClone","wrapper","bodyWrap","Promise","resolve","scale","canvas","ctx","getContext","isDark","fillStyle","fillRect","drawNode","node","baseRect","styles","getComputedStyle","visibility","bgColor","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","strokeStyle","borderTopColor","borderColor","lineWidth","beginPath","moveTo","lineTo","stroke","borderRightColor","borderBottomColor","borderLeftColor","centerX","centerY","radius","save","arc","PI","barWidth","barHeight","restore","children","child","HTMLElement","childNodes","nodeType","Node","TEXT_NODE","fontStyle","font","fontFamily","textBaseline","paddingTop","align","fillText","wrapperRect","toBlob","blob","filename","downloadUrl","URL","createObjectURL","link","download","click","revokeObjectURL","error","Error","message","collectStyles","element","prop","getPropertyValue","cssRules","styleSheets","sheet","rule","outerHTML","Blob","newProject","targetFolder","_pmCreatingProject","ask","res","Modal","input","close","open","projNum","momentFn","pmPlugin","getPlugin","flagKey","safeNum","safeNumDot","endsWith","fileName","template","tplPath","projectTemplate","tplFile","getFileByPath","cachedRead","flagRE","RegExp","p1","p2","_pFalse","p4","dirPath","fullPath","normalizePath","existing","create","foundFile","getLeaf","openFile","newActionItem","ActionItemModal","data","dueDate","parentEpic","parentStory","dependency","dependencyType","assignees","projectTasks","loadProjects","loadAssignees","loadProjectTasks","assigneeSet","updateDependencyDropdown","dependencyDropdown","selectEl","addOption","displayText","setValue","getEpicsForProject","getStoriesForEpic","updateParentEpicDropdown","parentEpicDropdown","updateParentStoryDropdown","parentStoryDropdown","updateParentControlsVisibility","parentEpicSetting","settingEl","parentStorySetting","Setting","setName","setDesc","addDropdown","dropdown","addText","setPlaceholder","addTextArea","inputEl","rows","datalistId","datalist","dependencySetting","buttonContainer","createActionItem","projectFile","generateTaskId","taskLine","createTaskLine","updatedLines","insertTaskIntoTable","reindex","existingTasks","getProjectTasks","nextNumber","parseInt","dependencyLine","newLines","tableStart","tableEnd","splice","insertIndex","tableRow","createTableRow","yr","wk","isoWeekYear","isoWeek","pushWithSubs","VIEW_TYPE_PM_TASKWEEKS","TaskWeeksView","totalGroups","currentPaths","visibleWeekPaths","displayMode","sortMode","collapsedProjects","assigneeFilter","getViewState","every","visiblePaths","areAllProjectsCollapsed","visibleProjectNames","projectName","collapsedKey","collapseAllProjects","findIndex","modeToggle","tooltipTimeout","showTooltip","event","hideTooltip","newTooltipText","wasAllCollapsed","caretEl","sortToggle","sortTooltip","sortTooltipTimeout","showSortTooltip","hideSortTooltip","globalProjectToggle","globalTooltip","globalTooltipTimeout","hideGlobalTooltip","showGlobalTooltip","tableContainer","keysToRemove","weekPaths","weekPath","newTableContainer","newScrollHeight","adjustedScrollTop","projCaret","newFilter","asnBtn","asnCaret","adOpen","adEl","buildAssigneeDropdown","list","ctl","closeAssigneeDropdown","port","visibleAss","nameKey","autoChecked","weekMap","dateToUse","wkKey","padStart","valueOf","todayKey","todayTasks","week","todayWeek","sbTasks","sa","todayDate","subtract","isSameOrBefore","isToday","matchesAssignees","subTasks","tk","taskWeeksOverloadThreshold","wTd","projectGroups","sortedProjects","_isProjectDivider","_projectName","_originalTasks","sortedProjectTasks","textA","textB","isProjectCollapsed","dividerRow","dividerContent","chevron","taskProjectName","taskIdUpper","aName","_0","_6","_5","_10","_9","_7","sTd","_12","statusWrapper","createDiv","projCell","_13","tFile","getCache","fmVal","_14","registry","people","listPeople","addPerson","VIEW_TYPE_PM_RESOURCES","ResourcesView","visibleGroupIds","visible","blockTooltip","agMap","rawAssignee","raw0","grp","g","counted","resourcesOverloadThreshold","editBtn","onEdit","showAssigneePicker","isSB","stCell","vis","visAllCollapsed","gatherAssigneesFromTasks","old","picker","listWrap","currentAssignee","footer","summary","btnWrap","btnOk","btnCancel","selectedName","opt","removeClass","reassignTask","pickerW","pickerH","newId","f","note","dvLine","lineNumber","bulletRE","snippet","ln","rowIdx","c","hasLead","hasTrail","col","newRow","replaced","_","pKey","newLine","lim","p2b","n2b","b2n","n2p","map$1","A","B","C","D","E","F","hex","h1","h2","eq","hexString","isShort","alpha","HUE_RE","hsl2rgbn","hsv2rgbn","hwb2rgbn","rgb","rgb2hsl","hueValue","calln","hsl2rgb","hueParse","str","exec","hwb2rgb","hsv2rgb","Z","Y","X","W","V","U","T","S","R","Q","P","O","N","M","L","K","G","H","I","J","names$1","OiceXe","antiquewEte","aqua","aquamarRe","azuY","beige","bisque","black","blanKedOmond","Xe","XeviTet","bPwn","burlywood","caMtXe","KartYuse","KocTate","cSO","cSnflowerXe","cSnsilk","crimson","cyan","xXe","xcyan","xgTMnPd","xWay","xgYF","xgYy","xkhaki","xmagFta","xTivegYF","xSange","xScEd","xYd","xsOmon","xsHgYF","xUXe","xUWay","xUgYy","xQe","xviTet","dAppRk","dApskyXe","dimWay","dimgYy","dodgerXe","fiYbrick","flSOwEte","foYstWAn","fuKsia","gaRsbSo","ghostwEte","gTd","gTMnPd","Way","gYF","gYFLw","gYy","honeyMw","hotpRk","RdianYd","Rdigo","ivSy","khaki","lavFMr","lavFMrXsh","lawngYF","NmoncEffon","ZXe","ZcSO","Zcyan","ZgTMnPdLw","ZWay","ZgYF","ZgYy","ZpRk","ZsOmon","ZsHgYF","ZskyXe","ZUWay","ZUgYy","ZstAlXe","ZLw","lime","limegYF","lRF","magFta","maPon","VaquamarRe","VXe","VScEd","VpurpN","VsHgYF","VUXe","VsprRggYF","VQe","VviTetYd","midnightXe","mRtcYam","mistyPse","moccasR","navajowEte","navy","Tdlace","Tive","TivedBb","Sange","SangeYd","ScEd","pOegTMnPd","pOegYF","pOeQe","pOeviTetYd","papayawEp","pHKpuff","peru","pRk","plum","powMrXe","purpN","YbeccapurpN","Yd","Psybrown","PyOXe","saddNbPwn","sOmon","sandybPwn","sHgYF","sHshell","siFna","silver","skyXe","UXe","UWay","UgYy","snow","sprRggYF","stAlXe","tan","teO","tEstN","tomato","Qe","viTet","JHt","wEte","wEtesmoke","Lw","LwgYF","names","nameParse","unpacked","tkeys","j","ok","nk","unpack","transparent","RGB_RE","pow","modHSL","tmp","proto","assign","fromObject","functionParse","rgbParse","Color","ret","len","_rgb","_valid","valid","obj","rgbString","hslString","mix","weight","c1","c2","w2","w1","interpolate","rgb1","rgb2","clearer","greyscale","opaquer","negate","lighten","darken","saturate","desaturate","rotate","deg","noop","uid","isNullOrUndef","prototype","isObject","isNumberFinite","finiteOrDefault","defaultValue","valueOrDefault","toDimension","dimension","callback","fn","args","thisArg","apply","each","loopable","reverse","_elementsEqual","a0","a1","ilen","v0","v1","datasetIndex","index","source","klen","isValidKey","_merger","options","tval","sval","merge","sources","merger","current","mergeIf","_mergerIf","hasOwnProperty","keyResolvers","o","resolveObjectKey","resolver","part","_splitKey","_getKeyResolver","_capitalize","defined","isFunction","setsEqual","item","TAU","PITAU","INFINITY","RAD_PER_DEG","HALF_PI","QUARTER_PI","TWO_THIRDS_PI","log10","sign","almostEquals","epsilon","niceNum","range","roundedRange","niceRange","floor","fraction","isNumber","Symbol","toPrimitive","isNonPrimitive","isNaN","_setMinAndMaxByKey","array","property","toRadians","degrees","toDegrees","radians","_decimalPlaces","getAngleFromPoint","centrePoint","anglePoint","distanceFromXCenter","distanceFromYCenter","radialDistanceFromCenter","sqrt","angle","atan2","distance","distanceBetweenPoints","pt1","pt2","_angleDiff","_normalizeAngle","_angleBetween","sameAngleIsFullCircle","angleToStart","angleToEnd","startToAngle","endToAngle","_limitValue","_isBetween","_lookup","cmp","mid","hi","lo","_lookupByKey","last","ti","_rlookupByKey","arrayEvents","unlistenArrayEvents","listener","stub","_chartjs","listeners","_arrayUnique","items","requestAnimFrame","throttled","argsToUse","ticking","_toLeftRightCenter","_alignStartEnd","_getStartAndCountOfVisiblePoints","meta","points","animationsDisabled","pointCount","_sorted","iScale","vScale","_parsed","spanGaps","axis","minDefined","maxDefined","getUserBounds","getPixelForValue","distanceToDefinedLo","point","distanceToDefinedHi","_scaleRangesChanged","xScale","yScale","_scaleRanges","newRanges","xmin","xmax","ymin","ymax","changed","atEdge","elasticIn","sin","elasticOut","effects","linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","cos","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce","isPatternOrGradient","getHoverColor","numbers","colors","intlCache","formatNumber","locale","cacheKey","JSON","stringify","formatter","Intl","NumberFormat","getNumberFormat","formatters","numeric","tickValue","ticks","chart","notation","delta","maxTick","calculateDelta","logDelta","numDecimal","minimumFractionDigits","maximumFractionDigits","logarithmic","remain","significand","Ticks","overrides","descriptors","getScope$1","root","scope","Defaults","_descriptors","_appliers","animation","datasets","devicePixelRatio","context","platform","getDevicePixelRatio","elements","events","family","lineHeight","hover","hoverBackgroundColor","hoverBorderColor","hoverColor","indexAxis","interaction","intersect","includeInvisible","maintainAspectRatio","onHover","onClick","parsing","responsive","scales","showLine","drawActiveElementsOnTop","describe","override","route","targetScope","targetName","scopeObject","targetScopeObject","privateName","defineProperties","writable","enumerable","local","appliers","defaults","_scriptable","_indexable","_fallback","duration","easing","loop","properties","active","resize","animations","autoPadding","beginAtZero","bounds","clip","grace","grid","drawOnChartArea","drawTicks","tickLength","tickWidth","_ctx","tickColor","dash","dashOffset","minRotation","maxRotation","mirror","textStrokeWidth","textStrokeColor","autoSkip","autoSkipPadding","labelOffset","minor","major","crossAlign","showLabelBackdrop","backdropColor","backdropPadding","_measureText","gc","longest","string","textWidth","measureText","_longestText","arrayOfThings","garbageCollect","jlen","thing","nestedThing","gcLen","_alignPixel","pixel","currentDevicePixelRatio","halfWidth","clearCanvas","resetTransform","clearRect","drawPoint","drawPointLegend","xOffset","yOffset","cornerRadius","xOffsetW","yOffsetW","pointStyle","rotation","rad","translate","drawImage","ellipse","closePath","SQRT1_2","fill","borderWidth","_isPointInArea","area","clipArea","unclipArea","_steppedLineTo","previous","flip","midpoint","_bezierCurveTo","bezierCurveTo","cp1x","cp2x","cp1y","cp2y","decorateText","opts","strikethrough","underline","metrics","actualBoundingBoxLeft","actualBoundingBoxRight","actualBoundingBoxAscent","actualBoundingBoxDescent","yDecoration","decorationWidth","drawBackdrop","oldColor","renderText","strokeWidth","strokeColor","translation","setRenderOpts","backdrop","strokeText","addRoundedRectPath","topLeft","bottomLeft","bottomRight","topRight","LINE_HEIGHT","FONT_STYLE","toLineHeight","matches","numberOrZero","_readValueToProps","objProps","toTRBL","toTRBLCorners","toPadding","toFont","fallback","warn","toFontString","inputs","info","cacheable","createContext","parentContext","_createResolver","scopes","prefixes","rootScopes","getTarget","finalRootScopes","_resolve","toStringTag","_cacheable","_scopes","_rootScopes","_getTarget","Proxy","deleteProperty","_keys","_cached","proxy","readKey","needsSubResolver","createSubResolver","_resolveWithPrefixes","getOwnPropertyDescriptor","Reflect","getPrototypeOf","getKeysFromAllScopes","ownKeys","storage","_storage","_attachContext","subProxy","descriptorDefaults","_proxy","_context","_subProxy","_stack","setContext","receiver","isScriptable","getValue","_resolveScriptable","isIndexable","_resolveArray","_resolveWithContext","allKeys","configurable","scriptable","indexable","_allKeys","resolveFallback","getScope","parent","addScopes","parentScopes","parentFallback","allScopes","addScopesFromKey","subGetTarget","resolveKeysFromAllScopes","_parseObjectDataRadialScale","_parsing","parsed","parse","EPSILON","getPoint","skip","getValueAxis","splineCurve","firstPoint","middlePoint","afterPoint","next","d01","d12","s01","s12","fa","fb","splineCurveMonotone","valueAxis","pointsLen","deltaK","mK","pointBefore","pointCurrent","pointAfter","slopeDelta","alphaK","betaK","tauK","squaredMagnitude","monotoneAdjust","iPixel","vPixel","monotoneCompute","capControlPoint","pt","_updateBezierControlPoints","controlPoints","cubicInterpolationMode","prev","tension","capBezierPoints","inArea","inAreaPrev","inAreaNext","_isDomSupported","_getParentNode","domNode","parentNode","host","parseMaxStyle","styleValue","parentProperty","valueInPixels","ownerDocument","defaultView","positions","getPositionedStyle","suffix","pos","getRelativePosition","borderBox","boxSizing","paddings","borders","touches","offsetY","shadowRoot","useOffsetPos","getCanvasPosition","round1","getMaximumSize","bbWidth","bbHeight","aspectRatio","margins","maxHeight","containerSize","containerStyle","containerBorder","containerPadding","getContainerSize","retinaScale","forceRatio","forceStyle","pixelRatio","deviceHeight","deviceWidth","setTransform","supportsEventListenerOptions","passiveSupported","readUsedSize","getStyle","_pointInLine","_steppedInterpolation","_bezierInterpolation","cp1","cp2","getRtlAdapter","rtl","rectX","setWidth","xPlus","leftForLtr","itemWidth","getRightToLeftAdapter","_itemWidth","overrideTextDirection","direction","original","getPropertyPriority","prevTextDirection","restoreTextDirection","propertyFn","between","compare","normalize","normalizeSegment","_boundSegment","segment","startBound","endBound","getSegment","prevValue","inside","subStart","shouldStart","shouldStop","_boundSegments","segments","sub","splitByStyles","segmentOptions","chartContext","_chart","baseStyle","readStyle","_datasetIndex","prevStyle","addStyle","p0","p0DataIndex","p1DataIndex","styleChanged","doSplitByStyles","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","replacer","getSizeForArea","chartArea","getDatasetClipArea","_clip","disabled","getDatasetArea","Animator","_request","_charts","_running","_lastDate","_notify","anims","callbacks","numSteps","initial","currentStep","_refresh","_update","remaining","running","draw","_active","_total","tick","_getAnims","charts","complete","progress","listen","acc","cur","_duration","stop","cancel","animator","interpolators","boolean","factor","c0","number","Animation","cfg","currentValue","_fn","_easing","_start","_loop","_target","_prop","_from","_to","_promises","update","elapsed","wait","promises","rej","resolved","method","Animations","config","_properties","configure","animationOptions","animatedProps","getOwnPropertyNames","option","_animateOptions","newOptions","$shared","$animations","resolveTargetOptions","_createAnimations","anim","all","awaitAll","then","scaleClip","allowedOverflow","getSortedDatasetIndices","filterVisible","metasets","_getSortedDatasetMetas","applyStack","stack","dsIndex","singleMode","otherValue","isStacked","stacked","getOrCreateStack","stacks","stackKey","indexValue","subStack","getLastIndexInStack","positive","getMatchingVisibleMetas","updateStacks","controller","_cachedMeta","_stacks","iAxis","vAxis","indexScale","valueScale","getStackKey","_top","_bottom","_visualValues","getFirstScaleId","clearStacks","isDirectUpdateMode","cloneIfNotShared","cached","shared","DatasetController","static","_cachedDataOpts","getMeta","_type","_data","_objectData","_sharedOptions","_drawStart","_drawCount","enableOptionSharing","supportsDecimation","$context","_syncList","datasetElementType","dataElementType","initialize","linkScales","_stacked","addElements","isPluginEnabled","updateIndex","getDataset","chooseId","xid","xAxisID","yid","yAxisID","rid","rAxisID","iid","iAxisID","vid","vAxisID","getScaleForId","rScale","getDatasetMeta","scaleID","_getOtherScale","reset","_destroy","_dataCheck","iAxisKey","vAxisKey","adata","convertObjectDataToArray","isExtensible","defineProperty","object","buildOrUpdateElements","resetNewElements","stackChanged","oldStacked","_resyncElements","scopeKeys","datasetScopeKeys","getOptionScopes","createResolver","sorted","parseArrayData","parseObjectData","parsePrimitiveData","isNotInOrderComparedToPrev","getLabels","singleScale","xAxisKey","yAxisKey","getParsed","getDataElement","updateRangeFromParsed","parsedValue","NaN","getMinMax","canStack","otherScale","hidden","createStack","otherMin","otherMax","_skip","getAllParsedValues","getMaxOverflow","getLabelAndValue","getLabelForValue","toClip","defaultClip","resolveDatasetElementOptions","resolveDataElementOptions","dataIndex","createDataContext","createDatasetContext","_resolveElementOptions","elementType","sharing","datasetElementScopeKeys","resolveNamedOptions","freeze","_resolveAnimations","transition","datasetAnimationScopeKeys","getSharedOptions","includeOptions","sharedOptions","_animationsDisabled","_getSharedOptions","firstOpts","previouslySharedOptions","updateSharedOptions","updateElement","_setStyle","removeHoverStyle","setHoverStyle","_removeDatasetHoverStyle","_setDatasetHoverStyle","arg1","arg2","numMeta","numData","_insertElements","_removeElements","move","updateElements","removed","_sync","_dataChanges","_onDataPush","arguments","_onDataPop","_onDataShift","_onDataSplice","newCount","_onDataUnshift","computeMinSampleSize","_cache","$bar","visibleMetas","concat","getAllScaleValues","curr","_length","updateMinAndPrev","getPixelForTick","parseValue","entry","startValue","endValue","barStart","barEnd","_custom","parseFloatBar","parseArrayOrPrimitive","isFloatBar","custom","setBorderSkipped","borderSkipped","horizontal","borderProps","enableBorderRadius","parseEdge","orig","v2","startEnd","setInflateAmount","inflateAmount","DoughnutController","animateRotate","animateScale","cutout","circumference","spacing","legend","generateLabels","fontColor","getDataVisibility","legendItem","toggleDataVisibility","innerRadius","outerRadius","getter","_getRotation","_getCircumference","_getRotationExtents","isDatasetVisible","arcs","getMaxBorderWidth","getMaxOffset","maxSize","chartWeight","_getRingWeight","ratioX","ratioY","startAngle","endAngle","startX","startY","endX","endY","calcMax","calcMin","maxX","maxY","minX","minY","getRatioAndOffset","maxRadius","radiusLength","_getVisibleDatasetWeightTotal","total","calculateTotal","_getRingWeightOffset","_circumference","calculateCircumference","animationOpts","metaData","borderAlign","hoverBorderWidth","hoverOffset","ringWeightOffset","PolarAreaController","angleLines","circular","pointLabels","bind","_updateRadius","minSize","cutoutPercentage","getVisibleDatasetCount","xCenter","yCenter","datasetStartAngle","getIndexAngle","defaultAngle","countVisibleElements","_computeAngle","getDistanceFromCenterForValue","controllers","__proto__","BarController","categoryPercentage","barPercentage","grouped","_index_","_value_","bars","getBasePixel","isHorizontal","ruler","_getRuler","vpixels","_calculateBarValuePixels","ipixels","_calculateBarIndexPixels","center","_getStacks","currentParsed","iScaleValue","skipNull","find","_getStackCount","_getAxisCount","_getAxis","getFirstScaleIdForIndexAxis","indexScaleId","firstScaleAxisId","_getStackIndex","pixels","barThickness","_startPixel","_endPixel","stackCount","baseValue","minBarLength","actualBase","floating","barSign","startPixel","getPixelForDecimal","endPixel","getValueForPixel","halfGrid","getLineWidthForValue","maxBarThickness","Infinity","axisCount","percent","chunk","computeFlexCategoryTraits","thickness","computeFitCategoryTraits","axisID","axisNumber","stackIndex","rects","BubbleController","LineController","_dataset","_decimated","animated","maxGapLength","directUpdate","pointsCount","prevParsed","nullData","lastPoint","updateControlPoints","PieController","RadarController","_fullLoop","pointPosition","getPointPositionForValue","ScatterController","getElement","abstract","DateAdapterBase","members","init","formats","adapters","binarySearch","metaset","lookupMethod","_reversePixels","getRange","evaluateInteractionItems","handler","getSortedVisibleDatasetMetas","getIntersectItems","useFinalPosition","isPointInArea","inRange","getNearestCartesianItems","distanceMetric","useX","useY","deltaX","getDistanceMetricForAxis","minDistance","getCenterPoint","getNearestItems","getProps","getNearestRadialItems","getAxisItems","rangeMethod","intersectsItem","Interaction","modes","nearest","STATIC_POSITIONS","filterByPosition","filterDynamicPositionByAxis","sortByWeight","setLayoutDims","layouts","params","stackWeight","placed","buildStacks","vBoxMaxWidth","hBoxMaxHeight","layout","fullSize","availableHeight","getCombinedMax","maxPadding","updateMaxPadding","boxPadding","updateDims","getPadding","outerWidth","newHeight","outerHeight","widthChanged","heightChanged","same","other","getMargins","marginForPositions","fitBoxes","boxes","refitBoxes","refit","setBoxDims","placeBoxes","userPadding","addBox","_layers","z","removeBox","layoutItem","minPadding","layoutBoxes","wrapBoxes","centerHorizontal","centerVertical","leftAndTop","rightAndBottom","vertical","buildLayoutBoxes","verticalBoxes","horizontalBoxes","beforeLayout","visibleVerticalBoxCount","updatePos","change","handleMaxPadding","BasePlatform","acquireContext","releaseContext","isAttached","updateConfig","BasicPlatform","EXPANDO_KEY","EVENT_TYPES","touchstart","touchmove","touchend","pointerenter","pointerdown","pointermove","pointerup","pointerleave","pointerout","isNullOrEmpty","eventListenerOptions","removeListener","nodeListContains","nodeList","createAttachObserver","observer","MutationObserver","trigger","addedNodes","removedNodes","childList","subtree","createDetachObserver","drpListeningCharts","oldDevicePixelRatio","onWindowResize","dpr","createResizeObserver","contentRect","listenDevicePixelRatioChanges","releaseObserver","unlistenDevicePixelRatioChanges","createProxyAndListen","native","fromNativeEvent","addListener","DomPlatform","renderHeight","renderWidth","displayWidth","displayHeight","initCanvas","proxies","$proxies","attach","detach","isConnected","Element","tooltipPosition","hasValue","final","tickOpts","determinedMaxTicks","_tickSize","maxScale","maxChart","_maxLength","determineMaxTicks","ticksLimit","maxTicksLimit","majorIndices","enabled","getMajorIndices","numMajorIndices","first","newTicks","skipMajors","evenMajorSpacing","getEvenSpacing","factors","_factorize","calculateSpacing","avgMajorSpacing","majorStart","majorEnd","offsetFromEdge","getTicksLimit","ticksLength","sample","numItems","increment","getPixelForGridLine","offsetGridLines","validIndex","lineValue","getTickMarkLength","getTitleHeight","titleAlign","reverseAlign","Scale","_margins","paddingBottom","paddingRight","labelRotation","_range","_gridLineItems","_labelItems","_labelSizes","_longestTextCache","_userMax","_userMin","_suggestedMax","_suggestedMin","_ticksLength","_borderValue","_dataLimitsCached","suggestedMin","suggestedMax","metas","getTicks","xLabels","yLabels","getLabelItems","_computeLabelItems","beforeUpdate","sampleSize","beforeSetDimensions","setDimensions","afterSetDimensions","beforeDataLimits","determineDataLimits","afterDataLimits","minmax","keepZero","_addGrace","beforeBuildTicks","buildTicks","afterBuildTicks","samplingEnabled","_convertTicksToLabels","beforeCalculateLabelRotation","calculateLabelRotation","afterCalculateLabelRotation","afterAutoSkip","beforeFit","fit","afterFit","afterUpdate","reversePixels","_alignToPixels","alignToPixels","_callHooks","notifyPlugins","beforeTickToLabelConversion","generateTickLabels","afterTickToLabelConversion","numTicks","maxLabelDiagonal","_isVisible","labelSizes","_getLabelSizes","maxLabelWidth","maxLabelHeight","highest","asin","titleOpts","gridOpts","titleHeight","tickPadding","angleRadians","labelHeight","_calculatePadding","_handleMargins","isRotated","labelsBelowTicks","offsetRight","isFullSize","_computeLabelSizes","caches","widths","heights","tickFont","fontString","nestedLabel","widestLabelSize","highestLabelSize","_resolveTickFontOptions","valueAt","decimal","getDecimalForPixel","getBaseValue","createTickContext","optionTicks","rot","_computeGridLineItems","tl","borderOpts","axisWidth","axisHalfWidth","alignBorderValue","borderValue","alignedLineValue","tx1","ty1","tx2","ty2","positionAxisID","limit","optsAtIndex","optsAtIndexBorder","lineColor","tickBorderDash","tickBorderDashOffset","tickAndPadding","hTickAndPadding","lineCount","textOffset","_getXAxisLabelAlignment","_getYAxisLabelAlignment","halfCount","tickTextAlign","labelPadding","_computeLabelArea","drawBackground","drawGrid","drawLine","setLineDash","lineDashOffset","drawBorder","lastLineWidth","drawLabels","renderTextOptions","drawTitle","titleX","titleY","titleArgs","tz","gz","bz","_maxDigits","TypedRegistry","isForType","isPrototypeOf","register","parentScope","isIChartComponent","itemDefaults","defaultRoutes","routes","propertyParts","sourceName","sourceScope","routeDefaults","registerDefaults","unregister","Registry","_typedRegistries","_each","addControllers","addPlugins","addScales","getController","_get","getScale","removeControllers","removeElements","removePlugins","removeScales","typedRegistry","arg","reg","_getRegistryForType","_exec","itemReg","component","camelMethod","PluginService","_init","notify","hook","_createDescriptors","descriptor","cancelable","invalidate","_oldCache","_notifyStateChanges","localIds","allPlugins","getOpts","pluginOpts","createDescriptors","previousDescriptors","pluginScopeKeys","getIndexAxis","datasetDefaults","idMatchesAxis","axisFromPosition","determineAxis","scaleOptions","getAxisFromDataset","mergeScaleConfig","chartDefaults","configScales","chartIndexAxis","scaleConf","boundDs","retrieveAxisFromDatasets","defaultId","getDefaultScaleIDFromAxis","defaultScaleOptions","defaultID","getAxisFromDefaultScaleID","initOptions","initData","keyCache","keysCached","cachedKeys","generate","addIfFound","Config","_config","initConfig","_scopeCache","_resolverCache","clearCache","datasetType","additionalOptionScopes","_cachedScopes","mainScope","resetCache","keyLists","chartOptionScopes","subPrefixes","getResolver","hasFunction","needContext","resolverCache","KNOWN_POSITIONS","positionIsHorizontal","compare2Level","l1","l2","onAnimationsComplete","onComplete","onAnimationProgress","onProgress","getCanvas","getElementById","instances","getChart","moveNumericKeys","intKey","Chart","invalidatePlugins","userConfig","initialCanvas","existingChart","OffscreenCanvas","_detectPlatform","_options","_aspectRatio","_metasets","_lastEvent","_listeners","_responsiveListeners","_sortedMetasets","_plugins","_hiddenIndices","attached","_doResize","timeout","debounce","resizeDelay","_initialize","bindEvents","_resizeBeforeDraw","_resize","newSize","newRatio","onResize","ensureScalesHaveIDs","axisOptions","buildOrUpdateScales","scaleOpts","isRadial","dposition","dtype","scaleType","hasUpdated","_updateMetasets","_destroyDatasetMeta","_removeUnreferencedMetasets","buildOrUpdateControllers","newControllers","order","ControllerClass","_resetElements","animsDisabled","_updateScales","_checkEventBindings","_updateHiddenIndices","_minPadding","_updateLayout","_updateDatasets","_eventHandler","_updateHoverStyles","existingEvents","newEvents","unbindEvents","changes","_getUniformDataChanges","datasetCount","makeSet","changeSet","noArea","_idx","_updateDataset","layers","_drawDatasets","_drawDataset","getElementsAtEventForMode","setDatasetVisibility","_updateVisibility","_stop","destroy","toBase64Image","toDataURL","bindUserEvents","bindResponsiveEvents","_add","_remove","detached","updateHoverStyle","getActiveElements","setActiveElements","activeElements","lastActive","pluginId","replay","hoverOptions","deactivated","activated","inChartArea","eventFilter","_handleEvent","_getActiveElements","isClick","_isClickEvent","lastEvent","determineLastEvent","parseBorderRadius$1","angleDelta","halfThickness","innerLimit","computeOuterLimit","outerArcLimit","outerStart","outerEnd","innerStart","innerEnd","rThetaToXY","theta","pathArc","pixelMargin","innerR","spacingOffset","avNogSpacingRadius","angleOffset","outerStartAdjustedRadius","outerEndAdjustedRadius","outerStartAdjustedAngle","outerEndAdjustedAngle","innerStartAdjustedRadius","innerEndAdjustedRadius","innerStartAdjustedAngle","innerEndAdjustedAngle","outerMidAdjustedAngle","pCenter","innerMidAdjustedAngle","p8","outerStartX","outerStartY","outerEndX","outerEndY","fullCircles","inner","lineJoin","angleMargin","clipArc","selfJoin","outerAngleClip","innerAngleClip","clipWidth","clipSelf","setStyle","lineCap","pathVars","paramsStart","paramsEnd","segmentStart","segmentEnd","outside","pathSegment","lineMethod","stepped","getLineMethod","fastPathSegment","prevX","lastY","avgX","countX","pointIndex","drawX","truncX","_getSegmentMethod","usePath2D","Path2D","_path","strokePathWithCache","segmentMethod","strokePathDirect","LineElement","_points","_segments","_pointsUpdated","findStartAndEnd","solidSegments","_computeSegments","_interpolate","_getInterpolationMethod","interpolated","inRange$1","hitRadius","getBarBounds","half","skipOrLimit","boundingRects","maxW","maxH","parseBorderWidth","maxR","enableBorder","parseBorderRadius","skipX","skipY","addNormalRectPath","inflateRect","amount","refRect","ArcElement","chartX","chartY","rAdjust","nonZeroBetween","betweenAngles","withinRadius","halfAngle","halfRadius","radiusOffset","drawArc","BarElement","addRectPath","mouseX","mouseY","inXRange","inYRange","PointElement","hoverRadius","BORDER_COLORS","BACKGROUND_COLORS","getBorderColor","getBackgroundColor","getColorizer","colorizeDoughnutDataset","colorizePolarAreaDataset","colorizeDefaultDataset","containsColorsDefinitions","plugin_colors","forceOverride","_args","chartOptions","containsColorDefenition","colorizer","cleanDecimatedDataset","cleanDecimatedData","plugin_decimation","algorithm","beforeElementsUpdate","xAxis","getStartAndCountOfVisiblePointsSimplified","threshold","decimated","samples","bucketWidth","sampledIndex","endIndex","maxAreaPoint","maxArea","nextA","avgY","avgRangeStart","avgRangeEnd","avgRangeLength","rangeOffs","rangeTo","pointAx","pointAy","lttbDecimation","minIndex","maxIndex","startIndex","xMin","dx","lastIndex","intermediateIndex1","intermediateIndex2","minMaxDecimation","_getBounds","_findSegmentEnd","_getEdge","_createBoundaryLine","boundary","linePoints","_pointsFromSegments","_shouldApplyFill","_resolveTarget","propagate","visited","_decodeFill","fillOption","parseFillOption","firstCh","decodeTargetIndex","addPointsBelow","sourcePoint","linesBelow","postponed","findPoint","unshift","pointValue","firstValue","lastValue","simpleArc","getLineByIndex","sourcePoints","below","getLinesBelow","_buildStackLine","_getTargetValue","computeCircularBoundary","_getTargetPixel","computeLinearBoundary","computeBoundary","_drawfill","lineOpts","fillColor","clipVertical","clipHorizontal","doFill","clipY","lineLoop","clipX","tpoints","targetSegments","tgt","subBounds","fillSources","fillSource","notShape","clipBounds","interpolatedLineTo","targetLoop","interpolatedPoint","afterDatasetsUpdate","$filler","beforeDraw","drawTime","beforeDatasetsDraw","beforeDatasetDraw","getBoxSize","labelOpts","boxHeight","boxWidth","usePointStyle","pointStyleWidth","itemHeight","Legend","_added","legendHitBoxes","_hoveredItem","doughnutMode","legendItems","columnSizes","lineWidths","buildLabels","labelFont","_computeTitleHeight","_fitRows","_fitCols","hitboxes","_itemHeight","heightLimit","currentColWidth","currentColHeight","legendItemText","calculateItemWidth","fontLineHeight","calculateLegendItemHeight","calculateItemHeight","calculateItemSize","adjustHitBoxes","rtlHelper","hitbox","_draw","defaultColor","halfFontSize","textDirection","lineDash","drawOptions","SQRT2","yBoxTop","xBoxLeft","drawLegendBox","_textX","titleFont","titlePadding","topPaddingPlusHalfFontSize","_getLegendItemAt","hitBox","lh","handleEvent","onLeave","isListened","hoveredItem","sameItem","plugin_legend","_element","afterEvent","ci","useBorderRadius","Title","_padding","textSize","_drawArgs","fontOpts","plugin_title","titleBlock","createTitle","WeakMap","plugin_subtitle","positioners","average","xSet","eventPosition","nearestElement","tp","pushOrConcat","toPush","splitNewlines","createTooltipItem","formattedValue","getTooltipSize","bodyFont","footerFont","titleLineCount","footerLineCount","bodyLineItemCount","combinedBodyLength","bodyItem","before","after","beforeBody","afterBody","titleSpacing","titleMarginBottom","displayColors","bodySpacing","footerMarginTop","footerSpacing","widthPadding","maxLineWidth","determineXAlign","yAlign","chartWidth","xAlign","caretSize","caretPadding","doesNotFitWithAlign","determineAlignment","determineYAlign","getBackgroundPoint","alignment","paddingAndSize","alignX","alignY","getAlignedX","getBeforeAfterBodyLines","overrideCallbacks","defaultCallbacks","beforeTitle","tooltipItems","labelCount","afterTitle","beforeLabel","tooltipItem","labelColor","labelTextColor","bodyColor","labelPointStyle","afterLabel","beforeFooter","afterFooter","invokeCallbackWithFallback","Tooltip","_eventPosition","_size","_cachedAnimations","_tooltipItems","dataPoints","caretX","caretY","labelColors","labelPointStyles","labelTextColors","getTitle","getBeforeBody","getBody","bodyItems","scoped","getAfterBody","getFooter","_createItems","itemSort","positionAndSize","backgroundPoint","external","drawCaret","tooltipPoint","caretPosition","getCaretPosition","x3","y3","ptX","ptY","titleColor","_drawColorBox","colorX","rtlColorX","yOffSet","colorY","multiKeyBackground","outerX","innerX","strokeRect","drawBody","bodyAlign","bodyLineHeight","xLinePadding","fillLineOfText","bodyAlignForCalculation","textColor","drawFooter","footerAlign","footerColor","tooltipSize","quadraticCurveTo","_updateAnimationTarget","animX","animY","_willRender","hasTooltipContent","globalAlpha","positionChanged","_positionChanged","_ignoreReplayEvents","plugin_tooltip","afterInit","afterDraw","Colors","Decimation","Filler","SubTitle","findOrAddLabel","addedLabels","addIfString","lastIndexOf","_getLabelForValue","generateTicks$1","generationOptions","dataRange","precision","maxTicks","maxDigits","includeBounds","unit","maxSpaces","rmin","rmax","countDefined","minSpacing","niceMin","niceMax","numSpaces","rounded","almostWhole","decimalPlaces","relativeLabelSize","LinearScaleBase","_startValue","_endValue","_valueRange","handleTickRangeOptions","setMin","setMax","minSign","maxSign","getTickLimit","stepSize","computeTickLimit","LinearScale","log10Floor","changeExponent","isMajor","tickVal","steps","rangeExp","rangeStep","generateTicks","minExp","exp","startExp","lastTick","LogarithmicScale","_zero","getTickBackdropHeight","measureLabelSize","determineLimits","fitWithPointLabels","limits","valueCount","_pointLabels","pointLabelOpts","additionalAngle","centerPointLabels","getPointLabelContext","getPointPosition","drawingArea","plFont","updateLimits","setCenterPoint","_pointLabelItems","itemOpts","extra","createPointLabelItem","isNotOverlapped","buildPointLabelItems","hLimits","vLimits","outerDistance","pointLabelPosition","yForAngle","getTextAlignForAngle","leftForTextAlign","drawPointLabelBox","backdropLeft","backdropTop","backdropWidth","backdropHeight","pathRadiusLine","RadialLinearScale","animate","leftMovement","rightMovement","topMovement","bottomMovement","scalingFactor","getValueForDistanceFromCenter","scaledDistance","pointLabel","createPointLabelContext","distanceFromCenter","getBasePosition","getPointLabelPosition","drawPointLabels","gridLineOpts","drawRadiusLine","INTERVALS","millisecond","common","second","minute","hour","month","quarter","year","UNITS","sorter","adapter","_adapter","parser","isoWeekday","_parseOpts","determineUnitForAutoTicks","minUnit","capacity","interval","MAX_SAFE_INTEGER","addTick","time","timestamps","ticksFromTimestamps","majorUnit","setMajorTicks","TimeScale","displayFormats","_unit","_majorUnit","_offsets","_normalized","normalized","_applyBounds","_getLabelBounds","getLabelTimestamps","timeOpts","_generate","_filterBetween","_getLabelCapacity","determineUnitForFormatting","determineMajorUnit","initOffsets","offsetAfterAutoskip","getDecimalForValue","weekday","hasWeekday","getDataTimestamps","tooltipFormat","datetime","_tickFormatFunction","minorFormat","majorFormat","offsets","_getLabelSize","ticksOpts","tickLabelWidth","cosRotation","sinRotation","tickFontSize","exampleTime","exampleLabel","prevSource","nextSource","prevTarget","nextTarget","CategoryScale","_addedLabels","added","TimeSeriesScale","_table","_minPos","_tableRange","_getTimestampsForTable","buildLookupTable","registerables","getTaskStatus","getTaskType","VIEW_TYPE_PM_DASHBOARD","DashboardView","originalAssignees","miniChartsAsBars","filterAssigneeName","updateAssigneeFilter","focusChart","chartType","focusedChart","collectTasks","createStatusChartData","statusCounts","createTypeChartData","typeCounts","subtask","createAssigneeChartData","assigneeCounts","sortedAssignees","additionalColors","colorIndex","createAssigneeProjectChartData","projectAssigneeCounts","allAssignees","assigneeMap","totalA","assigneeTotals","createProjectStatusChartData","projectStatusCounts","counts","createAssigneeStatusChartData","assigneeStatusCounts","createProjectChartData","projectCounts","taskType","renderProjectBreakdown","projectStats","stats","summaryContainer","projectCard","header","statsGrid","completedEl","inProgressEl","notStartedEl","onHoldEl","epicEl","storyEl","subtaskEl","otherEl","completionRate","rateEl","renderAssigneeBreakdown","assigneeStats","chartsContainer","chartCard","chartData","miniCanvas","createBarChart","createPieChart","isMiniChart","isDarkMode","tooltipTextColor","toFixed","assigneeBtn","assigneeBtnText","assigneeCaret","assigneeDdOpen","assigneeDdEl","assigneeList","dashboardContent","dashboardGrid","gridTemplateColumns","backBtn","backIcon","marginBottom","focusedTitle","focusedData","mainChartCard","focusedCanvas","projectSummaryCard","projectStatusCard","gridColumn","projectStatusCanvas","projectStatusData","assigneeProjectCard","assigneeProjectCanvas","assigneeProjectData","assigneeChartsCard","statusCard","statusHeader","statusZoomBtn","statusZoomIcon","statusCanvas","statusData","typeCard","typeHeader","typeZoomBtn","typeZoomIcon","typeCanvas","typeData","assigneeCard","assigneeHeader","assigneeZoomBtn","assigneeZoomIcon","assigneeCanvas","assigneeData","projectHeader","projectZoomBtn","projectZoomIcon","projectCanvas","projectData","assigneeStatusCard","assigneeStatusHeader","assigneeStatusZoomBtn","assigneeStatusZoomIcon","assigneeStatusCanvas","assigneeStatusData","summaryCard","summaryStats","totalTasksDiv","completedTasksDiv","completionRateDiv","uniqueProjects","uniqueAssignees","projectsDiv","assigneesDiv","isTaskCompleted","getDaysUntilStart","testDate","getDaysUntilDue","VIEW_TYPE_PM_TODAY","TodayView","showSubtasksOnly","showCompleted","showOverdueOnly","lastScrollTop","collapsedSections","selectedDate","collectTodayTasks","extendedTask","aScore","calculateTaskScore","score","high","medium","none","daysUntilDue","dateRow","datePicker","onchange","filterControls","subtaskToggle","completedToggle","overdueToggle","projectKey","taskIndex","daysUntilStart","isCompleted","isSubtask","sections","assigneeGroups","assigneeTasks","sectionClass","emoji","renderTaskSection","section","sectionHeader","collapseIcon","hasClass","taskEl","taskHeader","onHoldIndicator","shouldTaskBeStarted","taskStatus","isInProgress","colorClass","startText","statusClass","dueText","taskDetails","projectEl","iconEl","VIEW_TYPE_PM_CALENDAR","CalendarView","filterDropdownOpen","assigneeDropdownOpen","cleanupPopups","collectTasksForPeriod","incompleteTasks","generateCalendarDays","days","startOfMonth","endOfMonth","startOfCalendar","endOfCalendar","dueTasks","startingTasks","getTasksForDate","isCurrentMonth","expansion","targetDate","isTaskDueOnDate","isTaskStartingOnDate","calendarView","existingContent","navControls","prevBtn","nextBtn","todayBtn","buildProjectDropdown","noAssignees","extTask","calendarContent","calendarGrid","renderMonthView","dayHeaders","dayName","daysGrid","weeks","weekNumber","mondayOfWeek","weekNum","renderDayCell","taskCount","taskIndicators","dueIndicator","startIndicator","showDayExpansion","existingExpansion","closeBtn","dueSection","highDue","medDue","lowDue","noneDue","highSection","renderTaskItem","medSection","lowSection","noneSection","startSection","startTasks","highStart","medStart","lowStart","noneStart","expansionRect","taskItem","taskMeta","dateSpan","VIEW_TYPE_PM_PORTFOLIO","PromptModal","resolveFn","btnBar","prompt","FolderSelectModal","FuzzySuggestModal","onPick","picked","getItems","getAllLoadedFiles","TFolder","getItemText","onChooseItem","PORT_DIR","SB_WIDTH_KEY","SB_COLLAPSE_KEY","PortfolioView","portfolios","selectedId","descTip","sortKey","sortDir","oldPath","configDir","newPath","mkdir","listing","files","targetPath","substring","write","err","migrateOldPortfolios","ensureFolder","loadPortfolios","lastSelected","lastSelectedPortfolio","lastPortfolio","registerEvent","descBox","sel","pf","descHeight","savePortfolio","getFiles","extension","pth","parseYaml","projectPaths","validPaths","invalidPaths","findFileByName","isProjectFile","matchingFile","updatedData","modified","updatedYaml","stringifyYaml","created","normalizedFileName","normalizedFile","frontMatterMatch","frontMatter","projectFlag","yaml","deletePortfolio","fileManager","trashFile","openProgress","reuseProgressPane","getLeavesOfType","splitActiveLeaf","setViewState","view","revealLeaf","openDashboard","openToday","openCalendar","openTimeline","toggleSort","sidebar","savedW","localStorage","getItem","onmousedown","setItem","panel","startW","isDragging","onMove","newW","listHeader","leftSide","briefcaseIcon","addBtn","ul","li","nameSpan","ren","newName","del","confirm","createWrap","createBtn","folder","createTaskBtn","openBtns","calendarBtn","icoCalendar","icoToday","dashboardBtn","icoDashboard","dashBtn","icoDash","tlBtn","icoTl","wkBtn","icoWk","openTaskWeeks","resBtn","icoRs","openResources","descRow","saveHeight","ro","saveDesc","tbl","headRow","nameHead","icoName","areaHead","icoArea","prioHead","icoPrio","projMeta","normKey","cacheFm","cat","pr","prio","metaA","metaB","isSelected","hoverEl","prioText","actCell","openDashboardFor","openTimelineFor","openTaskWeeksFor","icoRes","openResourcesFor","saveBtn","projFile","projName","reuseTimelinePane","reuseTaskWeeksPane","reuseResourcesPane","ProjectCache","makeTaskKey","_debug","dumpRows","dumpHeaders","getMarkdownFiles","flag","fileLines","listItems","firstLineRaw","tableTaskMatch","startIdx","endIdx","rawBlock","attributes","rowText","matchAll","depAttr","stripped","caretMatch","idCell","dueProperty","getProject","getTask","updateTask","propKeys","nextLineIdx","attrLine","regex","moveTaskToStatus","statusProperty","getProjectFiles","DEFAULT_SETTINGS","ownerProperty","statusValues","showBarShadows","barColorE","barColorS","barColorSB","completedBarLight","milestoneLineLight","barColorE_dark","barColorS_dark","barColorSB_dark","completedBarDark","milestoneLineDark","showProgressRibbon","showTimelineRibbon","showTaskRibbon","showResourcesRibbon","showCalendarRibbon","PmSettingsTab","PluginSettingTab","coreSection","timelineSection","addToggle","resourcesSection","taskWeeksSection","addSlider","setLimits","applyBarColours","lightColorsSection","addColorPicker","cp","darkColorsSection","ribbonSection","refreshRibbonIcons","paneReuseSection","ProjectManagementPlugin","Plugin","ribbons","addedPortfolio","onload","loadSettings","addCommand","activateProgress","activateTimeline","activatePortfolio","activateTaskWeeks","activateResources","activateDashboard","activateCalendar","registerView","menu","addItem","setTitle","addSettingTab","registerDomEvent","handleBarMove","handleBarResize","isInteger","fmMatch","blockLines","findIdx","idxS","idxE","getISO","newRaw","iS","iE","onunload","activeLeaf","pinned","loadData","migrated","showDashboardRibbon","reuseDashboardPane","saveData","refreshAllTimelines","documentElement","shiftIso","lineLower","stateObj","activateToday","addRibbonIcon","timeline","taskWeeks","resources","portfolio","calendar"],"mappings":"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"}